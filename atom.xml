<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>gtang94&#39;s note</title>
  
  <subtitle>gtang94的技术笔记</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2021-03-04T15:26:06.974Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>gtang94</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>GIT使用</title>
    <link href="http://yoursite.com/2021/03/04/GIT%E4%BD%BF%E7%94%A8/"/>
    <id>http://yoursite.com/2021/03/04/GIT%E4%BD%BF%E7%94%A8/</id>
    <published>2021-03-04T10:18:22.000Z</published>
    <updated>2021-03-04T15:26:06.974Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ALIAS"><a href="#ALIAS" class="headerlink" title="ALIAS"></a>ALIAS</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ~/.git/config</span></span><br><span class="line">ci = commit</span><br><span class="line">st = status</span><br><span class="line">co = checkout</span><br><span class="line">br = branch</span><br><span class="line">ss = status --short</span><br><span class="line">df = diff</span><br><span class="line">lo = <span class="built_in">log</span> --oneline</span><br><span class="line">lg = <span class="built_in">log</span> --color --graph --pretty=format:<span class="string">'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset'</span> --abbrev-commit</span><br></pre></td></tr></table></figure><h2 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h2><h3 id="常见分支"><a href="#常见分支" class="headerlink" title="常见分支"></a>常见分支</h3><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1614871446/74843131-c8748500-532b-11ea-9cd9-280d997a6563_uapny6.png" alt="images"></p><ul><li><p>master: 理论上只有一个最稳定的主分支</p></li><li><p>develop: 理论上只有一个待发布的开发分支</p></li><li><p>feature: 多个正在开发的分支</p></li><li><p>hotfix: </p><blockquote><ol><li><p>一般线上bug，可在develop分支切hotFix分支进行修改，完成后合并到develop(一般是release-*)，下次版本发布时一起发布。</p></li><li><p>紧急线上bug，应在master分支上切hotfix分支进行修改，完成后合并到master发布</p></li></ol></blockquote></li><li><p>release-*: 可能从develop分支切分而来，但一定要合并到develop和master分支上；该分支一般用来： </p><blockquote><ol><li><p>在发布前紧急修复细小bug </p></li><li><p>准备要发布的版本号等数据 </p></li><li><p>合并细小bug</p></li></ol></blockquote></li></ul><p><strong>注意：</strong></p><ol><li><p><strong>合并前使用merge -no-ff 生成合并记录</strong></p></li><li><p><strong>分支合并前提交pull request进行code review</strong></p></li></ol><h3 id="分支命名规范"><a href="#分支命名规范" class="headerlink" title="分支命名规范"></a>分支命名规范</h3><blockquote><p>git分支分为集成分支(develop)、功能分支(feature)和修复分支(hotfix)</p></blockquote><h4 id="集成分支"><a href="#集成分支" class="headerlink" title="集成分支"></a>集成分支</h4><ul><li><p>版本内的集成分支： feature/versions/{$version}</p></li><li><p>所有待发布功能的集成分支： develop</p></li></ul><h4 id="功能分支"><a href="#功能分支" class="headerlink" title="功能分支"></a>功能分支</h4><ul><li><p>版本功能分支(根据版本需求拆分的功能分支): <code>feature/{$version}/{$issue_id}_{description}</code></p></li><li><p>非版本功能分支(不跟版本一起上线的功能或者一些不紧急的bug): <code>feature/{$username}/{$issue_id}_{$description}</code></p></li></ul><blockquote><p><code>{$username}</code> 代表开发者，例如：tanggq<br><code>{$version}</code> 代表版本号，例如：v2.1.1<br><code>{$issue_id}</code> 代表gitee的Issue Id，例如： #ISSUE12345<br><code>{$description}</code> 代表分支功能简短描述</p></blockquote><h4 id="修复分支"><a href="#修复分支" class="headerlink" title="修复分支"></a>修复分支</h4><ul><li>线上bug分支: <code>hotfix/{$username}/{$issue_id}_{$description}</code></li></ul><h2 id="提交"><a href="#提交" class="headerlink" title="提交"></a>提交</h2><h3 id="约定式提交规范"><a href="#约定式提交规范" class="headerlink" title="约定式提交规范"></a>约定式提交规范</h3><p>约定式提交规范是使用最广泛的git提交规范，源自<a href="https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#-git-commit-guidelines" target="_blank" rel="noopener">Angular JS</a>，提交格式如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">type</span>&gt;(&lt;scope&gt;): &lt;subject&gt;</span><br><span class="line">//&lt;BLANK LINE&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">//&lt;BLANK LINE&gt;</span><br><span class="line">&lt;footer&gt;</span><br></pre></td></tr></table></figure><h3 id="规范说明"><a href="#规范说明" class="headerlink" title="规范说明"></a>规范说明</h3><ol><li><code>&lt;type&gt;</code> 是提交类型，必须是以下类型中的一个：</li></ol><ul><li>feat：增加一个新功能</li><li>fix：修复bug</li><li>docs：只修改了文档</li><li>style：做了不影响代码含义的修改，空格、格式化、缺少分号等等</li><li>refactor：代码重构，既不是修复bug，也不是新功能的修改</li><li>perf：改进性能的代码</li><li>test：增加测试或更新已有的测试</li><li>chore：构建或辅助工具或依赖库的更新</li></ul><ol start="2"><li><p><code>(&lt;scope&gt;)</code> 可选，表示影响的范围、功能、模块</p></li><li><p><code>&lt;subject&gt;</code> 简单说明，不超过50个字</p></li><li><p><code>&lt;body&gt;</code> 选填，用于填写更详细的描述，可以分成多行。 无重大变更一般不写</p></li><li><p><code>&lt;footer&gt;</code> 选填，用于关联issue，一般是关联issue、关闭issue</p></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ALIAS&quot;&gt;&lt;a href=&quot;#ALIAS&quot; class=&quot;headerlink&quot; title=&quot;ALIAS&quot;&gt;&lt;/a&gt;ALIAS&lt;/h2&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;p
      
    
    </summary>
    
    
      <category term="架构" scheme="http://yoursite.com/categories/%E6%9E%B6%E6%9E%84/"/>
    
    
      <category term="alias" scheme="http://yoursite.com/tags/alias/"/>
    
      <category term="branch" scheme="http://yoursite.com/tags/branch/"/>
    
      <category term="commit" scheme="http://yoursite.com/tags/commit/"/>
    
  </entry>
  
  <entry>
    <title>yum update的破坏性</title>
    <link href="http://yoursite.com/2021/02/10/yum-update%E7%9A%84%E7%A0%B4%E5%8C%96%E6%80%A7/"/>
    <id>http://yoursite.com/2021/02/10/yum-update%E7%9A%84%E7%A0%B4%E5%8C%96%E6%80%A7/</id>
    <published>2021-02-10T09:24:29.000Z</published>
    <updated>2021-02-18T12:02:05.106Z</updated>
    
    <content type="html"><![CDATA[<h2 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h2><blockquote><p>yum 是一款自动化升级、安装、卸载rpm安装包的工具。 yum是使用一个中心仓库管理一部分应用程序的依赖关系，根据计算出来的依赖关系进行相关的升级、安装、更新等操作。</p></blockquote><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><blockquote><ul><li>可以同时配置多个资源库</li></ul></blockquote><blockquote><ul><li>配置文件简洁（/etc/yum.conf）</li></ul></blockquote><blockquote><ul><li>自动化处理更新rpm包时遇到的依赖问题</li></ul></blockquote><blockquote><ul><li>与rpm数据库一致</li></ul></blockquote><h2 id="yum-update的造成的影响"><a href="#yum-update的造成的影响" class="headerlink" title="yum update的造成的影响"></a>yum update的造成的影响</h2><blockquote><ul><li>升级内核</li></ul></blockquote><blockquote><ul><li>升级linux发行版本</li></ul></blockquote><blockquote><ul><li>升级所有包</li></ul></blockquote><blockquote><ul><li>改变软件设置和系统设置</li></ul></blockquote><h2 id="避免升级影响系统"><a href="#避免升级影响系统" class="headerlink" title="避免升级影响系统"></a>避免升级影响系统</h2><h3 id="update升级系统和发行版"><a href="#update升级系统和发行版" class="headerlink" title="update升级系统和发行版"></a>update升级系统和发行版</h3><blockquote><p>修改yum.conf配置文件，update时忽略内核和发行版</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># echo -e "\nexclude=kernel* \nexclude=centos-release*" &gt;&gt; /etc/yum.conf</span></span><br></pre></td></tr></table></figure><h4 id="对比升级前后"><a href="#对比升级前后" class="headerlink" title="对比升级前后"></a>对比升级前后</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># uname -a</span></span><br><span class="line">Linux iZm5ei1yo0mi0y72r6dyoxZ 3.10.0-1062.12.1.el7.x86_64 <span class="comment">#1 SMP Tue Feb 4 23:02:59 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># cat /etc/centos-release</span></span><br><span class="line">CentOS Linux release 7.6.1810 (Core) </span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># </span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># yum update</span></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># uname -a</span></span><br><span class="line">Linux iZm5ei1yo0mi0y72r6dyoxZ 3.10.0-1062.12.1.el7.x86_64 <span class="comment">#1 SMP Tue Feb 4 23:02:59 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># cat /etc/centos-release</span></span><br><span class="line">CentOS Linux release 7.6.1810 (Core) </span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="upgrade升级"><a href="#upgrade升级" class="headerlink" title="upgrade升级"></a>upgrade升级</h3><blockquote><p>upgrade时只升级所有包，不升级软件和系统内核</p></blockquote><h4 id="对比升级前后-1"><a href="#对比升级前后-1" class="headerlink" title="对比升级前后"></a>对比升级前后</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除/etc/yum.conf配置文件中的“exclude=kernel* exclude=centos-release*”</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># uname -a</span></span><br><span class="line">Linux iZm5ei1yo0mi0y72r6dyoxZ 3.10.0-1062.12.1.el7.x86_64 <span class="comment">#1 SMP Tue Feb 4 23:02:59 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># cat /etc/centos-release</span></span><br><span class="line">CentOS Linux release 7.6.1810 (Core) </span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># yum -y upgrade</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># uname -a</span></span><br><span class="line">Linux iZm5ei1yo0mi0y72r6dyoxZ 3.10.0-1062.12.1.el7.x86_64 <span class="comment">#1 SMP Tue Feb 4 23:02:59 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># cat /etc/centos-release</span></span><br><span class="line">CentOS Linux release 7.6.1810 (Core) </span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="误升级的回退"><a href="#误升级的回退" class="headerlink" title="误升级的回退"></a>误升级的回退</h2><h3 id="内核回退"><a href="#内核回退" class="headerlink" title="内核回退"></a>内核回退</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前内核版本</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># uname -r</span></span><br><span class="line">3.10.0-1062.12.1.el7.x86_64</span><br><span class="line"><span class="comment"># 查看当前内核详细信息</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># hostnamectl </span></span><br><span class="line">   Static hostname: iZm5ei1yo0mi0y72r6dyoxZ</span><br><span class="line">         Icon name: computer-vm</span><br><span class="line">           Chassis: vm</span><br><span class="line">        Machine ID: 20200220105402131453637367482142</span><br><span class="line">           Boot ID: f77698effc3d4250a195982dc8510977</span><br><span class="line">    Virtualization: kvm</span><br><span class="line">  Operating System: CentOS Linux 7 (Core)</span><br><span class="line">       CPE OS Name: cpe:/o:centos:centos:7</span><br><span class="line">            Kernel: Linux 3.10.0-1062.12.1.el7.x86_64</span><br><span class="line">      Architecture: x86-64</span><br><span class="line"><span class="comment"># 查看历史内核信息</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># cat /boot/grub2/grub.cfg |grep menuentry</span></span><br><span class="line"><span class="keyword">if</span> [ x<span class="string">"<span class="variable">$&#123;feature_menuentry_id&#125;</span>"</span> = xy ]; <span class="keyword">then</span></span><br><span class="line">  menuentry_id_option=<span class="string">"--id"</span></span><br><span class="line">  menuentry_id_option=<span class="string">""</span></span><br><span class="line"><span class="built_in">export</span> menuentry_id_option</span><br><span class="line">menuentry <span class="string">'CentOS Linux (3.10.0-1160.15.2.el7.x86_64) 7 (Core)'</span> --class centos --class gnu-linux --class gnu --class os --unrestricted <span class="variable">$menuentry_id_option</span> <span class="string">'gnulinux-3.10.0-1062.12.1.el7.x86_64-advanced-bdb48242-7da4-491c-ad1a-ae0994a965c9'</span> &#123;</span><br><span class="line">menuentry <span class="string">'CentOS Linux (3.10.0-1062.12.1.el7.x86_64) 7 (Core)'</span> --class centos --class gnu-linux --class gnu --class os --unrestricted <span class="variable">$menuentry_id_option</span> <span class="string">'gnulinux-3.10.0-1062.12.1.el7.x86_64-advanced-bdb48242-7da4-491c-ad1a-ae0994a965c9'</span> &#123;</span><br><span class="line">menuentry <span class="string">'CentOS Linux (3.10.0-1062.el7.x86_64) 7 (Core)'</span> --class centos --class gnu-linux --class gnu --class os --unrestricted <span class="variable">$menuentry_id_option</span> <span class="string">'gnulinux-3.10.0-1062.el7.x86_64-advanced-bdb48242-7da4-491c-ad1a-ae0994a965c9'</span> &#123;</span><br><span class="line">menuentry <span class="string">'CentOS Linux (0-rescue-20200220105402131453637367482142) 7 (Core)'</span> --class centos --class gnu-linux --class gnu --class os --unrestricted <span class="variable">$menuentry_id_option</span> <span class="string">'gnulinux-0-rescue-20200220105402131453637367482142-advanced-bdb48242-7da4-491c-ad1a-ae0994a965c9'</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前已设置的内核信息（可能未生效）</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># grub2-editenv list</span></span><br><span class="line">saved_entry=CentOS Linux (3.10.0-1062.12.1.el7.x86_64) 7 (Core)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置内核</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># grub2-set-default "CentOS Linux (3.10.0-1160.15.2.el7.x86_64) 7 (Core)"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># reboot</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启后查看是否生效</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># uname -r</span></span><br><span class="line">3.10.0-1160.15.2.el7.x86_64</span><br></pre></td></tr></table></figure><h3 id="发行版回退"><a href="#发行版回退" class="headerlink" title="发行版回退"></a>发行版回退</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 已存在的centos发行版的包</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># rpm -qa | grep centos-release</span></span><br><span class="line">centos-release-scl-2-3.el7.centos.noarch</span><br><span class="line">centos-release-scl-rh-2-3.el7.centos.noarch</span><br><span class="line">centos-release-7-9.2009.1.el7.centos.x86_64</span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载某版本的发行包</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># wget http://vault.centos.org/7.6.1810/os/x86_64/Packages/centos-release-7-6.1810.2.el7.centos.x86_64.rpm</span></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制回退到某个发行版本</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># rpm -ivh centos-release-7-6.1810.2.el7.centos.x86_64.rpm --force</span></span><br><span class="line">Preparing...                          <span class="comment">################################# [100%]</span></span><br><span class="line">Updating / installing...</span><br><span class="line">   1:centos-release-7-6.1810.2.el7.cen<span class="comment">################################# [100%]</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 已存在的centos发行版的包</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># rpm -qa | grep centos-release</span></span><br><span class="line">centos-release-scl-2-3.el7.centos.noarch</span><br><span class="line">centos-release-scl-rh-2-3.el7.centos.noarch</span><br><span class="line">centos-release-7-9.2009.1.el7.centos.x86_64</span><br><span class="line">centos-release-7-6.1810.2.el7.centos.x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回退确认</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># cat /etc/centos-release</span></span><br><span class="line">CentOS Linux release 7.6.1810 (Core) </span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment"># uname -r</span></span><br><span class="line">3.10.0-1160.15.2.el7.x86_64</span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;yum&quot;&gt;&lt;a href=&quot;#yum&quot; class=&quot;headerlink&quot; title=&quot;yum&quot;&gt;&lt;/a&gt;yum&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;yum 是一款自动化升级、安装、卸载rpm安装包的工具。 yum是使用一个中心仓库管理一部分应用程序的依赖
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="CentOS" scheme="http://yoursite.com/tags/CentOS/"/>
    
      <category term="yum update" scheme="http://yoursite.com/tags/yum-update/"/>
    
  </entry>
  
  <entry>
    <title>Ant</title>
    <link href="http://yoursite.com/2021/02/08/Ant/"/>
    <id>http://yoursite.com/2021/02/08/Ant/</id>
    <published>2021-02-08T05:20:01.000Z</published>
    <updated>2021-03-04T15:26:28.789Z</updated>
    
    <content type="html"><![CDATA[<h2 id="WHAT"><a href="#WHAT" class="headerlink" title="WHAT"></a>WHAT</h2><h3 id="Ant"><a href="#Ant" class="headerlink" title="Ant"></a>Ant</h3><blockquote><p>Apache Ant 是一个Java编写的命令行工具，主要是用来驱动构建文件中的描述的进程作为彼此依赖的目标和扩展点。 Ant主要是用来构建Java应用程序，当然也可以构建C和C++程序。</p></blockquote><h3 id="Ant-和-Maven区别"><a href="#Ant-和-Maven区别" class="headerlink" title="Ant 和 Maven区别"></a>Ant 和 Maven区别</h3><blockquote><p>Maven 是一个软件项目管理工具，基于POM(项目对象)模型的概念。 Maven可以从中央仓库获取程序依赖包，用以项目的编译、打包、发布等。 Maven有三套独立的生命周期：clean周期、default周期、site周期，clean周期又有以下阶段：pre-clean、clean、post-clean。 执行mvn clean时，必须按顺序先执行pre-clean，再执行clean</p></blockquote><blockquote><p>Ant 没有生命周期，所有的操作都需要手动去创建、部署</p></blockquote><h3 id="Ant的优势"><a href="#Ant的优势" class="headerlink" title="Ant的优势"></a>Ant的优势</h3><blockquote><ul><li>跨平台</li></ul></blockquote><blockquote><ul><li>语法清晰、 使用简单（与make比，不敢和maven比）</li></ul></blockquote><h2 id="HOW"><a href="#HOW" class="headerlink" title="HOW"></a>HOW</h2><h3 id="Ant环境配置"><a href="#Ant环境配置" class="headerlink" title="Ant环境配置"></a>Ant环境配置</h3><h4 id="JDK安装"><a href="#JDK安装" class="headerlink" title="JDK安装"></a>JDK安装</h4><blockquote><p>略</p></blockquote><h4 id="Ant下载"><a href="#Ant下载" class="headerlink" title="Ant下载"></a>Ant下载</h4><blockquote><p><a href="https://ant.apache.org/bindownload.cgi" target="_blank" rel="noopener">https://ant.apache.org/bindownload.cgi</a></p></blockquote><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ /]<span class="comment"># cd /usr/local/src</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ src]<span class="comment"># mkdir /usr/local/apache</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ src]<span class="comment"># tar zxvf apache-ant-1.9.15-bin.tar.gz -C /usr/local/apache/</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ src]<span class="comment"># echo -e "\nANT_HOME=/usr/local/apache/apache-ant-1.9.15\nPATH=$&#123;ANT_HOME&#125;/bin:$PATH" &gt;&gt; /etc/profile</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ src]<span class="comment"># source /etc/profile</span></span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ src]<span class="comment"># ant -version</span></span><br><span class="line">Apache Ant(TM) version 1.9.15 compiled on May 10 2020</span><br></pre></td></tr></table></figure><h3 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h3><h4 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-8-centos tmp]<span class="comment"># mkdir -p /tmp/test/src/club/hermit</span></span><br><span class="line">[root@VM-0-8-centos tmp]<span class="comment"># mkdir -p /tmp/test/classes</span></span><br></pre></td></tr></table></figure><h4 id="App-java-tmp-test-src-club-hermit-App-java"><a href="#App-java-tmp-test-src-club-hermit-App-java" class="headerlink" title="App.java(/tmp/test/src/club/hermit/App.java)"></a>App.java(/tmp/test/src/club/hermit/App.java)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"this is a ant build test application"</span>);</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="build-xml-tmp-test-build-xml"><a href="#build-xml-tmp-test-build-xml" class="headerlink" title="build.xml(/tmp/test/build.xml)"></a>build.xml(/tmp/test/build.xml)</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">name</span>=<span class="string">"Ant Test"</span> <span class="attr">default</span>=<span class="string">"compile"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"root"</span> <span class="attr">value</span>=<span class="string">"/tmp/test"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">"compile"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">delete</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">"classes"</span> <span class="attr">includes</span>=<span class="string">"**/*.class"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javac</span> <span class="attr">srcdir</span>=<span class="string">"src"</span> <span class="attr">destdir</span>=<span class="string">"classes"</span> <span class="attr">includeantruntime</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">"clean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">delete</span> <span class="attr">dir</span>=<span class="string">"classes"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">"run"</span> <span class="attr">depends</span>=<span class="string">"compile"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java</span> <span class="attr">classname</span>=<span class="string">"club.hermit.App"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">classpath</span> <span class="attr">path</span>=<span class="string">"classes"</span>&gt;</span><span class="tag">&lt;/<span class="name">classpath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">java</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="run"><a href="#run" class="headerlink" title="run"></a>run</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ <span class="built_in">test</span>]<span class="comment"># ant run</span></span><br><span class="line">Buildfile: /tmp/<span class="built_in">test</span>/build.xml</span><br><span class="line"></span><br><span class="line">compile:</span><br><span class="line">    [javac] Compiling 1 <span class="built_in">source</span> file to /tmp/<span class="built_in">test</span>/classes</span><br><span class="line"></span><br><span class="line">run:</span><br><span class="line">     [java] this is a ant build <span class="built_in">test</span> application</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL</span><br><span class="line">Total time: 1 second</span><br><span class="line">[root@iZm5ei1yo0mi0y72r6dyoxZ <span class="built_in">test</span>]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><ul><li><a href="https://iowiki.com/ant/ant_build_files.html" target="_blank" rel="noopener">Ant</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;WHAT&quot;&gt;&lt;a href=&quot;#WHAT&quot; class=&quot;headerlink&quot; title=&quot;WHAT&quot;&gt;&lt;/a&gt;WHAT&lt;/h2&gt;&lt;h3 id=&quot;Ant&quot;&gt;&lt;a href=&quot;#Ant&quot; class=&quot;headerlink&quot; title=&quot;Ant&quot;&gt;&lt;/a&gt;An
      
    
    </summary>
    
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Apache Ant" scheme="http://yoursite.com/tags/Apache-Ant/"/>
    
      <category term="编译工具" scheme="http://yoursite.com/tags/%E7%BC%96%E8%AF%91%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>Optional</title>
    <link href="http://yoursite.com/2020/11/24/Optional/"/>
    <id>http://yoursite.com/2020/11/24/Optional/</id>
    <published>2020-11-23T17:10:00.000Z</published>
    <updated>2020-11-23T17:12:14.161Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>空指针异常是Java中最常出现的异常，JDK8中使用Optional包装对象和解决空指针异常的一系列问题</p></blockquote><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Optional</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Common instance for &#123;<span class="doctag">@code</span> empty()&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Optional&lt;?&gt; EMPTY = <span class="keyword">new</span> Optional&lt;&gt;();</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * If non-null, the value; if null, indicates no value is present</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> T value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs an empty instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@implNote</span> Generally only one empty instance, &#123;<span class="doctag">@link</span> Optional#EMPTY&#125;,</span></span><br><span class="line"><span class="comment">     * should exist per VM.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Optional</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs an instance with the value present.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value the non-null value to be present</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if value is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Optional</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = Objects.requireNonNull(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>该类支持泛型，其属性value可以是任意类型T</li><li>该类有两个构造方法，且都是<code>private</code>，也即不能用外部构造该类的实例</li></ul></blockquote><h2 id="Api"><a href="#Api" class="headerlink" title="Api"></a>Api</h2><table><thead><tr><th>方法</th><th>介绍</th></tr></thead><tbody><tr><td><code>public static&lt;T&gt; Optional&lt;T&gt; empty()</code></td><td>该方法返回一个空的Optional实例，该实例的value为空</td></tr><tr><td><code>public static &lt;T&gt; Optional&lt;T&gt; of(T value)</code></td><td>根据传入的非空的value构造Optional实例</td></tr><tr><td><code>public static &lt;T&gt; Optional&lt;T&gt; ofNullable(T value)</code></td><td>根据传入的value构造Optional实例。如果传入的是非空的value，则和of(T value)一样；如果传入的是空的value，则调用empty()方法实例化Optional</td></tr><tr><td><code>public T get()</code></td><td>如果容器非空，则返回Optional的值，否则抛出NoSuchElementException异常</td></tr><tr><td><code>public boolean isPresent()</code></td><td>判断当前的Optional是否已经设置了值</td></tr><tr><td><code>public void ifPresent(Consumer&lt;? super T&gt; consumer)</code></td><td>判断当前Optional是否已设置了值，如果有值，则调用Consumer函数式接口进行处理</td></tr><tr><td><code>public Optional&lt;T&gt; filter(Predicate&lt;? super T&gt; predicate)</code></td><td>如果设置了值，且满足Predicate的判读条件，则返回该Optional，否则返回一个空的Optional</td></tr><tr><td><code>public&lt;U&gt; Optional&lt;U&gt; map(Function&lt;? super T, ? extends U&gt; mapper)</code></td><td>如果Optional设置了value，则调用Function进行处理，并返回包含处理后值的Optional，否则返回空的Optional</td></tr><tr><td><code>public&lt;U&gt; Optional&lt;U&gt; flatMap(Function&lt;? super T, Optional&lt;U&gt;&gt; mapper)</code></td><td>与map()方法类似，但他的mapper结构已经是一个Optional，不需要再对结果进行包装</td></tr><tr><td><code>public T orElse(T other)</code></td><td>如果Optional的值不为空，则返回该值，否则返回other</td></tr><tr><td><code>public T orElseGet(Supplier&lt;? extends T&gt; other)</code></td><td>如果Optional值不为空，则返回该值，否则根据other另外生成一个</td></tr><tr><td><code>public &lt;X extends Throwable&gt; T orElseThrow(Supplier&lt;? extends X&gt; exceptionSupplier) throws X</code></td><td>如果Option值不为空，则返回该值，否则通过supplier抛出一个异常</td></tr></tbody></table><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">JDK8之前：</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (msg != <span class="keyword">null</span>) &#123;</span><br><span class="line">System.out.println(msg);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">JDK8:</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">  Optional.ofNullable(msg)</span><br><span class="line">    .ifPresent(System.out.println(msg))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">JDK8之前：</span><br><span class="line"><span class="keyword">if</span> ( user != <span class="keyword">null</span>) &#123;</span><br><span class="line">  doSomething(user);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">JDK8：</span><br><span class="line">Optional.ofNullable（user）</span><br><span class="line">.ifPresent(u-&gt;&#123;</span><br><span class="line">doSomething(u);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">JDK8之前：</span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (user != <span class="keyword">null</span>) &#123;</span><br><span class="line">String name = user.getName();</span><br><span class="line"><span class="keyword">if</span> (<span class="string">"zhangsan"</span>.equals(name)) &#123;</span><br><span class="line"><span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">user = <span class="keyword">new</span> User();</span><br><span class="line">user.setName(<span class="string">"zhangsan"</span>);</span><br><span class="line"><span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">JDK8:</span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Optional.ofNullable(user)</span><br><span class="line">    .filter(u-&gt;<span class="string">"zhangsan"</span>.equals(u.getName()))</span><br><span class="line">    .orElseGet(() -&gt; &#123;</span><br><span class="line">      User user1 = <span class="keyword">new</span> User();</span><br><span class="line">      user1.setName(<span class="string">"zhangsan"</span>);</span><br><span class="line">      <span class="keyword">return</span> user1;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;空指针异常是Java中最常出现的异常，JDK8中使用Optional包装对象和解决空指针异常的一系列问题&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简
      
    
    </summary>
    
    
      <category term="源码分析" scheme="http://yoursite.com/categories/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="JDK8" scheme="http://yoursite.com/tags/JDK8/"/>
    
      <category term="Optional" scheme="http://yoursite.com/tags/Optional/"/>
    
  </entry>
  
  <entry>
    <title>Nginx安装</title>
    <link href="http://yoursite.com/2020/11/21/Nginx%E5%AE%89%E8%A3%85/"/>
    <id>http://yoursite.com/2020/11/21/Nginx%E5%AE%89%E8%A3%85/</id>
    <published>2020-11-21T03:48:00.000Z</published>
    <updated>2020-11-21T17:22:04.916Z</updated>
    
    <content type="html"><![CDATA[<h2 id="包下载-amp-依赖安装"><a href="#包下载-amp-依赖安装" class="headerlink" title="包下载&amp;依赖安装"></a>包下载&amp;依赖安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-8-centos ~]<span class="comment"># cd /usr/local/src/</span></span><br></pre></td></tr></table></figure><h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><blockquote><p><a href="https://nginx.org/en/download.html" target="_blank" rel="noopener">Nginx</a></p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-8-centos src]<span class="comment"># wget http://nginx.org/download/nginx-1.10.2.tar.gz</span></span><br></pre></td></tr></table></figure><h3 id="OpenSSL"><a href="#OpenSSL" class="headerlink" title="OpenSSL"></a>OpenSSL</h3><blockquote><p><a href="https://www.openssl.org/" target="_blank" rel="noopener">OpenSSL</a></p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-8-centos src]<span class="comment"># wget http://www.openssl.org/source/openssl-fips-2.0.10.tar.gz</span></span><br><span class="line">[root@VM-0-8-centos src]<span class="comment"># tar zxvf openssl-fips-2.0.10.tar.gz</span></span><br><span class="line">[root@VM-0-8-centos src]<span class="comment"># cd openssl-fips-2.0.10/</span></span><br><span class="line">[root@VM-0-8-centos openssl-fips-2.0.10]<span class="comment"># ./config &amp;&amp; make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><h3 id="zlib"><a href="#zlib" class="headerlink" title="zlib"></a>zlib</h3><blockquote><p><a href="http://www.zlib.net/" target="_blank" rel="noopener">zlib</a></p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-8-centos src]<span class="comment"># wget http://zlib.net/zlib-1.2.11.tar.gz</span></span><br><span class="line">[root@VM-0-8-centos src]<span class="comment"># tar zxvf zlib-1.2.11.tar.gz</span></span><br><span class="line">[root@VM-0-8-centos src]<span class="comment"># cd zlib-1.2.11/</span></span><br><span class="line">[root@VM-0-8-centos zlib-1.2.11]<span class="comment"># ./configure &amp;&amp; make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><h3 id="pcre"><a href="#pcre" class="headerlink" title="pcre"></a>pcre</h3><blockquote><p><a href="http://www.pcre.org/" target="_blank" rel="noopener">pcre</a></p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-8-centos src]<span class="comment"># wget https://ftp.pcre.org/pub/pcre/pcre-8.40.tar.gz</span></span><br><span class="line">[root@VM-0-8-centos src]<span class="comment"># tar zxvf pcre-8.40.tar.gz</span></span><br><span class="line">[root@VM-0-8-centos src]<span class="comment"># cd pcre-8.40/</span></span><br><span class="line">[root@VM-0-8-centos pcre-8.40]<span class="comment"># ./configure &amp;&amp; make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><h3 id="C-依赖"><a href="#C-依赖" class="headerlink" title="C++依赖"></a>C++依赖</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-8-centos src]<span class="comment"># yum install gcc-c++</span></span><br></pre></td></tr></table></figure><h2 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-8-centos src]<span class="comment"># tar zxvf nginx-1.10.2.tar.gz</span></span><br><span class="line">[root@VM-0-8-centos src]<span class="comment"># cd nginx-1.10.2/</span></span><br><span class="line">[root@VM-0-8-centos nginx-1.10.2]<span class="comment"># ./configure &amp;&amp; make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><h3 id="启动Nginx"><a href="#启动Nginx" class="headerlink" title="启动Nginx"></a>启动Nginx</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-8-centos sbin]<span class="comment"># /usr/local/nginx/sbin/nginx</span></span><br></pre></td></tr></table></figure><h2 id="Nginx配置"><a href="#Nginx配置" class="headerlink" title="Nginx配置"></a>Nginx配置</h2><h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;包下载-amp-依赖安装&quot;&gt;&lt;a href=&quot;#包下载-amp-依赖安装&quot; class=&quot;headerlink&quot; title=&quot;包下载&amp;amp;依赖安装&quot;&gt;&lt;/a&gt;包下载&amp;amp;依赖安装&lt;/h2&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;tab
      
    
    </summary>
    
    
      <category term="环境配置" scheme="http://yoursite.com/categories/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    
    
      <category term="nginx" scheme="http://yoursite.com/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>Shiro</title>
    <link href="http://yoursite.com/2020/11/01/Shiro/"/>
    <id>http://yoursite.com/2020/11/01/Shiro/</id>
    <published>2020-11-01T07:20:12.000Z</published>
    <updated>2020-11-01T15:56:38.649Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Shiro简介"><a href="#Shiro简介" class="headerlink" title="Shiro简介"></a>Shiro简介</h2><blockquote><p>shiro是java安全框架，shiro不会去维护用户、也不会去维护权限，需要程序员自己自己这些，shiro框架提供对交互过程的处理。</p></blockquote><blockquote><p>shiro可以完成以下基本功能：</p><ul><li>Authentication: 身份认证、登录，验证用户是否拥有相应身份</li><li>Authorization: 授权（权限验证）,即验证某个已认证得用户是否拥有某个权限</li><li>Session Management: 会话管理(Session管理)</li><li>Cryptograhpy: 加密</li></ul><p>也可完成以下高级功能：</p><ul><li>Web Support: 集成到web环境</li><li>Caching: 缓存，在用户登录后，将用户的基本信息、权限信息缓存到cache中，减小DB的压力、提供查询效率</li><li>Concurrency: 支持多线程应用的并发验证，如在一个线程中开启另一个线程，通过shiro可以自动将权限传递过去</li><li>Testing: 提供测试支持</li><li>Run as: 允许一个用户假装成另一个用户去访问</li><li>Remember me: 一次登录后，下次再来的会话不用再次登录</li></ul></blockquote><h3 id="从应用程序角度看shiro"><a href="#从应用程序角度看shiro" class="headerlink" title="从应用程序角度看shiro"></a>从应用程序角度看shiro</h3><p><img src="https://atts.w3cschool.cn/attachments/image/wk/shiro/2.png" alt="images"></p><blockquote><ul><li>subject: 主体。 代表了当前“用户”，是一个抽象概念。 这个subject可以是人，也可以是程序。所有的subject都绑定到securitymanager上，即对subject的所有操作，实际都是securitymanager去执行的。 subject和slf4j类似，都起门面的作用。</li><li>securitymanager: 安全管理器。 是shrio的核心，管理这所有的subject，也就是管理着所有和安全有关的操作。</li><li>域，realm相当于dataSources，是securitymanager的数据源，securitymanager操作时所有的用户数据、权限数据都是从这个realm中获取的。</li></ul></blockquote><blockquote><p>所以，对于应用程序来说，使用Shiro时包含以下两步：</p><ol><li>通过subject提供的API进行应用的认证、授权</li><li>向shiro框架提供数据源，即Realm</li></ol></blockquote><h3 id="从框架内部看shiro"><a href="#从框架内部看shiro" class="headerlink" title="从框架内部看shiro"></a>从框架内部看shiro</h3><p><img src="https://atts.w3cschool.cn/attachments/image/wk/shiro/3.png" alt="images"></p><blockquote><p>Subject: 主体，可以看到subject可以是任何可以使用shiro的application</p><p>Security Manager: shiro框架的核心，它管理者所有的Subject，负责进行认证、授权、会话、缓存的管理</p><p>Authenticator: 认证器，负责主体的认证，如果用户觉得Shiro默认的不好用，则可以自定义实现。Authenticator中的Authentication Strategy用来决定哪种情况下认证通过</p><p>Authrizer: 授权器（访问控制器），用来决定主体是否有权限进行相应的操作，即控制着用户能访问application中的哪些功能</p><p>Realm: 可以有一个或多个的Realm，是数据源，可以是JDBC实现的，也可以是LDAP实现等。Shiro并不知道我们的用户/权限具体的数据结构或存储位置，所以需要我们自己实现这个Realm</p><p>Session Manager: 此处的Session并不是传统意义上的Web中的Session，而是Shiro抽象出来的自己的Session</p><p>SessionDAO: 是用于操作Shiro抽象出的Session的数据访问对象，用户Session的CRUD，比如要把Session放入到redis中，则可以实现自己的SessionDAO用于操作redis中的这些Session数据</p><p>CacheManager: 缓存控制器，用来管理用户、角色、权限等的缓存</p><p>Cryptography: 加密模块</p></blockquote><h2 id="身份验证"><a href="#身份验证" class="headerlink" title="身份验证"></a>身份验证</h2><blockquote><p>在shiro中，用户需要提供<strong>principals(身份)</strong>和<strong>credentials(证明)</strong>，使得应用程序可以识别这个用户是谁。</p><ul><li>principals: 身份，即主体的标识属性。可以是用户名、邮箱、手机号等。</li><li>credentials: 凭证，即只有主体知道的安全值，如密码等。</li></ul></blockquote><p><img src="https://atts.w3cschool.cn/attachments/image/wk/shiro/4.png" alt="images"></p><h3 id="身份登录流程"><a href="#身份登录流程" class="headerlink" title="身份登录流程"></a>身份登录流程</h3><blockquote><p>流程如下：</p><ol><li>调用Subject.login(token)登录，其会自动委托给SecurityManager，调用之前必须先通过SecurityUtils.setSecurityManager()设置</li><li>SecurityManager负责真正的身份验证逻辑，它会委托给Authenticator进行验证</li><li>Authennticator才是真正的身份验证者，Shiro中核心的身份验证入口点，此处可以自定义自己的实现</li><li>Authenticator可能会委托给相应的AuthenticationStrategy进行多Realm身份验证，默认ModularRealmAuthenticator会调用AuthenticationStrategy进行多Realm身份验证</li><li>Authenticator会把相应的token传入Realm，从Realm获取身份信息，如果没有抛出异常就表示身份验证失败了</li></ol></blockquote><h3 id="Realm"><a href="#Realm" class="headerlink" title="Realm"></a>Realm</h3><blockquote><p>Realm是shiro的数据源，SecurityManager从Realm中获取用户信息进行比较确定用户身份是否合法；也从Realm中得到用户的角色/权限信息，以验证用户是否有操作权限</p><p>Realm源码如下：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Realm</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span></span>; <span class="comment">// 返回唯一的realm名字</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(AuthenticationToken var1)</span></span>; <span class="comment">// 判断此realm是否支持toekn</span></span><br><span class="line"></span><br><span class="line">    <span class="function">AuthenticationInfo <span class="title">getAuthenticationInfo</span><span class="params">(AuthenticationToken var1)</span> <span class="keyword">throws</span> AuthenticationException</span>; <span class="comment">// 根据token获取认证信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>shiro提供的默认Realm：</p></blockquote><p><img src="https://atts.w3cschool.cn/attachments/image/wk/shiro/5.png" alt="images"></p><blockquote><p>一般自定义实现的Realm都继承自AuthorizingRealm（授权），其继承自AuthenticatingRealm(身份验证)</p><ul><li>IniRealm: [users]部分指定用户名、密码、角色；[roles]部分指定权限信息（users/roles在.ini文件中配置）</li><li>PropertiesRealm: user.username=password,role1,role2指定用户名、密码、角色；role.role1=permission1,permission2指定角色及权限信息</li><li>JdbcRealm:通过sql查询相应的信息</li></ul></blockquote><h2 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h2><blockquote><p>授权，即访问控制，也就是在应用中控制谁能访问哪些资源。授权中涉及到的几个概念：</p><ul><li>主体: 访问应用的用户，在shiro中用subject表示该用户</li><li>资源: 在应用中用户可以访问的任何东西，如：CRUD数据</li><li>权限: 表示在应用中用户能不能访问某个资源。<strong>权限只表示有没有对某个资源操作的权力，并不表示哪出是具体哪个用户对这个资源的权力。所以后续还需要把权限赋予给用户，但这个赋予的操作需要实际运营(或其他工作人员)去配置</strong></li><li>角色: 权限的集合，一般情况下会赋予用户角色而不是权限，因为每个用户大多数情况下有多个权限</li></ul><p>角色有分为隐式角色和显式角色：</p><ul><li>隐式角色: 即直接通过角色来验证用户是否有操作权限。这种是将各种角色的逻辑判断写在代码中的，要修改时只能修改代码</li><li>显式角色: 即通过权限控制谁能访问某个资源。角色聚合一组权限集合，当要修改时，只需增删角色中的权限</li></ul></blockquote><h3 id="授权方式"><a href="#授权方式" class="headerlink" title="授权方式"></a>授权方式</h3><h4 id="编程式"><a href="#编程式" class="headerlink" title="编程式"></a>编程式</h4><blockquote><p>编程式即通过if/else完成授权逻辑，例：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Subject subject = SecurityUtils.getSubject();</span><br><span class="line"><span class="keyword">if</span> (subject.hasRole(<span class="string">"admin"</span>)) &#123;</span><br><span class="line">  <span class="comment">// 有admin角色的相关权限</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// 无权限</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="注解式"><a href="#注解式" class="headerlink" title="注解式"></a>注解式</h4><blockquote><p>通过Java注解完成授权逻辑，例：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiresRoles</span>(<span class="string">"admin"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 有admin角色的权限时执行改方法，没有时则抛出异常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="JSP-GSP标签"><a href="#JSP-GSP标签" class="headerlink" title="JSP/GSP标签"></a>JSP/GSP标签</h4><blockquote><p>在JSP页面通过标签完成授权逻辑，例：</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;shiro:hasRole name = <span class="string">"admin"</span> &gt;</span><br><span class="line">  &lt;!- 有admin角色的权限 -&gt;</span><br><span class="line">&lt;/shiro:hasRole&gt;</span><br></pre></td></tr></table></figure><h3 id="授权流程"><a href="#授权流程" class="headerlink" title="授权流程"></a>授权流程</h3><p><img src="https://atts.w3cschool.cn/attachments/image/wk/shiro/6.png" alt="images"></p><blockquote><p>授权流程如下：</p><ol><li>首先调用Subject.isPermitted<em>/hasRole</em>接口，其会委托给SecurityManager，而SecurityManager接着会委托给Authorizer</li><li>Authorizer是真正的授权者，如果我们调用如isPermitted(“user:view”)，其首先会通过PermissionResolver把字符串转成相应的Permission实例</li><li>在进行授权前，会调用相应的Realm获取Subject相应的角色/权限用于匹配传入的角色/权限</li><li>Authorizer会判断Realm的角色/权限是否和传入的匹配，如果有多个Realm，会委托给ModularRealmAuthorizer进行循环判断，如果匹配的如isPermitted<em>/hasRole</em>会返回true,否则返回false表示授权失败</li></ol></blockquote><blockquote><p>ModularRealmAuthorizer进行多Realm匹配流程：</p><ol><li>首先检查相应的Realm是否实现了Authorizer</li><li>如果实现了Authorizer，那么接着调用相应的isPermitted*/hasRole*接口进行匹配</li><li>如果有一个Realm匹配那么将返回true，否则返回false</li></ol></blockquote><blockquote><p>如果Realm进行授权的话，应该继承AuthorizingRealm，其流程是：</p><ol><li>如果调用hasRole*，则直接获取AuthorizationInfo.getRoles()与传入的角色比较</li><li>如果调用的如isPermitted(“user:view”)，则首先通过PermissionResolver将权限字符串转成相应的Permission实例，默认使用WildcardPermissionResolver，即转成通配符的WildcardPermission；</li><li>通过AuthorizationInfo.getObjectPermissions()得到Permission实例集合；通过AuthorizationInfo.getStringPermissions()得到字符串集合并通过PermissionResolver解析为Permission实例，然后获取用户的角色，并通过RolePermissionResolver解析角色对应的权限集合</li><li>接着调用Permission.implies(Permission p)逐个与传入的权限比较，如果有匹配的则返回true,否则返回false</li></ol></blockquote><h2 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h2><h3 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h3><blockquote><p>Servlet是JavaEE规范的一种，也就是servlet是规范(体现在java中就是个接口)，主要是为了扩展Java作为Web服务的功能，统一接口。</p><p>其他厂商如tomcat、jetty根据serlvet规范，内部实现了servlet接口及web功能，并对外暴露出tomcat容器、jetty容器。</p><p>在jetty容器监听到Web请求后，容器会根据URL信息，确定要将请求交给哪个servlet去处理，处理完后再交给容器，容器再返回给客户端。</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1604246170/servlet_f1uprm.webp" alt="images"></p><h3 id="Shiro的拦截器Filter"><a href="#Shiro的拦截器Filter" class="headerlink" title="Shiro的拦截器Filter"></a>Shiro的拦截器Filter</h3><blockquote><p>shiro使用了和Servlet一样的Filter接口扩展，shiro拦截器基础类图如下：</p></blockquote><p><img src="https://atts.w3cschool.cn/attachments/image/wk/shiro/14.png" alt="images"></p><blockquote><ul><li>NameableFilter: 给Filter起名字，默认FilterName</li><li>OncePerRequestFilter: 用于防止多次执行Filter，也就是说一次请求只会走一次拦截器，另外提供一个enabled属性，表示是否开启该拦截器实例</li><li>ShiroFilater: 是整个Shiro的入口，用于拦截需要安全控制的请求进行处理</li><li>AdviceFilter: 提供了AOP的支持</li><li>PathMatchingaFilter: 提供了基于Ant风格的请求路径匹配功能及拦截器参数解析的功能</li><li>AccessControlFilter: 提供了访问控制的功能，比如是否允许访问、当访问拒绝时如何处理等等</li></ul></blockquote><h3 id="拦截器链"><a href="#拦截器链" class="headerlink" title="拦截器链"></a>拦截器链</h3><blockquote><p>shiro对servlet容器的FilterChain进行了代理，即ShiroFilter在继续Servlet容器的Filter链的执行之前，通过ProxiedFilterChain对servlet容器的FilterChain进行了代理；即先走Shiro自己的Filter体系，然后才会委托给Servlet容器的FilterChain进行Servlet容器级别的Filter链执行</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Shiro简介&quot;&gt;&lt;a href=&quot;#Shiro简介&quot; class=&quot;headerlink&quot; title=&quot;Shiro简介&quot;&gt;&lt;/a&gt;Shiro简介&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;shiro是java安全框架，shiro不会去维护用户、也不会去维护权限，
      
    
    </summary>
    
    
      <category term="源码分析" scheme="http://yoursite.com/categories/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="Shiro" scheme="http://yoursite.com/tags/Shiro/"/>
    
      <category term="认证" scheme="http://yoursite.com/tags/%E8%AE%A4%E8%AF%81/"/>
    
      <category term="授权" scheme="http://yoursite.com/tags/%E6%8E%88%E6%9D%83/"/>
    
      <category term="servlet" scheme="http://yoursite.com/tags/servlet/"/>
    
  </entry>
  
  <entry>
    <title>Java异常</title>
    <link href="http://yoursite.com/2020/09/03/Java%E5%BC%82%E5%B8%B8/"/>
    <id>http://yoursite.com/2020/09/03/Java%E5%BC%82%E5%B8%B8/</id>
    <published>2020-09-03T13:30:22.000Z</published>
    <updated>2020-09-03T15:37:33.858Z</updated>
    
    <content type="html"><![CDATA[<h2 id="WHAT"><a href="#WHAT" class="headerlink" title="WHAT"></a>WHAT</h2><h3 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h3><blockquote><p>异常是指由于某种未预知的情况，导致程序中断运行的一种指令流，如：文件找不到、非法参数、网络超时等。为了保证程序正常运行，在设计程序时需要考虑到各种情况并正确处理这些情况</p></blockquote><blockquote><p>异常也是一种对象，在Java中，所有异常类的基类是<code>java.lang.Throwable</code>，Java中将异常划分为两类：</p><ul><li>Error：表示程序中无法处理的错误，一般是指程序执行时JVM出现了错误</li><li>Exception：表示程序本身由于健壮性不足导致的错误，程序本身可以捕捉到这类错误</li></ul></blockquote><blockquote><p>Exception异常又分为两类：</p><ul><li>运行时异常：RuntimeException类及其子类表示JVM在运行期间可能出现的错误。这类异常处于不可查异常，一般是由程序逻辑错误引起的，在程序中可以选择捕获处理，也可以不处理</li><li>编译异常：除RuntimeException及子类之外的异常。如果程序中出现了此类异常，则必须对该异常进行处理，否则编译不通过</li></ul></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">left to right direction</span><br><span class="line">Throwable &lt;|-- Error</span><br><span class="line">Throwable &lt;|-- Exception</span><br><span class="line"></span><br><span class="line">Error &lt;|-- VirtualMachineError</span><br><span class="line">VirtualMachineError &lt;|-- StackOverflowError</span><br><span class="line">Error &lt;|-- AWTError</span><br><span class="line"></span><br><span class="line">Exception &lt;|-- IOException</span><br><span class="line">Exception &lt;|-- RuntimeException</span><br><span class="line"></span><br><span class="line">IOException &lt;|-- EOFException</span><br><span class="line">IOException &lt;|-- FileNotFoundException</span><br><span class="line"></span><br><span class="line">RuntimeException &lt;|-- MissingResourceException</span><br><span class="line">RuntimeException &lt;|-- ClassNotFoundException</span><br><span class="line">RuntimeException &lt;|-- NullPointerException</span><br><span class="line">RuntimeException &lt;|-- IllegalArgumentException</span><br><span class="line">RuntimeException &lt;|-- ArrayIndexOutOfBoundsException</span><br><span class="line">RuntimeException &lt;|-- UnknownTypeException</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><h3 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h3><blockquote><p>在Java中，可通过 <strong>捕获</strong> 和 <strong>抛出</strong> 两种方式来处理异常</p></blockquote><h4 id="捕获异常"><a href="#捕获异常" class="headerlink" title="捕获异常"></a>捕获异常</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">  <span class="comment">// 有可能产生异常的代码</span></span><br><span class="line">&#125; <span class="keyword">catch</span>(ExceptionClz1 e1) &#123;</span><br><span class="line">  <span class="comment">// 处理异常</span></span><br><span class="line">&#125; <span class="keyword">catch</span>(ExceptionClz2 e2) &#123;</span><br><span class="line">  <span class="comment">// 处理异常</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  <span class="comment">// 不管是否发生异常，finally中的语句都会被执行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="抛出异常"><a href="#抛出异常" class="headerlink" title="抛出异常"></a>抛出异常</h4><blockquote><p>在代码中可以使用 <code>throws new ExceptionClz();</code> 的方式想调用该方法的上级方法抛出异常</p></blockquote><h2 id="HOW"><a href="#HOW" class="headerlink" title="HOW"></a>HOW</h2><h3 id="异常类"><a href="#异常类" class="headerlink" title="异常类"></a>异常类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseBusinessException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseBusinessException</span><span class="params">(Integer code, String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(msg);</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(Integer code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Business</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String str = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//            str.equals("233");</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BaseBusinessException(-<span class="number">1</span>, <span class="string">"this is baseBusiness Exception"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BaseBusinessException e1) &#123;</span><br><span class="line">            e1.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e2) &#123;</span><br><span class="line">            e2.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">club.hermit.study.exception.BaseBusinessException: this is baseBusiness Exception</span><br><span class="line">at club.hermit.study.exception.Business.main(Business.java:11)</span><br></pre></td></tr></table></figure><h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="Java-常见异常"><a href="#Java-常见异常" class="headerlink" title="Java 常见异常"></a>Java 常见异常</h3><table><thead><tr><th>异常类</th><th>说明</th></tr></thead><tbody><tr><td>java.lang.NullPointerException</td><td>空指针异常。当应用试图在要求使用对象的地方使用了null时，抛出该异常。譬如：调用null对象的实例方法、访问null对象的属性、计算null对象的长度、使用throw语句抛出null等等</td></tr><tr><td>java.lang.NoSuchMethodException</td><td>方法不存在异常。当访问某个类的不存在的方法时抛出该异常</td></tr><tr><td>java.lang.NoSuchFieldException</td><td>属性不存在异常。当访问某个类的不存在的属性时抛出该异常</td></tr><tr><td>java.lang.ArrayIndexOutOfBoundsException</td><td>数组索引越界异常。当对数组的索引值为负数或大于等于数组大小时抛出</td></tr><tr><td>java.lang.ClassNotFoundException</td><td>找不到类异常。当应用试图根据字符串形式的类名构造类，而在遍历CLASSPAH之后找不到对应名称的class文件时，抛出该异常</td></tr><tr><td>java.lang.ClassCastException</td><td>类造型异常。假设有类A和B（A不是B的父类或子类），O是A的实例，那么当强制将O构造为类B的实例时抛出该异常。该异常经常被称为强制类型转换异常</td></tr><tr><td>java.lang.StackOverflowError</td><td>堆栈溢出错误。当一个应用递归调用的层次太深而导致堆栈溢出或者陷入死循环时抛出该错误</td></tr><tr><td>java.lang.OutOfMemoryError</td><td>内存不足错误。当可用内存不足以让Java虚拟机分配给一个对象时抛出该错误</td></tr><tr><td>java.lang.AbstractMethodError</td><td>抽象方法错误。当应用试图调用抽象方法时抛出</td></tr><tr><td>java.lang.AssertionError</td><td>断言错，用来指示一个断言失败的情况</td></tr><tr><td>java.lang.ClassCircularityError</td><td>类循环依赖错误。在初始化一个类时，若检测到类之间循环依赖则抛出该异常</td></tr><tr><td>java.lang.ClassFormatError</td><td>类格式错误。当Java虚拟机试图从一个文件中读取Java类，而检测到该文件的内容不符合类的有效格式时抛出</td></tr><tr><td>java.lang.ExceptionInInitializerError</td><td>初始化程序错误。当执行一个类的静态初始化程序的过程中，发生了异常时抛出。静态初始化程序是指直接包含于类中的static语句段</td></tr><tr><td>java.lang.NoClassDefFoundError</td><td>未找到类定义错误。当Java虚拟机或者类装载器试图实例化某个类，而找不到该类的定义时抛出该错误</td></tr><tr><td>java.lang.NoSuchFieldError</td><td>域不存在错误。当应用试图访问或者修改某类的某个域，而该类的定义中没有该域的定义时抛出该错误</td></tr><tr><td>java.lang.NoSuchMethodError</td><td>方法不存在错误。当应用试图调用某类的某个方法，而该类的定义中没有该方法的定义时抛出该错误</td></tr><tr><td>java.lang.ThreadDeath</td><td>线程结束。当调用Thread类的stop方法时抛出该错误，用于指示线程结束</td></tr><tr><td>java.lang.UnknownError</td><td>未知错误。用于指示Java虚拟机发生了未知严重错误的情况</td></tr><tr><td>java.lang.ArrayStoreException</td><td>数组存储异常。当向数组中存放非数组声明类型对象时抛出</td></tr><tr><td>java.lang.CloneNotSupportedException</td><td>不支持克隆异常。当没有实现Cloneable接口或者不支持克隆方法时,调用其clone()方法则抛出该异常</td></tr><tr><td>java.lang.EnumConstantNotPresentException</td><td>枚举常量不存在异常。当应用试图通过名称和枚举类型访问一个枚举对象，但该枚举对象并不包含常量时，抛出该异常</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;WHAT&quot;&gt;&lt;a href=&quot;#WHAT&quot; class=&quot;headerlink&quot; title=&quot;WHAT&quot;&gt;&lt;/a&gt;WHAT&lt;/h2&gt;&lt;h3 id=&quot;异常&quot;&gt;&lt;a href=&quot;#异常&quot; class=&quot;headerlink&quot; title=&quot;异常&quot;&gt;&lt;/a&gt;异常&lt;/h
      
    
    </summary>
    
    
      <category term="源码分析" scheme="http://yoursite.com/categories/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="Throwable" scheme="http://yoursite.com/tags/Throwable/"/>
    
      <category term="Error" scheme="http://yoursite.com/tags/Error/"/>
    
      <category term="Exception" scheme="http://yoursite.com/tags/Exception/"/>
    
  </entry>
  
  <entry>
    <title>函数式编程</title>
    <link href="http://yoursite.com/2020/08/31/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/"/>
    <id>http://yoursite.com/2020/08/31/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/</id>
    <published>2020-08-31T15:30:20.000Z</published>
    <updated>2020-09-02T13:28:14.418Z</updated>
    
    <content type="html"><![CDATA[<h2 id="WHAT"><a href="#WHAT" class="headerlink" title="WHAT"></a>WHAT</h2><h3 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h3><blockquote><p>函数式编程是一种编程范式。它把计算当成是数学函数的求值，从而避免改变状态和使用可变数据。它是一种声明式的编程范式，通过表达式和声明而不是语句来编程。</p></blockquote><blockquote><p><strong>函数式编程</strong> 和 <strong>面向对象编程 **、</strong>面向过程编程** 等属于同一平行位置，都是一种编程思想或编程范式。</p></blockquote><h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><blockquote><p>函数类似于数学中的函数：输入元素-&gt;输入元素的集合的映射关系，并且每个输入元素只能映射到一个输出元素上，比如f(x) = x^2 = 4，则x可以是-2，也可以是2</p></blockquote><blockquote><p>对应到函数式编程中，输入元素-2/2称为函数的<strong>参数</strong>，输出元素4称为<strong>值</strong>，输入元素和其他附加元素的集合合称为函数的<strong>定义域</strong>，输出元素的集合合称为函数的<strong>到达域</strong>，输出元素的集合称为<strong>像</strong>。注：到达域 还可能包含除了像中元素之外的其他元素。</p></blockquote><h4 id="λ演算"><a href="#λ演算" class="headerlink" title="λ演算"></a>λ演算</h4><blockquote><p>λ演算是对函数概念的简化，λ演算的函数有主要两个特征：</p><ul><li>λ演算中的函数都是匿名的，没有显式的名称。比如函数<code>sum(x,y)=x+y</code>可以写成<code>(x,y)|-&gt;x+y</code>，由于函数本身仅由映射关系来确定，函数名称实际上并没有意义</li><li>λ演算中的函数都只有一个输入。有多个输入的函数可以转换称多个只包含一个输入的函数的嵌套调用。如<code>(x,y)|-&gt;x+y</code>可以转换成<code>x|-&gt;(y|-&gt;x+y)</code>，右边的函数的返回值是另一个函数</li></ul></blockquote><blockquote><p>λ演算是基于λ项的语言，λ项是λ演算的基本单元，λ演算在λ项上定义了各种转换规则</p></blockquote><h5 id="λ项"><a href="#λ项" class="headerlink" title="λ项"></a>λ项</h5><blockquote><p>λ项由下面规则来定义：</p><ul><li>一个变量x本身就是一个λ项</li><li>如果M是λ项，x是一个变量，那么(λx.M)也是一个λ项，这样的λ项称为λ抽象。x和M中间的点用来分隔函数参数和内容</li><li>如果M和N都是λ项，那么（MN）也是一个λ项，这样的λ项称为应用</li></ul></blockquote><h3 id="函数式编程和面向对象编程"><a href="#函数式编程和面向对象编程" class="headerlink" title="函数式编程和面向对象编程"></a>函数式编程和面向对象编程</h3><blockquote><p>例如，Son、Father、Grandpa三个元素</p><p>面向对象中的关系则是：Father类 继承 Grandpa类，Son类 继承 Father类</p><p>函数式编程中的关系 则是：Grandpa、Father、Son表示事务，fg、ff表示关系，fg作用到Grandpa事务上，则产生了Father事务，ff作用到Father事务上，则产生了Son事务</p></blockquote><h3 id="函数式接口"><a href="#函数式接口" class="headerlink" title="函数式接口"></a>函数式接口</h3><blockquote><p>JDK1.8采用了函数式接口作为Lambda表达式的目标类型。函数式接口是一个有且仅有一个抽象方法声明的接口，任意只包含一个抽象方法的接口，都可以用来做成Lambda表达式。</p></blockquote><blockquote><p>普通接口和函数式接口的区别：</p><ul><li>函数式接口中只能有一个抽象方法</li><li>接口中唯一的抽象方法的命名并不重要，因为函数式接口就是对某一行为进行抽象，主要目地就是支持Lambda表达式</li><li>自定义函数式接口时，应当在接口前加上@FunctionIInterface注解</li></ul></blockquote><h3 id="Java中的Lambda表达式"><a href="#Java中的Lambda表达式" class="headerlink" title="Java中的Lambda表达式"></a>Java中的Lambda表达式</h3><blockquote><p>Lambda表达式，也可称为闭包，允许把函数作为参数，使代码更加简洁</p></blockquote><h4 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h4><blockquote><p>Lambda表达式的基本结构为 <code>(arguments)-&gt;body</code>，有下列情况：</p><ul><li>参数类型可推导时，不需要指定类型，如：<code>(a)-&gt;System.out.println(a)</code></li><li>当只有一个参数且类型可推导时，不强制写()，如：<code>a-&gt;System.out.println(a)</code></li><li>参数指定类型时，必须有括号，如：<code>(int a)-&gt;System.out.println(a)</code></li><li>参数可以为空，如：<code>()-&gt;System.out.println(&quot;2333&quot;)</code></li><li>body需要用{}包含语句，当只有一条语句时{}可省略。<strong>注：有{}要return，无{}不能return</strong></li></ul></blockquote><h4 id="Lambda表示式的缺点"><a href="#Lambda表示式的缺点" class="headerlink" title="Lambda表示式的缺点"></a>Lambda表示式的缺点</h4><blockquote><ul><li>可读性太差，代码越长越差</li><li>难调试，没办法将代码运行中出现的问题输出到日志</li><li>只有JDK1.8以上才可以用</li></ul></blockquote><h2 id="HOW"><a href="#HOW" class="headerlink" title="HOW"></a>HOW</h2><h3 id="JDK内置的函数式接口"><a href="#JDK内置的函数式接口" class="headerlink" title="JDK内置的函数式接口"></a>JDK内置的函数式接口</h3><h4 id="JDK1-8之前的函数式接口"><a href="#JDK1-8之前的函数式接口" class="headerlink" title="JDK1.8之前的函数式接口"></a>JDK1.8之前的函数式接口</h4><table><thead><tr><th>函数式接口</th><th>方法名</th></tr></thead><tbody><tr><td><code>java.lang.Runnable</code></td><td><code>void run();</code></td></tr><tr><td><code>java.util.concurrent.Callable</code></td><td><code>V call();</code></td></tr><tr><td><code>java.security.PrivilegedAction</code></td><td><code>T run();</code></td></tr><tr><td><code>java.util.Comparator</code></td><td><code>int compare(T o1, T o2);</code></td></tr><tr><td><code>java.io.FileFilter</code></td><td><code>boolean accept(File pathname);</code></td></tr><tr><td><code>java.nio.file.PathMatcher</code></td><td><code>boolean matches(Path path);</code></td></tr><tr><td><code>java.lang.reflect.InvocationHandler</code></td><td><code>Object invoke(Object proxy, Method method, Object[] args)</code></td></tr><tr><td><code>java.beans.PropertyChangeListener</code></td><td><code>void propertyChange(PropertyChangeEvent evt);</code></td></tr><tr><td><code>java.awt.event.ActionListener</code></td><td><code>void actionPerformed(ActionEvent e);</code></td></tr><tr><td><code>javax.swing.event.ChangeListener</code></td><td><code>void stateChanged(ChangeEvent e);</code></td></tr></tbody></table><h4 id="JDK1-8新增的函数式接口"><a href="#JDK1-8新增的函数式接口" class="headerlink" title="JDK1.8新增的函数式接口"></a>JDK1.8新增的函数式接口</h4><table><thead><tr><th>函数式接口</th><th>方法名</th><th>形式化描述</th><th>分类</th><th>说明</th></tr></thead><tbody><tr><td><code>Supplier&lt;T&gt;</code></td><td><code>T get();</code></td><td><code>()-&gt;T</code></td><td>供给型</td><td>返回一个结果</td></tr><tr><td><code>Consumer&lt;T&gt;</code></td><td><code>void accept(T t);</code></td><td><code>(T)-&gt;void</code></td><td>消费型</td><td>消费一个输入</td></tr><tr><td><code>BiConsumer&lt;T, U&gt;</code></td><td><code>void accept(T t, U u);</code></td><td><code>(T,U)-&gt;void</code></td><td>消费型</td><td>消费两个输入</td></tr><tr><td><code>Function&lt;T, R&gt;</code></td><td><code>R apply(T t);</code></td><td><code>(T)-&gt;R</code></td><td>映射型</td><td>完成类型的变换</td></tr><tr><td><code>UnaryOperator&lt;T&gt;</code></td><td><code>R apply(T t);</code></td><td><code>(T)-&gt;T</code></td><td>映射型</td><td>同Function，入参和出参类型一致</td></tr><tr><td><code>BiFunction&lt;T, U, R&gt;</code></td><td><code>R apply(T t, U u);</code></td><td><code>(T,U)-&gt;R</code></td><td>映射型</td><td>同Function，接受两个参数</td></tr><tr><td><code>BinaryOperator&lt;T&gt;</code></td><td><code>T apply(T t, U u);</code></td><td><code>(T,T)-&gt;T</code></td><td>映射型</td><td>同Function，参数类型一致</td></tr><tr><td><code>Predicate&lt;T&gt;</code></td><td><code>boolean test(T t);</code></td><td><code>(T)-&gt;boolean</code></td><td>预测型</td><td>判断输入是否符合预期</td></tr><tr><td><code>BiPredicate&lt;T, U&gt;</code></td><td><code>boolean test(T t, U u);</code></td><td><code>(T,U)-&gt;boolean</code></td><td>预测型</td><td>同Predicate，接受两个参数</td></tr></tbody></table><h3 id="函数式接口的使用"><a href="#函数式接口的使用" class="headerlink" title="函数式接口的使用"></a>函数式接口的使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">func</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Consumer consumer = System.out::println;</span><br><span class="line">        consumer.accept(<span class="string">"this is a consumer test"</span>);</span><br><span class="line"></span><br><span class="line">        Function&lt;Integer, Integer&gt; function = (a) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> a + a;</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(function.apply(<span class="number">12</span>));</span><br><span class="line"></span><br><span class="line">        Predicate&lt;Integer&gt; predicate = (a) -&gt; a &gt; <span class="number">0</span>;</span><br><span class="line">        System.out.println(predicate.test(-<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">this is a consumer <span class="built_in">test</span></span><br><span class="line">24</span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h3><blockquote><p>JDK1.8新增了Stream，可以支持以一种声明的方式处理数据</p><p>Stream在程序中将要处理的集合看作一种流，流在管道中传输，并且可以在管道的节点上进行处理，比如筛选、排序、聚合等</p></blockquote><h4 id="Stream的操作"><a href="#Stream的操作" class="headerlink" title="Stream的操作"></a>Stream的操作</h4><blockquote><p>Stream操作分为中间操作和最终操作两种，中间操作返回Stream本身，最终操作返回一特定类型的计算结果</p></blockquote><h5 id="中间操作（intermediate）"><a href="#中间操作（intermediate）" class="headerlink" title="中间操作（intermediate）"></a>中间操作（intermediate）</h5><blockquote><p>一个流可以后面跟随零个或多个intermediate操作，其目地主要是打开流，做出某种程度的数据过滤，然后返回一个新的流，交给下一个操作使用</p><p>中间操作仅仅是调用这类方法，并没有真正开始流的遍历</p></blockquote><blockquote><p>常用的中间操作有：</p><ul><li>map</li><li>filter</li><li>distinct</li><li>sorted</li><li>peek</li><li>limit</li><li>skip</li><li>parallel</li><li>sequential</li><li>unordered</li></ul></blockquote><h5 id="最终操作（terminal）"><a href="#最终操作（terminal）" class="headerlink" title="最终操作（terminal）"></a>最终操作（terminal）</h5><blockquote><p>一个流只能有一个terminal操作，当这个操作执行后，流就被使用完了，无法再被操作</p><p>最终操作才会真正开始流的遍历，并且会生成一个结果</p></blockquote><blockquote><p>常用的最终操作有：</p><ul><li>forEach</li><li>forEachOrdered</li><li>toArray</li><li>reduce</li><li>collect</li><li>min</li><li>max</li><li>count</li><li>anyMatch</li><li>allMatch</li><li>noneMatch</li><li>findFirst</li><li>findAny</li><li>iterator</li></ul></blockquote><h4 id="Stream-的使用"><a href="#Stream-的使用" class="headerlink" title="Stream 的使用"></a>Stream 的使用</h4><h5 id="构造流"><a href="#构造流" class="headerlink" title="构造流"></a>构造流</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stream stream = Stream.of(<span class="string">"hello"</span>, <span class="string">"world"</span>);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String[] str = <span class="keyword">new</span> String[] &#123;<span class="string">"hello"</span>, <span class="string">"world"</span>&#125;</span><br><span class="line">Stream stream1 = Stream.of(str);</span><br><span class="line">Stream stream2 = Arrays.stream(str);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = Arrays.asList(&#123;<span class="string">"hello"</span>, <span class="string">"world"</span>&#125;);</span><br><span class="line">Stream stream = list.stream();</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造基本数据类型int、long、double的流</span></span><br><span class="line">IntStream stream = IntStream.rang(<span class="number">1</span>,<span class="number">10</span>);</span><br></pre></td></tr></table></figure><h5 id="流转化为其他数据结构"><a href="#流转化为其他数据结构" class="headerlink" title="流转化为其他数据结构"></a>流转化为其他数据结构</h5><blockquote><p>转化为数组</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String[] str = stream.toArray(String[]::<span class="keyword">new</span>);</span><br></pre></td></tr></table></figure><blockquote><p>转化为集合</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = stream.collect(Collectors.toList());</span><br><span class="line">Set set = stream.collect(Collectors.toSet());</span><br></pre></td></tr></table></figure><blockquote><p>转化为字符串</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String str = stream.collect(Collectors.joining()).toString;</span><br></pre></td></tr></table></figure><h5 id="流的操作"><a href="#流的操作" class="headerlink" title="流的操作"></a>流的操作</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.stydy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Java8Tester</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"使用 Java 7: "</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 计算空字符串</span></span><br><span class="line">        List&lt;String&gt; strings = Arrays.asList(<span class="string">"abc"</span>, <span class="string">""</span>, <span class="string">"bc"</span>, <span class="string">"efg"</span>, <span class="string">"abcd"</span>,<span class="string">""</span>, <span class="string">"jkl"</span>);</span><br><span class="line">        System.out.println(<span class="string">"列表: "</span> +strings);</span><br><span class="line">        <span class="keyword">long</span> count = getCountEmptyStringUsingJava7(strings);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"空字符数量为: "</span> + count);</span><br><span class="line">        count = getCountLength3UsingJava7(strings);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"字符串长度为 3 的数量为: "</span> + count);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 删除空字符串</span></span><br><span class="line">        List&lt;String&gt; filtered = deleteEmptyStringsUsingJava7(strings);</span><br><span class="line">        System.out.println(<span class="string">"筛选后的列表: "</span> + filtered);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 删除空字符串，并使用逗号把它们合并起来</span></span><br><span class="line">        String mergedString = getMergedStringUsingJava7(strings,<span class="string">", "</span>);</span><br><span class="line">        System.out.println(<span class="string">"合并字符串: "</span> + mergedString);</span><br><span class="line">        List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取列表元素平方数</span></span><br><span class="line">        List&lt;Integer&gt; squaresList = getSquares(numbers);</span><br><span class="line">        System.out.println(<span class="string">"平方数列表: "</span> + squaresList);</span><br><span class="line">        List&lt;Integer&gt; integers = Arrays.asList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">4</span>,<span class="number">15</span>,<span class="number">6</span>,<span class="number">17</span>,<span class="number">8</span>,<span class="number">19</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"列表: "</span> +integers);</span><br><span class="line">        System.out.println(<span class="string">"列表中最大的数 : "</span> + getMax(integers));</span><br><span class="line">        System.out.println(<span class="string">"列表中最小的数 : "</span> + getMin(integers));</span><br><span class="line">        System.out.println(<span class="string">"所有数之和 : "</span> + getSum(integers));</span><br><span class="line">        System.out.println(<span class="string">"平均数 : "</span> + getAverage(integers));</span><br><span class="line">        System.out.println(<span class="string">"随机数: "</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 输出10个随机数</span></span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">            System.out.println(random.nextInt());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"使用 Java 8: "</span>);</span><br><span class="line">        System.out.println(<span class="string">"列表: "</span> +strings);</span><br><span class="line"></span><br><span class="line">        count = strings.stream().filter(string-&gt;string.isEmpty()).count();</span><br><span class="line">        System.out.println(<span class="string">"空字符串数量为: "</span> + count);</span><br><span class="line"></span><br><span class="line">        count = strings.stream().filter(string -&gt; string.length() == <span class="number">3</span>).count();</span><br><span class="line">        System.out.println(<span class="string">"字符串长度为 3 的数量为: "</span> + count);</span><br><span class="line"></span><br><span class="line">        filtered = strings.stream().filter(string -&gt;!string.isEmpty()).collect(Collectors.toList());</span><br><span class="line">        System.out.println(<span class="string">"筛选后的列表: "</span> + filtered);</span><br><span class="line"></span><br><span class="line">        mergedString = strings.stream().filter(string -&gt;!string.isEmpty()).collect(Collectors.joining(<span class="string">", "</span>));</span><br><span class="line">        System.out.println(<span class="string">"合并字符串: "</span> + mergedString);</span><br><span class="line"></span><br><span class="line">        squaresList = numbers.stream().map( i -&gt;i*i).distinct().collect(Collectors.toList());</span><br><span class="line">        System.out.println(<span class="string">"Squares List: "</span> + squaresList);</span><br><span class="line">        System.out.println(<span class="string">"列表: "</span> +integers);</span><br><span class="line"></span><br><span class="line">        IntSummaryStatistics stats = integers.stream().mapToInt((x) -&gt;x).summaryStatistics();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"列表中最大的数 : "</span> + stats.getMax());</span><br><span class="line">        System.out.println(<span class="string">"列表中最小的数 : "</span> + stats.getMin());</span><br><span class="line">        System.out.println(<span class="string">"所有数之和 : "</span> + stats.getSum());</span><br><span class="line">        System.out.println(<span class="string">"平均数 : "</span> + stats.getAverage());</span><br><span class="line">        System.out.println(<span class="string">"随机数: "</span>);</span><br><span class="line"></span><br><span class="line">        random.ints().limit(<span class="number">10</span>).sorted().forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 并行处理</span></span><br><span class="line">        count = strings.parallelStream().filter(string -&gt; string.isEmpty()).count();</span><br><span class="line">        System.out.println(<span class="string">"空字符串的数量为: "</span> + count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getCountEmptyStringUsingJava7</span><span class="params">(List&lt;String&gt; strings)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(String string: strings)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(string.isEmpty())&#123;</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getCountLength3UsingJava7</span><span class="params">(List&lt;String&gt; strings)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(String string: strings)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(string.length() == <span class="number">3</span>)&#123;</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">deleteEmptyStringsUsingJava7</span><span class="params">(List&lt;String&gt; strings)</span></span>&#123;</span><br><span class="line">        List&lt;String&gt; filteredList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(String string: strings)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!string.isEmpty())&#123;</span><br><span class="line">                filteredList.add(string);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> filteredList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getMergedStringUsingJava7</span><span class="params">(List&lt;String&gt; strings, String separator)</span></span>&#123;</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(String string: strings)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!string.isEmpty())&#123;</span><br><span class="line">                stringBuilder.append(string);</span><br><span class="line">                stringBuilder.append(separator);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        String mergedString = stringBuilder.toString();</span><br><span class="line">        <span class="keyword">return</span> mergedString.substring(<span class="number">0</span>, mergedString.length()-<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title">getSquares</span><span class="params">(List&lt;Integer&gt; numbers)</span></span>&#123;</span><br><span class="line">        List&lt;Integer&gt; squaresList = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(Integer number: numbers)&#123;</span><br><span class="line">            Integer square = <span class="keyword">new</span> Integer(number.intValue() * number.intValue());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!squaresList.contains(square))&#123;</span><br><span class="line">                squaresList.add(square);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> squaresList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getMax</span><span class="params">(List&lt;Integer&gt; numbers)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> max = numbers.get(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i &lt; numbers.size();i++)&#123;</span><br><span class="line"></span><br><span class="line">            Integer number = numbers.get(i);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(number.intValue() &gt; max)&#123;</span><br><span class="line">                max = number.intValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getMin</span><span class="params">(List&lt;Integer&gt; numbers)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> min = numbers.get(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i &lt; numbers.size();i++)&#123;</span><br><span class="line">            Integer number = numbers.get(i);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(number.intValue() &lt; min)&#123;</span><br><span class="line">                min = number.intValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> min;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getSum</span><span class="params">(List numbers)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = (<span class="keyword">int</span>)(numbers.get(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i &lt; numbers.size();i++)&#123;</span><br><span class="line">            sum += (<span class="keyword">int</span>)numbers.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getAverage</span><span class="params">(List&lt;Integer&gt; numbers)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getSum(numbers) / numbers.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h3><blockquote><p>在Java开发中，空指针异常时最常见的异常，通常需要用 <code>if(obj != null){}</code> 类似这样处理，这样繁琐且难看<br>JDK1.8提供了一个Optional类用来处理这类繁琐的判断</p></blockquote><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>of</td><td>把指定的值封装为Optional对象，如果指定的值为null，则抛出NullPointerException</td></tr><tr><td>empty</td><td>创建一个空的Optional对象</td></tr><tr><td>ofNullable</td><td>把指定的值封装为Optional对象，如果指定的值为null，则创建一个空的Optional对象</td></tr><tr><td>get</td><td>如果创建的Optional中有值存在，则返回此值，否则抛出NoSuchElementException</td></tr><tr><td>orElse</td><td>如果创建的Optional中有值存在，则返回此值，否则返回一个默认值</td></tr><tr><td>orElseGet</td><td>如果创建的Optional中有值存在，则返回此值，否则返回一个由Supplier接口生成的值</td></tr><tr><td>orElseThrow</td><td>如果创建的Optional中有值存在，则返回此值，否则抛出一个由指定的Supplier接口生成的异常</td></tr><tr><td>filter</td><td>如果创建的Optional中的值满足filter中的条件，则返回包含该值的Optional对象，否则返回一个空的Optional对象</td></tr><tr><td>map</td><td>如果创建的Optional中的值存在，对该值执行提供的Function函数调用</td></tr><tr><td>flagMap</td><td>如果创建的Optional中的值存在，就对该值执行提供的Function函数调用，返回一个Optional类型的值，否则就返回一个空的Optional对象</td></tr><tr><td>isPresent</td><td>如果创建的Optional中的值存在，返回true，否则返回false</td></tr><tr><td>ifPresent</td><td>如果创建的Optional中的值存在，则执行该方法的调用，否则什么也不做</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        User user = <span class="keyword">null</span>;</span><br><span class="line">        Optional.ofNullable(user).orElseThrow(()-&gt;<span class="keyword">new</span> Exception(<span class="string">"user不存在"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> java.lang.Exception: user不存在</span><br><span class="line">at club.hermit.stydy.App.lambda<span class="variable">$main</span><span class="variable">$0</span>(App.java:11)</span><br><span class="line">at java.util.Optional.orElseThrow(Optional.java:290)</span><br><span class="line">at club.hermit.stydy.App.main(App.java:11)</span><br><span class="line"></span><br><span class="line">Process finished with <span class="built_in">exit</span> code 1</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;WHAT&quot;&gt;&lt;a href=&quot;#WHAT&quot; class=&quot;headerlink&quot; title=&quot;WHAT&quot;&gt;&lt;/a&gt;WHAT&lt;/h2&gt;&lt;h3 id=&quot;函数式编程&quot;&gt;&lt;a href=&quot;#函数式编程&quot; class=&quot;headerlink&quot; title=&quot;函数式编程&quot;&gt;
      
    
    </summary>
    
    
      <category term="源码分析" scheme="http://yoursite.com/categories/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="函数式编程" scheme="http://yoursite.com/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/"/>
    
      <category term="lambda" scheme="http://yoursite.com/tags/lambda/"/>
    
  </entry>
  
  <entry>
    <title>List集合</title>
    <link href="http://yoursite.com/2020/08/17/List%E9%9B%86%E5%90%88/"/>
    <id>http://yoursite.com/2020/08/17/List%E9%9B%86%E5%90%88/</id>
    <published>2020-08-17T15:52:00.000Z</published>
    <updated>2020-08-30T17:24:14.380Z</updated>
    
    <content type="html"><![CDATA[<h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1597164674/List_t99r85.png" alt="list"></p><h2 id="List家族支柱"><a href="#List家族支柱" class="headerlink" title="List家族支柱"></a>List家族支柱</h2><blockquote><p>List家族有三大支柱：Iterable 、 AbstractCollection 、 AbstractList</p></blockquote><blockquote><p>这三大支柱的继承实现关系分别是：</p><ul><li><strong>Collection接口 继承 Iterable接口</strong></li><li><strong>AbstractCollection抽象类 实现 Collection接口</strong></li><li><strong>AbstractList抽象类 继承 AbstractCollection抽象类</strong></li><li><strong>AbstractList抽象类 衍生万物。。。</strong></li></ul></blockquote><h3 id="Iterable"><a href="#Iterable" class="headerlink" title="Iterable"></a>Iterable</h3><blockquote><p>实现 Iterable接口 可以让一个对象具有「for-each loop」的属性。</p></blockquote><blockquote><p>该接口是在JDK1.5被创造出来的。该接口指定了三条规范：</p><ul><li><code>Iterator&lt;T&gt; iterator()</code> 返回一个T类型元素的迭代器</li><li><code>void forEach()</code> 对迭代器中的每个元素执行特定处理，直到处理完所有元素或抛出异常</li><li><code>Spliterator&lt;T&gt; spliterator</code> 返回一个并行遍历元素的迭代器</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">forEach</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> T&gt; action)</span> </span>&#123;</span><br><span class="line">    Objects.requireNonNull(action);</span><br><span class="line">    <span class="keyword">for</span> (T t : <span class="keyword">this</span>) &#123;</span><br><span class="line">        action.accept(t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">default</span> Spliterator&lt;T&gt; <span class="title">spliterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Spliterators.spliteratorUnknownSize(iterator(), <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>forEach() 和 spliterator() 是在JDK1.8中引入的，他们两个都是default修饰符修饰的，支持lambda表达式</p></blockquote><h3 id="AbstractCollection"><a href="#AbstractCollection" class="headerlink" title="AbstractCollection"></a>AbstractCollection</h3><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1597682764/AbstractCollection_kcs4i3.png" alt="AbstractCollection"></p><blockquote><p>该抽象类提供了Collection接口的基本实现，以尽量减少实现Collection接口所需的工作量。</p><p>如果要实现一个不可修改的集合，程序员只需扩展这个抽象类，并且实现该抽象类的iterator()方法和size()方法。</p><p>如果要实现一个可修改的集合，程序要必须另外覆盖这个抽象类的add()方法，并且iterator()方法返回的迭代器必须另外实现remove()方法</p></blockquote><h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The maximum size of array to allocate.</span></span><br><span class="line"><span class="comment"> * Some VMs reserve some header words in an array.</span></span><br><span class="line"><span class="comment"> * Attempts to allocate larger arrays may result in</span></span><br><span class="line"><span class="comment"> * OutOfMemoryError: Requested array size exceeds VM limit</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_ARRAY_SIZE = Integer.MAX_VALUE - <span class="number">8</span>;</span><br></pre></td></tr></table></figure><blockquote><p>定义可分配给数组的最大长度，在toArray的动态增加数组长度时用到</p></blockquote><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><h5 id="抽象方法"><a href="#抽象方法" class="headerlink" title="抽象方法"></a>抽象方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><blockquote><p>这两个方法是需要继承该类的类实现，在该类中，很多方法中都调用了这两个方法</p></blockquote><h5 id="破坏性方法"><a href="#破坏性方法" class="headerlink" title="破坏性方法"></a>破坏性方法</h5><blockquote><p>在该类中，add()方法是作为「具有破坏性」的方法出现的，如果继承该类的子类不覆盖此方法，则子类也是个不可修改的集合，如果想让子类集合可修改，则必须重写add()方法</p></blockquote><blockquote><p>如果要实现一个不可修改的集合，则add()方法不需要覆盖</p></blockquote><h5 id="依赖抽象方法的方法"><a href="#依赖抽象方法的方法" class="headerlink" title="依赖抽象方法的方法"></a>依赖抽象方法的方法</h5><blockquote><p>AbstractCollection类中的其他方法，具体实现或者依赖iterator()、或者依赖size()、或者依赖add()，如contains()和addAll()</p></blockquote><blockquote><p>在AbstractCollection类中，有一批抽象方法（或需要自己重写的方法）：</p><ul><li><code>abstract Iterator&lt;E&gt; iterator();</code></li><li><code>abstract int size();</code></li><li><code>boolean add(E e)；</code></li></ul><p>这些方法需要在子类中具体实现，而在本类的其他方法的实现中，大量调用了这三个方法。</p></blockquote><blockquote><p><strong>个人认为，这才是面向接口编程的精髓：接口制定了一系列规范，并利用这些规范实现了一系列所有子类通用的方法</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> size() == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>isEmpty()方法通过size()==0的方式判断集合是否为空，具体子类集合的长度size()按各自集合的有不同的计算方法，但不管具体的size()怎么实现，size()==0成立则该集合一定为空</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    Iterator&lt;E&gt; it = iterator();</span><br><span class="line">    <span class="keyword">if</span> (o==<span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext())</span><br><span class="line">            <span class="keyword">if</span> (it.next()==<span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext())</span><br><span class="line">            <span class="keyword">if</span> (o.equals(it.next()))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>如果该集合包含指定元素，则返回true</p></blockquote><blockquote><p>该元素首先通过调用在子类中实现的iterator()方法，返回一个子类集合的迭代器，然后通过迭代器挨个遍历元素，检查该集合中是否包含指定元素</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object[] toArray() &#123;</span><br><span class="line">    <span class="comment">// Estimate size of array; be prepared to see more or fewer elements</span></span><br><span class="line">    Object[] r = <span class="keyword">new</span> Object[size()];</span><br><span class="line">    Iterator&lt;E&gt; it = iterator();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; r.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (! it.hasNext()) <span class="comment">// fewer elements than expected</span></span><br><span class="line">            <span class="keyword">return</span> Arrays.copyOf(r, i);</span><br><span class="line">        r[i] = it.next();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> it.hasNext() ? finishToArray(r, it) : r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>该方法返回一个包含该集合所有元素的Object类型的数组。</p></blockquote><blockquote><p>toArray()方法先通过子类中具体实现的size()方法，创建一个和该集合元素数量一样大的Object数组，再返回该元素的迭代器。</p><p>通过迭代器，挨个将集合中的元素放入数组中。当集合中元素遍历完后，通过Arrays类的<code>Arrays.copyOf(r, i)</code>方法，将该Object数组复制到一个新数组并返回新数组的引用。（此处为什么要调用<code>Arrays.copyOf()</code>重新复制新数组呢？因为如果在遍历过程中集合元素减少了，则数组容量就会变大，而<code>Arrays.copyOf()</code>复制新数组时会保证数组容量不会有多余的）</p><p>但是，如果当在遍历元素的时候，集合长度增加了，也就是在执行过<code>Object[] r = new Object[size()];</code>这个后，执行<code>r[i] = it.next();</code>的时候，集合增加了，则Object数组不能完全放入集合元素了，则需要调用<code>finishToArray(r, it)</code>做数组的动态扩容。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; T[] finishToArray(T[] r, Iterator&lt;?&gt; it) &#123;</span><br><span class="line">    <span class="keyword">int</span> i = r.length;</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">        <span class="keyword">int</span> cap = r.length;</span><br><span class="line">        <span class="keyword">if</span> (i == cap) &#123;</span><br><span class="line">            <span class="keyword">int</span> newCap = cap + (cap &gt;&gt; <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// overflow-conscious code</span></span><br><span class="line">            <span class="keyword">if</span> (newCap - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">                newCap = hugeCapacity(cap + <span class="number">1</span>);</span><br><span class="line">            r = Arrays.copyOf(r, newCap);</span><br><span class="line">        &#125;</span><br><span class="line">        r[i++] = (T)it.next();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// trim if overallocated</span></span><br><span class="line">    <span class="keyword">return</span> (i == r.length) ? r : Arrays.copyOf(r, i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_ARRAY_SIZE = Integer.MAX_VALUE - <span class="number">8</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hugeCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (minCapacity &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> OutOfMemoryError</span><br><span class="line">            (<span class="string">"Required array size too large"</span>);</span><br><span class="line">    <span class="keyword">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class="line">        Integer.MAX_VALUE :</span><br><span class="line">        MAX_ARRAY_SIZE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在finishToArray()方法中，通过<code>int newCap = cap + (cap &gt;&gt; 1) + 1;</code>给数组扩容，这里的<code>&gt;&gt;1</code>右移一位表示除以2，最后的长度是 <code>newCap = cap + cap/2 +1;</code> 如果newCap超过最大长度，则赋值为最大长度，然后再次通过<code>Arrays.copyOf(r, newCap);</code>复制得到新数组，这样保证了新数组不会有空余的空间。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; T[] toArray(T[] a) &#123;</span><br><span class="line">    <span class="comment">// Estimate size of array; be prepared to see more or fewer elements</span></span><br><span class="line">    <span class="keyword">int</span> size = size();</span><br><span class="line">    T[] r = a.length &gt;= size ? a :</span><br><span class="line">              (T[])java.lang.reflect.Array</span><br><span class="line">              .newInstance(a.getClass().getComponentType(), size);</span><br><span class="line">    Iterator&lt;E&gt; it = iterator();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; r.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (! it.hasNext()) &#123; <span class="comment">// fewer elements than expected</span></span><br><span class="line">            <span class="keyword">if</span> (a == r) &#123;</span><br><span class="line">                r[i] = <span class="keyword">null</span>; <span class="comment">// null-terminate</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a.length &lt; i) &#123;</span><br><span class="line">                <span class="keyword">return</span> Arrays.copyOf(r, i);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.arraycopy(r, <span class="number">0</span>, a, <span class="number">0</span>, i);</span><br><span class="line">                <span class="keyword">if</span> (a.length &gt; i) &#123;</span><br><span class="line">                    a[i] = <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        &#125;</span><br><span class="line">        r[i] = (T)it.next();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// more elements than expected</span></span><br><span class="line">    <span class="keyword">return</span> it.hasNext() ? finishToArray(r, it) : r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>该方法返回一个指定类型的数组。如果指定类型的数组合适，则返回该指定类型的数组，如果不适合则返回一个新数组</p></blockquote><blockquote><p>先判断是定类型的数组长度和集合长度的大小，若指定数组长度大，则使用指定数组，否则通过Arrays的反射新实例化一个和集合长度相等的新数组。</p><p>在for循环中，用<code>==</code>判断两个数组的引用是否相等，也即<code>a</code>和<code>r</code>是否是同一个数组对象，如果是直接将传过来的<code>a</code>返回回去；如果新数组和参数传递过来的<code>a</code>不是同一个对象，则通过<code>Arrays.copyOf(r, i)</code>返回新数组；或者在多线程或某种情况下，集合元素变少了，通过<code>System.arraycopy(r, 0, a, 0, i);</code>拷贝返回新数组。 </p><p>这个地方<code>System.arraycopy(r, 0, a, 0, i);</code>和<code>Arrays.copyOf(r, i);</code>又有什么区别呢？</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T[] copyOf(T[] original, <span class="keyword">int</span> newLength) &#123;</span><br><span class="line">    <span class="keyword">return</span> (T[]) copyOf(original, newLength, original.getClass());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T,U&gt; T[] copyOf(U[] original, <span class="keyword">int</span> newLength, Class&lt;? extends T[]&gt; newType) &#123;</span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    T[] copy = ((Object)newType == (Object)Object[]<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line">        ? (T[]) new Object[newLength]</span><br><span class="line">        : (T[]) Array.newInstance(newType.getComponentType(), newLength);</span><br><span class="line">    System.arraycopy(original, <span class="number">0</span>, copy, <span class="number">0</span>,</span><br><span class="line">                     Math.min(original.length, newLength));</span><br><span class="line">    <span class="keyword">return</span> copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>可以看到，<code>Arrays.copyOf(r, i);</code>的底层其实也是调用了<code>System.arraycopy(r, 0, a, 0, i);</code>的，前者相当于后者的阉割版，更适合于数组的扩容。</p></blockquote><h3 id="AbstractList"><a href="#AbstractList" class="headerlink" title="AbstractList"></a>AbstractList</h3><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1598437808/AbstractList_j5xkkw.png" alt="AbstractList"></p><blockquote><p>AbstractList类提供了List接口的骨干实现，以最大限度地减少实现「随机访问」数据存储（如数组）支持的该接口所需的工作。对于连续的访问数据（如链表），应优先使用 <strong>AbstractSequentialList</strong> 类</p></blockquote><blockquote><p>要实现一个不可修改的List，编程人员只需扩展此类，并提供get()方法和size()方法的实现</p></blockquote><blockquote><p>要实现一个可修改的List，编程人员只需另外重写set()方法，如果List可变大小，则需要另外重写add()方法和rmove()方法</p></blockquote><h4 id="内部类"><a href="#内部类" class="headerlink" title="内部类"></a>内部类</h4><blockquote><p>Itr 和 ListItr 是 AbstractList 的内部类，以以下方式定义在AbstractList的内部。这两个类实现了额外的列表迭代器</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractCollection</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Itr</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ListItr</span> <span class="keyword">extends</span> <span class="title">Itr</span> <span class="keyword">implements</span> <span class="title">ListIterator</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>那为什么Itr和ListItr要声明成内部类呢？</p><ul><li>对外部隐藏这两个类，且外部类也不需要用到这两个类</li><li>方便这两个类访问外部类(即AbstractList)的私有方法和私有属性</li></ul></blockquote><h5 id="Itr"><a href="#Itr" class="headerlink" title="Itr"></a>Itr</h5><h6 id="属性-1"><a href="#属性-1" class="headerlink" title="属性"></a>属性</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> cursor = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><blockquote><p>调用next()方法时返回的元素索引值</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> lastRet = -<span class="number">1</span>;</span><br></pre></td></tr></table></figure><blockquote><p>最近一次调用next()方法或previous()方法时返回的元素索引。如果调用remove()方法删除元素，则该值会重置为-1</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> expectedModCount = modCount;</span><br></pre></td></tr></table></figure><blockquote><p>modCount 是迭代器认为的该List集合应该支持的值，如果该值和迭代器期望的不一致，则表示迭代器已经检测到并发程序修改了该集合的值</p></blockquote><h6 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> cursor != size();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  checkForComodification();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">int</span> i = cursor;</span><br><span class="line">    E next = get(i);</span><br><span class="line">    lastRet = i;</span><br><span class="line">    cursor = i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> next;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException e) &#123;</span><br><span class="line">    checkForComodification();</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">checkForComodification</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">transient</span> <span class="keyword">int</span> modCount = <span class="number">0</span>; <span class="comment">// 在AbstractList中定义，表示该List集合被修改的次数，该值是在SubList中被修改的</span></span><br></pre></td></tr></table></figure><blockquote><p>checkForComodification()方法用来检测并发程序是否修改该集合，其中<code>modCount</code>是<code>AbstractList</code>类的属性</p></blockquote><blockquote><p>get()方法和size()方法都是抽象方法，需要在子类中具体实现！</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">abstract</span> <span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (lastRet &lt; <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line">  checkForComodification();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    AbstractList.<span class="keyword">this</span>.remove(lastRet);</span><br><span class="line">    <span class="keyword">if</span> (lastRet &lt; cursor)</span><br><span class="line">      cursor--;</span><br><span class="line">    lastRet = -<span class="number">1</span>;</span><br><span class="line">    expectedModCount = modCount;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>按照此处<code>lastRet &lt; 0</code>的判断，难道不能连续执行两次remove()方法？</p></blockquote><h5 id="ListItr"><a href="#ListItr" class="headerlink" title="ListItr"></a>ListItr</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ListItr</span> <span class="keyword">extends</span> <span class="title">Itr</span> <span class="keyword">implements</span> <span class="title">ListIterator</span>&lt;<span class="title">E</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>该类继承了上面说的<code>Itr</code>类，实现了<code>ListIterator</code>接口，而<code>ListIterator</code>接口完全是一个规范了操作List的一系列add()、set()、next()、hasNext()、previous()方法，没有任何的方法实现。ListItr类实现了接口ListIterator中的所有方法。当然，像remove()、next()、hasNext()这些方法，用的是继承自Itr类的</p></blockquote><h6 id="属性-2"><a href="#属性-2" class="headerlink" title="属性"></a>属性</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">transient</span> <span class="keyword">int</span> modCount = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><blockquote><p>该变量是用来保存 <strong>集合结构被修改次数</strong> 的字段</p></blockquote><h4 id="AbstractList方法"><a href="#AbstractList方法" class="headerlink" title="AbstractList方法"></a>AbstractList方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">AbstractList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>AbstractList唯一的构造方法，由子类的构造方法调用</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">  ListIterator&lt;E&gt; it = listIterator();</span><br><span class="line">  <span class="keyword">if</span> (o==<span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext())</span><br><span class="line">      <span class="keyword">if</span> (it.next()==<span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> it.previousIndex();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext())</span><br><span class="line">      <span class="keyword">if</span> (o.equals(it.next()))</span><br><span class="line">        <span class="keyword">return</span> it.previousIndex();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> ListIterator&lt;E&gt; <span class="title">listIterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> listIterator(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> ListIterator&lt;E&gt; <span class="title">listIterator</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">  rangeCheckForAdd(index);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> ListItr(index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>indexOf()方法返回该集合第一次出现的指定元素的索引，如果此集合不包含该元素，则返回-1</p><p>该方法先实例化一个子类是ListItr的List迭代器，然后通过这个迭代器挨个遍历该集合</p></blockquote><h3 id="SubList"><a href="#SubList" class="headerlink" title="SubList"></a>SubList</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>SubList</code>和<code>RandomAccessSubList</code>类虽然在AbstractList.java文件中，但这两个类是继承了AbstractList的子类，在该子类中，具体实现了AbstractList类中的抽象方法</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">  rangeCheck(index);</span><br><span class="line">  checkForComodification();</span><br><span class="line">  <span class="keyword">return</span> l.set(index+offset, element);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">  rangeCheck(index);</span><br><span class="line">  checkForComodification();</span><br><span class="line">  <span class="keyword">return</span> l.get(index+offset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  checkForComodification();</span><br><span class="line">  <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">  rangeCheckForAdd(index);</span><br><span class="line">  checkForComodification();</span><br><span class="line">  l.add(index+offset, element);</span><br><span class="line">  <span class="keyword">this</span>.modCount = l.modCount;</span><br><span class="line">  size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="RandomAccessSubList"><a href="#RandomAccessSubList" class="headerlink" title="RandomAccessSubList"></a>RandomAccessSubList</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomAccessSubList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">SubList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">RandomAccess</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>该类继承了<code>SubList</code>类，实现了<code>RandomAccess</code>接口。该类只提供了一个构造方法和返回List集合的方法。</p></blockquote><blockquote><p><code>RandomAccess</code>是个标记接口，表名实现了该接口的子类支持快速随机访问</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomAccessSubList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">SubList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">RandomAccess</span> </span>&#123;</span><br><span class="line">    RandomAccessSubList(AbstractList&lt;E&gt; list, <span class="keyword">int</span> fromIndex, <span class="keyword">int</span> toIndex) &#123;</span><br><span class="line">        <span class="keyword">super</span>(list, fromIndex, toIndex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;E&gt; <span class="title">subList</span><span class="params">(<span class="keyword">int</span> fromIndex, <span class="keyword">int</span> toIndex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RandomAccessSubList&lt;&gt;(<span class="keyword">this</span>, fromIndex, toIndex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AbstractSequentialList"><a href="#AbstractSequentialList" class="headerlink" title="AbstractSequentialList"></a>AbstractSequentialList</h3><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1598799332/AbstractSequentialList_vx7jby.png" alt="AbstractSequentialList"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractSequentialList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>该类继承了AbstractList类，提供了List接口的骨干实现，以最大限度的减少实现「顺序访问」（如链表）数据存储支持的该接口所需的工作。</p></blockquote><blockquote><p>要实现一个列表，程序员只需扩展此类，并提供listIterator和size方法的实现即可</p></blockquote><blockquote><p>要实现一个不可修改的列表，程序员只需实现列表迭代器的hasNext、next、hasPrevious、previous、index方法即可</p></blockquote><h2 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h2><blockquote><p>ArrayList是list接口的大小可变数组的实现，类继承关系如下：</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1597248203/ArrayList_pnuojs.png" alt="ArrayList"></p><blockquote><p>如上，ArrayList实现的接口有：</p><ul><li>Cloneable：它实现了Cloneable且实现了Object的clone方法，所以可是实现克隆（标记接口）</li><li>Serializable：所以它可以序列化（标记接口）</li><li>List：所以list定义的所有方法都适用于它</li><li>RandomAccess：表明它可以快速随机访问（标记接口）</li></ul><p>继承了以下类：</p><ul><li>AbstractList：这个类提供了一个最简单的实现list接口的框架，这个框架支持随机访问数据。所以ArrayList继承这个类的话，也大大简便了对随机访问数据的操作</li></ul></blockquote><h3 id="属性-3"><a href="#属性-3" class="headerlink" title="属性"></a>属性</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CAPACITY = <span class="number">10</span>;</span><br></pre></td></tr></table></figure><blockquote><p>默认初始化容器的容量</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] EMPTY_ELEMENTDATA = &#123;&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>对于空ArrayList实例共享的空数组实例</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>默认大小的空ArrayList实例 用到的 共享空数组实例。</p></blockquote><blockquote><p>与<code>EMPTY_ELEMENTDATA</code>变量不同的是，该变量是用来在向ArrayList容器中添加元素时，标识添充多少容量的</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">transient</span> Object[] elementData;</span><br></pre></td></tr></table></figure><blockquote><p>ArrayList元素存储到数组缓冲区中，ArrayList的容量是此数组缓冲区的长度。</p></blockquote><blockquote><p>当一个空的ArrayList添加第一个元素时，它的容量就会自动被填充成<code>DEFAULT_CAPACITY</code>的大小</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> size;</span><br></pre></td></tr></table></figure><blockquote><p>容器中元素的数量</p></blockquote><h3 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h3><blockquote><p>ArrayList提供了三个构造方法：空参数构造方法、指定容量构造方法、指定集合构造方法</p></blockquote><h4 id="空参数构造方法"><a href="#空参数构造方法" class="headerlink" title="空参数构造方法"></a>空参数构造方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>该构造方法构造了一个容量为10的空列表。</p><p>初始化时容量为空，当添加第一个元素时，会将容量设置为10</p></blockquote><h4 id="指定容量的构造方法"><a href="#指定容量的构造方法" class="headerlink" title="指定容量的构造方法"></a>指定容量的构造方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (initialCapacity &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.elementData = <span class="keyword">new</span> Object[initialCapacity];</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (initialCapacity == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal Capacity: "</span>+</span><br><span class="line">                                       initialCapacity);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>构造一个指定容量的空列表，如果指定容量为0，则默认初始化为10</p></blockquote><h4 id="指定集合的构造方法"><a href="#指定集合的构造方法" class="headerlink" title="指定集合的构造方法"></a>指定集合的构造方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">  elementData = c.toArray();</span><br><span class="line">  <span class="keyword">if</span> ((size = elementData.length) != <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span></span><br><span class="line">    <span class="keyword">if</span> (elementData.getClass() != Object[]<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">      <span class="title">elementData</span> </span>= Arrays.copyOf(elementData, size, Object[]<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// replace with empty array.</span></span><br><span class="line">    <span class="keyword">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>构造一个包含指定元素的集合列表，如果指定指定的元素集合为空，则替换为默认的空数组。那不为空的情况是啥样的呢？</p><p>为什么要先<code>elementData = c.toArray();</code> 然后在做一次拷贝呢 <code>Arrays.copyOf(elementData, size, Object[].class);</code> 这句注释<code>c.toArray might (incorrectly) not return Object[] (see 6260652)</code>又是什么意思呢？</p></blockquote><blockquote><p>这块主要有三点注意的：</p><ul><li><code>Collection&lt;? extends E&gt; c</code> 这个形参表示c是一个集合，这个集合内的元素都是E或E的子类</li><li><code>&lt;? extends E&gt;</code> 是泛型中的上限通配符，用来限制元素类型的上限</li><li><code>6260652</code> 是<a href="https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6260652" target="_blank" rel="noopener">JDK的bug编号</a></li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ArrayList list = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    list.add(<span class="string">"ss"</span>);</span><br><span class="line">    list.add(<span class="number">12</span>);</span><br><span class="line">    System.out.println(list.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>上面这段代码是可以运行的！既然ArrayList的底层是数组实现的，那为什么可以往ArrayList中添加不同类型的元素呢？</p></blockquote><blockquote><p>这就设计到ArrayList的转型了，在上面的构造函数中，<code>elementData = c.toArray();</code>这样虽然可以通过强制类型转换将E（或E的子类）类型的数组向上转型成Objectp[]类型，但不能再向这个elementData中添加Object类型的元素了。<strong>这也就是加入有一个Object数组，但并不代表可以将Object对象存进去，具体能存进去什么类型的元素还取决于这个数组的实际类型。</strong> 所以在这个构造函数中，通过<code>elementData.getClass() != Object[].class</code>判断该elementData变量的实际类型是否是Object数组，如果不是，则通过<code>Arrays.copyOf(elementData, size, Object[].class)</code>将拷贝到Object数组中，返回这个Object数组，这样就保证ArrayList中的元素是Object类型的了</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T,U&gt; T[] copyOf(U[] original, <span class="keyword">int</span> newLength, Class&lt;? extends T[]&gt; newType) &#123;</span><br><span class="line">  <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">  T[] copy = ((Object)newType == (Object)Object[]<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line">    ? (T[]) new Object[newLength]</span><br><span class="line">    : (T[]) Array.newInstance(newType.getComponentType(), newLength);</span><br><span class="line">  System.arraycopy(original, <span class="number">0</span>, copy, <span class="number">0</span>,</span><br><span class="line">                   Math.min(original.length, newLength));</span><br><span class="line">  <span class="keyword">return</span> copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="序列化实现"><a href="#序列化实现" class="headerlink" title="序列化实现"></a>序列化实现</h3><blockquote><p>ArrayList 是实现了<code>java.io.Serializable</code>接口以达到序列化的目地，所以重写了readObject()方法和writeObject()方法</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(java.io.ObjectOutputStream s)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> java.io.IOException</span>&#123;</span><br><span class="line">    <span class="comment">// Write out element count, and any hidden stuff</span></span><br><span class="line">    <span class="keyword">int</span> expectedModCount = modCount;</span><br><span class="line">    s.defaultWriteObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Write out size as capacity for behavioural compatibility with clone()</span></span><br><span class="line">    s.writeInt(size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Write out all elements in the proper order.</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;size; i++) &#123;</span><br><span class="line">        s.writeObject(elementData[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">    elementData = EMPTY_ELEMENTDATA;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read in size, and any hidden stuff</span></span><br><span class="line">    s.defaultReadObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read in capacity</span></span><br><span class="line">    s.readInt(); <span class="comment">// ignored</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// be like clone(), allocate array based upon size not capacity</span></span><br><span class="line">        <span class="keyword">int</span> capacity = calculateCapacity(elementData, size);</span><br><span class="line">        SharedSecrets.getJavaOISAccess().checkArray(s, Object[]<span class="class">.<span class="keyword">class</span>, <span class="title">capacity</span>)</span>;</span><br><span class="line">        ensureCapacityInternal(size);</span><br><span class="line"></span><br><span class="line">        Object[] a = elementData;</span><br><span class="line">        <span class="comment">// Read in all elements in the proper order.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;size; i++) &#123;</span><br><span class="line">            a[i] = s.readObject();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="添加元素"><a href="#添加元素" class="headerlink" title="添加元素"></a>添加元素</h3><blockquote><p>ArrayList重载了两个add()方法实现添加元素的操作，其中涉及到ArrayList的动态扩容</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">    rangeCheckForAdd(index);</span><br><span class="line"></span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">    System.arraycopy(elementData, index, elementData, index + <span class="number">1</span>,</span><br><span class="line">                     size - index);</span><br><span class="line">    elementData[index] = element;</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>其中，两个方法都是先调用ensureCapacityInternal()方法确保该ArrayList的容量足够</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacityInternal</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureExplicitCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    modCount++;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">        grow(minCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">    <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">    <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hugeCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (minCapacity &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> OutOfMemoryError();</span><br><span class="line">    <span class="keyword">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class="line">        Integer.MAX_VALUE :</span><br><span class="line">        MAX_ARRAY_SIZE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>当 <code>minCapacity &gt; elementData.length</code> 即添加元素后的ArrayList的最小所需容量比当前ArrayList的容量大时，执行grow()方法扩容</p><p>在add()的动态扩容中，和toArray()是的扩容一样，也是<code>oldCapacity + (oldCapacity &gt;&gt; 1);</code>在原来的基础上扩容一般，即原来的容量是10，则扩容后的容量是10 + 10/2 = 15</p></blockquote><h3 id="修改元素"><a href="#修改元素" class="headerlink" title="修改元素"></a>修改元素</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">    rangeCheck(index);</span><br><span class="line"></span><br><span class="line">    E oldValue = elementData(index);</span><br><span class="line">    elementData[index] = element;</span><br><span class="line">    <span class="keyword">return</span> oldValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>替换指定位置的元素，返回替换前的指定位置的值</p></blockquote><h3 id="移除元素"><a href="#移除元素" class="headerlink" title="移除元素"></a>移除元素</h3><blockquote><p>移除元素有两个重载方法，第一个是按照元素索引移除，第二个是按照元素值移除</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    rangeCheck(index);</span><br><span class="line"></span><br><span class="line">    modCount++;</span><br><span class="line">    E oldValue = elementData(index);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> numMoved = size - index - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</span><br><span class="line">        System.arraycopy(elementData, index+<span class="number">1</span>, elementData, index,</span><br><span class="line">                         numMoved);</span><br><span class="line">    elementData[--size] = <span class="keyword">null</span>; <span class="comment">// clear to let GC do its work</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> oldValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>该方法中，主要是通过<code>System.arraycopy(elementData, index+1, elementData, index, numMoved);</code>这段代码实现移除元素操作的，是将 elementData数组中的index+1到index+1+numMoved-1之间的元素复制到 elementData数组的index到index+numMoved-1的位置上</p><p>假如ArrayList中有三个元素：a、b、c、d，则执行<code>remove(2)</code>时，先将3号(2+1)位置到3(2+1+1-1)号位置上的d，复制到该list的2(index=2)号到2(2+1-1)号位置上，也就是这个list变成了a、b、d、d，然后执行<code>elementData[--size] = null;</code>将3号位置上的值重置为null，并通知GC回收该位置</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; size; index++)</span><br><span class="line">            <span class="keyword">if</span> (elementData[index] == <span class="keyword">null</span>) &#123;</span><br><span class="line">                fastRemove(index);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; size; index++)</span><br><span class="line">            <span class="keyword">if</span> (o.equals(elementData[index])) &#123;</span><br><span class="line">                fastRemove(index);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>通过Object删除值和上面的通过索引删除类似，只不过通过元素删除时，先遍历list，找到该Object所在的位置，然后再执行替换并重置为null的操作</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fastRemove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">int</span> numMoved = size - index - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</span><br><span class="line">        System.arraycopy(elementData, index+<span class="number">1</span>, elementData, index,</span><br><span class="line">                         numMoved);</span><br><span class="line">    elementData[--size] = <span class="keyword">null</span>; <span class="comment">// clear to let GC do its work</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="遍历List"><a href="#遍历List" class="headerlink" title="遍历List"></a>遍历List</h3><blockquote><p><strong>ArrayList的在JDK1.8时就支持lambda表达式通过forEach遍历list了，但暂时没有看lambda的源码，留后补充</strong></p><p>ArrayListSpliterator</p></blockquote><h3 id="克隆"><a href="#克隆" class="headerlink" title="克隆"></a>克隆</h3><blockquote><p><code>ArrayList</code>被 <code>Cloneable</code> 接口标记，所以只要重写了clone()方法，就可以实现元素的拷贝</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">clone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ArrayList&lt;?&gt; v = (ArrayList&lt;?&gt;) <span class="keyword">super</span>.clone();</span><br><span class="line">        v.elementData = Arrays.copyOf(elementData, size);</span><br><span class="line">        v.modCount = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">        <span class="comment">// this shouldn't happen, since we are Cloneable</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InternalError(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>此处没有对具体元素的做clone处理，所以只是浅克隆</p></blockquote><h2 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h2><blockquote><p>LinkedList是List接口的链表的实现，类继承关系如下：</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1598799346/LinkedList_gwrgd3.png" alt="LinkedList"></p><blockquote><p>如上LinkedList类实现了如下接口：</p><ul><li>Serializable：所以它可以序列化（标记接口）</li><li>Cloneable：它实现了Cloneable且实现了Object的clone方法，所以可是实现克隆（标记接口）</li><li>Deque: 该接口制定了双向链表的规范</li></ul><p>继承了以下类：</p><ul><li>AbstractSequentialList: 该类提供了「顺序访问」数据结构的简单实现</li></ul></blockquote><h3 id="属性-4"><a href="#属性-4" class="headerlink" title="属性"></a>属性</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><blockquote><p>LinkedList的长度，即节点个数</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">transient</span> Node&lt;E&gt; first;</span><br></pre></td></tr></table></figure><blockquote><p>不可变，指第一个节点</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">transient</span> Node&lt;E&gt; last;</span><br></pre></td></tr></table></figure><blockquote><p>不可变，指最后一个节点</p></blockquote><h3 id="内部类-1"><a href="#内部类-1" class="headerlink" title="内部类"></a>内部类</h3><h4 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    E item;</span><br><span class="line">    Node&lt;E&gt; next;</span><br><span class="line">    Node&lt;E&gt; prev;</span><br><span class="line"></span><br><span class="line">    Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123;</span><br><span class="line">        <span class="keyword">this</span>.item = element;</span><br><span class="line">        <span class="keyword">this</span>.next = next;</span><br><span class="line">        <span class="keyword">this</span>.prev = prev;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>该类定义了双向链表的数据结构，item是该节点的元素，next是下一个节点的地址，prev是上个节点的地址</p></blockquote><h4 id="ListItr-1"><a href="#ListItr-1" class="headerlink" title="ListItr"></a>ListItr</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ListItr</span> <span class="keyword">implements</span> <span class="title">ListIterator</span>&lt;<span class="title">E</span>&gt;</span>&#123;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>该类实现了ListIterator接口，实现了LinkedList的迭代器，属性主要有：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Node&lt;E&gt; lastReturned; <span class="comment">// 最近一次返回的节点</span></span><br><span class="line"><span class="keyword">private</span> Node&lt;E&gt; next; <span class="comment">// 下一个节点</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> nextIndex; <span class="comment">// 下一节点的索引</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> expectedModCount = modCount; <span class="comment">// 更改数</span></span><br></pre></td></tr></table></figure><blockquote><p>该迭代器中实现了ListIterator中定义的add()、set()、remove()、next()等方法</p></blockquote><h4 id="DescendingIterator"><a href="#DescendingIterator" class="headerlink" title="DescendingIterator"></a>DescendingIterator</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">DescendingIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ListItr itr = <span class="keyword">new</span> ListItr(size());</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> itr.hasPrevious();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> itr.previous();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        itr.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="获取节点"><a href="#获取节点" class="headerlink" title="获取节点"></a>获取节点</h3><blockquote><p>该node()方法，根据索引值获取链表中的节点值</p><p>以为链表不能和数组一样通过下表获取值，所以在获取值时，先根据index和链表长度，判断index的值在链表的前半部分还是后半部分，然后再通过循环链表的方式获取指定索引的节点值</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Node&lt;E&gt; <span class="title">node</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// assert isElementIndex(index);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &lt; (size &gt;&gt; <span class="number">1</span>)) &#123;</span><br><span class="line">        Node&lt;E&gt; x = first;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++)</span><br><span class="line">            x = x.next;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Node&lt;E&gt; x = last;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = size - <span class="number">1</span>; i &gt; index; i--)</span><br><span class="line">            x = x.prev;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="构造方法-1"><a href="#构造方法-1" class="headerlink" title="构造方法"></a>构造方法</h3><blockquote><p>LinkedList有两个构造方法：空参构造方法、指定集合的构造方法</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在指定集合的构造方法中，其实第一步也是调用空参构造方法实例化一个空的LinkedList，然后再调用addAll()方法将指定集合逐个添加到LinkedList中</p></blockquote><blockquote><p>而在addAll()的过程中，也分两种情况：1. 该LinkedList为空，2. 其他线程已经向该LinkedList中添加了元素</p></blockquote><blockquote><p>该LinkedList为空时：</p><ul><li>将参数c集合通过<code>toArray</code>转成数组，声明两个临时Node变量pred和succ，pred为当前的游标值</li><li><code>pred=last</code>将游标Node置为最后一个元素，遍历上步c集合转换后的数组，将遍历的第一个元素置为first：<code>first = newNode;</code></li><li>循环遍历数组，移动游标Node。完成遍历后将last设置为最后一个游标Node</li></ul></blockquote><blockquote><p>其他线程已经向该LinkedList中添加了元素时：</p><ul><li>将succ置为索引指定的Node：<code>succ = node(index);</code> 将游标Node置为succ的下一个元素：<code>pred = succ.prev;</code></li><li>循环向游标Node中添加next值</li><li>将游标Node的下一个指定为succ，将succ的上一个指定为游标Node：<code>pred.next = succ;succ.prev = pred;</code></li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>();</span><br><span class="line">    addAll(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> addAll(size, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(<span class="keyword">int</span> index, Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    checkPositionIndex(index);</span><br><span class="line"></span><br><span class="line">    Object[] a = c.toArray();</span><br><span class="line">    <span class="keyword">int</span> numNew = a.length;</span><br><span class="line">    <span class="keyword">if</span> (numNew == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    Node&lt;E&gt; pred, succ;</span><br><span class="line">    <span class="keyword">if</span> (index == size) &#123;</span><br><span class="line">        succ = <span class="keyword">null</span>;</span><br><span class="line">        pred = last;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        succ = node(index);</span><br><span class="line">        pred = succ.prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Object o : a) &#123;</span><br><span class="line">        <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>) E e = (E) o;</span><br><span class="line">        Node&lt;E&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(pred, e, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (pred == <span class="keyword">null</span>)</span><br><span class="line">            first = newNode;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            pred.next = newNode;</span><br><span class="line">        pred = newNode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (succ == <span class="keyword">null</span>) &#123;</span><br><span class="line">        last = pred;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        pred.next = succ;</span><br><span class="line">        succ.prev = pred;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    size += numNew;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="克隆-1"><a href="#克隆-1" class="headerlink" title="克隆"></a>克隆</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">clone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    LinkedList&lt;E&gt; clone = superClone();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Put clone into "virgin" state</span></span><br><span class="line">    clone.first = clone.last = <span class="keyword">null</span>;</span><br><span class="line">    clone.size = <span class="number">0</span>;</span><br><span class="line">    clone.modCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize clone with our elements</span></span><br><span class="line">    <span class="keyword">for</span> (Node&lt;E&gt; x = first; x != <span class="keyword">null</span>; x = x.next)</span><br><span class="line">        clone.add(x.item);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> clone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> LinkedList&lt;E&gt; <span class="title">superClone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (LinkedList&lt;E&gt;) <span class="keyword">super</span>.clone();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InternalError(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>此处并未对Node节点的item做clone处理，所以依旧是浅克隆</p></blockquote><h3 id="获取对象索引"><a href="#获取对象索引" class="headerlink" title="获取对象索引"></a>获取对象索引</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Node&lt;E&gt; x = first; x != <span class="keyword">null</span>; x = x.next) &#123;</span><br><span class="line">            <span class="keyword">if</span> (x.item == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">return</span> index;</span><br><span class="line">            index++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Node&lt;E&gt; x = first; x != <span class="keyword">null</span>; x = x.next) &#123;</span><br><span class="line">            <span class="keyword">if</span> (o.equals(x.item))</span><br><span class="line">                <span class="keyword">return</span> index;</span><br><span class="line">            index++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>该方法是通过Object获取链表中该Object的索引值的，在该方法中，为什么null和非null情况不能放到一起呢？</p></blockquote><blockquote><p>先来明确<code>==</code>和<code>equals()</code>的区别：</p><ol><li>对于<code>==</code>,</li></ol><ul><li>如果作用与基本数据类型的变量，则直接比较其存储的值是否相等</li><li>如果作用于引用类型的变量，则比较的是所指向的对象的地址</li></ul><ol start="2"><li>对于<code>equals()</code></li></ol><ul><li>不能作用于基本数据类型的变量</li><li>如果没有对<code>equals()</code>方法重写，则比较的是引用类型的变量所指向的对象的地址。对于String、Date等类对<code>equals()</code>方法进行了重写，所以比较的是对象的内容。</li></ul></blockquote><blockquote><p>在此处将null和非null分开主要是因为如果<code>null.equals()</code>的话会报<code>NullPointerException</code>的异常，所以要分开。<strong>正因为有这种情况，所以在coding时，在使用<code>equals()</code>时需要做判断，如<code>if(str!=null &amp;&amp; str.equals(&quot;XXX&quot;)){}</code></strong></p></blockquote><h3 id="序列化实现-1"><a href="#序列化实现-1" class="headerlink" title="序列化实现"></a>序列化实现</h3><blockquote><p>LinkedList实现了<code>java.io.Serializable</code>接口，所以重写了writeObject()方法和readObject()方法，以达到序列化的目的</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(java.io.ObjectOutputStream s)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> java.io.IOException </span>&#123;</span><br><span class="line">    <span class="comment">// Write out any hidden serialization magic</span></span><br><span class="line">    s.defaultWriteObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Write out size</span></span><br><span class="line">    s.writeInt(size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Write out all elements in the proper order.</span></span><br><span class="line">    <span class="keyword">for</span> (Node&lt;E&gt; x = first; x != <span class="keyword">null</span>; x = x.next)</span><br><span class="line">        s.writeObject(x.item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">    <span class="comment">// Read in any hidden serialization magic</span></span><br><span class="line">    s.defaultReadObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read in size</span></span><br><span class="line">    <span class="keyword">int</span> size = s.readInt();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read in all elements in the proper order.</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">        linkLast((E)s.readObject());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;List&quot;&gt;&lt;a href=&quot;#List&quot; class=&quot;headerlink&quot; title=&quot;List&quot;&gt;&lt;/a&gt;List&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;https://res.cloudinary.com/djy7jydp5/image/upload/v1
      
    
    </summary>
    
    
      <category term="源码分析" scheme="http://yoursite.com/categories/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="List" scheme="http://yoursite.com/tags/List/"/>
    
      <category term="ArrayList" scheme="http://yoursite.com/tags/ArrayList/"/>
    
      <category term="LinkedList" scheme="http://yoursite.com/tags/LinkedList/"/>
    
      <category term="AbstractCollection" scheme="http://yoursite.com/tags/AbstractCollection/"/>
    
      <category term="AbstractList" scheme="http://yoursite.com/tags/AbstractList/"/>
    
  </entry>
  
  <entry>
    <title>HTTP重定向</title>
    <link href="http://yoursite.com/2020/08/14/%E9%87%8D%E5%AE%9A%E5%90%91/"/>
    <id>http://yoursite.com/2020/08/14/%E9%87%8D%E5%AE%9A%E5%90%91/</id>
    <published>2020-08-14T08:35:00.000Z</published>
    <updated>2020-08-30T17:25:20.657Z</updated>
    
    <content type="html"><![CDATA[<h2 id="WHAT"><a href="#WHAT" class="headerlink" title="WHAT"></a>WHAT</h2><h3 id="重定向和转发"><a href="#重定向和转发" class="headerlink" title="重定向和转发"></a>重定向和转发</h3><h4 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h4><blockquote><p>重定向 是一种当实际资源，如单个页面、域名等被迁移到新的位置的时候，保持原有地址可用的技术。HTTP协议提供了一种特殊形式的响应，HTTP重定向来处理这种情况。</p></blockquote><blockquote><p>HTTP重定向是由浏览器进行跳转的，浏览器根据收到的Http Code和Location具体决定挑战到哪个新位置，它本质上是发送了两个http请求，并且重定向后浏览器的地址栏会变成Location中的值。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">浏览器 -&gt; 服务器: GET &#x2F;api HTTP&#x2F;1.1</span><br><span class="line">服务器 --&gt; 浏览器: HTTP&#x2F;1.1 301 Moved Permanently\n Location: &#x2F;api_new</span><br><span class="line">浏览器 --&gt; 服务器: GET &#x2F;api_new HTTP&#x2F;1.1</span><br><span class="line">服务器 -&gt; 浏览器: HTTP&#x2F;1.1 200 OK</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><h4 id="转发"><a href="#转发" class="headerlink" title="转发"></a>转发</h4><blockquote><p>转发是由服务器完成的，在转发时，浏览器的地址栏是不会发生变化的，并且转发是对浏览器透明的，也就是浏览器并不知道本次请求发生了转发。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">浏览器 -&gt; 网关服务器: GET &#x2F;api HTTP&#x2F;1.1</span><br><span class="line">网关服务器 --&gt; 上游服务器: GET &#x2F;api2 HTTP&#x2F;1.1</span><br><span class="line">上游服务器 --&gt; 网关服务器: HTTP&#x2F;1.1 200 OK</span><br><span class="line">网关服务器 -&gt; 浏览器: HTTP&#x2F;1.1 200 OK</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><h3 id="Http重定向分类"><a href="#Http重定向分类" class="headerlink" title="Http重定向分类"></a>Http重定向分类</h3><h4 id="永久重定向"><a href="#永久重定向" class="headerlink" title="永久重定向"></a>永久重定向</h4><blockquote><p>永久重定向的操作是 <strong>永久性</strong> 的。它表示原有的URL不应再被使用，应该优先选用新的URL。</p></blockquote><blockquote><p>谷歌搜索引擎在遇到301时，会直接收录新的URL。</p></blockquote><table><thead><tr><th>HTTP状态码</th><th>处理</th><th>应用场景</th></tr></thead><tbody><tr><td>301 Moved Permanent</td><td>GET方法不会发生改变，其他方法有可能会变为GET方法</td><td>请求的 URL 已被移除时使用；默认情况下，永久重定向是会被浏览器缓存的</td></tr><tr><td><strong>308 Permanent Redirect</strong></td><td>方法和消息体都不会发生变化</td><td>用于非GET方法，被浏览器默认缓存</td></tr></tbody></table><h4 id="临时重定向"><a href="#临时重定向" class="headerlink" title="临时重定向"></a>临时重定向</h4><blockquote><p>可以简单的理解为被访问的资源原本确实存在，但已经被 <strong>临时</strong> 改变了位置。</p></blockquote><blockquote><p>这种情况下，谷歌搜索引擎不会记录新的、临时的URL。</p></blockquote><table><thead><tr><th>HTTP状态码</th><th>处理</th><th>备注</th></tr></thead><tbody><tr><td>302 Found</td><td>GET方法不会发生变更，其他方法有可能变更为GET方法</td><td>由于不可预见的原因该页面暂时不可用。在这种情况下，搜索引擎不会更新它们的链接</td></tr><tr><td>303 See Other</td><td>GET方法不会发生变更，其他方法会变更为GET方法</td><td>用户PUT或POST请求完成之后进行页面跳转来防止由于页面刷新导致的操作重复触发</td></tr><tr><td><strong>307 Temporary Redirect</strong></td><td>方法和消息体都不发生变化</td><td>由于不可预见的原因该页面暂时不可用。在这种情况下，搜索引擎不会更新它们的链接。当站点支持非GET方法的链接或操作的时候，该状态码优于302状态码。<strong>307与302相比，307不允许修改请求方法</strong></td></tr></tbody></table><h4 id="特殊重定向"><a href="#特殊重定向" class="headerlink" title="特殊重定向"></a>特殊重定向</h4><blockquote><p>特殊重定向的状态码包括304和300，304表示资源未被修改，会使页面跳转到本地就的缓存版本中；而300表示多项选择，是一种手动重定向：以web页面形式呈现在浏览器中的消息主体包含了一个可能的重定向链接的列表，用户可以从中选择。</p></blockquote><table><thead><tr><th>HTTP状态码</th><th>应用场景</th></tr></thead><tbody><tr><td>300 Multiple Choice</td><td>不常用。所有的选项在消息主体的HTML页面中列出，可在Link头部加入机器可读的rel=alternate</td></tr><tr><td>304 Not Modified</td><td>发送用于重新验证的条件请求。表示缓存的响应仍然是最新的并且可以使用</td></tr></tbody></table><h2 id="HOW"><a href="#HOW" class="headerlink" title="HOW"></a>HOW</h2><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><h4 id="docker安装"><a href="#docker安装" class="headerlink" title="docker安装"></a>docker安装</h4><blockquote><p>略</p></blockquote><h4 id="lamp环境配置"><a href="#lamp环境配置" class="headerlink" title="lamp环境配置"></a>lamp环境配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拉取现成别人做好的lamp镜像</span></span><br><span class="line">[gtang94@izwz9hvzt7nfcuosqsmqtfz ~]$ docker pull xiaowenxiao/lamp:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看拉取的镜像</span></span><br><span class="line">[gtang94@izwz9hvzt7nfcuosqsmqtfz ~]$ docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">xiaowenxiao/lamp    latest              fb7c111e75ee        12 months ago       3.86GB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建挂载路径</span></span><br><span class="line">[gtang94@izwz9hvzt7nfcuosqsmqtfz ~]$ mkdir /usr/<span class="built_in">local</span>/lamp/project &amp;&amp; chmod 777 /usr/<span class="built_in">local</span>/lamp/project</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动容器</span></span><br><span class="line">[gtang94@izwz9hvzt7nfcuosqsmqtfz ~]$ docker run --privileged -tid -p 3307:3306 -p 81:80 -v /usr/<span class="built_in">local</span>/lamp/project:/var/www/project --name=lamp xiaowenxiao/lamp:latest /usr/sbin/init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看容器启动状态</span></span><br><span class="line">[gtang94@izwz9hvzt7nfcuosqsmqtfz ~]$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE                     COMMAND             CREATED             STATUS              PORTS                                                NAMES</span><br><span class="line">bfdb64914288        xiaowenxiao/lamp:latest   <span class="string">"/usr/sbin/init"</span>    4 seconds ago       Up 4 seconds        22/tcp, 0.0.0.0:81-&gt;80/tcp, 0.0.0.0:3307-&gt;3306/tcp   lamp</span><br></pre></td></tr></table></figure><h3 id="Apache重定向"><a href="#Apache重定向" class="headerlink" title="Apache重定向"></a>Apache重定向</h3><h4 id="Apache支持-htaccess"><a href="#Apache支持-htaccess" class="headerlink" title="Apache支持.htaccess"></a>Apache支持.htaccess</h4><blockquote><ul><li>修改 /etc/httpd/conf/httpd.conf， 将 &lt;Directory “/var/www/project”&gt; 中的 AllowOverride None 改成 AllowOverride All</li><li>重启apache : <code>systemctl restart httpd.service</code></li></ul></blockquote><blockquote><p>启用 .htaccess 后，每次请求资源时，无论是否真正用到，都需要在每个目录下查找读取.htaccess文件。例如访，问 /gateway/user/list.html，需要依次查找：</p><ul><li>/.htaccess</li><li>/gateway/.htaccess</li><li>/gateway/user/.htaccess</li></ul></blockquote><h4 id="htaccess基本正则"><a href="#htaccess基本正则" class="headerlink" title=".htaccess基本正则"></a>.htaccess基本正则</h4><table><thead><tr><th>字符</th><th>描述</th></tr></thead><tbody><tr><td>.</td><td>匹配换行符以外的所有字符</td></tr><tr><td>\w</td><td>匹配字母、数字、下划线、汉字</td></tr><tr><td>\s</td><td>匹配任意空白符</td></tr><tr><td>\d</td><td>匹配数字</td></tr><tr><td>\b</td><td>匹配单词的开始或结束</td></tr><tr><td>^</td><td>匹配以某个字符串开始</td></tr><tr><td>$</td><td>匹配以某个字符串结束</td></tr><tr><td>*</td><td>匹配零次或多次</td></tr><tr><td>+</td><td>匹配依次或多次</td></tr><tr><td>?</td><td>匹配零次或一次</td></tr><tr><td>{n}</td><td>重复n次</td></tr><tr><td>{n,}</td><td>重复n次或n次以上</td></tr><tr><td>{n,m}</td><td>重复n到m次</td></tr><tr><td>()</td><td>一个括号代表一个分组，第一个括号的内容用 $1 引用，第二个括号的内容用 $2 引用，依次类推</td></tr></tbody></table><h4 id="htaccess语法"><a href="#htaccess语法" class="headerlink" title=".htaccess语法"></a>.htaccess语法</h4><h5 id="RewriteEngine"><a href="#RewriteEngine" class="headerlink" title="RewriteEngine"></a>RewriteEngine</h5><blockquote><p>RewriteEngine 用于开启或停用rewrite功能，值为 On 或 Off，例：<code>RewriteEngine On</code></p></blockquote><h5 id="RewriteBase"><a href="#RewriteBase" class="headerlink" title="RewriteBase"></a>RewriteBase</h5><blockquote><p>RewriteBase 用于设置重写的基准目录，根目录使用 / ，例：<code>RewriteBase /</code></p></blockquote><h5 id="RewriteCond"><a href="#RewriteCond" class="headerlink" title="RewriteCond"></a>RewriteCond</h5><blockquote><p>RewriteCond 用于设置匹配的条件，只有匹配所有的 RewriteCond 后才能进入下面的 RewriteRule </p></blockquote><blockquote><p>RewriteCond 的语法格式：<code>RewriteCond TestString CondPattern [flags]</code></p></blockquote><blockquote><p>TestString 是一个纯文本的字符串，主要参数如下：</p></blockquote><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>HTTP_HOST</td><td>当前请求的 Host: 头部的内容</td></tr><tr><td>HTTP_COOKIE</td><td>cookie</td></tr><tr><td>HTTP_UPGRADE_INSECURE_REQUESTS</td><td>表示浏览器可读懂服务器发过来的请求</td></tr><tr><td>HTTP_USER_AGENT</td><td>获取用户相关信息，包括用户浏览器、操作系统等信息</td></tr><tr><td>HTTP_ACCEPT</td><td>当前请求的ACCEPT头部信息</td></tr><tr><td>HTTP_ACCEPT_LANGUAGE</td><td><em>当前请求的 Accept-Language: 头部的内容。例如：“en”</em></td></tr><tr><td>SERVER_SIGNATURE</td><td><em>包含服务器版本和 虚拟主机名的字符串</em></td></tr><tr><td>SERVER_SOFTWARE</td><td><em>服务器标识的字串，在响应请求时的头部中给出</em></td></tr><tr><td>SERVER_NAME</td><td>当前 运行脚本所在服务器 主机的名称</td></tr><tr><td>SERVER_ADDR</td><td>当前 运行脚本所在服务器 IP地址</td></tr><tr><td>SERVER_PORT</td><td>当前 运行脚本所在服务器 端口</td></tr><tr><td>REMOTE_ADDR</td><td>正在浏览当前页面用户的 IP 地址</td></tr><tr><td>DOCUMENT_ROOT</td><td>当前 运行脚本所在的文档根目录。在服务器配置文件中定义</td></tr><tr><td>SERVER_ADMIN</td><td>管理员信息</td></tr><tr><td>SCRIPT_FILENAME</td><td>当前执行 脚本的 绝对路径名</td></tr><tr><td>REMOTE_PORT</td><td>用户连接到服务器时所使用的端口</td></tr><tr><td>GATEWAY_INTERFACE</td><td>服务器使用的 CGI 规范的版本。例如，“CGI/1.1”</td></tr><tr><td>SERVER_PROTOCOL</td><td>请求页面时通信协议的名称和版本。例如，“HTTP/1.0”</td></tr><tr><td>REQUEST_METHOD</td><td>访问页面时的请求方法。例如：“GET”、“HEAD”，“POST”，“PUT”</td></tr><tr><td>QUERY_STRING</td><td>查询(query)的字符串</td></tr><tr><td>REQUEST_URI</td><td>访问此页面所需的 URI。例如，“/index.html”</td></tr><tr><td>SCRIPT_NAME</td><td>包含当前 脚本的路径。这在页面需要指向自己时非常有用</td></tr><tr><td>PHP_SELF</td><td>当前正在执行 脚本的文件名，与 document root相关</td></tr><tr><td>PATH_TRANSLATED</td><td>当前 脚本所在文件系统（不是文档根目录）的基本路径</td></tr><tr><td>argv</td><td>传递给该 脚本的参数</td></tr></tbody></table><blockquote><p>CondPattern 是条件pattern，也就是TestString的具体值会被计算与CondPattern匹配，用 ! 是表示匹配的反转</p><p>flags 是RewriteCond的标志符，有以下参数：</p></blockquote><table><thead><tr><th>字符</th><th>描述</th></tr></thead><tbody><tr><td>nocase|NC</td><td>忽略大小</td></tr><tr><td>ornext|OR</td><td>逻辑或，可以同时匹配多个RewriteCond条件RewriteRule适用的标志符</td></tr><tr><td>redirect|R [=code]</td><td>强迫重写为基于http开头的外部转向(注意URL的变化) 如：[R=301,L]</td></tr><tr><td>forbidden|F</td><td>重写为禁止访问</td></tr><tr><td>proxy|P</td><td>重写为通过代理访问的http路径</td></tr><tr><td>last|L</td><td>最后的重写规则标志，如果匹配，不再执行以后的规则</td></tr><tr><td>next|N</td><td>循环同一个规则，直到不能满足匹配</td></tr><tr><td>chain|C</td><td>如果匹配该规则，则继续下面的有Chain标志的规则</td></tr><tr><td>type|T=MIME-type</td><td>指定MIME类型</td></tr><tr><td>nosubreq|NS</td><td>如果是内部子请求则跳过</td></tr><tr><td>nocase|NC</td><td>忽略大小</td></tr><tr><td>qsappend|QSA</td><td>附加查询字符串</td></tr><tr><td>noescape|NE</td><td>禁止URL中的字符自动转义成%[0-9]+的形式</td></tr><tr><td>passthrough|PT</td><td>将重写结果运用于mod_alias</td></tr><tr><td>skip|S=num</td><td>跳过下面几个规则</td></tr></tbody></table><h5 id="RewriteRule"><a href="#RewriteRule" class="headerlink" title="RewriteRule"></a>RewriteRule</h5><blockquote><p>RewriteRule 是具体的重定向规则， 语法格式：<code>RewriteRule Pattern Substitution [flags]</code></p></blockquote><blockquote><p>Pattern：一般是重定向前的URL</p><p>Substitution：一般是重定向后的新URL</p><p>flags 是Rewrite的标志符，一般有以下参数：</p></blockquote><table><thead><tr><th>字符</th><th>描述</th></tr></thead><tbody><tr><td>R</td><td>表示强制重定向，后面可跟返回给浏览器的HTTP状态码（常用）</td></tr><tr><td>F</td><td>表示禁止访问（常用）</td></tr><tr><td>L</td><td>表示当前规则是最后一条规则，停止读取后面的条件和规则，立即执行当前重定向（常用）</td></tr><tr><td>G</td><td>表示强制URL变为GONE，返回410的HTTP状态码</td></tr><tr><td>P</td><td>表示强制使用代理转发</td></tr><tr><td>N</td><td>表示重新从第一条规则开始重新允许重写过程</td></tr><tr><td>C</td><td>表示与下一条规则关联</td></tr><tr><td>T</td><td>表示强制转为MIME类型</td></tr><tr><td>NS</td><td>只用于不是内部的子请求</td></tr><tr><td>NC</td><td>不区分大小写</td></tr><tr><td>QSA</td><td>追加请求字符串</td></tr><tr><td>NE</td><td>不再输出转义特殊字符</td></tr><tr><td>PT</td><td>表示传递给下一个处理</td></tr></tbody></table><h5 id="AcceptPathInfo"><a href="#AcceptPathInfo" class="headerlink" title="AcceptPathInfo"></a>AcceptPathInfo</h5><blockquote><p>改指令决定是否在接受附带多余路径名信息的请求，语法：<code>AcceptPathInfo On|Off|Default</code> ，此指令默认是Default，指令取值范围如下：</p></blockquote><table><thead><tr><th>取值</th><th>描述</th></tr></thead><tbody><tr><td>On</td><td>只要前导路径可以映射到一个真实存在的路径，就可以接受该请求</td></tr><tr><td>Off</td><td>只有当一个请求映射到真实存在的路径时，才会被接受</td></tr><tr><td>Default</td><td>是否接收附带多余路径名信息的请求又其处理器(cgi-script、isapi-isa)决定</td></tr></tbody></table><h3 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h3><h4 id="将H5的客户端发送的请求重定向到指定文件"><a href="#将H5的客户端发送的请求重定向到指定文件" class="headerlink" title="将H5的客户端发送的请求重定向到指定文件"></a>将H5的客户端发送的请求重定向到指定文件</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RewriteCond %&#123;HTTP_USER_AGENT&#125; (iPhone|Android|dream|CUPCAKE|blackberry9500|blackberry9530|blackberry9520|blackberry9550|blackberry9800|webOS|incognito|webmate)</span><br><span class="line">RewriteRule ^a.html b.html [R=301,L]</span><br></pre></td></tr></table></figure><h4 id="重定向死循环"><a href="#重定向死循环" class="headerlink" title="重定向死循环"></a>重定向死循环</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果是sp的URL，用pc客户但打开后URL变成pc的URL，用sp的客户端打开后URL变成pc的URL</span></span><br><span class="line"><span class="comment"># 如果是pc的URL，用pc客户但打开后URL变成pc的URL，用sp的客户端打开后URL变成pc的URL</span></span><br><span class="line">RewriteCond %&#123;HTTP_USER_AGENT&#125; (iPhone|Android|dream|CUPCAKE|blackberry9500|blackberry9530|blackberry9520|blackberry9550|blackberry9800|webOS|incognito|webmate)</span><br><span class="line">RewriteRule die_pc.html die_sp.html</span><br><span class="line"></span><br><span class="line">RewriteRule die_sp.html die_pc.html [R=301,L]</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RewriteCond %&#123;HTTP_USER_AGENT&#125; (iPhone|Android|dream|CUPCAKE|blackberry9500|blackberry9530|blackberry9520|blackberry9550|blackberry9800|webOS|incognito|webmate)</span><br><span class="line">RewriteRule die_pc.html die_sp.html [L]</span><br><span class="line"></span><br><span class="line">RewriteCond %&#123;ENV:REDIRECT_STATUS&#125; ^$</span><br><span class="line">RewriteRule die_sp.html die_pc.html [R=301,L]</span><br></pre></td></tr></table></figure><h4 id="多条件满足"><a href="#多条件满足" class="headerlink" title="多条件满足"></a>多条件满足</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RewriteCond %&#123;REMOTE_ADDR&#125; ^1\.80\.146\.247$ [OR]</span><br><span class="line">RewriteCond %&#123;HTTP_USER_AGENT&#125; (iPhone|Android|dream|CUPCAKE|blackberry9500|blackberry9530|blackberry9520|blackberry9550|blackberry9800|webOS|incognito|webmate)</span><br><span class="line">RewriteRule mul.html 404.html</span><br></pre></td></tr></table></figure><h4 id="按照请求的资源类型匹配"><a href="#按照请求的资源类型匹配" class="headerlink" title="按照请求的资源类型匹配"></a>按照请求的资源类型匹配</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; -f</span><br><span class="line">RewriteRule ^ft(.*)\.html ft.html [R=301,L]</span><br></pre></td></tr></table></figure><h4 id="按资源类型转发-排除特定文件"><a href="#按资源类型转发-排除特定文件" class="headerlink" title="按资源类型转发(排除特定文件)"></a>按资源类型转发(排除特定文件)</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !ft1.html</span><br><span class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; -f</span><br><span class="line">RewriteRule ^ft(\d+)\.html ft.html [R=301,L]</span><br></pre></td></tr></table></figure><h4 id="全目录下的资源重定向"><a href="#全目录下的资源重定向" class="headerlink" title="全目录下的资源重定向"></a>全目录下的资源重定向</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RewriteCond %&#123;HTTP_USER_AGENT&#125; (iPhone|Android|dream|CUPCAKE|blackberry9500|blackberry9530|blackberry9520|blackberry9550|blackberry9800|webOS|incognito|webmate)</span><br><span class="line">RewriteRule ^learn/(\d+).html learn.html [L]</span><br></pre></td></tr></table></figure><h4 id="参数匹配重定向"><a href="#参数匹配重定向" class="headerlink" title="参数匹配重定向"></a>参数匹配重定向</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RewriteCond %&#123;QUERY_STRING&#125; (p=2)$</span><br><span class="line">RewriteRule ^param1.html param2.html [L]</span><br></pre></td></tr></table></figure><h4 id="请求转发"><a href="#请求转发" class="headerlink" title="请求转发"></a>请求转发</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RewriteRule a.html b.html</span><br></pre></td></tr></table></figure><h4 id="添加参数重定向"><a href="#添加参数重定向" class="headerlink" title="添加参数重定向"></a>添加参数重定向</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RewriteRule ^addp1.php addp2.php?p2=22222 [QSA,L]</span><br></pre></td></tr></table></figure><h4 id="POST请求的重定向"><a href="#POST请求的重定向" class="headerlink" title="POST请求的重定向"></a>POST请求的重定向</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--index.html--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>This is a simple HTML form!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"out_before.php"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">name:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">select some products: <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">"products[]"</span> <span class="attr">size</span>=<span class="string">6</span> <span class="attr">multiple</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"c++"</span>&gt;</span>c++<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"c#"</span>&gt;</span>c#<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"php"</span>&gt;</span>php<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"Python"</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"lua"</span>&gt;</span>lua<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"JavaScript"</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">Message:<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">"message"</span> <span class="attr">rows</span>=<span class="string">"5"</span> <span class="attr">cols</span>=<span class="string">"40"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"ok"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//out_before.php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;pre&gt;"</span>;</span><br><span class="line">print_r($_SERVER);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/pre&gt;"</span>;</span><br><span class="line"><span class="keyword">exit</span>;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// out_after.php</span></span><br><span class="line">header(<span class="string">"Content-Type: text/html; charset=UTF-8"</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">"username"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"输入的名户名为："</span> . $_POST[<span class="string">"username"</span>] . <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">"products"</span>])) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (is_array($_POST[<span class="string">"products"</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">"products"</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"选择的科目为："</span> . <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">        <span class="keyword">foreach</span> ($_POST[<span class="string">"products"</span>] <span class="keyword">as</span>  $value ) &#123;</span><br><span class="line">            <span class="keyword">echo</span>  <span class="string">"$value &lt;br /&gt;"</span>;&#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"选择的个数为："</span> . count($_POST[<span class="string">"products"</span></span><br><span class="line">        ]) . <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">"message"</span>])) </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"输入的消息为："</span> . $_POST[<span class="string">"message"</span>] . <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .htaccess</span></span><br><span class="line">RewriteEngine On</span><br><span class="line">RewriteBase /</span><br><span class="line"></span><br><span class="line"><span class="comment">#RewriteRule ^out_before.php p308/out_after.php [R=301,L]</span></span><br><span class="line"></span><br><span class="line">RewriteRule ^out_before.php p308/out_after.php [R=308,L]</span><br></pre></td></tr></table></figure><h3 id="代码中重定向"><a href="#代码中重定向" class="headerlink" title="代码中重定向"></a>代码中重定向</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">'HTTP/1.1 301 Moved Permanently'</span>);</span><br><span class="line">header(<span class="string">"Location: phpr2.php"</span>);</span><br></pre></td></tr></table></figure><h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="HTTP-Code"><a href="#HTTP-Code" class="headerlink" title="HTTP Code"></a><a href="[https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81](https://zh.wikipedia.org/wiki/HTTP状态码)">HTTP Code</a></h3><h3 id="在线调试"><a href="#在线调试" class="headerlink" title="在线调试"></a><a href="https://htaccess.madewithlove.be/" target="_blank" rel="noopener">在线调试</a></h3><h3 id="Apache配置文件参数"><a href="#Apache配置文件参数" class="headerlink" title="Apache配置文件参数"></a>Apache配置文件参数</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">ServerRoot <span class="string">"/etc/httpd"</span> <span class="comment"># 你的apache软件安装的位置。其它指定的目录如果没有指定绝对路径，则目录是相对于该目录</span></span><br><span class="line"></span><br><span class="line">Listen 80 <span class="comment"># #服务器监听的端口号</span></span><br><span class="line"></span><br><span class="line">Include conf.modules.d/*.conf</span><br><span class="line"></span><br><span class="line">User apache</span><br><span class="line"></span><br><span class="line">Group apache</span><br><span class="line"></span><br><span class="line">ServerAdmin root@localhost <span class="comment">#管理员的邮件地址</span></span><br><span class="line"></span><br><span class="line">&lt;Directory /&gt;</span><br><span class="line">    AllowOverride none</span><br><span class="line">    Require all denied</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">DocumentRoot <span class="string">"/var/www/project"</span> <span class="comment">#主站点的网页存储位置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># == 主站点的目录进行访问控制 start ==</span></span><br><span class="line">&lt;Directory <span class="string">"/var/www/project"</span>&gt;</span><br><span class="line">    AllowOverride None</span><br><span class="line">    Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory <span class="string">"/var/www/project"</span>&gt;</span><br><span class="line"><span class="comment"># Options：配置在特定目录使用哪些特性，常用的值和基本含义如下:</span></span><br><span class="line"><span class="comment"># ExecCGI: 在该目录下允许执行CGI脚本</span></span><br><span class="line"><span class="comment"># FollowSymLinks: 在该目录下允许文件系统使用符号连接</span></span><br><span class="line"><span class="comment"># Indexes: 当用户访问该目录时，如果用户找不到DirectoryIndex指定的主页文件(例如index.html),则返回该目录下的文件列表给用户</span></span><br><span class="line"><span class="comment"># SymLinksIfOwnerMatch: 当使用符号连接时，只有当符号连接的文件拥有者与实际文件的拥有者相同时才可以访问</span></span><br><span class="line">    Options Indexes FollowSymLinks</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># AllowOverride：允许存在于.htaccess文件中的指令类型(.htaccess文件名是可以改变的，其文件名由AccessFileName指令决定):</span></span><br><span class="line">    <span class="comment"># None: 当AllowOverride被设置为None时。不搜索该目录下的.htaccess文件（可以减小服务器开销）</span></span><br><span class="line">    <span class="comment"># All: 在.htaccess文件中可以使用所有的指令</span></span><br><span class="line">    <span class="comment"># Order：控制在访问时Allow和Deny两个访问规则哪个优先</span></span><br><span class="line">    <span class="comment"># Allow：允许访问的主机列表</span></span><br><span class="line">    <span class="comment"># Deny：拒绝访问的主机列表</span></span><br><span class="line">    AllowOverride All</span><br><span class="line">    </span><br><span class="line">    Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"><span class="comment"># == 主站点的目录进行访问控制 end ==</span></span><br><span class="line"></span><br><span class="line">&lt;IfModule dir_module&gt;</span><br><span class="line">    DirectoryIndex index.php index.html</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line">&lt;Files <span class="string">".ht*"</span>&gt;</span><br><span class="line">    Require all denied</span><br><span class="line">&lt;/Files&gt;</span><br><span class="line"></span><br><span class="line">ErrorLog <span class="string">"logs/error_log"</span> <span class="comment"># 日志的保存位置</span></span><br><span class="line"></span><br><span class="line">LogLevel warn <span class="comment"># 日志的级别</span></span><br><span class="line"></span><br><span class="line">&lt;IfModule log_config_module&gt;</span><br><span class="line">    LogFormat <span class="string">"%h %l %u %t \"%r\" %&gt;s %b \"%&#123;Referer&#125;i\" \"%&#123;User-Agent&#125;i\""</span> combined</span><br><span class="line">    LogFormat <span class="string">"%h %l %u %t \"%r\" %&gt;s %b"</span> common</span><br><span class="line"></span><br><span class="line">    &lt;IfModule logio_module&gt;</span><br><span class="line">      <span class="comment"># You need to enable mod_logio.c to use %I and %O</span></span><br><span class="line">      LogFormat <span class="string">"%h %l %u %t \"%r\" %&gt;s %b \"%&#123;Referer&#125;i\" \"%&#123;User-Agent&#125;i\" %I %O"</span> combinedio</span><br><span class="line">    &lt;/IfModule&gt;</span><br><span class="line">        CustomLog <span class="string">"logs/access_log"</span> combined</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line">&lt;IfModule alias_module&gt;</span><br><span class="line">    ScriptAlias /cgi-bin/ <span class="string">"/var/www/cgi-bin/"</span></span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory <span class="string">"/var/www/cgi-bin"</span>&gt;</span><br><span class="line">    AllowOverride None</span><br><span class="line">    Options None</span><br><span class="line">    Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;IfModule mime_module&gt;</span><br><span class="line">    TypesConfig /etc/mime.types</span><br><span class="line">    </span><br><span class="line">    AddType application/x-compress .Z</span><br><span class="line">    AddType application/x-gzip .gz .tgz</span><br><span class="line">    AddType application/x-httpd-php .php</span><br><span class="line">    AddType application/x-httpd-php-source .php5</span><br><span class="line">    </span><br><span class="line">    AddType text/html .shtml</span><br><span class="line">    AddOutputFilter INCLUDES .shtml</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line">AddDefaultCharset UTF-8</span><br><span class="line"></span><br><span class="line">&lt;IfModule mime_magic_module&gt;</span><br><span class="line">    MIMEMagicFile conf/magic</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line">EnableSendfile on</span><br><span class="line"></span><br><span class="line">IncludeOptional conf.d/*.conf</span><br><span class="line">ServerName localhost:80 <span class="comment"># 主站点名称（网站的主机名）</span></span><br><span class="line">AddType application/x-httpd-php .php</span><br><span class="line">DirectoryIndex index.php index.htm index.html <span class="comment"># 主页文件的设置（本例将主页文件设置为：index.html,index.htm和index.php）</span></span><br><span class="line">AddHandler php7-script .php</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;WHAT&quot;&gt;&lt;a href=&quot;#WHAT&quot; class=&quot;headerlink&quot; title=&quot;WHAT&quot;&gt;&lt;/a&gt;WHAT&lt;/h2&gt;&lt;h3 id=&quot;重定向和转发&quot;&gt;&lt;a href=&quot;#重定向和转发&quot; class=&quot;headerlink&quot; title=&quot;重定向和转
      
    
    </summary>
    
    
      <category term="网络" scheme="http://yoursite.com/categories/%E7%BD%91%E7%BB%9C/"/>
    
    
      <category term="301" scheme="http://yoursite.com/tags/301/"/>
    
      <category term="302" scheme="http://yoursite.com/tags/302/"/>
    
      <category term="HTTP重定向" scheme="http://yoursite.com/tags/HTTP%E9%87%8D%E5%AE%9A%E5%90%91/"/>
    
      <category term="apache" scheme="http://yoursite.com/tags/apache/"/>
    
      <category term="lamp" scheme="http://yoursite.com/tags/lamp/"/>
    
  </entry>
  
  <entry>
    <title>集合接口</title>
    <link href="http://yoursite.com/2020/08/08/%E9%9B%86%E5%90%88%E6%8E%A5%E5%8F%A3/"/>
    <id>http://yoursite.com/2020/08/08/%E9%9B%86%E5%90%88%E6%8E%A5%E5%8F%A3/</id>
    <published>2020-08-08T09:09:00.000Z</published>
    <updated>2020-08-30T17:33:11.339Z</updated>
    
    <content type="html"><![CDATA[<h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><h3 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h3><blockquote><p>在Java中，有一个类专门用来存放其他类的对象，这个存放其他类的对象就叫做容器。</p></blockquote><blockquote><p>常见的容器有：</p><ul><li>Collection：存储对象的集合</li><li>Map：存储键值对（两个对象）的映射表</li><li>数组</li></ul></blockquote><h3 id="集合-Collection"><a href="#集合-Collection" class="headerlink" title="集合 Collection"></a>集合 Collection</h3><blockquote><p>集合有List、Set、Queue。集合类图继承关系如下：</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1596733072/collection_fgqruy.png" alt="collection"></p><h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><blockquote><p>map类图继承关系如下：</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1596733075/map_iubgoc.png" alt="map"></p><h2 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h2><h3 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h3><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1596964477/Object_ti6xr6.png" alt="Object"></p><blockquote><p>Object 类在 java.lang 下，Object类所有类的基类，所有类（包括数据）都实现了这个类的方法</p></blockquote><h4 id="registerNatives"><a href="#registerNatives" class="headerlink" title="registerNatives"></a>registerNatives</h4><blockquote><p>静态native方法，用来注册native方法的</p><p>在Object类的的静态代码块中，调用改方法</p></blockquote><p>####getClass</p><blockquote><p>返回该Object类的运行时类。返回的类对象是被表示类的static synchronized方法锁定的对象。</p><p>实际结构的类型是Class类型。</p></blockquote><h4 id="hashCode"><a href="#hashCode" class="headerlink" title="hashCode"></a>hashCode</h4><blockquote><p>返回这个对象的哈希值，支持这个方式是为了哈希表，例如HashMap提供的那样。</p></blockquote><blockquote><p>这个hashCode通常的概念是：</p><ul><li>只要在执行Java应用程序时多次在同一个对象上调用该方法，如果equals方法比较中使用的信息没有被修改时，hashCode方法返回必须始终返回相同的整数</li><li>如果调用equals方法检测两个对象相等，那么在这两个对象上调用hashCode方法产生的结果相同</li><li>如果调用eqlas方法检测两个对象不相等，那么这两个对象调用hashCode方法的结果一定不相同。为不相等的对象生成不同的哈希值可能会提高哈希表的性能</li></ul></blockquote><h4 id="equals"><a href="#equals" class="headerlink" title="equals"></a>equals</h4><blockquote><p>判断其他类是否和该类相等</p></blockquote><blockquote><p>equals方法在非空对象引用上的等价关系：</p><ul><li>自反性：对应任何非空的对象x，x.equals(x)返回true</li><li>对称性：对应任何非空的对象x和y，x.equals(y)返回true   y.equals(x)返回true</li><li>传递性：对应任何非空的对象x、y、z，如果 x.equals(y) 返回true、y.equals(z)返回true，则必然 x.equals(z) 返回true</li><li>一致性：对应任何非空的对象x、y，如果equals方法比较中使用的信息没有被修改时，多次调用 x.equals(y)始终返回true(或false)</li><li>对应任何非空的对象x，x.equals(null)返回false</li></ul></blockquote><blockquote><p><strong>注：覆盖该方法是，通常都需要一起覆盖hashCode方法。equals方法规定，equals相等的对象必须具有相等的哈希值</strong></p></blockquote><h4 id="clone"><a href="#clone" class="headerlink" title="clone"></a>clone</h4><blockquote><p>创建并返回该对象的副本。</p></blockquote><h5 id="为什么要用clone"><a href="#为什么要用clone" class="headerlink" title="为什么要用clone"></a>为什么要用clone</h5><blockquote><p>在实际编程中，常常遇到这样的情况：有一个对象A，在某一时刻，A对象中包含了一些有效值，此时需要一个和A对象完全相同的B对象，并且在此后对B对象的任何修改都不能改变A中的值，也就是A和B是完全独立的两个对象，但B的初始值是由A确定的。这种情况下就需要用到clone了</p></blockquote><h5 id="new一个对象和clone一个对象"><a href="#new一个对象和clone一个对象" class="headerlink" title="new一个对象和clone一个对象"></a>new一个对象和clone一个对象</h5><blockquote><p>new一个对象的基本过程：</p><ul><li>按照对象类型分配内存空间</li><li>调用构造函数，填充对象的各个域（对象的初始化）</li><li>对象初始化完成，将该对象的引用返回到外部</li></ul></blockquote><blockquote><p>clone一个对象的基本过程：</p><ul><li>按照对象类型分配内存空间</li><li>使用原对象中对应的各个域，填充新对象的域</li><li>将该对象的引用返回到外部</li></ul></blockquote><h5 id="假克隆（复制）"><a href="#假克隆（复制）" class="headerlink" title="假克隆（复制）"></a>假克隆（复制）</h5><blockquote><p>在Java中，基本数据类型可以通过 = 克隆，但引用类型不能通过该方式克隆</p></blockquote><blockquote><p>Java的栈中保存基本数据类型和引用变量，在堆中保存对象。= 克隆只能克隆栈中的变量，不能克隆堆中的变量</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.Collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(<span class="keyword">int</span> age, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.Collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Student stu1 = <span class="keyword">new</span> Student(<span class="number">11</span>, <span class="string">"gtang11"</span>);</span><br><span class="line">        Student stu2 = stu1;</span><br><span class="line"></span><br><span class="line">        System.out.println(stu1);</span><br><span class="line">        System.out.println(stu2);</span><br><span class="line"></span><br><span class="line">        stu1.setAge(<span class="number">12</span>);</span><br><span class="line">        System.out.println(stu1.getAge());</span><br><span class="line">        System.out.println(stu2.getAge());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">club.hermit.study.Collection.Student@5e481248</span><br><span class="line">club.hermit.study.Collection.Student@5e481248</span><br><span class="line">12</span><br><span class="line">12</span><br></pre></td></tr></table></figure><blockquote><p>通过结果可知道stu1和stu2的地址值是相同的，也就是这两个指向的是同一个对象，stu2只是stu1的引用。这种是引用的克隆。内存的情景如下：</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1596991734/copy_phd8b5.png" alt="copy"></p><h5 id="浅克隆"><a href="#浅克隆" class="headerlink" title="浅克隆"></a>浅克隆</h5><blockquote><p>浅克隆是指：克隆对象时仅克隆对象本身及对象中的基本变量，不拷贝对象包含的引用指向的对象</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.Collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> Name name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(<span class="keyword">int</span> age, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="keyword">new</span> Name(<span class="string">"sur"</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Student)<span class="keyword">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String surnames;</span><br><span class="line">    <span class="keyword">private</span> String monicker;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Name</span><span class="params">(String s, String m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.surnames = s;</span><br><span class="line">        <span class="keyword">this</span>.monicker = m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.Collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        Student stu1 = <span class="keyword">new</span> Student(<span class="number">11</span>, <span class="string">"gtang11"</span>);</span><br><span class="line">        Student stu2 = (Student) stu1.clone();</span><br><span class="line"></span><br><span class="line">        System.out.println(stu1);</span><br><span class="line">        System.out.println(stu2);</span><br><span class="line"></span><br><span class="line">        System.out.println(stu1.name);</span><br><span class="line">        System.out.println(stu2.name);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">club.hermit.study.Collection.Student@5e481248</span><br><span class="line">club.hermit.study.Collection.Student@66d3c617</span><br><span class="line">club.hermit.study.Collection.Name@63947c6b</span><br><span class="line">club.hermit.study.Collection.Name@63947c6b</span><br></pre></td></tr></table></figure><blockquote><p>通过结果可知，stu1和stu2的地址值不同，所以他们指向的是两个对象，但stu1的name和stu2的name的地址值相同，也就是这两个name指向同一个对象。这种情况的内存情景如下：</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1596993430/q_pnivxv.png" alt="shallow"></p><h5 id="深克隆"><a href="#深克隆" class="headerlink" title="深克隆"></a>深克隆</h5><blockquote><p>深克隆是指：克隆对象时不仅克隆对象本身，还会克隆对象中包含的引用指向的所有对象</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.Collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> Name name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(<span class="keyword">int</span> age, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="keyword">new</span> Name(<span class="string">"sur"</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        Student newStu = (Student)<span class="keyword">super</span>.clone();</span><br><span class="line">        newStu.name = (Name) name.clone();</span><br><span class="line">        <span class="keyword">return</span> newStu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String surnames;</span><br><span class="line">    <span class="keyword">private</span> String monicker;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Name</span><span class="params">(String s, String m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.surnames = s;</span><br><span class="line">        <span class="keyword">this</span>.monicker = m;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Name)<span class="keyword">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.Collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        Student stu1 = <span class="keyword">new</span> Student(<span class="number">11</span>, <span class="string">"gtang11"</span>);</span><br><span class="line">        Student stu2 = (Student) stu1.clone();</span><br><span class="line"></span><br><span class="line">        System.out.println(stu1);</span><br><span class="line">        System.out.println(stu2);</span><br><span class="line"></span><br><span class="line">        System.out.println(stu1.name);</span><br><span class="line">        System.out.println(stu2.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">club.hermit.study.Collection.Student@5e481248</span><br><span class="line">club.hermit.study.Collection.Student@66d3c617</span><br><span class="line">club.hermit.study.Collection.Name@63947c6b</span><br><span class="line">club.hermit.study.Collection.Name@2b193f2d</span><br></pre></td></tr></table></figure><blockquote><p>如果要深克隆一个对象，则这个对象要实现Cloneable接口，实现clone方法，并且在clone方法的内部，把该对象引用的其他对象也要clone一份，这就要求这个被引用的对象（如Name）也要必须实现Cloneable接口并实现clone方法。这种情况的内存情景如下：</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1596994157/s_phyure.png" alt="deep"></p><h4 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString"></a>toString</h4><blockquote><p>返回对象的字符串表示形式。建议所有子类覆盖此方法</p></blockquote><blockquote><p>该方法返回一个类对象实例，返回值相当于： getClass().getName() + ‘@’ + Integer.toHexString(hashCode())</p></blockquote><h4 id="notify、notifyAll"><a href="#notify、notifyAll" class="headerlink" title="notify、notifyAll"></a>notify、notifyAll</h4><blockquote><p>唤醒一个正在等待对象监视器的单个线程</p></blockquote><blockquote><p>唤醒正在等待对象监视器的所有线程</p></blockquote><h4 id="wait"><a href="#wait" class="headerlink" title="wait"></a>wait</h4><blockquote><p>使当前线程等待，知道另一个线程调用此对象的notify()方法或notifyAll()方法，也可指定过期时间</p></blockquote><h4 id="finalize"><a href="#finalize" class="headerlink" title="finalize"></a>finalize</h4><blockquote><p>当垃圾回收器确定不再有对该对象的引用时，GC在对象上调用该对象此方法</p><p>当子类需要处理系统资源或者执行其他清理工作时需重写该方法</p></blockquote><blockquote><p>对于任何对象，JVM从不调用多次finalize方法</p></blockquote><h3 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h3><blockquote><p>Collection是集合的根接口，它继承了 Iterable 接口。定义了集合的基本操作方式，下面是Collection的继承类：</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1597159182/Collection_m8fain.png" alt="collection"></p><blockquote><p>Collection中定义的方法主要分为：</p><ul><li>查询操作方法</li><li>修改操作方法</li><li>批量操作方法</li><li>比较和散列方法</li></ul></blockquote><h4 id="查询操作方法"><a href="#查询操作方法" class="headerlink" title="查询操作方法"></a>查询操作方法</h4><table><thead><tr><th>方法</th><th>作用</th></tr></thead><tbody><tr><td>size()</td><td>返回此集合中的元素数</td></tr><tr><td>isEmpty()</td><td>如果此集合不好办元素，则返回true</td></tr><tr><td>contains(Object)</td><td>如果此集合包含指定的元素，则返回true</td></tr><tr><td>iterator()</td><td>返回此集合元素中的迭代器</td></tr><tr><td>toArray(T[])</td><td>返回包含此集合中所有元素的数组，返回的数组的运行时类型是指定数组的运行时类型</td></tr></tbody></table><h4 id="修改操作方法"><a href="#修改操作方法" class="headerlink" title="修改操作方法"></a>修改操作方法</h4><table><thead><tr><th>方法</th><th>作用</th></tr></thead><tbody><tr><td>add(E)</td><td>确保此集合包含指定的元素</td></tr><tr><td>remove(Object)</td><td>从该集合中删除指定元素的单个实例</td></tr></tbody></table><h4 id="批量操作方法"><a href="#批量操作方法" class="headerlink" title="批量操作方法"></a>批量操作方法</h4><table><thead><tr><th>方法</th><th>作用</th></tr></thead><tbody><tr><td>containsAll(Collection&lt;?&gt;)</td><td>如果此集合包含指定集合中的所有元素，则返回true</td></tr><tr><td>addAll(Collection&lt;? extend E&gt;)</td><td>将指定集合中的所有元素添加到此集合</td></tr><tr><td>removeAll(Collection&lt;?&gt;)</td><td>将指定集合中的所有元素从此集合中移除</td></tr><tr><td>removeIf(Predicate&lt;? super E&gt; filter)</td><td>删除满足给定谓词的此集合的所有元素</td></tr><tr><td>retainAll(Collection&lt;?&gt;)</td><td>仅保留此集合中包含在指定集合中的元素</td></tr><tr><td>clear()</td><td>从此集合中删除所有元素</td></tr></tbody></table><h4 id="比较和散列方法"><a href="#比较和散列方法" class="headerlink" title="比较和散列方法"></a>比较和散列方法</h4><table><thead><tr><th>方法</th><th>作用</th></tr></thead><tbody><tr><td>equals(Object o)</td><td>将指定的对象与此集合进行比较</td></tr><tr><td>hashCode()</td><td>返回此集合的哈希值</td></tr><tr><td>Spliterator()</td><td>创建一个Spliterator在这个集合中的元素</td></tr><tr><td>stream()</td><td>返回以此集合作为源的顺序stream</td></tr></tbody></table><h4 id="可选操作的方法"><a href="#可选操作的方法" class="headerlink" title="可选操作的方法"></a>可选操作的方法</h4><blockquote><p>在Collection的源码中注释中，有部分 标注为 optional operation 的方法，如add()方法、clear()方法：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Removes all of the elements from this collection (optional operation).</span></span><br><span class="line"><span class="comment"> * The collection will be empty after this method returns.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> UnsupportedOperationException if the &lt;tt&gt;clear&lt;/tt&gt; operation</span></span><br><span class="line"><span class="comment"> *         is not supported by this collection</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><blockquote><p>在Collection接口中包含一些“具有破坏性”的方法，即通过调用这些方法可以修改集合的这类方法。如果集合不支持这类方法时，需要抛出 UnsupportedOperationException 异常。</p></blockquote><blockquote><p>接口的目的 就是为了让实现类实现这个接口中的方法，但这样就出现一种情况：接口定义了很多方法，但部分子类并不需要其中的一些方法，比如在不可变的集合中，add、addAll、remove这类方法就是冗余的，而且会给类的使用者带来困扰！！所以就需要抛出 UnsupportedOperationException 异常。</p></blockquote><blockquote><p>在JDK中的实现了Collection接口的AbstractCollection抽象类中，就对这类可选操作的方法抛出了异常。</p></blockquote><h4 id="default方法"><a href="#default方法" class="headerlink" title="default方法"></a>default方法</h4><blockquote><p>在JDK1.8之前，接口中只能声明方法，具体的实现只能在实现类中的。为了支持lambda表达式，JDK1.8引入了default关键字。</p><p>在JDK1.8之后，接口中被声明为default的方法也可以有具体实现了。</p></blockquote><blockquote><p>Collection中的spliterator、stream、parallelStream都被声明为default以支持lambda表达式。</p></blockquote><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><blockquote><p>List接口继承了Collection接口，在Collection接口方法的基础上扩展了一些方法，类继承关系如下：</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1597164674/List_t99r85.png" alt="list"></p><blockquote><p>List接口在Collection接口的基础上，又增加了以下方法：</p><ul><li>批量操作方法（新增2个方法）</li><li>位置访问操作方法</li><li>搜索操作方法</li><li>List迭代器方法</li><li>查看操作方法</li></ul></blockquote><p>####批量操作方法</p><table><thead><tr><th>方法</th><th>作用</th></tr></thead><tbody><tr><td>replaceAll(UnaryOperator<E>)</td><td>将该列表的每个元素替换为将该运算符应用于该元素的结果</td></tr><tr><td>sort(Comparator&lt;? super E&gt;)</td><td>按照指定的Comparator给此list排序</td></tr></tbody></table><h5 id="replaceAll"><a href="#replaceAll" class="headerlink" title="replaceAll"></a>replaceAll</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">replaceAll</span><span class="params">(UnaryOperator&lt;E&gt; operator)</span> </span>&#123;</span><br><span class="line">    Objects.requireNonNull(operator);</span><br><span class="line">    <span class="keyword">final</span> ListIterator&lt;E&gt; li = <span class="keyword">this</span>.listIterator();</span><br><span class="line">    <span class="keyword">while</span> (li.hasNext()) &#123;</span><br><span class="line">        li.set(operator.apply(li.next()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> E&gt; c)</span> </span>&#123;</span><br><span class="line">    Object[] a = <span class="keyword">this</span>.toArray();</span><br><span class="line">    Arrays.sort(a, (Comparator) c);</span><br><span class="line">    ListIterator&lt;E&gt; i = <span class="keyword">this</span>.listIterator();</span><br><span class="line">    <span class="keyword">for</span> (Object e : a) &#123;</span><br><span class="line">        i.next();</span><br><span class="line">        i.set((E) e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="位置访问操作方法"><a href="#位置访问操作方法" class="headerlink" title="位置访问操作方法"></a>位置访问操作方法</h4><table><thead><tr><th>方法</th><th>作用</th></tr></thead><tbody><tr><td>get(int)</td><td>返回此list中指定位置的元素</td></tr><tr><td>set(int, E)</td><td>用指定的元素替换此list中指定位置的元素</td></tr><tr><td>add(int, E)</td><td>将指定的元素插入到此list中的指定位置</td></tr><tr><td>remove(int)</td><td>移除该list中指定位置的元素</td></tr></tbody></table><h4 id="搜索操作方法"><a href="#搜索操作方法" class="headerlink" title="搜索操作方法"></a>搜索操作方法</h4><table><thead><tr><th>方法</th><th>作用</th></tr></thead><tbody><tr><td>indexOf(Object）</td><td>返回此list中指定元素第一次出现的索引值，不如该list中不包含该元素，返回-1</td></tr><tr><td>lastIndexOf(Object）</td><td>返回此list中指定元素最后一次出现的索引值，不如该list中不包含该元素，返回-1</td></tr></tbody></table><h4 id="List迭代器操作方法"><a href="#List迭代器操作方法" class="headerlink" title="List迭代器操作方法"></a>List迭代器操作方法</h4><table><thead><tr><th>方法</th><th>作用</th></tr></thead><tbody><tr><td>listIterator()</td><td>返回列表中的列表迭代器</td></tr><tr><td>listIterator(int)</td><td>从列表中的指定位置开始，返回列表中的元素的列表迭代器</td></tr></tbody></table><h4 id="查看操作方法"><a href="#查看操作方法" class="headerlink" title="查看操作方法"></a>查看操作方法</h4><table><thead><tr><th>方法</th><th>作用</th></tr></thead><tbody><tr><td>subList(int fromIndex,int toIndex)</td><td>返回此列表中的指定的fromIndex到toIndex之间的元素</td></tr><tr><td>spliterator()</td><td>在此列表的元素上创建一个Spliterator</td></tr></tbody></table><h4 id="list的特点"><a href="#list的特点" class="headerlink" title="list的特点"></a>list的特点</h4><blockquote><p>list接口有以下特点：</p><ul><li>元素有序</li><li>允许插入多个null元素</li><li>元素可重复</li></ul></blockquote><h5 id="list的哪些设计使得list接口有这些特点"><a href="#list的哪些设计使得list接口有这些特点" class="headerlink" title="list的哪些设计使得list接口有这些特点"></a>list的哪些设计使得list接口有这些特点</h5><blockquote><p>个人对这个问题的认识：</p><p>面向接口编程，接口只是一个规范，实现类是接口的具体实现而已。具体到list，Java的作者只是对list接口做了上面这些特点的规定而已，具体遵不遵守完全看个人（但Java系列则一定是严格遵守的），也就是你自己写一个实现了list接口的类，这个类add、remove的时候都是随机的也没问任何问题的</p></blockquote><h3 id="Map-1"><a href="#Map-1" class="headerlink" title="Map"></a>Map</h3><blockquote><p>待补充</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;What&quot;&gt;&lt;a href=&quot;#What&quot; class=&quot;headerlink&quot; title=&quot;What&quot;&gt;&lt;/a&gt;What&lt;/h2&gt;&lt;h3 id=&quot;容器&quot;&gt;&lt;a href=&quot;#容器&quot; class=&quot;headerlink&quot; title=&quot;容器&quot;&gt;&lt;/a&gt;容器&lt;/h
      
    
    </summary>
    
    
      <category term="源码分析" scheme="http://yoursite.com/categories/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="List" scheme="http://yoursite.com/tags/List/"/>
    
      <category term="Object" scheme="http://yoursite.com/tags/Object/"/>
    
      <category term="假克隆" scheme="http://yoursite.com/tags/%E5%81%87%E5%85%8B%E9%9A%86/"/>
    
      <category term="深克隆" scheme="http://yoursite.com/tags/%E6%B7%B1%E5%85%8B%E9%9A%86/"/>
    
      <category term="浅克隆" scheme="http://yoursite.com/tags/%E6%B5%85%E5%85%8B%E9%9A%86/"/>
    
      <category term="Collection" scheme="http://yoursite.com/tags/Collection/"/>
    
      <category term="Map" scheme="http://yoursite.com/tags/Map/"/>
    
  </entry>
  
  <entry>
    <title>代理模式</title>
    <link href="http://yoursite.com/2020/07/26/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2020/07/26/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/</id>
    <published>2020-07-25T16:50:09.000Z</published>
    <updated>2020-07-26T11:49:58.203Z</updated>
    
    <content type="html"><![CDATA[<h2 id="WHAT"><a href="#WHAT" class="headerlink" title="WHAT"></a>WHAT</h2><h3 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h3><blockquote><p>代理模式是一种常见的设计模式，代理模式为另一个对象提供一个替身或占位符以控制对这个对象的访问</p></blockquote><h3 id="代理模式的用途"><a href="#代理模式的用途" class="headerlink" title="代理模式的用途"></a>代理模式的用途</h3><blockquote><p>代理模式为其他对象提供了一种代理以控制对这个对象的访问。在某些情况下，一个客户不想或者不能直接引用另一个对象，而代理对象可以在客户端和目标对象之间起到中介的作用</p></blockquote><blockquote><p>代理模式的应用场景主要有：</p><ul><li>Spring AOP </li><li>RPC</li><li>Java注解</li><li>性能监控</li></ul></blockquote><h3 id="代理模式的基本概念"><a href="#代理模式的基本概念" class="headerlink" title="代理模式的基本概念"></a>代理模式的基本概念</h3><h4 id="subject"><a href="#subject" class="headerlink" title="subject"></a>subject</h4><blockquote><p>抽象主题角色。定义代理类和真实主题的公共对外方法，也是代理类代理真实主题的方法</p></blockquote><h4 id="realsubject"><a href="#realsubject" class="headerlink" title="realsubject"></a>realsubject</h4><blockquote><p>真实主题角色。真正实现业务逻辑的类</p></blockquote><h4 id="proxy"><a href="#proxy" class="headerlink" title="proxy"></a>proxy</h4><blockquote><p>代理主题角色。用来代理和封装真实的主题</p></blockquote><h4 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">left to right direction</span><br><span class="line"></span><br><span class="line">class client &#123;&#125;</span><br><span class="line">note left: 客户端</span><br><span class="line"></span><br><span class="line">interface Subject &#123;</span><br><span class="line">    + request()</span><br><span class="line">&#125;</span><br><span class="line">note top: 抽象主题角色</span><br><span class="line"></span><br><span class="line">class Proxy &#123;</span><br><span class="line">    - before()</span><br><span class="line">    + request()</span><br><span class="line">    - after()</span><br><span class="line">&#125;</span><br><span class="line">note left: 代理主题类</span><br><span class="line"></span><br><span class="line">class RealSubject &#123;</span><br><span class="line">    + request()</span><br><span class="line">&#125;</span><br><span class="line">note right: 真实主题类</span><br><span class="line"></span><br><span class="line">Subject &lt;|- RealSubject</span><br><span class="line">Subject &lt;|- Proxy</span><br><span class="line">Proxy --&gt; RealSubject: 调用真实主题的request方法</span><br><span class="line">client ..&gt; Subject</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><h4 id="按场景分类"><a href="#按场景分类" class="headerlink" title="按场景分类"></a>按场景分类</h4><blockquote><ul><li>远程代理</li><li>虚拟代理</li><li>Copy-on-Write代理</li><li>保护代理</li><li>Cache代理</li><li>防火墙代理</li><li>同步化代理</li><li>智能引用代理</li></ul></blockquote><h4 id="按字节码创建时机分类"><a href="#按字节码创建时机分类" class="headerlink" title="按字节码创建时机分类"></a>按字节码创建时机分类</h4><h5 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h5><blockquote><p>在程序运行前就已经存在代理类的字节码文件，代理类和真实主题角色的关系在程序运行前就确定了</p></blockquote><h5 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h5><blockquote><p>动态代理的代码不用程序员写，也就是程序编译后，并没有代理类的.class文件；代理类是在程序运行期间，由JVM根据反射机制动态的生成的</p></blockquote><h2 id="HOW"><a href="#HOW" class="headerlink" title="HOW"></a>HOW</h2><h3 id="静态代理实现"><a href="#静态代理实现" class="headerlink" title="静态代理实现"></a>静态代理实现</h3><h4 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">request</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RealSubject"><a href="#RealSubject" class="headerlink" title="RealSubject"></a>RealSubject</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RealSubject</span> <span class="keyword">implements</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"real subject"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Subject subject;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Proxy</span><span class="params">(Subject subject)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.subject = subject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        before();</span><br><span class="line">        subject.request();</span><br><span class="line">        after();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"proxy before"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"proxy after"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Subject proxy = <span class="keyword">new</span> Proxy(<span class="keyword">new</span> RealSubject());</span><br><span class="line">        proxy.request();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="输出结果"><a href="#输出结果" class="headerlink" title="输出结果"></a>输出结果</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxy before</span><br><span class="line">real subject</span><br><span class="line">proxy after</span><br><span class="line"></span><br><span class="line">Process finished with <span class="built_in">exit</span> code 0</span><br></pre></td></tr></table></figure><h3 id="动态代理实现"><a href="#动态代理实现" class="headerlink" title="动态代理实现"></a>动态代理实现</h3><h4 id="JDK动态代理实现"><a href="#JDK动态代理实现" class="headerlink" title="JDK动态代理实现"></a>JDK动态代理实现</h4><h5 id="Subject-1"><a href="#Subject-1" class="headerlink" title="Subject"></a>Subject</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">request</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="RealSubject-1"><a href="#RealSubject-1" class="headerlink" title="RealSubject"></a>RealSubject</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RealSubject</span> <span class="keyword">implements</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"real subject"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="JdkProxyHandler"><a href="#JdkProxyHandler" class="headerlink" title="JdkProxyHandler"></a>JdkProxyHandler</h5><blockquote><p>该类实现了InvocationHandler接口，此接口在后面的原理中详解</p><p>该类只是一个调用逻辑处理类，在该类的invode方法中，编写动态生成的Proxy中的X方法的处理逻辑（X方法也就是Proxy实现了Subject类中那个方法，此处就是request方法）</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdkProxyHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Object target; <span class="comment">// 被代理的对象，也就是上面的RealSubject类</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JdkProxyHandler</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">        before();</span><br><span class="line">        Object res = method.invoke(target, args);</span><br><span class="line">        after();</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"jdk proxy handler before"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"jdk proxy handler after"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="JdkProxyClient"><a href="#JdkProxyClient" class="headerlink" title="JdkProxyClient"></a>JdkProxyClient</h5><blockquote><p>在该Client类中，动态生成jdkProxy代理类是通过Proxy的newProxyInstance方法（注：该处的Proxy是java.lang.reflect.Proxy类）</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdkProxyClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        RealSubject realSubject = <span class="keyword">new</span> RealSubject();</span><br><span class="line">        ClassLoader classLoader = realSubject.getClass().getClassLoader();</span><br><span class="line">        Class[] interfaces = realSubject.getClass().getInterfaces();<span class="comment">// 获取被代理类实现的所有接口</span></span><br><span class="line">        InvocationHandler handler = <span class="keyword">new</span> JdkProxyHandler(realSubject);</span><br><span class="line">        <span class="comment">//此处动态创建代理类：</span></span><br><span class="line">        <span class="comment">// 1. JDK会根据传入的参数动态的在内存中创建和.class文件等同的字节码</span></span><br><span class="line">        <span class="comment">// 2. 然后根据创建的.class字节码在内存中生成一个代表该类的 java.lang.Class 对象</span></span><br><span class="line">        <span class="comment">// 3. 通过newProxyInstance创建实例</span></span><br><span class="line">        Subject jdkProxy = (Subject) Proxy.newProxyInstance(classLoader, interfaces, handler);</span><br><span class="line">        jdkProxy.request();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="输出结果-1"><a href="#输出结果-1" class="headerlink" title="输出结果"></a>输出结果</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jdk proxy handler before</span><br><span class="line">real subject</span><br><span class="line">jdk proxy handler after</span><br><span class="line"></span><br><span class="line">Process finished with <span class="built_in">exit</span> code 0</span><br></pre></td></tr></table></figure><h4 id="CGLIB动态代理实现"><a href="#CGLIB动态代理实现" class="headerlink" title="CGLIB动态代理实现"></a>CGLIB动态代理实现</h4><blockquote><p>Maven中引入cglib相关包：</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="Subject-2"><a href="#Subject-2" class="headerlink" title="Subject"></a>Subject</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">request</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="RealSubject-2"><a href="#RealSubject-2" class="headerlink" title="RealSubject"></a>RealSubject</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RealSubject</span> <span class="keyword">implements</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"real subject"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="CglibProxyInterceptor"><a href="#CglibProxyInterceptor" class="headerlink" title="CglibProxyInterceptor"></a>CglibProxyInterceptor</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CglibProxyInterceptor</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        before();</span><br><span class="line">        Object res = methodProxy.invokeSuper(o, objects);</span><br><span class="line">        after();</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"cglib proxy interceptor before"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"cglib proxy interceptor after"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="CglibProxyClient"><a href="#CglibProxyClient" class="headerlink" title="CglibProxyClient"></a>CglibProxyClient</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.Enhancer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CglibProxyClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        CglibProxyInterceptor cglibProxyInterceptor = <span class="keyword">new</span> CglibProxyInterceptor();</span><br><span class="line">        Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">        enhancer.setSuperclass(RealSubject<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        enhancer.setCallback(cglibProxyInterceptor);</span><br><span class="line"></span><br><span class="line">        Subject proxy = (Subject) enhancer.create();<span class="comment">//创建代理类</span></span><br><span class="line">        proxy.request();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="输出结果-2"><a href="#输出结果-2" class="headerlink" title="输出结果"></a>输出结果</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cglib proxy interceptor before</span><br><span class="line">real subject</span><br><span class="line">cglib proxy interceptor after</span><br><span class="line"></span><br><span class="line">Process finished with <span class="built_in">exit</span> code 0</span><br></pre></td></tr></table></figure><h2 id="WHY"><a href="#WHY" class="headerlink" title="WHY"></a>WHY</h2><h3 id="静态代理实现原理"><a href="#静态代理实现原理" class="headerlink" title="静态代理实现原理"></a>静态代理实现原理</h3><blockquote><p>静态代理的实现体现了 面向对象中的 面向interface编程！</p></blockquote><h3 id="静态代理的缺陷"><a href="#静态代理的缺陷" class="headerlink" title="静态代理的缺陷"></a>静态代理的缺陷</h3><blockquote><p>静态代理在复杂业务场景下并不适用，如：</p><ul><li>当Proxy类中要代理多种Subject类时，静态代理的实现方式会使Proxy类变的特别复杂，因为Proxy中要实现各种代理的各种Subject接口中声明的所有方法</li><li>当要增、删、改Subject类中方法时，Proxy类也要跟着改动</li></ul><p>而动态代理刚好解决了以上问题</p></blockquote><h3 id="动态代理实现原理"><a href="#动态代理实现原理" class="headerlink" title="动态代理实现原理"></a>动态代理实现原理</h3><blockquote><p>在<a href="[https://gtang94.github.io/2020/07/11/Java%E7%B1%BB%E5%9E%8B%E4%BF%A1%E6%81%AF/](https://gtang94.github.io/2020/07/11/Java类型信息/)">类加载机制</a>的加载阶段中，首先是通过类的全限定名来获取该类的二进制字节流(.class字节码)，此处的获取途径就有很多：</p><ul><li>从ZIP包获取</li><li>从网络中获取，如Applet</li><li>运行时计算生成。这中途径使用最多的是动态代理技术，在 java.lang.reflect.Proxy 类中，就是用了 ProxyGenerator.generateProxyClass 来为特定接口生成形式为 *$Proxy 的代理类的二进制字节流</li><li>由其他文件生成，如由JSP文件生成对应的Class类</li><li>从DB中获取</li></ul></blockquote><blockquote><p>动态代理就是根据接口或者RealSubject对象，由程序计算得到Proxy类的字节码，然后将该Proxy加载到JVM中使用的</p><p>那程序是怎么计算得到Proxy类字节码的呢？？</p><p>Java中有许多<a href="https://java-source.net/open-source/bytecode-libraries" target="_blank" rel="noopener">操作字节码的类库</a>，通常是通过这些类库来实现上面的计算Proxy字节码的。最常用的方式有以下两种：</p><ul><li>通过实现接口的方式： JDK动态代理</li><li>通过继承类的方式：CGLIB动态代理</li></ul></blockquote><h4 id="JDK动态代理"><a href="#JDK动态代理" class="headerlink" title="JDK动态代理"></a>JDK动态代理</h4><blockquote><p>JDK动态代理主要涉及 java.lang.reflect.Proxy 和 java.lang.reflect.InvocationHandler 类</p></blockquote><h5 id="java-lang-reflect-InvocationHandler"><a href="#java-lang-reflect-InvocationHandler" class="headerlink" title="java.lang.reflect.InvocationHandler"></a>java.lang.reflect.InvocationHandler</h5><blockquote><p>InvocationHandler 是由代理实例的调用处理程序实现的接口</p><p>该方法主要有invoke方法，用来处理代理实例上的方法调用并返回结果的</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> Throwable</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="java-lang-reflect-Proxy"><a href="#java-lang-reflect-Proxy" class="headerlink" title="java.lang.reflect.Proxy"></a>java.lang.reflect.Proxy</h5><blockquote><p>该类提供了创建动态代理类和实体的静态方法，它也是由这些方法创建的所有动态代理类的超类</p></blockquote><blockquote><p>getInvocationHandler() 方法用于获取指定代理对象所关联的调用处理器</p></blockquote><blockquote><p>getProxyClass() 方法用于返回指定接口的代理类</p></blockquote><blockquote><p>newProxyInstance() 方法用于构造实现指定接口的代理类的一个新实例，所有方法会调用给定处理器对象的invoke方法</p></blockquote><blockquote><p>isProxyClass() 该方法用于返回cl类是否为一个代理类</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">class Proxy &#123;</span><br><span class="line">    - serialVersionUID</span><br><span class="line">    - constructorParams</span><br><span class="line">    - proxyClassCache</span><br><span class="line">    # h</span><br><span class="line">    - key0</span><br><span class="line"></span><br><span class="line">    + getProxyClass(ClassLoader, Class&lt;?&gt;...)</span><br><span class="line">    - checkProxyAccess(Class&lt;?&gt;, ClassLoader, Class&lt;?&gt;...)</span><br><span class="line">    - getProxyClass0(ClassLoader, Class&lt;?&gt;...)</span><br><span class="line">    + newProxyInstance(ClassLoader, Class&lt;?&gt;[], InvocationHandler)</span><br><span class="line">    - checkNewProxyPermission(Class&lt;?&gt;, Class&lt;?&gt;)</span><br><span class="line">    + isProxyClass(Class&lt;?&gt;)</span><br><span class="line">    + getInvocationHandler(Object)</span><br><span class="line">    - defineClass0(ClassLoader, String, byte[], int, int)</span><br><span class="line">&#125;</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><h5 id="持久化JDK动态生成的Proxy类"><a href="#持久化JDK动态生成的Proxy类" class="headerlink" title="持久化JDK动态生成的Proxy类"></a>持久化JDK动态生成的Proxy类</h5><blockquote><p>改写JdkProxyClient类，将生成的Proxy持久化到硬盘中</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sun.misc.ProxyGenerator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdkProxyClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        RealSubject realSubject = <span class="keyword">new</span> RealSubject();</span><br><span class="line">        ClassLoader classLoader = realSubject.getClass().getClassLoader();</span><br><span class="line">        Class[] interfaces = realSubject.getClass().getInterfaces();</span><br><span class="line">        InvocationHandler handler = <span class="keyword">new</span> JdkProxyHandler(realSubject);</span><br><span class="line">        Subject proxy = (Subject) Proxy.newProxyInstance(classLoader, interfaces, handler);</span><br><span class="line">        proxy.request();</span><br><span class="line">        saveJdkProxy(realSubject.getClass(), <span class="string">"Proxy"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">saveJdkProxy</span><span class="params">(Class clz, String proxyName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] file = ProxyGenerator.generateProxyClass(proxyName, clz.getInterfaces());</span><br><span class="line">        String path = clz.getResource(<span class="string">"."</span>).getPath();</span><br><span class="line">        FileOutputStream out = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            out = <span class="keyword">new</span> FileOutputStream(path + proxyName + <span class="string">".class"</span>);</span><br><span class="line">            out.write(file);</span><br><span class="line">            out.flush();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                out.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>动态生成的代理类Proxy如下：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> club.hermit.study.proxy.Subject;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.UndeclaredThrowableException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">reflect</span>.<span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m1;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m2;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m3;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m0;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Proxy</span><span class="params">(InvocationHandler var1)</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(var1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object var1)</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Boolean)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m1, <span class="keyword">new</span> Object[]&#123;var1&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var3;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var4) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var4);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (String)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m2, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">request</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m3, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Integer)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m0, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            m1 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"equals"</span>, Class.forName(<span class="string">"java.lang.Object"</span>));</span><br><span class="line">            m2 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"toString"</span>);</span><br><span class="line">            m3 = Class.forName(<span class="string">"club.hermit.study.proxy.Subject"</span>).getMethod(<span class="string">"request"</span>);</span><br><span class="line">            m0 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"hashCode"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchMethodError(var2.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoClassDefFoundError(var3.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>从上面动态生成的Proxy可以看到：</p><ul><li>该类生成了equals、toString、hashCode、request方法</li><li>该类继承了java.lang.reflect.Proxy 类，实现了Subject类</li><li>该类的参数h是Proxy类中的InvocationHandler接口的实例变量，并且在request中，h调用了InvocationHandler接口的invode方法，也就是调用了上面手动实现的JdkProxyHandler接口中的invoke方法</li><li>该类中的m3是静态代码块中通过反射获取到的Subject接口中的request方法</li></ul></blockquote><h5 id="调用时序图"><a href="#调用时序图" class="headerlink" title="调用时序图"></a>调用时序图</h5><blockquote><p>所以，整个类的调用时序图如下：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line"></span><br><span class="line">class JdkProxyClient &#123;&#125;</span><br><span class="line">class JdkProxy &#123;</span><br><span class="line">    - m0</span><br><span class="line">    - m1</span><br><span class="line">    - m2</span><br><span class="line">    - m3</span><br><span class="line">    + equals()</span><br><span class="line">    + hashCode()</span><br><span class="line">    + toString()</span><br><span class="line">    + request()</span><br><span class="line">&#125;</span><br><span class="line">class JdkProxyHandler &#123;</span><br><span class="line">    ~ target</span><br><span class="line">    + invoke()</span><br><span class="line">    - before</span><br><span class="line">    - after</span><br><span class="line">&#125;</span><br><span class="line">class RealSubject &#123;</span><br><span class="line">    ~ request()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">JdkProxyClient -&gt; JdkProxy: request()</span><br><span class="line">JdkProxy -&gt; JdkProxyHandler: h.invode()</span><br><span class="line">JdkProxyHandler -&gt; RealSubject: method.invoke()</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><h4 id="CGLIB动态代理"><a href="#CGLIB动态代理" class="headerlink" title="CGLIB动态代理"></a>CGLIB动态代理</h4><blockquote><p>GBLIB创建动态代理类的模式是：</p><ul><li>查找目标类上的所有非final的public类型的方法定义</li><li>将这些方法的定义转换成字节码</li><li>将组成的字节码转换成响应的代理的class对象</li><li>实现MethodInterceptor接口，用来处理对代理类上所有方法的请求</li></ul></blockquote><h4 id="JDK和CGLIB实现动态代理的对比"><a href="#JDK和CGLIB实现动态代理的对比" class="headerlink" title="JDK和CGLIB实现动态代理的对比"></a>JDK和CGLIB实现动态代理的对比</h4><table><thead><tr><th>代理方式</th><th>实现</th><th>优点</th></tr></thead><tbody><tr><td>JDK</td><td>实现被代理对象的接口</td><td>1. 最小依赖关系，减少依赖意味着简化开发和维护，JDK本身支持，比CGLIB更可靠；2. 平滑进行JDK版本升级，而字节码类库通常需要进行更新以保证在新版本的Java上能够正常使用；3.代码实现简单</td></tr><tr><td>CGLIB</td><td>继承被代理类</td><td>1. 无需实现接口，达到代码类无侵入；2. 值操作我们关系的类，而不必为其他相关类增加工作量；3. 高性能</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;WHAT&quot;&gt;&lt;a href=&quot;#WHAT&quot; class=&quot;headerlink&quot; title=&quot;WHAT&quot;&gt;&lt;/a&gt;WHAT&lt;/h2&gt;&lt;h3 id=&quot;代理模式&quot;&gt;&lt;a href=&quot;#代理模式&quot; class=&quot;headerlink&quot; title=&quot;代理模式&quot;&gt;&lt;/a
      
    
    </summary>
    
    
      <category term="设计模式" scheme="http://yoursite.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="Java动态代理" scheme="http://yoursite.com/tags/Java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"/>
    
      <category term="Java静态代理" scheme="http://yoursite.com/tags/Java%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86/"/>
    
      <category term="JDK动态代理" scheme="http://yoursite.com/tags/JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"/>
    
      <category term="CGLIB动态代理" scheme="http://yoursite.com/tags/CGLIB%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>Java注解</title>
    <link href="http://yoursite.com/2020/07/25/Java%E6%B3%A8%E8%A7%A3/"/>
    <id>http://yoursite.com/2020/07/25/Java%E6%B3%A8%E8%A7%A3/</id>
    <published>2020-07-25T04:03:04.000Z</published>
    <updated>2020-07-26T11:49:07.350Z</updated>
    
    <content type="html"><![CDATA[<h2 id="WHAT"><a href="#WHAT" class="headerlink" title="WHAT"></a>WHAT</h2><h3 id="注解是什么"><a href="#注解是什么" class="headerlink" title="注解是什么"></a>注解是什么</h3><blockquote><p>Java注解又叫Java标注，是Java5.0开始支持加入源代码的特殊语法元数据</p></blockquote><blockquote><p>Java语言中的类、方法、变量、参数、包都可以被标注，Java标注可以通过反射获取标注内容，在编译生成class文件时，可以嵌入到字节码中，JVM可以保留标注的内容，在运行时可以获取到标注内容</p></blockquote><h3 id="注解应用场景"><a href="#注解应用场景" class="headerlink" title="注解应用场景"></a>注解应用场景</h3><blockquote><ul><li>生成文档，Java最早提供的注解</li><li>跟踪代码依赖，替代配置文件，Spring中大量使用注解</li><li>参数校验 / 拦截器 等等</li></ul></blockquote><blockquote><p>自定义注解一般有两种用法：</p><ul><li>自定义注解处理器</li><li>配合Spring等框架使用</li></ul></blockquote><h3 id="JDK内置注解"><a href="#JDK内置注解" class="headerlink" title="JDK内置注解"></a>JDK内置注解</h3><blockquote><p>Java定义的注解一共有7个，3个在 java.lang 中，4个在 java.lang.annotation 中（JDK7之前）</p></blockquote><h4 id="作用在代码中的注解"><a href="#作用在代码中的注解" class="headerlink" title="作用在代码中的注解"></a>作用在代码中的注解</h4><h5 id="Override"><a href="#Override" class="headerlink" title="@Override"></a>@Override</h5><blockquote><p>检查该方法是否是重写方法</p><p>如果发现其父类，或者是引用的接口中并没有该方法时，会报编译错误</p></blockquote><h5 id="Deprecated"><a href="#Deprecated" class="headerlink" title="@Deprecated"></a>@Deprecated</h5><blockquote><p>标记过时方法</p><p>如果使用了注解为它的元素，编译器就会发出警告消息</p></blockquote><h5 id="Suppress-Warnings"><a href="#Suppress-Warnings" class="headerlink" title="@Suppress Warnings"></a>@Suppress Warnings</h5><blockquote><p>指示编译器去忽略注解中声明的警告</p></blockquote><h4 id="作用在注解上的注解（也叫-元注解）"><a href="#作用在注解上的注解（也叫-元注解）" class="headerlink" title="作用在注解上的注解（也叫 元注解）"></a>作用在注解上的注解（也叫 元注解）</h4><h5 id="Target"><a href="#Target" class="headerlink" title="@Target"></a>@Target</h5><blockquote><p>描述了该注解可以用于什么地方，它的值在 java.lang.annotation.ElementType 中定义</p></blockquote><blockquote><p>ElementType的参数包括：</p><ul><li>CONSTRUCTOR：声明构造器</li><li>FIELD：声明域（包括enum实例）</li><li>LOCAL_VARIABLE：局部变量声明</li><li>METHOD：声明方法</li><li>PACKAGE：声明包</li><li>PARAMETER：声明参数</li><li>TYPE：类、接口（包括注解类型）或enum的声明</li></ul></blockquote><h5 id="Retention"><a href="#Retention" class="headerlink" title="@Retention"></a>@Retention</h5><blockquote><p>描述了在什么级别保存该注解信息（注解的保留时间范围），值在 java.lang.annotatioin.RetentionPolicy中定义</p></blockquote><blockquote><p>RetentionPolicy参数包括：</p><ul><li>SOURCE：在源文件中保留，编译时该注解就会被忽略</li><li>CLASS：跟随源文件编译到.class文件中，运行时就会被忽略</li><li>RUNTIME：在运行时候也保留，因此可通过反射机制读取注解的信息</li></ul></blockquote><h5 id="Documented"><a href="#Documented" class="headerlink" title="@Documented"></a>@Documented</h5><blockquote><p>将此注解包含在Javadoc中</p></blockquote><h5 id="Inherited"><a href="#Inherited" class="headerlink" title="@Inherited"></a>@Inherited</h5><blockquote><p>允许子类继承父类中的注解</p></blockquote><h4 id="Java7新增的注解"><a href="#Java7新增的注解" class="headerlink" title="Java7新增的注解"></a>Java7新增的注解</h4><h5 id="SafeVarargs"><a href="#SafeVarargs" class="headerlink" title="@SafeVarargs"></a>@SafeVarargs</h5><blockquote><p>Java 7开始支持，忽略任何使用参数为泛型变量的方法或构造函数调用产生的警告</p></blockquote><h5 id="FunctionalInterface"><a href="#FunctionalInterface" class="headerlink" title="@FunctionalInterface"></a>@FunctionalInterface</h5><blockquote><p>Java 8开始支持，标识一个匿名函数或函数式接口</p></blockquote><h5 id="Repeatable"><a href="#Repeatable" class="headerlink" title="@Repeatable"></a>@Repeatable</h5><blockquote><p>Java 8开始支持，标识某注解可以在同一个声明上使用多次</p></blockquote><h2 id="注解用法"><a href="#注解用法" class="headerlink" title="注解用法"></a>注解用法</h2><h3 id="自定义注解规范"><a href="#自定义注解规范" class="headerlink" title="自定义注解规范"></a>自定义注解规范</h3><blockquote><p>注释声明用 @interface，且</p><ul><li>该声明会自动继承 java.lang.annotation.Annotation 接口</li><li>用该声明后不能再继承其他类或接口</li></ul><p>声明格式为：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> 注解名 &#123;</span><br><span class="line">  修饰符 返回值 属性名() 默认值</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>修饰符 ：修饰符只能用public或default</p></blockquote><blockquote><p>返回值：返回值只能是</p><ul><li>Java基本数据类型(byte、char、short、int、float、double、long、boolean)</li><li>String类型</li><li>Class类型</li><li>enum类型</li><li>Annotation类型</li><li>以类型的数组</li></ul></blockquote><blockquote><p>属性名：该注解的属性名，如@UseCase(id=12,name=”gg”)中的id和name</p></blockquote><blockquote><p>默认值：不指定属性名时的默认值，这块可以不要</p></blockquote><h3 id="定义注解"><a href="#定义注解" class="headerlink" title="定义注解"></a>定义注解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(ElementType.FIELD)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Name &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="注解处理器"><a href="#注解处理器" class="headerlink" title="注解处理器"></a>注解处理器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NameAnnotationHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getInfo</span><span class="params">(Class&lt;?&gt; clz)</span> </span>&#123;</span><br><span class="line">        String res = <span class="string">""</span>;</span><br><span class="line">        Field[] declaredFieds = clz.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field : declaredFieds) &#123;</span><br><span class="line">            <span class="keyword">if</span> (field.isAnnotationPresent(Name<span class="class">.<span class="keyword">class</span>)) </span>&#123;</span><br><span class="line">                Name nameAnnotation = field.getAnnotation(Name<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">                res = nameAnnotation.value();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="注解属性"><a href="#注解属性" class="headerlink" title="注解属性"></a>注解属性</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Name</span>(<span class="string">"gtang94"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="NameTest"><a href="#NameTest" class="headerlink" title="NameTest"></a>NameTest</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NameTest</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String name = NameAnnotationHandler.getInfo(Person<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="输出结果"><a href="#输出结果" class="headerlink" title="输出结果"></a>输出结果</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gtang94</span><br><span class="line"></span><br><span class="line">Process finished with <span class="built_in">exit</span> code 0</span><br></pre></td></tr></table></figure><h2 id="注解源码"><a href="#注解源码" class="headerlink" title="注解源码"></a>注解源码</h2><h3 id="java-lang-annotation包"><a href="#java-lang-annotation包" class="headerlink" title="java.lang.annotation包"></a>java.lang.annotation包</h3><h4 id="Annotation"><a href="#Annotation" class="headerlink" title="Annotation"></a>Annotation</h4><blockquote><p>所有注释类型扩展的公共接口。该接口本身并不定义注释类型</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Annotation</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">toString</span><span class="params">()</span></span>;</span><br><span class="line">    Class&lt;? extends Annotation&gt; annotationType();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>annotationType()方法返回此注释的注释类型</p></blockquote><h4 id="异常或错误"><a href="#异常或错误" class="headerlink" title="异常或错误"></a>异常或错误</h4><h5 id="AnnotationFormatError"><a href="#AnnotationFormatError" class="headerlink" title="AnnotationFormatError"></a>AnnotationFormatError</h5><blockquote><p>该类继承 Error 类</p></blockquote><blockquote><p>当注释解析器尝试从类文件读取注释并确认注释格式错误时抛出错误</p></blockquote><h5 id="AnnotationTypeMismatchException"><a href="#AnnotationTypeMismatchException" class="headerlink" title="AnnotationTypeMismatchException"></a>AnnotationTypeMismatchException</h5><blockquote><p>继承 RuntimeException 类</p></blockquote><blockquote><p>抛出以指示程序已尝试访问主机编辑后类已更改的注释元素</p></blockquote><h5 id="IncompleteAnnotationException"><a href="#IncompleteAnnotationException" class="headerlink" title="IncompleteAnnotationException"></a>IncompleteAnnotationException</h5><blockquote><p>抛出以指示程序已尝试访问在编辑或序列化注释后添加到注释类型定义的注释类型的元素的异常</p></blockquote><h4 id="元注释"><a href="#元注释" class="headerlink" title="元注释"></a>元注释</h4><h5 id="Documented-1"><a href="#Documented-1" class="headerlink" title="Documented"></a>Documented</h5><h5 id="Inherited-1"><a href="#Inherited-1" class="headerlink" title="Inherited"></a>Inherited</h5><h5 id="Native"><a href="#Native" class="headerlink" title="Native"></a>Native</h5><blockquote><p>Java1.8才引入的元注释</p></blockquote><h5 id="Repeatable-1"><a href="#Repeatable-1" class="headerlink" title="Repeatable"></a>Repeatable</h5><blockquote><p>Java1.8才引入的元注释</p></blockquote><h5 id="Retention-1"><a href="#Retention-1" class="headerlink" title="Retention"></a>Retention</h5><h5 id="Target-1"><a href="#Target-1" class="headerlink" title="Target"></a>Target</h5><h4 id="ElementType"><a href="#ElementType" class="headerlink" title="ElementType"></a>ElementType</h4><blockquote><p>该枚举类中定义了在Java程序中可能出现注释的位置的分类</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ElementType &#123;</span><br><span class="line">    <span class="comment">/** Class, interface (including annotation type), or enum declaration */</span></span><br><span class="line">    TYPE,</span><br><span class="line">    <span class="comment">/** Field declaration (includes enum constants) */</span></span><br><span class="line">    FIELD,</span><br><span class="line">    <span class="comment">/** Method declaration */</span></span><br><span class="line">    METHOD,</span><br><span class="line">    <span class="comment">/** Formal parameter declaration */</span></span><br><span class="line">    PARAMETER,</span><br><span class="line">    <span class="comment">/** Constructor declaration */</span></span><br><span class="line">    CONSTRUCTOR,</span><br><span class="line">    <span class="comment">/** Local variable declaration */</span></span><br><span class="line">    LOCAL_VARIABLE,</span><br><span class="line">    <span class="comment">/** Annotation type declaration */</span></span><br><span class="line">    ANNOTATION_TYPE,</span><br><span class="line">    <span class="comment">/** Package declaration */</span></span><br><span class="line">    PACKAGE,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Type parameter declaration</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    TYPE_PARAMETER,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Use of a type</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    TYPE_USE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RetentionPolicy"><a href="#RetentionPolicy" class="headerlink" title="RetentionPolicy"></a>RetentionPolicy</h4><blockquote><p>注释保留策略。这个枚举类型的常量标识了在何时保留注释</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> RetentionPolicy &#123;</span><br><span class="line">    SOURCE,</span><br><span class="line">    CLASS,</span><br><span class="line">    RUNTIME</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="注解原理"><a href="#注解原理" class="headerlink" title="注解原理"></a>注解原理</h3><blockquote><p>注解本质是一个继承了Annotation 的特殊接口，其具体实现类是Java 运行时生成的动态代理类。而我们通过反射获取注解时，返回的是Java 运行时生成的动态代理对象$Proxy1。通过代理对象调用自定义注解（接口）的方法，会最终调用AnnotationInvocationHandler 的invoke 方法。该方法会从memberValues 这个Map 中索引出对应的值。而memberValues 的来源是Java 常量池。</p><p>— 摘自《<a href="https://www.cnblogs.com/acm-bingzi/p/javaAnnotation.html" target="_blank" rel="noopener">注解Annotation实现原理与自定义注解例子</a>》</p></blockquote><h4 id="将动态代理对象-Proxy1持久化到硬盘"><a href="#将动态代理对象-Proxy1持久化到硬盘" class="headerlink" title="将动态代理对象$Proxy1持久化到硬盘"></a>将动态代理对象$Proxy1持久化到硬盘</h4><blockquote><p>在NameAnnotationHandler断点debug，可知动态生成了$Proxy1代理类</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1595751725/WechatIMG1_kerabq.png" alt="=annotation"></p><blockquote><p>修改NameTest，将$Proxy1持久化</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.hermit.study.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NameTest</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.setProperty(<span class="string">"sun.misc.ProxyGenerator.saveGeneratedFiles"</span>, <span class="string">"true"</span>);</span><br><span class="line">        String name = NameAnnotationHandler.getInfo(Person<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>点击重新运行后得到$Proxy1.class源码</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by Fernflower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.sun.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.hermit.study.annotation.Name;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.UndeclaredThrowableException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> $<span class="title">Proxy1</span> <span class="keyword">extends</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">Name</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m1;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m2;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m4;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m0;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m3;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $Proxy1(InvocationHandler var1) <span class="keyword">throws</span>  &#123;</span><br><span class="line">        <span class="keyword">super</span>(var1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object var1)</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Boolean)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m1, <span class="keyword">new</span> Object[]&#123;var1&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var3;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var4) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var4);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (String)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m2, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Class <span class="title">annotationType</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Class)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m4, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Integer)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m0, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">value</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (String)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m3, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            m1 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"equals"</span>, Class.forName(<span class="string">"java.lang.Object"</span>));</span><br><span class="line">            m2 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"toString"</span>);</span><br><span class="line">            m4 = Class.forName(<span class="string">"club.hermit.study.annotation.Name"</span>).getMethod(<span class="string">"annotationType"</span>);</span><br><span class="line">            m0 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"hashCode"</span>);</span><br><span class="line">            m3 = Class.forName(<span class="string">"club.hermit.study.annotation.Name"</span>).getMethod(<span class="string">"value"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchMethodError(var2.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoClassDefFoundError(var3.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>由$Proxy1.class源码可知：</p><ul><li>$Proxy1继承了 Proxy 类，实现了Name接口（但Name是@interface声明的，并不是一个接口啊!?）</li><li>value()方法中，调用InvocationHandler接口的invoke方法</li></ul></blockquote><h4 id="反编译Name接口"><a href="#反编译Name接口" class="headerlink" title="反编译Name接口"></a>反编译Name接口</h4><h5 id="反编译工具"><a href="#反编译工具" class="headerlink" title="反编译工具"></a>反编译工具</h5><blockquote><p>javap是java内置的反编译工具，具体用法如下：</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">gtang94MacBook-Pro:note tangguoqiang$ javap -<span class="built_in">help</span></span><br><span class="line">用法: javap &lt;options&gt; &lt;classes&gt;</span><br><span class="line">其中, 可能的选项包括:</span><br><span class="line">  -<span class="built_in">help</span>  --<span class="built_in">help</span>  -?        输出此用法消息</span><br><span class="line">  -version                 版本信息</span><br><span class="line">  -v  -verbose             输出附加信息</span><br><span class="line">  -l                       输出行号和本地变量表</span><br><span class="line">  -public                  仅显示公共类和成员</span><br><span class="line">  -protected               显示受保护的/公共类和成员</span><br><span class="line">  -package                 显示程序包/受保护的/公共类</span><br><span class="line">                           和成员 (默认)</span><br><span class="line">  -p  -private             显示所有类和成员</span><br><span class="line">  -c                       对代码进行反汇编</span><br><span class="line">  -s                       输出内部类型签名</span><br><span class="line">  -sysinfo                 显示正在处理的类的</span><br><span class="line">                           系统信息 (路径, 大小, 日期, MD5 散列)</span><br><span class="line">  -constants               显示最终常量</span><br><span class="line">  -classpath &lt;path&gt;        指定查找用户类文件的位置</span><br><span class="line">  -cp &lt;path&gt;               指定查找用户类文件的位置</span><br><span class="line">  -bootclasspath &lt;path&gt;    覆盖引导类文件的位置</span><br></pre></td></tr></table></figure><h5 id="反编译Name"><a href="#反编译Name" class="headerlink" title="反编译Name"></a>反编译Name</h5><blockquote><p>执行 javap -v Name.class 后输出Name.class信息，可知：</p><ul><li>Name 接口继承了 java.lang.annotation.Annotation 接口</li><li>ACC_ANNOTATION 表名Name是一个注解</li></ul></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">gtang94MacBook-Pro:annotation tangguoqiang$ javap -v Name.class</span><br><span class="line">Classfile /Users/gtang94/data/recharge/study/study/target/classes/club/hermit/study/annotation/Name.class</span><br><span class="line">  Last modified 2020-7-26; size 452 bytes</span><br><span class="line">  MD5 checksum 37d757a80b01e1ac9855c35355f0afc1</span><br><span class="line">  Compiled from <span class="string">"Name.java"</span></span><br><span class="line">public interface club.hermit.study.annotation.Name extends java.lang.annotation.Annotation</span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: 52</span><br><span class="line">  flags: ACC_PUBLIC, ACC_INTERFACE, ACC_ABSTRACT, ACC_ANNOTATION</span><br><span class="line">Constant pool:</span><br><span class="line">   <span class="comment">#1 = Class              #17            // club/hermit/study/annotation/Name</span></span><br><span class="line">   <span class="comment">#2 = Class              #18            // java/lang/Object</span></span><br><span class="line">   <span class="comment">#3 = Class              #19            // java/lang/annotation/Annotation</span></span><br><span class="line">   <span class="comment">#4 = Utf8               value</span></span><br><span class="line">   <span class="comment">#5 = Utf8               ()Ljava/lang/String;</span></span><br><span class="line">   <span class="comment">#6 = Utf8               AnnotationDefault</span></span><br><span class="line">   <span class="comment">#7 = Utf8</span></span><br><span class="line">   <span class="comment">#8 = Utf8               SourceFile</span></span><br><span class="line">   <span class="comment">#9 = Utf8               Name.java</span></span><br><span class="line">  <span class="comment">#10 = Utf8               RuntimeVisibleAnnotations</span></span><br><span class="line">  <span class="comment">#11 = Utf8               Ljava/lang/annotation/Retention;</span></span><br><span class="line">  <span class="comment">#12 = Utf8               Ljava/lang/annotation/RetentionPolicy;</span></span><br><span class="line">  <span class="comment">#13 = Utf8               RUNTIME</span></span><br><span class="line">  <span class="comment">#14 = Utf8               Ljava/lang/annotation/Target;</span></span><br><span class="line">  <span class="comment">#15 = Utf8               Ljava/lang/annotation/ElementType;</span></span><br><span class="line">  <span class="comment">#16 = Utf8               FIELD</span></span><br><span class="line">  <span class="comment">#17 = Utf8               club/hermit/study/annotation/Name</span></span><br><span class="line">  <span class="comment">#18 = Utf8               java/lang/Object</span></span><br><span class="line">  <span class="comment">#19 = Utf8               java/lang/annotation/Annotation</span></span><br><span class="line">&#123;</span><br><span class="line">  public abstract java.lang.String value();</span><br><span class="line">    descriptor: ()Ljava/lang/String;</span><br><span class="line">    flags: ACC_PUBLIC, ACC_ABSTRACT</span><br><span class="line">    AnnotationDefault:</span><br><span class="line">      default_value: s<span class="comment">#7&#125;</span></span><br><span class="line">SourceFile: <span class="string">"Name.java"</span></span><br><span class="line">RuntimeVisibleAnnotations:</span><br><span class="line">  0: <span class="comment">#11(#4=e#12.#13)</span></span><br><span class="line">  1: <span class="comment">#14(#4=[e#15.#16])</span></span><br></pre></td></tr></table></figure><h5 id="调用逻辑处理类"><a href="#调用逻辑处理类" class="headerlink" title="调用逻辑处理类"></a>调用逻辑处理类</h5><blockquote><p>注释是通过动态代理实现的，那调用逻辑处理类是在哪的呢？也即InvocationHandler的实现类是哪个</p><p>通过debug单步运行NameAnnotationHandler类，如下可知调用逻辑处理类是 sun.reflect.annotation.AnnotationInvocationHandler</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1595763069/WechatIMG2_umpwhf.png" alt="handler"></p><blockquote><p>sun.reflect.annotation.AnnotationInvocationHandler类的invoke()源码如下：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object var1, Method var2, Object[] var3)</span> </span>&#123;</span><br><span class="line">    String var4 = var2.getName();</span><br><span class="line">    Class[] var5 = var2.getParameterTypes();</span><br><span class="line">    <span class="keyword">if</span> (var4.equals(<span class="string">"equals"</span>) &amp;&amp; var5.length == <span class="number">1</span> &amp;&amp; var5[<span class="number">0</span>] == Object<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.equalsImpl(var3[<span class="number">0</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (var5.length != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(<span class="string">"Too many parameters for an annotation method"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">byte</span> var7 = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">switch</span>(var4.hashCode()) &#123;</span><br><span class="line">        <span class="keyword">case</span> -<span class="number">1776922004</span>:</span><br><span class="line">            <span class="keyword">if</span> (var4.equals(<span class="string">"toString"</span>)) &#123;</span><br><span class="line">                var7 = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">147696667</span>:</span><br><span class="line">            <span class="keyword">if</span> (var4.equals(<span class="string">"hashCode"</span>)) &#123;</span><br><span class="line">                var7 = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1444986633</span>:</span><br><span class="line">            <span class="keyword">if</span> (var4.equals(<span class="string">"annotationType"</span>)) &#123;</span><br><span class="line">                var7 = <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span>(var7) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.toStringImpl();</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.hashCodeImpl();</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.type;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            Object var6 = <span class="keyword">this</span>.memberValues.get(var4);</span><br><span class="line">            <span class="keyword">if</span> (var6 == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IncompleteAnnotationException(<span class="keyword">this</span>.type, var4);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (var6 <span class="keyword">instanceof</span> ExceptionProxy) &#123;</span><br><span class="line">                <span class="keyword">throw</span> ((ExceptionProxy)var6).generateException();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (var6.getClass().isArray() &amp;&amp; Array.getLength(var6) != <span class="number">0</span>) &#123;</span><br><span class="line">                    var6 = <span class="keyword">this</span>.cloneArray(var6);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> var6;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;WHAT&quot;&gt;&lt;a href=&quot;#WHAT&quot; class=&quot;headerlink&quot; title=&quot;WHAT&quot;&gt;&lt;/a&gt;WHAT&lt;/h2&gt;&lt;h3 id=&quot;注解是什么&quot;&gt;&lt;a href=&quot;#注解是什么&quot; class=&quot;headerlink&quot; title=&quot;注解是什么&quot;&gt;
      
    
    </summary>
    
    
      <category term="源码分析" scheme="http://yoursite.com/categories/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="注解" scheme="http://yoursite.com/tags/%E6%B3%A8%E8%A7%A3/"/>
    
      <category term="反编译" scheme="http://yoursite.com/tags/%E5%8F%8D%E7%BC%96%E8%AF%91/"/>
    
      <category term="动态代理" scheme="http://yoursite.com/tags/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>Java类型信息</title>
    <link href="http://yoursite.com/2020/07/11/Java%E7%B1%BB%E5%9E%8B%E4%BF%A1%E6%81%AF/"/>
    <id>http://yoursite.com/2020/07/11/Java%E7%B1%BB%E5%9E%8B%E4%BF%A1%E6%81%AF/</id>
    <published>2020-07-11T02:23:10.000Z</published>
    <updated>2020-07-25T17:13:15.885Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>在某些情况下，Java需要在运行时再发现和确定类型信息，发现和确定用到的方法就是RTTI（Runtime Type Infomation，运行时类型信息），Java中的RTTI主要有个下面两种方式：</p><ul><li>传统RTTI ： 假定在编译时已经知道了所有的类型</li><li>反射 ： 允许在运行时发现和使用类的信息</li></ul></blockquote><blockquote><p><strong>运行时类型信息</strong> 使得程序员从只能在编译期执行面向类型的操作的禁锢中解脱了出来</p></blockquote><h2 id="传统RTTI"><a href="#传统RTTI" class="headerlink" title="传统RTTI"></a>传统RTTI</h2><blockquote><p>也叫RTTI。是通过继承和多态来实现的，在运行时通过调用超类的方法来实现具体的功能</p></blockquote><blockquote><p>传统RTTI有3中实现方式：</p><ul><li>向上转型或向下转型</li><li>通过Class对象(注：用了Class类并不代表就是反射)</li><li>通过instanceof或isInstance()</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span> + <span class="string">".draw()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Circle"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Square"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Shape&gt; list = Arrays.asList(</span><br><span class="line">                <span class="keyword">new</span> Circle(),</span><br><span class="line">                <span class="keyword">new</span> Square()</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">for</span> (Shape shape : list) &#123;</span><br><span class="line">            shape.draw();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Circle.draw()</span><br><span class="line">Square.draw()</span><br><span class="line"></span><br><span class="line">Process finished with <span class="built_in">exit</span> code 0</span><br></pre></td></tr></table></figure><h2 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h2><h3 id="反射是什么"><a href="#反射是什么" class="headerlink" title="反射是什么"></a>反射是什么</h3><blockquote><p>反射是RTTI的另一种实现方式，是在Java程序运行时，动态的获取信息已经动态调用对象方法的机制</p></blockquote><h3 id="反射用在啥地方"><a href="#反射用在啥地方" class="headerlink" title="反射用在啥地方"></a>反射用在啥地方</h3><blockquote><p>在平时项目开发中，很少用反射，但在更深层次的模块化开发、框架开发中，经常用到反射。例如：</p><ul><li>动态代理设计模式</li><li>Spring框架</li><li>JDBC</li></ul></blockquote><h3 id="传统RTTI和反射的区别"><a href="#传统RTTI和反射的区别" class="headerlink" title="传统RTTI和反射的区别"></a>传统RTTI和反射的区别</h3><blockquote><p>RTTI在编译期就需要.class文件，而反射不需要</p></blockquote><h2 id="反射基本用法"><a href="#反射基本用法" class="headerlink" title="反射基本用法"></a>反射基本用法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span> + <span class="string">".draw()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String nameStr = <span class="string">"CircleNameStr"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> redius;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">double</span> PI = <span class="number">3.1415</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Circle</span><span class="params">(<span class="keyword">float</span> redius)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redius = redius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getRedius</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRedius</span><span class="params">(<span class="keyword">float</span> redius)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redius = redius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">getArea</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> PI * <span class="keyword">this</span>.redius * redius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Circle"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="获取类的所有变量"><a href="#获取类的所有变量" class="headerlink" title="获取类的所有变量"></a>获取类的所有变量</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Class circle = Circle<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">        System.out.println(circle.getName()); <span class="comment">// 获取类名</span></span><br><span class="line">        Field[] fields1 = circle.getFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field : fields1) &#123;</span><br><span class="line">            <span class="keyword">int</span> modifiers = field.getModifiers(); <span class="comment">// 获取访问权限</span></span><br><span class="line">            System.out.println(Modifier.toString(modifiers));</span><br><span class="line">            System.out.println(field.getType().getName() + <span class="string">" : "</span> + field.getName()); <span class="comment">//获取变量类型和变量名称</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        Field[] fields2 = circle.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field : fields2) &#123;</span><br><span class="line">            <span class="keyword">int</span> modifiers = field.getModifiers();</span><br><span class="line">            System.out.println(Modifier.toString(modifiers));</span><br><span class="line">            System.out.println(field.getType().getName() + <span class="string">" : "</span> + field.getName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">club.hermit.study.reflect.Circle</span><br><span class="line">public</span><br><span class="line">java.lang.String : nameStr</span><br><span class="line">public static final</span><br><span class="line">double : PI</span><br><span class="line"></span><br><span class="line">public</span><br><span class="line">java.lang.String : nameStr</span><br><span class="line">private</span><br><span class="line"><span class="built_in">float</span> : redius</span><br><span class="line">public static final</span><br><span class="line">double : PI</span><br><span class="line"></span><br><span class="line">Process finished with <span class="built_in">exit</span> code 0</span><br></pre></td></tr></table></figure><h3 id="获取类的所有方法"><a href="#获取类的所有方法" class="headerlink" title="获取类的所有方法"></a>获取类的所有方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeTest2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Class circle = Circle<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">        System.out.println(<span class="string">"类名: "</span> + circle.getName()); <span class="comment">// 获取类名</span></span><br><span class="line"></span><br><span class="line">        Method[] methods1 = circle.getMethods(); <span class="comment">// 获取所有public方法</span></span><br><span class="line">        System.out.println(<span class="string">"=====所有public方法：====="</span>);</span><br><span class="line">        <span class="keyword">for</span> (Method method : methods1) &#123;</span><br><span class="line">            <span class="keyword">int</span> modifiers = method.getModifiers(); <span class="comment">// 获取权限修饰符</span></span><br><span class="line">            System.out.println(<span class="string">"方法修饰符: "</span> + Modifier.toString(modifiers));</span><br><span class="line"></span><br><span class="line">            Class resType = method.getReturnType(); <span class="comment">// 获取返回值</span></span><br><span class="line">            System.out.println(<span class="string">"方法返回值: "</span> + resType.getName() + <span class="string">" : "</span> + method.getName());</span><br><span class="line"></span><br><span class="line">            Parameter[] parameters = method.getParameters(); <span class="comment">// 获取参数</span></span><br><span class="line">            <span class="keyword">if</span> (parameters.length != <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.print(<span class="string">"方法参数: "</span>);</span><br><span class="line">                <span class="keyword">for</span> (Parameter parameter : parameters) &#123;</span><br><span class="line">                    System.out.print(parameter.getType().getName() + <span class="string">" : "</span> + parameter.getName());</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">""</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Class[] ex = method.getExceptionTypes(); <span class="comment">// 获取异常</span></span><br><span class="line">            <span class="keyword">if</span> (ex.length != <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.print(<span class="string">"方法异常: "</span>);</span><br><span class="line">                <span class="keyword">for</span> (Class <span class="keyword">var</span> : ex) &#123;</span><br><span class="line">                    System.out.print(<span class="keyword">var</span>.getName());</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">""</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">""</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"=====所有方法====="</span>);</span><br><span class="line"></span><br><span class="line">        Method[] methods2 = circle.getDeclaredMethods(); <span class="comment">// 获取所有方法</span></span><br><span class="line">        <span class="keyword">for</span> (Method method : methods2) &#123;</span><br><span class="line">            <span class="keyword">int</span> modifiers = method.getModifiers(); <span class="comment">// 获取权限修饰符</span></span><br><span class="line">            System.out.println(<span class="string">"方法修饰符: "</span> + Modifier.toString(modifiers));</span><br><span class="line"></span><br><span class="line">            Class resType = method.getReturnType(); <span class="comment">// 获取返回值</span></span><br><span class="line">            System.out.println(<span class="string">"方法返回值: "</span> + resType.getName() + <span class="string">" : "</span> + method.getName());</span><br><span class="line"></span><br><span class="line">            Parameter[] parameters = method.getParameters(); <span class="comment">// 获取参数</span></span><br><span class="line">            <span class="keyword">if</span> (parameters.length != <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.print(<span class="string">"方法参数: "</span>);</span><br><span class="line">                <span class="keyword">for</span> (Parameter parameter : parameters) &#123;</span><br><span class="line">                    System.out.print(parameter.getType().getName() + <span class="string">" : "</span> + parameter.getName());</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">""</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Class[] ex = method.getExceptionTypes(); <span class="comment">// 获取异常</span></span><br><span class="line">            <span class="keyword">if</span> (ex.length != <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.print(<span class="string">"方法异常: "</span>);</span><br><span class="line">                <span class="keyword">for</span> (Class <span class="keyword">var</span> : ex) &#123;</span><br><span class="line">                    System.out.print(<span class="keyword">var</span>.getName());</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">""</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">""</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">类名: club.hermit.study.reflect.Circle</span><br><span class="line">=====所有public方法：=====</span><br><span class="line">方法修饰符: public</span><br><span class="line">方法返回值: java.lang.String : toString</span><br><span class="line"></span><br><span class="line">方法修饰符: public</span><br><span class="line">方法返回值: <span class="built_in">float</span> : getRedius</span><br><span class="line"></span><br><span class="line">方法修饰符: public</span><br><span class="line">方法返回值: void : setRedius</span><br><span class="line">方法参数: <span class="built_in">float</span> : arg0</span><br><span class="line"></span><br><span class="line">方法修饰符: public final</span><br><span class="line">方法返回值: void : <span class="built_in">wait</span></span><br><span class="line">方法参数: long : arg0int : arg1</span><br><span class="line">方法异常: java.lang.InterruptedException</span><br><span class="line"></span><br><span class="line">方法修饰符: public final native</span><br><span class="line">方法返回值: void : <span class="built_in">wait</span></span><br><span class="line">方法参数: long : arg0</span><br><span class="line">方法异常: java.lang.InterruptedException</span><br><span class="line"></span><br><span class="line">方法修饰符: public final</span><br><span class="line">方法返回值: void : <span class="built_in">wait</span></span><br><span class="line">方法异常: java.lang.InterruptedException</span><br><span class="line"></span><br><span class="line">方法修饰符: public</span><br><span class="line">方法返回值: boolean : equals</span><br><span class="line">方法参数: java.lang.Object : arg0</span><br><span class="line"></span><br><span class="line">方法修饰符: public native</span><br><span class="line">方法返回值: int : hashCode</span><br><span class="line"></span><br><span class="line">方法修饰符: public final native</span><br><span class="line">方法返回值: java.lang.Class : getClass</span><br><span class="line"></span><br><span class="line">方法修饰符: public final native</span><br><span class="line">方法返回值: void : notify</span><br><span class="line"></span><br><span class="line">方法修饰符: public final native</span><br><span class="line">方法返回值: void : notifyAll</span><br><span class="line"></span><br><span class="line">=====所有方法=====</span><br><span class="line">方法修饰符: public</span><br><span class="line">方法返回值: java.lang.String : toString</span><br><span class="line"></span><br><span class="line">方法修饰符: public</span><br><span class="line">方法返回值: <span class="built_in">float</span> : getRedius</span><br><span class="line"></span><br><span class="line">方法修饰符: public</span><br><span class="line">方法返回值: void : setRedius</span><br><span class="line">方法参数: <span class="built_in">float</span> : arg0</span><br><span class="line"></span><br><span class="line">方法修饰符: private</span><br><span class="line">方法返回值: double : getArea</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Process finished with <span class="built_in">exit</span> code 0</span><br></pre></td></tr></table></figure><blockquote><p>此处，Circle.class 和 Class.forName(“Circle”) 都可以创建Circle类的Class对象，但用Circle.class创建时，不会自动初始化该Class对象，也就是不会执行Circle中的static{}部分的代码(如果有这部分代码的话)</p></blockquote><h3 id="反射访问private方法"><a href="#反射访问private方法" class="headerlink" title="反射访问private方法"></a>反射访问private方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeTest3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Circle circle = <span class="keyword">new</span> Circle(<span class="number">12</span>);</span><br><span class="line">        Class circleClass = circle.getClass(); <span class="comment">// 获取Class类实例</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Method area = circleClass.getDeclaredMethod(<span class="string">"getArea"</span>, <span class="keyword">null</span>); <span class="comment">// 获取circleClass中的方法</span></span><br><span class="line">            <span class="keyword">if</span> (area != <span class="keyword">null</span>) &#123;</span><br><span class="line">                area.setAccessible(<span class="keyword">true</span>); <span class="comment">// 获取私有方法的访问权限</span></span><br><span class="line">                System.out.println(area.invoke(circle)); <span class="comment">// 使用invoke调用</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">452.376</span><br><span class="line"></span><br><span class="line">Process finished with <span class="built_in">exit</span> code 0</span><br></pre></td></tr></table></figure><h3 id="反射修改private变量"><a href="#反射修改private变量" class="headerlink" title="反射修改private变量"></a>反射修改private变量</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeTest4</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Circle circle = <span class="keyword">new</span> Circle(<span class="number">12</span>);</span><br><span class="line">        Class circleClass = circle.getClass(); <span class="comment">// 获取Class类实例</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field field = circleClass.getDeclaredField(<span class="string">"redius"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (field != <span class="keyword">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">"更改前: "</span> + circle.getRedius());</span><br><span class="line">                field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                field.set(circle, <span class="number">10</span>);</span><br><span class="line">                System.out.println(<span class="string">"更改后: "</span> + circle.getRedius());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">更改前: 12.0</span><br><span class="line">更改后: 10.0</span><br><span class="line"></span><br><span class="line">Process finished with <span class="built_in">exit</span> code 0</span><br></pre></td></tr></table></figure><h3 id="反射修改private常量"><a href="#反射修改private常量" class="headerlink" title="反射修改private常量"></a>反射修改private常量</h3><blockquote><p>Java在编译时，JVM会对<strong>已赋值的</strong>int、float、double等基本类型以及String类的常量做优化，将常量直接替换成具体值，但包装类型Integer、Float、Double及其他类就不会。</p><p>如下Circle类的.class文件：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by Fernflower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> club.hermit.study.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String nameStr = <span class="string">"CircleNameStr"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> redius;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">double</span> PI = <span class="number">3.1415</span>D;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Circle</span><span class="params">(<span class="keyword">float</span> redius)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redius = redius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getRedius</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.redius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRedius</span><span class="params">(<span class="keyword">float</span> redius)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redius = redius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">getArea</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3.1415</span>D * (<span class="keyword">double</span>)<span class="keyword">this</span>.redius * (<span class="keyword">double</span>)<span class="keyword">this</span>.redius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Circle"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>所以，在这个时候就算通过反射替换了这种常量，依旧没有用</p></blockquote><blockquote><p>但如果将int、float、double、String这类常量不直接赋值，而是在构造方法中赋值，则可以修改，因为在编译后的.class文件中是通过变量名使用这种变量的。</p><p>例如，修改Circle类，去掉PI的static修饰符，不给PI直接赋值，而是放在构造方法中，则编译后的.class文件变为:</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String nameStr = <span class="string">"CircleNameStr"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> redius;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">double</span> PI;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Circle</span><span class="params">(<span class="keyword">float</span> redius)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redius = redius;</span><br><span class="line">        <span class="keyword">this</span>.PI = <span class="number">3.1415</span>D;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getRedius</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.redius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRedius</span><span class="params">(<span class="keyword">float</span> redius)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redius = redius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">getArea</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.PI * (<span class="keyword">double</span>)<span class="keyword">this</span>.redius * (<span class="keyword">double</span>)<span class="keyword">this</span>.redius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Circle"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>所以此时是可以通过反射修改此处的PI值的</p></blockquote><h2 id="反射原理"><a href="#反射原理" class="headerlink" title="反射原理"></a>反射原理</h2><h3 id="类的加载机制"><a href="#类的加载机制" class="headerlink" title="类的加载机制"></a>类的加载机制</h3><h4 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h4><blockquote><p>每个类编译后都会生成一个.class文件，JVM使用类加载器(Class Loader)来加载这个.class文件，类加载器实质上是一条类加载器链，一般的，只会用到一个原生的类加载器，通常只是在本地磁盘中加载。如果需要从远程或DB中加载.class文件时，就需要挂载额外的类加载器来实现了。</p></blockquote><blockquote><p>一般来说，类加载器是按照树形层次结构组织的，每个加载器都有一个父类加载器。另外，每个类加载器都支持代理模式，也就是可以自己完成.class的加载工作，也可以代理给其他加载器完成。</p></blockquote><blockquote><p>类加载器的加载顺序有两种：</p><ul><li>父类优先策略：JDK就采用这种方式，在这种策略下，类加载某个.class之前，会尝试先代理给父类加载器，只有当父类加载器找不到时，才会自己加载</li><li>子类优先策略：与父类优先策略相反，先尝试子类加载，找不到时候使用父类加载器加载</li></ul></blockquote><h4 id="动态加载"><a href="#动态加载" class="headerlink" title="动态加载"></a>动态加载</h4><blockquote><p>不论是采用 <strong>父类优先策略</strong> 加载还是采用 <strong>子类优先策略</strong> 加载，类都是在第一次被用到时动态加载到JVM的，即：</p><ul><li>Java程序在运行时，并不是一起把所有.class都加载，而是只有在使用的时候发现该类还未被加载时才会加载</li><li>当程序创建第一个对类的静态成员的引用时，才会加载该类。Java这个特性就叫<strong>动态加载</strong></li></ul></blockquote><blockquote><p>注：当加载一个.class文件时，并不意味着就会初始化这个对象。</p><p>类的初始化包括:</p><ul><li>加载：由类加载器执行，加载.class字节码，并创建一个Class对象</li><li>链接：验证字节码，为静态域分配存储空间（只是分配，并不初始化该存储空间），解析该类创建所需要的对其他类的应用</li><li>初始化：首先执行静态初始化块static{}，初始化静态变量，执行静态方法（如静态方法）</li></ul></blockquote><h4 id="加载"><a href="#加载" class="headerlink" title="加载"></a>加载</h4><blockquote><p>加载阶段主要完成以下几件事：</p><ul><li>通过一个类的全限定类名来获取定义此类的二进制字节流</li><li>将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构</li><li>在内存中生成一个代表这个类的 java.lang.Class 对象，作为方法区这个类的各种数据访问入口</li></ul></blockquote><h4 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h4><blockquote><p>Java在加载了类之后，需要进行链接的步骤，链接简单的说，就是将已经加载的Java二进制代码组合到JVM运行状态中去。它包含三个步骤：</p><ul><li>验证：验证是保证二进制字节码在结构上的正确性，具体来说，工作包括检测类型的正确性、接入属性正确性、检查final class没有被继承、检查静态变量的正确性等</li><li>准备：准备阶段主要是创建静态域、分配空间、给这些域设置默认值，需要注意的是：1. 在准备阶段不会执行任何代码，仅仅是ishezhi默认值；2. 这些默认值是这样分配的，原生类型全部设为0，其他引用类型设置为null</li><li>解析：解析的过程就是对类中的接口、类、方法、变量的符号引用进行解析和定位，解析成直接引用（符号引用就是编码是用字符串表示某个变量、接口的位置，直接引用就是根据符号引用翻译出来的地址），并保证这些类被正确的找到。解析的过程可能导致其他的类被加载。需要注意的是：根据不同的解析策略，这一步不是必须的，有些解析策略在解析时递归的把所有引用姐写，这是early resolution，要求所有引用都必须存在；还有一种策略是late resolution，这也是oracle的JDK所采用的策略，即在类只是被引用了，还没有别真正用到时，并不进行解析，只有当真正用到了，才去加载和解析这个类</li></ul></blockquote><h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><blockquote><p>根据JVM规范，所有JVM实现必须在每个类或接口被Java程序首次使用时才初始化。主要有以下几种：</p><ul><li>创建类的实例</li><li>访问某个类或者接口的静态变量，或者对该静态变量赋值</li><li>调用类的静态方法</li><li>反射</li><li>初始化一个类的子类，不过直接通过子类引用父类元素，不会引起子类的初始化</li><li>JVM被标明为启动类的类</li></ul></blockquote><h3 id="Class类"><a href="#Class类" class="headerlink" title="Class类"></a>Class类</h3><blockquote><p>Class的实例代表了Java运行程序中的类或接口。一个枚举就是一种类，一个注释就是一种接口。每个数组也属于反映Class对象的一个类，这个类被具有相同元素类型和数量维度的所有数组共享。而Java的原始类型，如：booealn、byte、char、short、int、long、float、double、及void也被表示为Class对象</p></blockquote><h4 id="类声明"><a href="#类声明" class="headerlink" title="类声明"></a>类声明</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Class</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>,</span></span><br><span class="line"><span class="class">                              <span class="title">GenericDeclaration</span>,</span></span><br><span class="line"><span class="class">                              <span class="title">Type</span>,</span></span><br><span class="line"><span class="class">                              <span class="title">AnnotatedElement</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Class类被声明为final，做了阉割，不能有子类</p></blockquote><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><h5 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">Class</span><span class="params">(ClassLoader loader)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Initialize final field for classLoader.  The initialization value of non-null</span></span><br><span class="line">  <span class="comment">// prevents future JIT optimizations from assuming this final field is null.</span></span><br><span class="line">  classLoader = loader;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Class类没有public的构造方法；该private的构造方法也是为了阻止默认构造方法被使用（在Java中，如果创建了一个带有三处的构造方法，那么无参的构造方法必须显式的写出来）</p><p>当.class字节码文件在类加载器(Class Loader)中被加载并且被已定义的类方法被调用时，JVM才会自动构造Class对象</p></blockquote><h5 id="生成实例"><a href="#生成实例" class="headerlink" title="生成实例"></a>生成实例</h5><blockquote><p>该类方法主要是根据给定的类名，加载类信息并执行初始化</p></blockquote><h6 id="forName"><a href="#forName" class="headerlink" title="forName"></a>forName</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CallerSensitive</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Class&lt;?&gt; forName(String className)</span><br><span class="line">            <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">    Class&lt;?&gt; caller = Reflection.getCallerClass();</span><br><span class="line">    <span class="keyword">return</span> forName0(className, <span class="keyword">true</span>, ClassLoader.getClassLoader(caller), caller);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@CallerSensitive</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Class&lt;?&gt; forName(String name, <span class="keyword">boolean</span> initialize,</span><br><span class="line">                               ClassLoader loader)</span><br><span class="line">    <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">&#123;</span><br><span class="line">    Class&lt;?&gt; caller = <span class="keyword">null</span>;</span><br><span class="line">    SecurityManager sm = System.getSecurityManager();</span><br><span class="line">    <span class="keyword">if</span> (sm != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Reflective call to get caller class is only needed if a security manager</span></span><br><span class="line">        <span class="comment">// is present.  Avoid the overhead of making this call otherwise.</span></span><br><span class="line">        caller = Reflection.getCallerClass();</span><br><span class="line">        <span class="keyword">if</span> (sun.misc.VM.isSystemDomainLoader(loader)) &#123;</span><br><span class="line">            ClassLoader ccl = ClassLoader.getClassLoader(caller);</span><br><span class="line">            <span class="keyword">if</span> (!sun.misc.VM.isSystemDomainLoader(ccl)) &#123;</span><br><span class="line">                sm.checkPermission(</span><br><span class="line">                    SecurityConstants.GET_CLASSLOADER_PERMISSION);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> forName0(name, initialize, loader, caller);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Called after security check for system loader access checks have been made. */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> Class&lt;?&gt; forName0(String name, <span class="keyword">boolean</span> initialize,</span><br><span class="line">                                        ClassLoader loader,</span><br><span class="line">                                        Class&lt;?&gt; caller)</span><br><span class="line">    <span class="keyword">throws</span> ClassNotFoundException;</span><br></pre></td></tr></table></figure><blockquote><p>forName()方法共有两个重载方法，他们最终都调用navite方法forName0()</p><p>在只有一个形参的forName方法中，通过获得类加载器，调用forName0方法</p><p>在另一个forName方法中，通过SecurityManager类，JVM在应用层进行安全检查，按照各种权限判断是否可获取类加载器</p></blockquote><h6 id="newInstance"><a href="#newInstance" class="headerlink" title="newInstance"></a>newInstance</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CallerSensitive</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">newInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InstantiationException, IllegalAccessException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (System.getSecurityManager() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        checkMemberAccess(Member.PUBLIC, Reflection.getCallerClass(), <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> the following code may not be strictly correct under</span></span><br><span class="line">    <span class="comment">// the current Java memory model.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Constructor lookup</span></span><br><span class="line">    <span class="keyword">if</span> (cachedConstructor == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == Class<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalAccessException(</span><br><span class="line">                <span class="string">"Can not call newInstance() on the Class for java.lang.Class"</span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt;[] empty = &#123;&#125;;</span><br><span class="line">            <span class="keyword">final</span> Constructor&lt;T&gt; c = getConstructor0(empty, Member.DECLARED);</span><br><span class="line">            <span class="comment">// Disable accessibility checks on the constructor</span></span><br><span class="line">            <span class="comment">// since we have to do the security check here anyway</span></span><br><span class="line">            <span class="comment">// (the stack depth is wrong for the Constructor's</span></span><br><span class="line">            <span class="comment">// security check to work)</span></span><br><span class="line">            java.security.AccessController.doPrivileged(</span><br><span class="line">                <span class="keyword">new</span> java.security.PrivilegedAction&lt;Void&gt;() &#123;</span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Void <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                            c.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">            cachedConstructor = c;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> (InstantiationException)</span><br><span class="line">                <span class="keyword">new</span> InstantiationException(getName()).initCause(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Constructor&lt;T&gt; tmpConstructor = cachedConstructor;</span><br><span class="line">    <span class="comment">// Security check (same as in java.lang.reflect.Constructor)</span></span><br><span class="line">    <span class="keyword">int</span> modifiers = tmpConstructor.getModifiers();</span><br><span class="line">    <span class="keyword">if</span> (!Reflection.quickCheckMemberAccess(<span class="keyword">this</span>, modifiers)) &#123;</span><br><span class="line">        Class&lt;?&gt; caller = Reflection.getCallerClass();</span><br><span class="line">        <span class="keyword">if</span> (newInstanceCallerCache != caller) &#123;</span><br><span class="line">            Reflection.ensureMemberAccess(caller, <span class="keyword">this</span>, <span class="keyword">null</span>, modifiers);</span><br><span class="line">            newInstanceCallerCache = caller;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Run constructor</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tmpConstructor.newInstance((Object[])<span class="keyword">null</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">        Unsafe.getUnsafe().throwException(e.getTargetException());</span><br><span class="line">        <span class="comment">// Not reached</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>通过该方法，可以创建一个被Class表示的类的新实例，如果该类尚未没初始化时该类就会在此时被初始化</p><p>在该方法中，通过getConstructor0()、privateGetDeclaredConstructors()、reflectionData()等方法获取构造函数数组，接着根据参数列表为空判断找到空构造函数，拷贝并返回该构造函数</p><p>最后调用Constructor类的newInstance方法返回一个新实例</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Constructor&lt;T&gt; <span class="title">getConstructor0</span><span class="params">(Class&lt;?&gt;[] parameterTypes,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    <span class="keyword">int</span> which)</span> <span class="keyword">throws</span> NoSuchMethodException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Constructor&lt;T&gt;[] constructors = privateGetDeclaredConstructors((which == Member.PUBLIC));</span><br><span class="line">    <span class="keyword">for</span> (Constructor&lt;T&gt; constructor : constructors) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arrayContentsEq(parameterTypes,</span><br><span class="line">                            constructor.getParameterTypes())) &#123;</span><br><span class="line">            <span class="keyword">return</span> getReflectionFactory().copyConstructor(constructor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchMethodException(getName() + <span class="string">".&lt;init&gt;"</span> + argumentTypesToString(parameterTypes));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="获取类信息"><a href="#获取类信息" class="headerlink" title="获取类信息"></a>获取类信息</h5><blockquote><p>这一类方法比较多，包括获取类的构造函数、已经声明的字段、方法，该类的注解、包名、父类，以及判断该类是否是数组、枚举、接口等</p><p>这类方法有：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Package <span class="title">getPackage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Package.getPackage(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> Class&lt;? <span class="keyword">super</span> T&gt; getSuperclass();</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">getModifiers</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> Object[] getSigners();</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CallerSensitive</span></span><br><span class="line"><span class="keyword">public</span> Field[] getFields() <span class="keyword">throws</span> SecurityException &#123;</span><br><span class="line">  checkMemberAccess(Member.PUBLIC, Reflection.getCallerClass(), <span class="keyword">true</span>);</span><br><span class="line">  <span class="keyword">return</span> copyFields(privateGetPublicFields(<span class="keyword">null</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CallerSensitive</span></span><br><span class="line"><span class="keyword">public</span> Method[] getMethods() <span class="keyword">throws</span> SecurityException &#123;</span><br><span class="line">  checkMemberAccess(Member.PUBLIC, Reflection.getCallerClass(), <span class="keyword">true</span>);</span><br><span class="line">  <span class="keyword">return</span> copyMethods(privateGetPublicMethods());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CallerSensitive</span></span><br><span class="line"><span class="keyword">public</span> Constructor&lt;?&gt;[] getConstructors() <span class="keyword">throws</span> SecurityException &#123;</span><br><span class="line">  checkMemberAccess(Member.PUBLIC, Reflection.getCallerClass(), <span class="keyword">true</span>);</span><br><span class="line">  <span class="keyword">return</span> copyConstructors(privateGetDeclaredConstructors(<span class="keyword">true</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CallerSensitive</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Field <span class="title">getField</span><span class="params">(String name)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> NoSuchFieldException, SecurityException </span>&#123;</span><br><span class="line">  checkMemberAccess(Member.PUBLIC, Reflection.getCallerClass(), <span class="keyword">true</span>);</span><br><span class="line">  Field field = getField0(name);</span><br><span class="line">  <span class="keyword">if</span> (field == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchFieldException(name);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> field;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CallerSensitive</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Method <span class="title">getMethod</span><span class="params">(String name, Class&lt;?&gt;... parameterTypes)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> NoSuchMethodException, SecurityException </span>&#123;</span><br><span class="line">  checkMemberAccess(Member.PUBLIC, Reflection.getCallerClass(), <span class="keyword">true</span>);</span><br><span class="line">  Method method = getMethod0(name, parameterTypes, <span class="keyword">true</span>);</span><br><span class="line">  <span class="keyword">if</span> (method == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchMethodException(getName() + <span class="string">"."</span> + name + argumentTypesToString(parameterTypes));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> method;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>等一系列方法……</p></blockquote><h5 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h5><h6 id="asSubclass"><a href="#asSubclass" class="headerlink" title="asSubclass"></a>asSubclass</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;U&gt; Class&lt;? extends U&gt; asSubclass(Class&lt;U&gt; clazz) &#123;</span><br><span class="line">  <span class="keyword">if</span> (clazz.isAssignableFrom(<span class="keyword">this</span>))</span><br><span class="line">    <span class="keyword">return</span> (Class&lt;? extends U&gt;) <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ClassCastException(<span class="keyword">this</span>.toString());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">isAssignableFrom</span><span class="params">(Class&lt;?&gt; cls)</span></span>;</span><br></pre></td></tr></table></figure><blockquote><p>该asSubclass方法将类转换为它的子类</p><p>isAssignableFrom方法用来判断clazz是否是当前实例，或者是当前实例的父类</p></blockquote><h6 id="cast"><a href="#cast" class="headerlink" title="cast"></a>cast</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">cast</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (obj != <span class="keyword">null</span> &amp;&amp; !isInstance(obj))</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ClassCastException(cannotCastMsg(obj));</span><br><span class="line">  <span class="keyword">return</span> (T) obj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">isInstance</span><span class="params">(Object obj)</span></span>;</span><br></pre></td></tr></table></figure><blockquote><p>将obj对象转换成Class类表示的类或接口</p></blockquote><h3 id="Reflect包"><a href="#Reflect包" class="headerlink" title="Reflect包"></a>Reflect包</h3><h4 id="Constructor"><a href="#Constructor" class="headerlink" title="Constructor"></a>Constructor</h4><blockquote><p>该类提供了有关单个类的构造函数，该类用在newInstance()方法中</p></blockquote><h5 id="newInstance方法"><a href="#newInstance方法" class="headerlink" title="newInstance方法"></a>newInstance方法</h5><blockquote><p>使用被 Constructor类表示的构造器初始化一个、声明了该构造器的类的是实例，</p></blockquote><h2 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h2><h3 id="三种获取Class对象-new-Object-getClass、Object-class、Class-forName-“className”-区别"><a href="#三种获取Class对象-new-Object-getClass、Object-class、Class-forName-“className”-区别" class="headerlink" title="三种获取Class对象( new Object().getClass、Object.class、Class.forName(“className”) )区别"></a>三种获取Class对象( new Object().getClass、Object.class、Class.forName(“className”) )区别</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">reflect1</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"reflect1 静态代码块"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">"reflect1 动态代码块"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">reflect1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行reflect1构造方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">reflect2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"reflect2 静态代码块"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">"reflect2 动态代码块"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">reflect2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行reflect2构造方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">reflect3</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"reflect3 静态代码块"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">"reflect3 动态代码块"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">reflect3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行reflect3构造方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"=========clz1========="</span>);</span><br><span class="line">        Class clz1 = reflect1<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">        System.out.println(<span class="string">"=========clz1========="</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"=========clz2========="</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class clz2 = Class.forName(<span class="string">"club.hermit.study.reflect.reflect2"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"=========clz2========="</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"=========clz3========="</span>);</span><br><span class="line">        Class clz3 = <span class="keyword">new</span> reflect3().getClass();</span><br><span class="line">        System.out.println(<span class="string">"=========clz3========="</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">=========clz1=========</span><br><span class="line">=========clz1=========</span><br><span class="line">=========clz2=========</span><br><span class="line">reflect2 静态代码块</span><br><span class="line">=========clz2=========</span><br><span class="line">=========clz3=========</span><br><span class="line">reflect3 静态代码块</span><br><span class="line">reflect3 动态代码块</span><br><span class="line">执行reflect3构造方法</span><br><span class="line">=========clz3=========</span><br><span class="line"></span><br><span class="line">Process finished with <span class="built_in">exit</span> code 0</span><br></pre></td></tr></table></figure><blockquote><p>由上可知，</p><ul><li>object.class 静态、动态代码块和构造方法都不会执行</li><li>Class.forName(“”) 只执行静态代码块</li><li>new Object().getClass()  会执行静态代码块、动态代码块、构造方法</li></ul></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;在某些情况下，Java需要在运行时再发现和确定类型信息，发现和确定用到的方法就是RTTI（Runtime Type Infomation，运行时类型信息），Java中的RTTI主要有个下面两种方式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;传统RTTI ： 假定
      
    
    </summary>
    
    
      <category term="源码分析" scheme="http://yoursite.com/categories/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="Class" scheme="http://yoursite.com/tags/Class/"/>
    
      <category term="类加载器" scheme="http://yoursite.com/tags/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8/"/>
    
      <category term="反射" scheme="http://yoursite.com/tags/%E5%8F%8D%E5%B0%84/"/>
    
      <category term="Reflect" scheme="http://yoursite.com/tags/Reflect/"/>
    
      <category term="Class Loader" scheme="http://yoursite.com/tags/Class-Loader/"/>
    
  </entry>
  
  <entry>
    <title>序列化源码分析</title>
    <link href="http://yoursite.com/2020/07/05/%E5%BA%8F%E5%88%97%E5%8C%96%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/07/05/%E5%BA%8F%E5%88%97%E5%8C%96%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</id>
    <published>2020-07-04T16:50:09.000Z</published>
    <updated>2020-07-22T13:48:25.787Z</updated>
    
    <content type="html"><![CDATA[<h2 id="what"><a href="#what" class="headerlink" title="what"></a>what</h2><h3 id="序列化-反序列化是什么"><a href="#序列化-反序列化是什么" class="headerlink" title="序列化/反序列化是什么"></a>序列化/反序列化是什么</h3><blockquote><p>Java序列化是把Java Bean转化成有序字节流的过程</p><p>Java反序列化是把有序字节流转化成Java Bean的过程</p></blockquote><h3 id="序列化-反序列化有什么用"><a href="#序列化-反序列化有什么用" class="headerlink" title="序列化/反序列化有什么用"></a>序列化/反序列化有什么用</h3><blockquote><p>在网络通信过程中，所有的数据，如图片、文本都是以二进制序列的形式传输的。而将这些图片、文本对应的对象转化成二进制序列就是通过序列化实现的</p></blockquote><blockquote><p>而将网络中的二进制数据流恢复成对象就是通过Java Bean实现的</p></blockquote><h3 id="序列化用在什么情况下"><a href="#序列化用在什么情况下" class="headerlink" title="序列化用在什么情况下"></a>序列化用在什么情况下</h3><blockquote><ul><li>将对象持久化到硬盘中</li><li>将对象传输到网络中</li><li>进程间的对象传输</li></ul></blockquote><h2 id="序列化-反序列化怎么用"><a href="#序列化-反序列化怎么用" class="headerlink" title="序列化/反序列化怎么用"></a>序列化/反序列化怎么用</h2><blockquote><p>Java的序列化有两种方式：</p><ul><li>实现 Serializable 接口</li><li>实现 Externalizable 接口</li></ul></blockquote><h3 id="实现-Serializable-接口"><a href="#实现-Serializable-接口" class="headerlink" title="实现 Serializable 接口"></a>实现 Serializable 接口</h3><h4 id="默认方式实现序列化"><a href="#默认方式实现序列化" class="headerlink" title="默认方式实现序列化"></a>默认方式实现序列化</h4><blockquote><p>用FileOutputStream类实例化ObjectOutputStream类，然后使用ObjectOutputStream的默认的序列化方式，对非transient变量进行序列化</p></blockquote><blockquote><p>用FileInputStream类实例化ObjectInputStream类，然后使用ObjectInputStream的默认反序列化方式，对非transient变量进行反序列化</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SerialParent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            ObjectOutputStream oss = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">"test.txt"</span>));</span><br><span class="line">            Test test = <span class="keyword">new</span> Test(<span class="number">12</span>);</span><br><span class="line">            oss.writeObject(test);</span><br><span class="line"></span><br><span class="line">            ObjectInputStream iss = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">"test.txt"</span>));</span><br><span class="line">            Test itest = (Test) iss.readObject();</span><br><span class="line">            System.out.println(itest.getAge());</span><br><span class="line">           </span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="自定义方式实现序列化"><a href="#自定义方式实现序列化" class="headerlink" title="自定义方式实现序列化"></a>自定义方式实现序列化</h4><h5 id="writeObject-readObject"><a href="#writeObject-readObject" class="headerlink" title="writeObject / readObject"></a>writeObject / readObject</h5><blockquote><p>在实现了Serializable类的子类中重写readObject和writeObject方法，在序列化/反序列化的时候，就会调用该类的readObject和writeObject方法</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SerialParent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            ObjectOutputStream oss = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">"test.txt"</span>));</span><br><span class="line">            Test test = <span class="keyword">new</span> Test(<span class="number">12</span>);</span><br><span class="line">            oss.writeObject(test);</span><br><span class="line"></span><br><span class="line">            ObjectInputStream iss = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">"test.txt"</span>));</span><br><span class="line">            Test itest = (Test) iss.readObject();</span><br><span class="line">            System.out.println(itest.toString());</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(java.io.ObjectOutputStream outputStream)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            outputStream.defaultWriteObject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream inputStream)</span> <span class="keyword">throws</span> IOException,ClassNotFoundException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            inputStream.defaultReadObject();</span><br><span class="line">            age = <span class="number">1000</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Test &#123;"</span> +</span><br><span class="line">                <span class="string">"age = "</span> + age +</span><br><span class="line">                <span class="string">"&#125;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="writeReplace-readResolve"><a href="#writeReplace-readResolve" class="headerlink" title="writeReplace / readResolve"></a>writeReplace / readResolve</h5><blockquote><p>和writeObject/readObject类似，重写writeReplace/readResolve方法也能实现自定义序列化</p><p>但在序列化时，会先调用writeReplace方法，在调用writeObject方法。该方法可将任意对象代替成目标序列化对象</p><p>在反序列化时，readResolve方法会替换反序列化出的对象，反序列出来的方法会别立即丢弃。该方法在readObject之后调用</p></blockquote><h3 id="实现-Externalizable-接口"><a href="#实现-Externalizable-接口" class="headerlink" title="实现 Externalizable 接口"></a>实现 Externalizable 接口</h3><blockquote><p>实现Externalizable接口，并且实现writeExternal方法和readExternal方法，在序列化/反序列化时，会调用这两个方法进行序列化</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SerialParent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            ObjectOutputStream oss = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">"test.txt"</span>));</span><br><span class="line">            Test test = <span class="keyword">new</span> Test(<span class="number">12</span>);</span><br><span class="line">            oss.writeObject(test);</span><br><span class="line"></span><br><span class="line">            ObjectInputStream iss = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">"test.txt"</span>));</span><br><span class="line">            Test itest = (Test) iss.readObject();</span><br><span class="line">            System.out.println(itest.toString());</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">implements</span> <span class="title">Externalizable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">"zhangsan"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Test &#123;"</span> +</span><br><span class="line">                <span class="string">"age = "</span> + age +</span><br><span class="line">                <span class="string">"&#125;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeExternal</span><span class="params">(ObjectOutput out)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        StringBuffer buff = <span class="keyword">new</span> StringBuffer(<span class="keyword">this</span>.name).reverse();</span><br><span class="line">        out.writeObject(buff);</span><br><span class="line">        out.writeInt(<span class="keyword">this</span>.age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readExternal</span><span class="params">(ObjectInput in)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = ((StringBuffer)in.readObject()).reverse().toString();</span><br><span class="line">        <span class="keyword">this</span>.age = in.readInt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><h3 id="标记接口"><a href="#标记接口" class="headerlink" title="标记接口"></a>标记接口</h3><blockquote><p>标记接口并不是Java语言特有的，标记接口是编程中的一种通用的设计思路。</p><p>Java中的标记接口有Serializable、Cloneable等，他们没有实际的方法，只是起到标记类的作用。比如Class A implements Serializable, Cloneable ，只是表示A可以被序列化和克隆。</p><p>在Java运行时，通过 obj instanceof Serializable 判断是否实现这些标记接口，实现则做特殊处理</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>标记接口是编程中的一种设计思路，编程语言本身并不支持为类维护元数据。而标记接口则弥补了这个功能上的缺失：当一个类实现了标记接口时，实际上从某种意义上来说就成为了这个类的元数据之一，在运行时，通过编程语言的反射机制，我们就可以拿到代码中的元数据了</p></blockquote><h3 id="元数据"><a href="#元数据" class="headerlink" title="元数据"></a>元数据</h3><blockquote><p><a href="https://www.oracle.com/technetwork/articles/hunter-meta-097643-zhs.html" target="_blank" rel="noopener">元数据</a>是用来描述数据的数据，也就是描述代码与其他资源(如：DB表)之间内在联系的数据</p><p>例如：富士苹果有一个属性：它是红色的。假定有一个 FujiApple 类，您可以使用 <code>@Color</code> 批注类型的一个批注来指定它的颜色。通过这么做，您就提供了关于苹果的元数据</p></blockquote><blockquote><p>在JDK1.5之前标记接口主要担任元数据的角色(描述代码的字节流联系的数据)，1.5之后注解主要作为元数据的角色</p></blockquote><h3 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h3><blockquote><p>在正常情况下，在使用一个类时，必须先得知道它是做什么的，有什么用，有哪些属性，有哪些方法。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Person person = <span class="keyword">new</span> Person();</span><br><span class="line">person.getAge(<span class="number">20</span>);</span><br></pre></td></tr></table></figure><blockquote><p>但在某些情况下，在程序运行时才你呢个知道要操作的是什么类，及这个类的方法属性，然后调用它的方法</p><p>在这种情况下，即在运行时操作类的方式就是反射</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class clz = Class.forName(<span class="string">"club.hermit.study.Person"</span>);</span><br><span class="line">Method method = clz.getMethod(<span class="string">"setAge"</span>, <span class="keyword">int</span><span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">Constructor cons = clz.getConstructor();</span><br><span class="line">Object object = cons.newInstance();</span><br><span class="line">method.invoke(object, <span class="number">20</span>);</span><br></pre></td></tr></table></figure><blockquote><p>上面两个都实现了实例化Person类，已经设置Person类的age属性，但一个是通过正常实例化类的方式，后者是通过发射的方式</p></blockquote><h3 id="序列化原理"><a href="#序列化原理" class="headerlink" title="序列化原理"></a>序列化原理</h3><blockquote><p>在通过ObjectOutputStream实现序列化的过程中，writeObject0方法做以下的事：</p><ol><li>先处理以前写入或不重新写入的对象</li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// handle previously written and non-replaceable objects</span></span><br><span class="line"><span class="keyword">int</span> h;</span><br><span class="line"><span class="keyword">if</span> ((obj = subs.lookup(obj)) == <span class="keyword">null</span>) &#123;</span><br><span class="line">  writeNull();</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!unshared &amp;&amp; (h = handles.lookup(obj)) != -<span class="number">1</span>) &#123;</span><br><span class="line">  writeHandle(h);</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Class) &#123;</span><br><span class="line">  writeClass((Class) obj, unshared);</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> ObjectStreamClass) &#123;</span><br><span class="line">  writeClassDesc((ObjectStreamClass) obj, unshared);</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>判断对象是否为null、对象句柄映射、Class的子类、及待序列化的类是否是序列化类的描述内，根据各自判断直接将结果写入流中</p><p>ObjectStreamClass类是类的序列化描述符，可以通过lookup方法查找或创建JVM中加的的特定类的ObjectStreamClass类。该类中包含了类名和序列化ID(serialVersionUID)</p></blockquote><blockquote><ol start="2"><li>检查是否需要更换对象</li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// check for replacement object</span></span><br><span class="line">Object orig = obj;</span><br><span class="line">Class&lt;?&gt; cl = obj.getClass();</span><br><span class="line">ObjectStreamClass desc;</span><br><span class="line"><span class="keyword">for</span> (;;) &#123;</span><br><span class="line">  <span class="comment">// REMIND: skip this check for strings/arrays?</span></span><br><span class="line">  Class&lt;?&gt; repCl;</span><br><span class="line">  desc = ObjectStreamClass.lookup(cl, <span class="keyword">true</span>);</span><br><span class="line">  <span class="keyword">if</span> (!desc.hasWriteReplaceMethod() ||</span><br><span class="line">      (obj = desc.invokeWriteReplace(obj)) == <span class="keyword">null</span> ||</span><br><span class="line">      (repCl = obj.getClass()) == cl)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  cl = repCl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (enableReplace) &#123;</span><br><span class="line">  Object rep = replaceObject(obj);</span><br><span class="line">  <span class="keyword">if</span> (rep != obj &amp;&amp; rep != <span class="keyword">null</span>) &#123;</span><br><span class="line">    cl = rep.getClass();</span><br><span class="line">    desc = ObjectStreamClass.lookup(cl, <span class="keyword">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  obj = rep;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>首先通过反射拿到需序列化的类的类名cl</li><li>然后通过第一步说的lookup方法查找JVM中加载的cl类对应的ObjectStreamClass描述符</li><li>如果需序列化的类中定义了writeReplace方法，则会反射执行该writeReplace方法</li></ul><p>注：该处的 if 条件用的贼鸡儿好<del>~</del> 如果未定义直接break，如果定义才之后 || 后面的条件(即反射执行的writeReplace方法)</p></blockquote><blockquote><ol start="3"><li>判断对象的父接口</li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// remaining cases</span></span><br><span class="line"><span class="keyword">if</span> (obj <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">  writeString((String) obj, unshared);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (cl.isArray()) &#123;</span><br><span class="line">  writeArray(obj, desc, unshared);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Enum) &#123;</span><br><span class="line">  writeEnum((Enum&lt;?&gt;) obj, desc, unshared);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Serializable) &#123;</span><br><span class="line">  writeOrdinaryObject(obj, desc, unshared);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (extendedDebugInfo) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NotSerializableException(</span><br><span class="line">      cl.getName() + <span class="string">"\n"</span> + debugInfoStack.toString());</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NotSerializableException(cl.getName());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在此处判断实现序列化接口 obj instanceof Serializable ，将对象写入字节流</p></blockquote><blockquote><p>在 writeOrdinaryObject 方法中，通过 ObjectStreamClass 描述符判断此序列化是实现了 Serializable 接口还是实现了 Externalizable 接口</p></blockquote><blockquote><ul><li>在 writeSerialData 方法即实现Serializable接口是调用的方法中，按照ObjectStreamClass描述符对每个属性遍历，如果重写了writeObject方法，则反射执行该writeObject方法，否则执行默认的defaultWriteFields方法</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">ObjectStreamClass.ClassDataSlot[] slots = desc.getClassDataLayout();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; slots.length; i++) &#123;</span><br><span class="line">  ObjectStreamClass slotDesc = slots[i].desc;</span><br><span class="line">  <span class="keyword">if</span> (slotDesc.hasWriteObjectMethod()) &#123;</span><br><span class="line">    PutFieldImpl oldPut = curPut;</span><br><span class="line">    curPut = <span class="keyword">null</span>;</span><br><span class="line">    SerialCallbackContext oldContext = curContext;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (extendedDebugInfo) &#123;</span><br><span class="line">      debugInfoStack.push(</span><br><span class="line">        <span class="string">"custom writeObject data (class \""</span> +</span><br><span class="line">        slotDesc.getName() + <span class="string">"\")"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      curContext = <span class="keyword">new</span> SerialCallbackContext(obj, slotDesc);</span><br><span class="line">      bout.setBlockDataMode(<span class="keyword">true</span>);</span><br><span class="line">      slotDesc.invokeWriteObject(obj, <span class="keyword">this</span>);</span><br><span class="line">      bout.setBlockDataMode(<span class="keyword">false</span>);</span><br><span class="line">      bout.writeByte(TC_ENDBLOCKDATA);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      curContext.setUsed();</span><br><span class="line">      curContext = oldContext;</span><br><span class="line">      <span class="keyword">if</span> (extendedDebugInfo) &#123;</span><br><span class="line">        debugInfoStack.pop();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    curPut = oldPut;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    defaultWriteFields(obj, slotDesc);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>同理，在实现了Externalizable接口后，执行writeExternalData方法，执行需序列化的类中定义的writeExternal方法</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curContext = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (protocol == PROTOCOL_VERSION_1) &#123;</span><br><span class="line">  obj.writeExternal(<span class="keyword">this</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  bout.setBlockDataMode(<span class="keyword">true</span>);</span><br><span class="line">  obj.writeExternal(<span class="keyword">this</span>);</span><br><span class="line">  bout.setBlockDataMode(<span class="keyword">false</span>);</span><br><span class="line">  bout.writeByte(TC_ENDBLOCKDATA);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="反序列化原理"><a href="#反序列化原理" class="headerlink" title="反序列化原理"></a>反序列化原理</h3><blockquote><p>在反序列化中，根据序列化的类型逐个解析</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> TC_ARRAY:</span><br><span class="line"><span class="keyword">return</span> checkResolve(readArray(unshared));</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> TC_ENUM:</span><br><span class="line"><span class="keyword">return</span> checkResolve(readEnum(unshared));</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> TC_OBJECT:</span><br><span class="line"><span class="keyword">return</span> checkResolve(readOrdinaryObject(unshared));</span><br></pre></td></tr></table></figure><blockquote><p>根据JVM中获取的ObjectStreamClass描述符，根据反射形式，执行在类中预定义的readExternal和readObject方法反序列化对象</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ObjectStreamClass desc = readClassDesc(<span class="keyword">false</span>);</span><br><span class="line">desc.checkDeserialize();</span><br><span class="line"></span><br><span class="line">Class&lt;?&gt; cl = desc.forClass();</span><br><span class="line"><span class="keyword">if</span> (cl == String<span class="class">.<span class="keyword">class</span> || <span class="title">cl</span> </span>== Class<span class="class">.<span class="keyword">class</span></span></span><br><span class="line"><span class="class">    || <span class="title">cl</span> </span>== ObjectStreamClass<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> InvalidClassException(<span class="string">"invalid class descriptor"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (desc.isExternalizable()) &#123;</span><br><span class="line">  readExternalData((Externalizable) obj, desc);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  readSerialData(obj, desc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (obj != <span class="keyword">null</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    obj.readExternal(<span class="keyword">this</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ClassNotFoundException ex) &#123;</span><br><span class="line">    handles.markException(passHandle, ex);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (obj == <span class="keyword">null</span> || handles.lookupException(passHandle) != <span class="keyword">null</span>) &#123;</span><br><span class="line">  defaultReadFields(<span class="keyword">null</span>, slotDesc); <span class="comment">// skip field values</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (slotDesc.hasReadObjectMethod()) &#123;</span><br><span class="line">  ThreadDeath t = <span class="keyword">null</span>;</span><br><span class="line">  <span class="keyword">boolean</span> reset = <span class="keyword">false</span>;</span><br><span class="line">  SerialCallbackContext oldContext = curContext;</span><br><span class="line">  <span class="keyword">if</span> (oldContext != <span class="keyword">null</span>)</span><br><span class="line">    oldContext.check();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    curContext = <span class="keyword">new</span> SerialCallbackContext(obj, slotDesc);</span><br><span class="line"></span><br><span class="line">    bin.setBlockDataMode(<span class="keyword">true</span>);</span><br><span class="line">    slotDesc.invokeReadObject(obj, <span class="keyword">this</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ClassNotFoundException ex) &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">                         * In most cases, the handle table has already</span></span><br><span class="line"><span class="comment">                         * propagated a CNFException to passHandle at this</span></span><br><span class="line"><span class="comment">                         * point; this mark call is included to address cases</span></span><br><span class="line"><span class="comment">                         * where the custom readObject method has cons'ed and</span></span><br><span class="line"><span class="comment">                         * thrown a new CNFException of its own.</span></span><br><span class="line"><span class="comment">                         */</span></span><br><span class="line">    handles.markException(passHandle, ex);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        curContext.setUsed();</span><br><span class="line">        <span class="keyword">if</span> (oldContext!= <span class="keyword">null</span>)</span><br><span class="line">          oldContext.check();</span><br><span class="line">        curContext = oldContext;</span><br><span class="line">        reset = <span class="keyword">true</span>;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (ThreadDeath x) &#123;</span><br><span class="line">        t = x;  <span class="comment">// defer until reset is true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (!reset);</span><br><span class="line">    <span class="keyword">if</span> (t != <span class="keyword">null</span>)</span><br><span class="line">      <span class="keyword">throw</span> t;</span><br><span class="line">  &#125;</span><br><span class="line">  defaultDataEnd = <span class="keyword">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  defaultReadFields(obj, slotDesc);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (slotDesc.hasWriteObjectData()) &#123;</span><br><span class="line">  skipCustomData();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  bin.setBlockDataMode(<span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">      slotDesc.hasReadObjectNoDataMethod() &amp;&amp;</span><br><span class="line">      handles.lookupException(passHandle) == <span class="keyword">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    slotDesc.invokeReadObjectNoData(obj);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h2><h3 id="为什么向Stream写入对象的顺序和从Stream读对象的数据的顺序要一样"><a href="#为什么向Stream写入对象的顺序和从Stream读对象的数据的顺序要一样" class="headerlink" title="为什么向Stream写入对象的顺序和从Stream读对象的数据的顺序要一样"></a>为什么向Stream写入对象的顺序和从Stream读对象的数据的顺序要一样</h3><h3 id="为什么父类实现序列化，子类会自动实现"><a href="#为什么父类实现序列化，子类会自动实现" class="headerlink" title="为什么父类实现序列化，子类会自动实现"></a>为什么父类实现序列化，子类会自动实现</h3><blockquote><p>因为父类实现了 序列化接口Externalizable或Serializable，由下来源码可知</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// remaining cases</span></span><br><span class="line"><span class="keyword">if</span> (obj <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">  writeString((String) obj, unshared);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (cl.isArray()) &#123;</span><br><span class="line">  writeArray(obj, desc, unshared);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Enum) &#123;</span><br><span class="line">  writeEnum((Enum&lt;?&gt;) obj, desc, unshared);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Serializable) &#123;</span><br><span class="line">  writeOrdinaryObject(obj, desc, unshared);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (extendedDebugInfo) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NotSerializableException(</span><br><span class="line">      cl.getName() + <span class="string">"\n"</span> + debugInfoStack.toString());</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NotSerializableException(cl.getName());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在此处相当于子类也实现了，所以当父类实现序列化时，子类也会自动实现</p></blockquote><h3 id="子类实现序列化，父类的属性不可以正常实例化"><a href="#子类实现序列化，父类的属性不可以正常实例化" class="headerlink" title="子类实现序列化，父类的属性不可以正常实例化"></a>子类实现序列化，父类的属性不可以正常实例化</h3><blockquote><p>实现 Externalizable 接口的类，在反序列化时需要无参的构造函数，所以为了构造父对象时，只能调用无参构造函数作为默认的父对象，因此父类的属性值是无参构造函数执行后的值</p></blockquote><h3 id="serialVersionUID如何保证版本兼容"><a href="#serialVersionUID如何保证版本兼容" class="headerlink" title="serialVersionUID如何保证版本兼容"></a>serialVersionUID如何保证版本兼容</h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;what&quot;&gt;&lt;a href=&quot;#what&quot; class=&quot;headerlink&quot; title=&quot;what&quot;&gt;&lt;/a&gt;what&lt;/h2&gt;&lt;h3 id=&quot;序列化-反序列化是什么&quot;&gt;&lt;a href=&quot;#序列化-反序列化是什么&quot; class=&quot;headerlink&quot; ti
      
    
    </summary>
    
    
      <category term="源码分析" scheme="http://yoursite.com/categories/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="Java序列化" scheme="http://yoursite.com/tags/Java%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
      <category term="Externalizable" scheme="http://yoursite.com/tags/Externalizable/"/>
    
      <category term="Serializable" scheme="http://yoursite.com/tags/Serializable/"/>
    
  </entry>
  
  <entry>
    <title>黄金圈法则What-How-Why</title>
    <link href="http://yoursite.com/2020/07/01/%E9%BB%84%E9%87%91%E5%9C%88%E6%B3%95%E5%88%99What-How-Why/"/>
    <id>http://yoursite.com/2020/07/01/%E9%BB%84%E9%87%91%E5%9C%88%E6%B3%95%E5%88%99What-How-Why/</id>
    <published>2020-07-01T15:32:22.000Z</published>
    <updated>2020-07-22T13:48:25.787Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本文内容转自作者[朱利安_AI产品经理]的博客 <a href="https://www.jianshu.com/p/f1185cc40c41" target="_blank" rel="noopener">思考的梯子 | 黄金圈法则What-How-Why(超干货)</a></p></blockquote><h2 id="「黄金圈」是什么？"><a href="#「黄金圈」是什么？" class="headerlink" title="「黄金圈」是什么？"></a>「黄金圈」是什么？</h2><blockquote><p>这里的「黄金圈」并不是金拱门那个</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593614321/1060404-94a6f1ba2acd1ae5_yitj9c.webp" alt="images"></p><blockquote><p>「黄金圈」法则是营销大师Simon Sinek 提出的理论</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593614413/1060404-bc89d66866e63b1c_fn4ccq.webp" alt="images"></p><blockquote><p>上面这段英文的大概意思就是消费者更愿意为「本质需求」买单。</p></blockquote><blockquote><p>举个例子（瞎编的），假设外国车在一开始中国本地化的时候</p></blockquote><ul><li><h4 id="宝马宣传策略"><a href="#宝马宣传策略" class="headerlink" title="宝马宣传策略"></a>宝马宣传策略</h4></li></ul><blockquote><p>车好，发动机好，省油，动力足，安全</p></blockquote><ul><li><h4 id="奥迪宣传策略"><a href="#奥迪宣传策略" class="headerlink" title="奥迪宣传策略"></a>奥迪宣传策略</h4></li></ul><blockquote><p>中国特有加长版，后排乘坐超舒适，尊贵</p></blockquote><blockquote><p><strong>这种情况下高端市场谁的销量好？</strong></p></blockquote><blockquote><p>肯定是「奥迪」，高端车和普通车，都是四个轮子，<strong>如何体现差异性</strong>，这时候再从表象入手已经不能体现差异，必须深入到人内心的本质。</p><p><strong>国人好面子，「加长」「尊贵」简直就是直击老板们的内心，销量自然不差</strong></p><p>上面的case中，如果只看到了「表象」，谈论的就是「是什么」，就是在「What」层面，但谈论的是「为什么」的时候，已经深入到了「Why」层面。</p></blockquote><blockquote><p><strong>将事物分为「What-How-Why」逐层深入，就是「黄金圈」法则。</strong></p><p>而在实际生活和工作中使用，网上各种版本都有，切入的角度不相同，下面总结两种我认为比较合适的切入角度。</p></blockquote><h2 id="使用「黄金圈」实现「1–-gt-0-1」的过程"><a href="#使用「黄金圈」实现「1–-gt-0-1」的过程" class="headerlink" title="使用「黄金圈」实现「1–&gt;0.1」的过程"></a>使用「黄金圈」实现「1–&gt;0.1」的过程</h2><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593614662/1060404-bdebe9419348bd52_joe6ct.webp" alt="images"></p><blockquote><p>当一个事物，现象或者需求已经存在的时，<strong>我们想要去探寻它，了解它，学习或者分享它的时候</strong>，适合用<strong>「What - How - Why」</strong>的思维方式</p></blockquote><h3 id="我们学新事物的过程"><a href="#我们学新事物的过程" class="headerlink" title="我们学新事物的过程"></a>我们学新事物的过程</h3><blockquote><p>当面对一个新的事物，如果上来直接讲原理，多数人是会懵逼的</p><p>但如果你从表象出发</p><ul><li>What - 了解完这个东西是什么？</li><li>How - 再了解这个东西它是怎么使用的？</li><li>Why - 最终再去了解原理</li></ul><p><strong>那么这个过程就会变得顺畅很多，而这个过程实际也就是这样一个整体拆成一个个组成部分，掰开揉碎的过程</strong></p></blockquote><h3 id="给老外介绍微信支付的case"><a href="#给老外介绍微信支付的case" class="headerlink" title="给老外介绍微信支付的case"></a>给老外介绍微信支付的case</h3><blockquote><p>举一个简单例子，假如有个老外来中国，他完全没有用过移动支付，你需要给他介绍微信支付</p></blockquote><h4 id="Step1-What"><a href="#Step1-What" class="headerlink" title="Step1 - What"></a>Step1 - What</h4><blockquote><p>你需要告诉他什么是微信支付？最简单的例子就是直接给他演示一遍支付的过程。</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593614757/1060404-85b8db355ba4e86e_g1b1ef.webp" alt="images"></p><h4 id="Step2-How"><a href="#Step2-How" class="headerlink" title="Step2 - How"></a>Step2 - How</h4><blockquote><p>而当他知道了什么是微信支付之后，你教她如何使用微信支付，就需要一步一步的引导</p><ol><li>绑定银行卡</li><li>实名认证</li><li>开通微信支付</li><li>设定密码</li><li>使用</li></ol></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593614838/1060404-422053e0c54a3e55_umxurz.webp" alt="images"></p><h4 id="Step3-Why"><a href="#Step3-Why" class="headerlink" title="Step3 - Why"></a>Step3 - Why</h4><blockquote><p>后续随着交谈的进一步深入</p><p>你们可以<strong>再去讨论一下为什么在中国会诞生如此通用的微信支付</strong>？</p></blockquote><blockquote><p>又或者探讨一下<strong>为什么</strong>国内的人愿意使用微信支付，但是<strong>在外国更多使用信用卡？</strong></p><p>探索内容其实是围绕的<strong>微信支付引申出的更加深入的内容</strong>，可能会涉及到社会的科技，经济，文化等。</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593614882/1060404-47a0245ff32e4a25_lrrrzt.webp" alt="images"></p><blockquote><p>通过以上简单的例子，说明<strong>当一个事物它本身存在在那里，你要去介绍或者探索它的时候就可以通过「What - How - Why」的方式，实现「1-&gt;0.1」逐步拆解</strong>。</p><p>千万不要觉得这东西太简单没有用。</p><p>我们试着<strong>把场景延伸一点，例如你去分析用户需求时，实际也可以使用这个策略</strong></p></blockquote><h3 id="运营人员的数据看板的case"><a href="#运营人员的数据看板的case" class="headerlink" title="运营人员的数据看板的case"></a>运营人员的数据看板的case</h3><blockquote><p>例如你要给公司内部运营人员做「数据看板」的工具，自动获取当天的数据形成图表显示。</p><p>当你收集需求的时候，注意！<strong>这个需求是已经存在的，你是可以通过需要通过「What - How - Why」的步骤去深入挖掘</strong></p><p>例如，面对面交流时</p><ul><li>what - 运营人员口头表述的需求是什么？</li><li>How - 他们现在<strong>用什么流程实现上述需求</strong>？（没有数据看板工具时，他们用什么流程完成数据汇总展示）</li><li>Why - 为什么会有这个需求？是因为KPI指标？还是领导个人喜好？</li></ul></blockquote><h3 id="介绍一本书-一个工具-一部电影case"><a href="#介绍一本书-一个工具-一部电影case" class="headerlink" title="介绍一本书/一个工具/一部电影case"></a>介绍一本书/一个工具/一部电影case</h3><blockquote><p>再比如你在写文章介绍自己喜欢的一本书时</p><ul><li>what - 这本书是关于什么内容？</li><li>How - 作者是如何去呈现这些内容？建议读者怎样去阅读这本书？</li><li>Why - 为什么推荐这本书？为什么作者会有书中的这些观点，而我是怎么看的？等</li></ul><p>合理的使用「What - How - Why」，<strong>它能够在你大脑毫无思绪的时候，快速建立起逻辑框架</strong>，顺着这个框架往下走，能够深入的挖掘出不少有价值的内容。</p></blockquote><h2 id="使用「黄金圈」实现「0-1–-gt-1」的过程"><a href="#使用「黄金圈」实现「0-1–-gt-1」的过程" class="headerlink" title="使用「黄金圈」实现「0.1–&gt;1」的过程"></a>使用「黄金圈」实现「0.1–&gt;1」的过程</h2><blockquote><p>在产品策划需求的时候，需要<strong>将大脑中的点子，转化为最终实际可以被用户使用的产品。</strong></p><p>这个过程我认为是从「0.1–&gt;1」的过程，适合用「What - Why - How」的方式</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593615064/1060404-cfdf00fc910db12b_fbbt49.webp" alt="images"></p><blockquote><p>策划产品功能时，<strong>一开始是不知道最终的形态是什么的，所以你需要从零开始一点点的深入，积累每一个0.1，最终才能形成一个完整的1。</strong></p><p>举一个用户反馈功能策划的思考过程</p></blockquote><h3 id="用户反馈功能策划case"><a href="#用户反馈功能策划case" class="headerlink" title="用户反馈功能策划case"></a>用户反馈功能策划case</h3><h4 id="Step1-What-1"><a href="#Step1-What-1" class="headerlink" title="Step1 - What"></a>Step1 - What</h4><blockquote><p><strong>用户说需要一个反馈功能</strong>，我们设想<strong>用户能够利用该功能吐槽产品，反馈他的建议</strong>，产品人员能看到用户的建议，从而改进我们的产品</p><p>但如果直接开发，可能并没有挖到用户真实的需求</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593615165/1060404-fa613dd03c41a47f_vuhnqv.webp" alt="images"></p><h4 id="Step2-Why"><a href="#Step2-Why" class="headerlink" title="Step2 - Why"></a>Step2 - Why</h4><blockquote><p>我们继续去探索下，<strong>为什么用户会有这个需求？</strong></p><p>问用户为什么需要这个功能时，解释说<strong>因为要退货，但是不知道怎么退</strong>，产品上也没有任何的提示，希望得到你们的帮助，所以我希望有反馈功能，<strong>你们看到我的问题就可以帮我退货</strong>。</p></blockquote><blockquote><p>好吧，其实<strong>用户想要的并不是一个用户反馈的功能，而是一个帮助中心的功能</strong>，因为他不知道怎么去完成退货，APP里又不存在帮助中心。</p><p><strong>在他过往的概念里，退货就是打电话反馈给相应的人，这个问题就能解决，所以他需要一个反馈的功能。</strong></p><p>虽然用反馈功能确实能够解决这<strong>一个用户</strong>的问题，但它不是最佳的方式。反而提供<strong>「帮助中心」</strong>给他，不仅能解决他一个人的问题，也<strong>能解决其他用户的问题</strong>。</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593615229/1060404-89f4000f8db3faee_ytqw4r.webp" alt="images"></p><h4 id="Step3-How"><a href="#Step3-How" class="headerlink" title="Step3 - How"></a>Step3 - How</h4><blockquote><p>开始思考如何实现帮助中心，用「Visio」梳理清楚，当有了清晰流程后，再用「Auxre」画原型。</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593615260/1060404-7db96e912eb0dc08_ey48wc.webp" alt="images"></p><blockquote><p>上述的这个例子实际是虚构的，但做产品过程中，问题会比上述的更为复杂，而且要规划的是一整个产品的所有用功能</p><p>但其实是对于整个产品，<strong>这样的思考思路依旧是成立的，将一整个产品拆散给一个个的业务流，每一个业务流里面去使用「What - Why - How」</strong></p></blockquote><h3 id="完成老板的需求的case"><a href="#完成老板的需求的case" class="headerlink" title="完成老板的需求的case"></a>完成老板的需求的case</h3><blockquote><p>如果你不是产品策划人员，这个思考方式依旧对你有用。</p></blockquote><blockquote><p><strong>例如某天临下班的时，老板说做一个介绍公司的PPT，明天上午就要用！</strong></p><p>如果你没有任何的思考，直接去做，<strong>即使你熬夜通宵</strong>，做出了一份「公司简史」，描述过公司从创立到现今取得的种种成就，公司的愿景，使命，价值观等，<strong>但第二天老板可能大发雷霆，因为你写的东西并不是他想要的。</strong></p><p><strong>你可以使用如下的方式思考</strong></p><ul><li><strong>what</strong> - 做一个介绍公司的PPT</li><li><strong>Why</strong> - <strong>为什么需要做一个PPT？</strong></li></ul><p>老板回答「<strong>明天上午有投资人过来</strong>，需要你写个PPT，介绍一下我们公司」，价值，愿景，使命这些带过就可以了，着重描述一下我们的产品</p></blockquote><blockquote><p>需求明确了，老板是想<strong>通过**</strong>介绍我们公司的产品来获得投资人的青睐<strong>，所以你</strong>应该思考投资人希望看到什么**。</p><p>例如产品的市场占有率，增长率，日活跃等等，表现产品在市面上蒸蒸日上的感觉</p></blockquote><blockquote><ul><li><strong>How</strong> - 将上述你思考的需要给投资人看的点，通过PPT描述出来</li></ul></blockquote><h3 id="两种思考方式如何配合？"><a href="#两种思考方式如何配合？" class="headerlink" title="两种思考方式如何配合？"></a>两种思考方式如何配合？</h3><blockquote><p><strong>上述提及的两种思考方式，实际是相辅相成的。</strong></p><p>当你设计一个东西的时候，东西不存在，是「0.1 –&gt;1」的过程，用「What - Why - How」去思考整体流程。</p><p>而当你去探寻一个已知的事物的时候，实现「0.1 –&gt; 0.01」逐步拆解的过程，用「What - How - Why」的方式</p></blockquote><blockquote><p><strong>再回来看 「用户反馈需求的case」</strong></p><p>case里面我们用了「What - Why - How」的过程</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593615444/1060404-c24d2349c1647492.png_ahvcaj.webp" alt="images"></p><blockquote><p>而<strong>「Why」这一步去探寻用户的需求的时候，**</strong>是站在「用户的视角」，用「What - How - Why」去深挖**</p></blockquote><blockquote><p><strong>再回看「给老板写PPT的Case」</strong></p><p>因为这个PPT，你不明确要写什么内容的时候，你要去创造它，我们用了「What - Why - How」的流程</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593615497/1060404-071cee81e04b7cde.png_pwl5va.webp" alt="images"></p><blockquote><p><strong>当你在思考「why」时，是去思考「投资人」想要看什么，使用「What - How - Why」的方式去深挖。</strong></p><p>而最终实际展示给投资人的PPT，也是通过「What - How - Why」来讲解，展示公司的实力。</p></blockquote><blockquote><p>所以，当你在<strong>创造时，从「0.1–&gt;1」，用「What - Why - How」</strong>的大流程，去逐渐的将每个0.1拼接起来，成为1</p><p>但当你要<strong>深挖需求的时候，实际就是要深入的每一个「0.1」</strong>，<strong>你要切换视角</strong>，<strong>将自己**</strong>作为需求方去思考「What - How - Why」**，去深挖。</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593615549/1060404-7cd0dfcf681814d1_chshnl.webp" alt="images"></p><blockquote><p>两种思维方式实际在过程中是不断切换使用，不断的将每一个「0.1」思考透彻，最终逐步汇聚成「1」</p><p>以上说的可能有点绕，如果看不明白的话，可以认真再看一遍 : P</p></blockquote><h2 id="为什么推荐用「黄金圈」？"><a href="#为什么推荐用「黄金圈」？" class="headerlink" title="为什么推荐用「黄金圈」？"></a>为什么推荐用「黄金圈」？</h2><blockquote><p>在我「梯子仓库」中，其实存在着多种思考模型，但是<strong>「黄金圈」却是我最常用的一种</strong>，我自己在生活中和在产品策划上的亲身实践经验也告诉我，<strong>这个思考方式普适性很广，极力推荐。</strong></p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593615616/1060404-0d1ee818b49c0354_g8g4aw.webp" alt="images"></p><blockquote><p><strong>熟练的使用「黄金圈」，能很快的从「表象层」下的「本质层」去打「本质大Boss」，获得Boss爆出的装备 —— 「</strong>部分的<strong>真相」</strong></p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593615643/1060404-5ae0e77b111e26cc_yx0pzu.webp" alt="images"></p><h2 id="重点总结"><a href="#重点总结" class="headerlink" title="重点总结"></a>重点总结</h2><h3 id="什么是「黄金圈」法则？"><a href="#什么是「黄金圈」法则？" class="headerlink" title="什么是「黄金圈」法则？"></a>什么是「黄金圈」法则？</h3><blockquote><p>由营销大师 Simon Sinek 提出的理论，事物有「What，How，Why」三个层，逐层深入</p><ul><li><strong>What</strong>，是什么</li><li><strong>How</strong>，如何实现</li><li><strong>Why</strong>，为什么是这样（而不是另外的样子呢）？</li></ul></blockquote><h3 id="如何在工作和生活中使用「黄金圈」法则？"><a href="#如何在工作和生活中使用「黄金圈」法则？" class="headerlink" title="如何在工作和生活中使用「黄金圈」法则？"></a>如何在工作和生活中使用「黄金圈」法则？</h3><h4 id="当你构思的时候，使用「what-why-how」"><a href="#当你构思的时候，使用「what-why-how」" class="headerlink" title="当你构思的时候，使用「what - why - how」"></a>当你构思的时候，使用「what - why - how」</h4><blockquote><p>拿到一个需求不要立刻动手画原型，先思考可能的本质（为什么有这个需求），想清楚每一个「0.1」，最终再汇总为「1」，形成方案。</p></blockquote><h4 id="当你需要深入细节部分的时候，使用「What-How-Why」"><a href="#当你需要深入细节部分的时候，使用「What-How-Why」" class="headerlink" title="当你需要深入细节部分的时候，使用「What - How - Why」"></a>当你需要深入细节部分的时候，使用「What - How - Why」</h4><blockquote><p>一个事物本身存在在那里，你要去探索或介绍它时，可以通过「What - How - Why」的方式，通过「0.1–&gt;0.01」逐步拆解的过程，获得更深入的挖掘。</p></blockquote><blockquote><p>这篇文章你可能看的觉得累，良药苦口，希望对你有帮助，感谢优秀的你耐心看完啦~</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;本文内容转自作者[朱利安_AI产品经理]的博客 &lt;a href=&quot;https://www.jianshu.com/p/f1185cc40c41&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;思考的梯子 | 黄金圈法则What-Ho
      
    
    </summary>
    
    
      <category term="方法论" scheme="http://yoursite.com/categories/%E6%96%B9%E6%B3%95%E8%AE%BA/"/>
    
    
      <category term="What-How-Why" scheme="http://yoursite.com/tags/What-How-Why/"/>
    
      <category term="黄金圈" scheme="http://yoursite.com/tags/%E9%BB%84%E9%87%91%E5%9C%88/"/>
    
  </entry>
  
  <entry>
    <title>IDEA调试技巧</title>
    <link href="http://yoursite.com/2020/07/01/IDEA%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7/"/>
    <id>http://yoursite.com/2020/07/01/IDEA%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7/</id>
    <published>2020-06-30T17:45:12.000Z</published>
    <updated>2021-02-14T06:01:40.410Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本文内容转自作者光年的博客 <a href="https://www.cnblogs.com/jun1019/p/9741224.html" target="_blank" rel="noopener">你可能不知道的IDEA高级调试技巧</a></p></blockquote><h2 id="条件断点"><a href="#条件断点" class="headerlink" title="条件断点"></a>条件断点</h2><blockquote><p>循环中经常用到这个技巧，比如：遍历1个大List的过程中，想让断点停在某个特定值。</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593539643/640_d1dije.png" alt="img"></p><blockquote><p>参考上图，在断点的位置，右击断点旁边的小红点，会出来一个界面，在Condition这里填入断点条件即可，这样调试时，就会自动停在i=10的位置</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593539683/640_yum8dv.png" alt="img"></p><h2 id="回到”上一步”"><a href="#回到”上一步”" class="headerlink" title="回到”上一步”"></a>回到”上一步”</h2><blockquote><p>该技巧最适合特别复杂的方法套方法的场景，好不容易跑起来，一不小心手一抖，断点过去了，想回过头看看刚才的变量值，如果不知道该技巧，只能再跑一遍。</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593539717/640_lajuxz.png" alt="img"></p><blockquote><p>参考上图，method1方法调用method2，当前断点的位置j=100，点击上图红色箭头位置的Drop Frame图标后，时间穿越了</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593539752/640_piua3m.png" alt="img"></p><blockquote><p>回到了method1刚开始调用的时候，变量i变成了99，没毛病吧，老铁们，是不是很6 :)</p></blockquote><blockquote><p>注：好奇心是人类进步的阶梯，如果想知道为啥这个功能叫Drop Frame，而不是类似Back To Previous 之类的，可以去翻翻JVM的书，JVM内部以栈帧为单位保存线程的运行状态，drop frame即扔掉当前运行的栈帧，这样当前“指针”的位置，就自然到了上一帧的位置。</p></blockquote><h2 id="多线程调试"><a href="#多线程调试" class="headerlink" title="多线程调试"></a>多线程调试</h2><blockquote><p>多线程同时运行时，谁先执行，谁后执行，完全是看CPU心情的，无法控制先后，运行时可能没什么问题，但是调试时就比较麻烦了，最明显的就是断点乱跳，一会儿停这个线程，一会儿停在另一个线程，比如下图</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593539790/640_wnwb9x.png" alt="img"></p><blockquote><p>如果想希望下一个断点位置是第2句诗句，可能要失望了：</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593539818/640_so81g4.png" alt="img"></p><blockquote><p>如果想让线程在调试时，想按自己的愿意来，让它停在哪个线程就停在哪个线程，可以在图中3个断点的小红点上右击，</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593539845/640_efqx7c.png" alt="img"></p><blockquote><p>即：Suspend挂起的条件是按每个线程来，而非All。把这3个断点都这么设置后，再来一发试试</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593539878/640_icm5kx.png" alt="img"></p><blockquote><p>注意上图中的红框位置，断点停下来时，这个下拉框可以看到各个线程（注：给线程起个容易识别的名字是个好习惯！），我们可以选择线程“天空中的飞鸟”</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593540251/27612-20170415105122517-107387528_xljbze.png" alt="img"></p><blockquote><p>断点如愿停在了第2句诗。</p></blockquote><h2 id="远程调试"><a href="#远程调试" class="headerlink" title="远程调试"></a>远程调试</h2><blockquote><p>这也是一个装B的利器，本机不用启动项目，只要有源代码，可以在本机直接远程调试服务器上的代码，打开姿势如下：</p></blockquote><h3 id="项目启动时，先允许远程调试"><a href="#项目启动时，先允许远程调试" class="headerlink" title="项目启动时，先允许远程调试"></a>项目启动时，先允许远程调试</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -server -Xms512m -Xmx512m -Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt\_socket,server=y,<span class="built_in">suspend</span>=n,address=9081 -Djava.ext.dirs=. <span class="variable">$&#123;main\_class&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>起作用的就是</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,<span class="built_in">suspend</span>=n,address=9081</span><br></pre></td></tr></table></figure><blockquote><p>注意：远程调试从技术上讲，就是在本机与远程建立scoket通讯，所以端口不要冲突，而且本机要允许访问远程端口，另外这一段参数，放要在-jar 或 ${main_class}的前面</p></blockquote><h3 id="idea中设置远程调试"><a href="#idea中设置远程调试" class="headerlink" title="idea中设置远程调试"></a>idea中设置远程调试</h3><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593540024/640_bhwihk.png" alt="img"></p><blockquote><p>然后就可以调试了</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593540052/640_xs7tio.png" alt="img"></p><h2 id="临时执行表达式-修改变量的运行值"><a href="#临时执行表达式-修改变量的运行值" class="headerlink" title="临时执行表达式/修改变量的运行值"></a>临时执行表达式/修改变量的运行值</h2><blockquote><p>调试时，可以临时执行一些表达式，参考下图：点击这二个图标中的任何1个都可以</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593540081/640_k7lqd7.png" alt="img"></p><blockquote><p>点击+号后，就可以在新出现的输入框里输入表达式，比如i+5</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593540109/640_myrbws.png" alt="img"></p><blockquote><p>然后回车，马上就能看到结果</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593540137/640_md8g3e.png" alt="img"></p><blockquote><p>当然，如果调试时，想动态修改变量的值，也很容易，在变量上右击，然后选择Set Value，剩下的事，地球人都知道。</p></blockquote><p><img src="https://res.cloudinary.com/djy7jydp5/image/upload/v1593540166/640_fnnxll.png" alt="img"></p><blockquote><p>善用上述调试技巧，相当大家撸起代码来会更有感觉，祝大家使用愉快！</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;本文内容转自作者光年的博客 &lt;a href=&quot;https://www.cnblogs.com/jun1019/p/9741224.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;你可能不知道的IDEA高级调试技巧&lt;/a&gt;&lt;
      
    
    </summary>
    
    
      <category term="环境配置" scheme="http://yoursite.com/categories/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    
    
      <category term="IntelliJ IDEA" scheme="http://yoursite.com/tags/IntelliJ-IDEA/"/>
    
      <category term="调试技巧" scheme="http://yoursite.com/tags/%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7/"/>
    
  </entry>
  
  <entry>
    <title>String源码分析</title>
    <link href="http://yoursite.com/2020/07/01/String%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/07/01/String%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</id>
    <published>2020-06-30T17:40:22.000Z</published>
    <updated>2020-07-22T13:48:25.786Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Java中所有的字符串都是String类实例的实现。</p></blockquote><blockquote><p>字符串是常量，所以一旦字符串被创建后，它们的值就不能被更改。 <strong>但字符串缓冲区支持可变字符串</strong></p></blockquote><blockquote><p>正因为String对象不可变，所以他们可以被共享。例如：String str = “abc”; 和 char data[] = {‘a’,’b’,’c’}; String str = new String(data); 这两个str相等。</p></blockquote><blockquote><p>Java对连接运算符(+)提供了特殊的支持，用于其他对象转换为string</p></blockquote><blockquote><p>字符串转换通过Object基类中的<code>toString</code>方法实现</p></blockquote><h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><h3 id="value"><a href="#value" class="headerlink" title="value"></a>value</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** The value is used for character storage. */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> value[];</span><br></pre></td></tr></table></figure><blockquote><p>从注释可以看出，这个value[]是用来实际保存字符串内容的 该变量被修饰为final, 而final修饰数组(引用数据类型)时，该数组本身可以修改，但指向该数组的地址的引用不能修改 但String初始化后可以被修改啊？如：String str = “abc”; str = “123”; 此处的其实并没有修改”abc”的引用，而是str先断开”abc”的引用，再将”123”的引用赋给str</p></blockquote><h3 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Cache the hash code for the string */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> hash; <span class="comment">// Default to 0</span></span><br></pre></td></tr></table></figure><blockquote><p>从注释可以看出，hash是字符串的哈希值 【hash的作用】 Java的对象是存储在堆中的，为了提高对象的查询效率使用散列值查找。散列值的使用方式时，定义一个键来映射对象所在的内存地址，当需要查找对象时，可以直接用这个键去查找而不用遍历整个堆中的对象，这个值就是此处的hash</p></blockquote><h3 id="serialVersionUID"><a href="#serialVersionUID" class="headerlink" title="serialVersionUID"></a>serialVersionUID</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** use serialVersionUID from JDK 1.0.2 for interoperability */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">6849794470754667710L</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Class String is special cased within the Serialization Stream Protocol.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * A String instance is written into an ObjectOutputStream according to</span></span><br><span class="line"><span class="comment"> * &lt;a href="&#123;<span class="doctag">@docRoot</span>&#125;/../platform/serialization/spec/output.html"&gt;</span></span><br><span class="line"><span class="comment"> * Object Serialization Specification, Section 6.2, "Stream Elements"&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectStreamField[] serialPersistentFields =</span><br><span class="line">    <span class="keyword">new</span> ObjectStreamField[<span class="number">0</span>];</span><br></pre></td></tr></table></figure><blockquote><p>String类实现了序列化Serializable接口，在网络传输或固态化对象是，通过序列化的方式实现。 这两个参数就是用来实现序列化和反序列化的。 在JVM的反序列化中，會比較數據流中的serialVersionUID和類中的serialVersionUID是否相等，如果相等，則認爲類沒有變化，可以把數據流加載成實例對象，如果不同則抛出InvalidClassException異常</p></blockquote><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><h3 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h3><h4 id="无参构造器"><a href="#无参构造器" class="headerlink" title="无参构造器"></a>无参构造器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.value = <span class="string">""</span>.value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>初始化创建一个新的空字符串的String对象，注意尽量不用这个构造方法，因为会创建不可变的空的字符串对象，会浪费JVM进行GC处理</p><p>此处的 <strong>“”.value</strong> 其实就是Object.value，”” 就是这个Object</p></blockquote><h4 id="字符串参数的构造器"><a href="#字符串参数的构造器" class="headerlink" title="字符串参数的构造器"></a>字符串参数的构造器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(String original)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.value = original.value;</span><br><span class="line">    <span class="keyword">this</span>.hash = original.hash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在实现中，直接将字符串内容和hash值赋值给新创建对象的value和hash</p></blockquote><h4 id="字符数组参数的构造器"><a href="#字符数组参数的构造器" class="headerlink" title="字符数组参数的构造器"></a>字符数组参数的构造器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">char</span> value[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.value = Arrays.copyOf(value, value.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">char</span> value[], <span class="keyword">int</span> offset, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (offset &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(offset);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (count &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (count &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (offset &lt;= value.length) &#123;</span><br><span class="line">            <span class="keyword">this</span>.value = <span class="string">""</span>.value;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Note: offset or count might be near -1&gt;&gt;&gt;1.</span></span><br><span class="line">    <span class="keyword">if</span> (offset &gt; value.length - count) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(offset + count);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.value = Arrays.copyOfRange(value, offset, offset+count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>用字符数组创建String类是，会用Arrays类的copyOf或copyOfRange方法，将旧数据复制到新数组返回的</p></blockquote><h4 id="通过unicode的编码值数组初始化String对象"><a href="#通过unicode的编码值数组初始化String对象" class="headerlink" title="通过unicode的编码值数组初始化String对象"></a>通过unicode的编码值数组初始化String对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">int</span>[] codePoints, <span class="keyword">int</span> offset, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (offset &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(offset);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (count &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (count &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (offset &lt;= codePoints.length) &#123;</span><br><span class="line">            <span class="keyword">this</span>.value = <span class="string">""</span>.value;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Note: offset or count might be near -1&gt;&gt;&gt;1.</span></span><br><span class="line">    <span class="keyword">if</span> (offset &gt; codePoints.length - count) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(offset + count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> end = offset + count;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Pass 1: Compute precise size of char[]</span></span><br><span class="line">    <span class="keyword">int</span> n = count;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = offset; i &lt; end; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> c = codePoints[i];</span><br><span class="line">        <span class="keyword">if</span> (Character.isBmpCodePoint(c))</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (Character.isValidCodePoint(c))</span><br><span class="line">            n++;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(Integer.toString(c));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Pass 2: Allocate and fill in char[]</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">char</span>[] v = <span class="keyword">new</span> <span class="keyword">char</span>[n];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = offset, j = <span class="number">0</span>; i &lt; end; i++, j++) &#123;</span><br><span class="line">        <span class="keyword">int</span> c = codePoints[i];</span><br><span class="line">        <span class="keyword">if</span> (Character.isBmpCodePoint(c))</span><br><span class="line">            v[j] = (<span class="keyword">char</span>)c;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            Character.toSurrogates(c, v, j++);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.value = v;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>该方法的前半部分和<em>字符数组参数</em>的实现一样，后面将int数组转换为字符串数组，然后赋值给value</p></blockquote><h4 id="字节数组参数构造器"><a href="#字节数组参数构造器" class="headerlink" title="字节数组参数构造器"></a>字节数组参数构造器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">byte</span> bytes[], <span class="keyword">int</span> offset, <span class="keyword">int</span> length, String charsetName)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (charsetName == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"charsetName"</span>);</span><br><span class="line">    checkBounds(bytes, offset, length);</span><br><span class="line">    <span class="keyword">this</span>.value = StringCoding.decode(charsetName, bytes, offset, length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">byte</span> bytes[], <span class="keyword">int</span> offset, <span class="keyword">int</span> length, Charset charset)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (charset == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"charset"</span>);</span><br><span class="line">    checkBounds(bytes, offset, length);</span><br><span class="line">    <span class="keyword">this</span>.value =  StringCoding.decode(charset, bytes, offset, length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">byte</span> bytes[], String charsetName)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(bytes, <span class="number">0</span>, bytes.length, charsetName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">byte</span> bytes[], Charset charset)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(bytes, <span class="number">0</span>, bytes.length, charset);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">byte</span> bytes[], <span class="keyword">int</span> offset, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">    checkBounds(bytes, offset, length);</span><br><span class="line">    <span class="keyword">this</span>.value = StringCoding.decode(bytes, offset, length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">byte</span> bytes[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(bytes, <span class="number">0</span>, bytes.length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Java的String中是按Unicode编码来存储内容的，在网络中Java对象以byte的形式传输，当需要将byte和String之间转换时就需要指定编码方式，具体使用StringCoding的decode的方法解码, 当不传编码方式，如下默认使用ISO-8859-1</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">char</span>[] decode(<span class="keyword">byte</span>[] ba, <span class="keyword">int</span> off, <span class="keyword">int</span> len) &#123;</span><br><span class="line">    String csn = Charset.defaultCharset().name();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// use charset name decode() variant which provides caching.</span></span><br><span class="line">        <span class="keyword">return</span> decode(csn, ba, off, len);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnsupportedEncodingException x) &#123;</span><br><span class="line">        warnUnsupportedCharset(csn);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> decode(<span class="string">"ISO-8859-1"</span>, ba, off, len);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnsupportedEncodingException x) &#123;</span><br><span class="line">        <span class="comment">// If this code is hit during VM initialization, MessageUtils is</span></span><br><span class="line">        <span class="comment">// the only way we will be able to get any kind of error message.</span></span><br><span class="line">        MessageUtils.err(<span class="string">"ISO-8859-1 charset not available: "</span></span><br><span class="line">                         + x.toString());</span><br><span class="line">        <span class="comment">// If we can not find ISO-8859-1 (a required encoding) then things</span></span><br><span class="line">        <span class="comment">// are seriously wrong with the installation.</span></span><br><span class="line">        System.exit(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="StringBuffer-StringBuilder作为参数的构造器"><a href="#StringBuffer-StringBuilder作为参数的构造器" class="headerlink" title="StringBuffer/StringBuilder作为参数的构造器"></a>StringBuffer/StringBuilder作为参数的构造器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(StringBuffer buffer)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(buffer) &#123;</span><br><span class="line">        <span class="keyword">this</span>.value = Arrays.copyOf(buffer.getValue(), buffer.length());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(StringBuilder builder)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.value = Arrays.copyOf(builder.getValue(), builder.length());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这两种构造方法和char数组的类似，都是调用Arrays的copyOf方法，将旧数据复制到新数组然后返回的方式，但StringBuffer是线程安全的。 这两个估摸着很少用到，直接用StringBuffer/StringBuilder的toString方法更方便</p></blockquote><h4 id="保护类型的构造方法"><a href="#保护类型的构造方法" class="headerlink" title="保护类型的构造方法"></a>保护类型的构造方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Package private constructor which shares value array for speed.</span></span><br><span class="line"><span class="comment">* this constructor is always expected to be called with share==true.</span></span><br><span class="line"><span class="comment">* a separate constructor is needed because we already have a public</span></span><br><span class="line"><span class="comment">* String(char[]) constructor that makes a copy of the given char[].</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">String(<span class="keyword">char</span>[] value, <span class="keyword">boolean</span> share) &#123;</span><br><span class="line">    <span class="comment">// assert share : "unshared not supported";</span></span><br><span class="line">    <span class="keyword">this</span>.value = value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>该方法是default类型的、也即Package private类型的方法。和 String(char value[]) 方法相比：</p><ol><li>多了一个boolean的形参，且”this constructor is always expected to be called with share==true.” share恒为true，且在方法体中没有用到该形参。所以share参数只是为了重载这个构造方法</li><li>方法体中的实现不同。 String(char value[])的方法是通过Arrays.copyOf申请新地址，然后将旧内容逐一拷贝到新申请的地址中。 String(char[] value, boolean share)方法是直接将旧的数组引用赋值给新值，也就是新值和旧值同时指向同一个地址。</li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">char</span> value[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.value = Arrays.copyOf(value, value.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">char</span>[] copyOf(<span class="keyword">char</span>[] original, <span class="keyword">int</span> newLength) &#123;</span><br><span class="line">    <span class="keyword">char</span>[] copy = <span class="keyword">new</span> <span class="keyword">char</span>[newLength];</span><br><span class="line">    System.arraycopy(original, <span class="number">0</span>, copy, <span class="number">0</span>,</span><br><span class="line">                     Math.min(original.length, newLength));</span><br><span class="line">    <span class="keyword">return</span> copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="字符串比较"><a href="#字符串比较" class="headerlink" title="字符串比较"></a>字符串比较</h3><h4 id="与对象比较-equals"><a href="#与对象比较-equals" class="headerlink" title="与对象比较 equals"></a>与对象比较 equals</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Compares this string to the specified object.  The result is &#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment"> * true&#125; if and only if the argument is not &#123;<span class="doctag">@code</span> null&#125; and is a &#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment"> * String&#125; object that represents the same sequence of characters as this</span></span><br><span class="line"><span class="comment"> * object.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  anObject</span></span><br><span class="line"><span class="comment"> *         The object to compare this &#123;<span class="doctag">@code</span> String&#125; against</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  &#123;<span class="doctag">@code</span> true&#125; if the given object represents a &#123;<span class="doctag">@code</span> String&#125;</span></span><br><span class="line"><span class="comment"> *          equivalent to this string, &#123;<span class="doctag">@code</span> false&#125; otherwise</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span>  #compareTo(String)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span>  #equalsIgnoreCase(String)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object anObject)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == anObject) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (anObject <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">        String anotherString = (String)anObject;</span><br><span class="line">        <span class="keyword">int</span> n = value.length;</span><br><span class="line">        <span class="keyword">if</span> (n == anotherString.value.length) &#123;</span><br><span class="line">            <span class="keyword">char</span> v1[] = value;</span><br><span class="line">            <span class="keyword">char</span> v2[] = anotherString.value;</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (n-- != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (v1[i] != v2[i])</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>String对equals进行了重写。 在该方法中，逐一对比字符串的每个字符，相同返回true，否则返回false</p></blockquote><h4 id="与StringBuffer-CharSequence比较-contentEquals"><a href="#与StringBuffer-CharSequence比较-contentEquals" class="headerlink" title="与StringBuffer/CharSequence比较 contentEquals"></a>与StringBuffer/CharSequence比较 contentEquals</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contentEquals</span><span class="params">(StringBuffer sb)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> contentEquals((CharSequence)sb);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">nonSyncContentEquals</span><span class="params">(AbstractStringBuilder sb)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> v1[] = value;</span><br><span class="line">    <span class="keyword">char</span> v2[] = sb.getValue();</span><br><span class="line">    <span class="keyword">int</span> n = v1.length;</span><br><span class="line">    <span class="keyword">if</span> (n != sb.length()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v1[i] != v2[i]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contentEquals</span><span class="params">(CharSequence cs)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Argument is a StringBuffer, StringBuilder</span></span><br><span class="line">    <span class="keyword">if</span> (cs <span class="keyword">instanceof</span> AbstractStringBuilder) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cs <span class="keyword">instanceof</span> StringBuffer) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(cs) &#123;</span><br><span class="line">               <span class="keyword">return</span> nonSyncContentEquals((AbstractStringBuilder)cs);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> nonSyncContentEquals((AbstractStringBuilder)cs);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Argument is a String</span></span><br><span class="line">    <span class="keyword">if</span> (cs <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">        <span class="keyword">return</span> equals(cs);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Argument is a generic CharSequence</span></span><br><span class="line">    <span class="keyword">char</span> v1[] = value;</span><br><span class="line">    <span class="keyword">int</span> n = v1.length;</span><br><span class="line">    <span class="keyword">if</span> (n != cs.length()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v1[i] != cs.charAt(i)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="忽略大小写比较字符串对象-equalsIgnoreCase"><a href="#忽略大小写比较字符串对象-equalsIgnoreCase" class="headerlink" title="忽略大小写比较字符串对象 equalsIgnoreCase"></a>忽略大小写比较字符串对象 equalsIgnoreCase</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equalsIgnoreCase</span><span class="params">(String anotherString)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">this</span> == anotherString) ? <span class="keyword">true</span></span><br><span class="line">            : (anotherString != <span class="keyword">null</span>)</span><br><span class="line">            &amp;&amp; (anotherString.value.length == value.length)</span><br><span class="line">            &amp;&amp; regionMatches(<span class="keyword">true</span>, <span class="number">0</span>, anotherString, <span class="number">0</span>, value.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">regionMatches</span><span class="params">(<span class="keyword">boolean</span> ignoreCase, <span class="keyword">int</span> toffset,</span></span></span><br><span class="line"><span class="function"><span class="params">        String other, <span class="keyword">int</span> ooffset, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> ta[] = value;</span><br><span class="line">    <span class="keyword">int</span> to = toffset;</span><br><span class="line">    <span class="keyword">char</span> pa[] = other.value;</span><br><span class="line">    <span class="keyword">int</span> po = ooffset;</span><br><span class="line">    <span class="comment">// Note: toffset, ooffset, or len might be near -1&gt;&gt;&gt;1.</span></span><br><span class="line">    <span class="keyword">if</span> ((ooffset &lt; <span class="number">0</span>) || (toffset &lt; <span class="number">0</span>)</span><br><span class="line">            || (toffset &gt; (<span class="keyword">long</span>)value.length - len)</span><br><span class="line">            || (ooffset &gt; (<span class="keyword">long</span>)other.value.length - len)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (len-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">char</span> c1 = ta[to++];</span><br><span class="line">        <span class="keyword">char</span> c2 = pa[po++];</span><br><span class="line">        <span class="keyword">if</span> (c1 == c2) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ignoreCase) &#123;</span><br><span class="line">            <span class="comment">// If characters don't match but case may be ignored,</span></span><br><span class="line">            <span class="comment">// try converting both characters to uppercase.</span></span><br><span class="line">            <span class="comment">// If the results match, then the comparison scan should</span></span><br><span class="line">            <span class="comment">// continue.</span></span><br><span class="line">            <span class="keyword">char</span> u1 = Character.toUpperCase(c1);</span><br><span class="line">            <span class="keyword">char</span> u2 = Character.toUpperCase(c2);</span><br><span class="line">            <span class="keyword">if</span> (u1 == u2) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Unfortunately, conversion to uppercase does not work properly</span></span><br><span class="line">            <span class="comment">// for the Georgian alphabet, which has strange rules about case</span></span><br><span class="line">            <span class="comment">// conversion.  So we need to make one last check before</span></span><br><span class="line">            <span class="comment">// exiting.</span></span><br><span class="line">            <span class="keyword">if</span> (Character.toLowerCase(u1) == Character.toLowerCase(u2)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>此处用三目运算符，如果完全相等直接返回，否则将字符逐一转成大/小写判断是否相等</p></blockquote><h4 id="比较字符串-compareTo"><a href="#比较字符串-compareTo" class="headerlink" title="比较字符串 compareTo"></a>比较字符串 compareTo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(String anotherString)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len1 = value.length;</span><br><span class="line">    <span class="keyword">int</span> len2 = anotherString.value.length;</span><br><span class="line">    <span class="keyword">int</span> lim = Math.min(len1, len2);</span><br><span class="line">    <span class="keyword">char</span> v1[] = value;</span><br><span class="line">    <span class="keyword">char</span> v2[] = anotherString.value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (k &lt; lim) &#123;</span><br><span class="line">        <span class="keyword">char</span> c1 = v1[k];</span><br><span class="line">        <span class="keyword">char</span> c2 = v2[k];</span><br><span class="line">        <span class="keyword">if</span> (c1 != c2) &#123;</span><br><span class="line">            <span class="keyword">return</span> c1 - c2;</span><br><span class="line">        &#125;</span><br><span class="line">        k++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> len1 - len2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>逐一比较两字符串的每个字符，长度为两字符串间的最小值，若不相等则返回不相等的两字符的ASCII码差值；若两个字符串长度不等则返回他们的长度差；若相等返回0</p></blockquote><h4 id="字符串局部匹配相等-regionMatches"><a href="#字符串局部匹配相等-regionMatches" class="headerlink" title="字符串局部匹配相等 regionMatches"></a>字符串局部匹配相等 regionMatches</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">regionMatches</span><span class="params">(<span class="keyword">int</span> toffset, String other, <span class="keyword">int</span> ooffset,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> ta[] = value;</span><br><span class="line">    <span class="keyword">int</span> to = toffset;</span><br><span class="line">    <span class="keyword">char</span> pa[] = other.value;</span><br><span class="line">    <span class="keyword">int</span> po = ooffset;</span><br><span class="line">    <span class="comment">// Note: toffset, ooffset, or len might be near -1&gt;&gt;&gt;1.</span></span><br><span class="line">    <span class="keyword">if</span> ((ooffset &lt; <span class="number">0</span>) || (toffset &lt; <span class="number">0</span>)</span><br><span class="line">            || (toffset &gt; (<span class="keyword">long</span>)value.length - len)</span><br><span class="line">            || (ooffset &gt; (<span class="keyword">long</span>)other.value.length - len)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (len-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ta[to++] != pa[po++]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">regionMatches</span><span class="params">(<span class="keyword">boolean</span> ignoreCase, <span class="keyword">int</span> toffset,</span></span></span><br><span class="line"><span class="function"><span class="params">        String other, <span class="keyword">int</span> ooffset, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> ta[] = value;</span><br><span class="line">    <span class="keyword">int</span> to = toffset;</span><br><span class="line">    <span class="keyword">char</span> pa[] = other.value;</span><br><span class="line">    <span class="keyword">int</span> po = ooffset;</span><br><span class="line">    <span class="comment">// Note: toffset, ooffset, or len might be near -1&gt;&gt;&gt;1.</span></span><br><span class="line">    <span class="keyword">if</span> ((ooffset &lt; <span class="number">0</span>) || (toffset &lt; <span class="number">0</span>)</span><br><span class="line">            || (toffset &gt; (<span class="keyword">long</span>)value.length - len)</span><br><span class="line">            || (ooffset &gt; (<span class="keyword">long</span>)other.value.length - len)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (len-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">char</span> c1 = ta[to++];</span><br><span class="line">        <span class="keyword">char</span> c2 = pa[po++];</span><br><span class="line">        <span class="keyword">if</span> (c1 == c2) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ignoreCase) &#123;</span><br><span class="line">            <span class="comment">// If characters don't match but case may be ignored,</span></span><br><span class="line">            <span class="comment">// try converting both characters to uppercase.</span></span><br><span class="line">            <span class="comment">// If the results match, then the comparison scan should</span></span><br><span class="line">            <span class="comment">// continue.</span></span><br><span class="line">            <span class="keyword">char</span> u1 = Character.toUpperCase(c1);</span><br><span class="line">            <span class="keyword">char</span> u2 = Character.toUpperCase(c2);</span><br><span class="line">            <span class="keyword">if</span> (u1 == u2) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Unfortunately, conversion to uppercase does not work properly</span></span><br><span class="line">            <span class="comment">// for the Georgian alphabet, which has strange rules about case</span></span><br><span class="line">            <span class="comment">// conversion.  So we need to make one last check before</span></span><br><span class="line">            <span class="comment">// exiting.</span></span><br><span class="line">            <span class="keyword">if</span> (Character.toLowerCase(u1) == Character.toLowerCase(u2)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="字符串搜索"><a href="#字符串搜索" class="headerlink" title="字符串搜索"></a>字符串搜索</h3><h4 id="正则匹配"><a href="#正则匹配" class="headerlink" title="正则匹配"></a>正则匹配</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(String regex)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Pattern.matches(regex, <span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="字符串包含"><a href="#字符串包含" class="headerlink" title="字符串包含"></a>字符串包含</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns true if and only if this string contains the specified</span></span><br><span class="line"><span class="comment"> * sequence of char values.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> s the sequence to search for</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> true if this string contains &#123;<span class="doctag">@code</span> s&#125;, false otherwise</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(CharSequence s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> indexOf(s.toString()) &gt; -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="指定字符在字符串中出现的位置"><a href="#指定字符在字符串中出现的位置" class="headerlink" title="指定字符在字符串中出现的位置"></a>指定字符在字符串中出现的位置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(<span class="keyword">int</span> ch)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> indexOf(ch, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lastIndexOf</span><span class="params">(<span class="keyword">int</span> ch)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> lastIndexOf(ch, length() - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lastIndexOf</span><span class="params">(<span class="keyword">int</span> ch, <span class="keyword">int</span> fromIndex)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isLatin1() ? StringLatin1.lastIndexOf(value, ch, fromIndex) : StringUTF16.lastIndexOf(value, ch, fromIndex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="字符串截取"><a href="#字符串截取" class="headerlink" title="字符串截取"></a>字符串截取</h3><h4 id="substring"><a href="#substring" class="headerlink" title="substring"></a>substring</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">substring</span><span class="params">(<span class="keyword">int</span> beginIndex)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (beginIndex &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(beginIndex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> subLen = value.length - beginIndex;</span><br><span class="line">    <span class="keyword">if</span> (subLen &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(subLen);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (beginIndex == <span class="number">0</span>) ? <span class="keyword">this</span> : <span class="keyword">new</span> String(value, beginIndex, subLen);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">substring</span><span class="params">(<span class="keyword">int</span> beginIndex, <span class="keyword">int</span> endIndex)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (beginIndex &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(beginIndex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (endIndex &gt; value.length) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(endIndex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> subLen = endIndex - beginIndex;</span><br><span class="line">    <span class="keyword">if</span> (subLen &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(subLen);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ((beginIndex == <span class="number">0</span>) &amp;&amp; (endIndex == value.length)) ? <span class="keyword">this</span></span><br><span class="line">            : <span class="keyword">new</span> String(value, beginIndex, subLen);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这两个重载方法中，如果截取本身则直接返回，否则调用构造方法，用Arrays.copyOfRange的方法申请内存复制返回新字符串</p></blockquote><h3 id="字符串替换"><a href="#字符串替换" class="headerlink" title="字符串替换"></a>字符串替换</h3><h4 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Replaces each substring of this string that matches the literal target</span></span><br><span class="line"><span class="comment"> * sequence with the specified literal replacement sequence. The</span></span><br><span class="line"><span class="comment"> * replacement proceeds from the beginning of the string to the end, for</span></span><br><span class="line"><span class="comment"> * example, replacing "aa" with "b" in the string "aaa" will result in</span></span><br><span class="line"><span class="comment"> * "ba" rather than "ab".</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  target The sequence of char values to be replaced</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  replacement The replacement sequence of char values</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  The resulting string</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">replace</span><span class="params">(CharSequence target, CharSequence replacement)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Pattern.compile(target.toString(), Pattern.LITERAL).matcher(</span><br><span class="line">            <span class="keyword">this</span>).replaceAll(Matcher.quoteReplacement(replacement.toString()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>替换字符串子串是通过从前往后匹配父字符串来实现的。 比如，将aaa替换成b，替换后应该时ba，而不是ab</p></blockquote><h3 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h3><h4 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concatenates the specified string to the end of this string.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * If the length of the argument string is &#123;<span class="doctag">@code</span> 0&#125;, then this</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> String&#125; object is returned. Otherwise, a</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> String&#125; object is returned that represents a character</span></span><br><span class="line"><span class="comment"> * sequence that is the concatenation of the character sequence</span></span><br><span class="line"><span class="comment"> * represented by this &#123;<span class="doctag">@code</span> String&#125; object and the character</span></span><br><span class="line"><span class="comment"> * sequence represented by the argument string.&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Examples:</span></span><br><span class="line"><span class="comment"> * &lt;blockquote&gt;&lt;pre&gt;</span></span><br><span class="line"><span class="comment"> * "cares".concat("s") returns "caress"</span></span><br><span class="line"><span class="comment"> * "to".concat("get").concat("her") returns "together"</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;&lt;/blockquote&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>   str   the &#123;<span class="doctag">@code</span> String&#125; that is concatenated to the end</span></span><br><span class="line"><span class="comment"> *                of this &#123;<span class="doctag">@code</span> String&#125;.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  a string that represents the concatenation of this object's</span></span><br><span class="line"><span class="comment"> *          characters followed by the string argument's characters.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">concat</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> otherLen = str.length();</span><br><span class="line">    <span class="keyword">if</span> (otherLen == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> len = value.length;</span><br><span class="line">    <span class="keyword">char</span> buf[] = Arrays.copyOf(value, len + otherLen);</span><br><span class="line">    str.getChars(buf, len);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(buf, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>该方法是通过重新申请一块内存，然后把新旧字符串拷贝到新内容中，并返回新String类的方式实现的</p></blockquote><h3 id="字符串转换"><a href="#字符串转换" class="headerlink" title="字符串转换"></a>字符串转换</h3><h4 id="Bytes转换"><a href="#Bytes转换" class="headerlink" title="Bytes转换"></a>Bytes转换</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] getBytes() &#123;</span><br><span class="line">    <span class="keyword">return</span> StringCoding.encode(value, <span class="number">0</span>, value.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] getBytes(String charsetName)</span><br><span class="line">        <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">    <span class="keyword">if</span> (charsetName == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">return</span> StringCoding.encode(charsetName, value, <span class="number">0</span>, value.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] getBytes(Charset charset) &#123;</span><br><span class="line">    <span class="keyword">if</span> (charset == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">return</span> StringCoding.encode(charset, value, <span class="number">0</span>, value.length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>若不指定字符集，默认编码方式为ISO-8859-1</p></blockquote><h4 id="转化为字符数组"><a href="#转化为字符数组" class="headerlink" title="转化为字符数组"></a>转化为字符数组</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">char</span>[] toCharArray() &#123;</span><br><span class="line">    <span class="comment">// Cannot use Arrays.copyOf because of class initialization order issues</span></span><br><span class="line">    <span class="keyword">char</span> result[] = <span class="keyword">new</span> <span class="keyword">char</span>[value.length];</span><br><span class="line">    System.arraycopy(value, <span class="number">0</span>, result, <span class="number">0</span>, value.length);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>通过申请新的物理地址，拷贝旧文件实现复制</p></blockquote><h4 id="大小写转换"><a href="#大小写转换" class="headerlink" title="大小写转换"></a>大小写转换</h4><h5 id="toUpperCase"><a href="#toUpperCase" class="headerlink" title="toUpperCase"></a>toUpperCase</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toUpperCase</span><span class="params">(Locale locale)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (locale == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> firstLower;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> len = value.length;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Now check if there are any characters that need to be changed. */</span></span><br><span class="line">    scan: &#123;</span><br><span class="line">        <span class="keyword">for</span> (firstLower = <span class="number">0</span> ; firstLower &lt; len; ) &#123;</span><br><span class="line">            <span class="keyword">int</span> c = (<span class="keyword">int</span>)value[firstLower];</span><br><span class="line">            <span class="keyword">int</span> srcCount;</span><br><span class="line">            <span class="keyword">if</span> ((c &gt;= Character.MIN_HIGH_SURROGATE)</span><br><span class="line">                    &amp;&amp; (c &lt;= Character.MAX_HIGH_SURROGATE)) &#123;</span><br><span class="line">                c = codePointAt(firstLower);</span><br><span class="line">                srcCount = Character.charCount(c);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                srcCount = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> upperCaseChar = Character.toUpperCaseEx(c);</span><br><span class="line">            <span class="keyword">if</span> ((upperCaseChar == Character.ERROR)</span><br><span class="line">                    || (c != upperCaseChar)) &#123;</span><br><span class="line">                <span class="keyword">break</span> scan;</span><br><span class="line">            &#125;</span><br><span class="line">            firstLower += srcCount;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* result may grow, so i+resultOffset is the write location in result */</span></span><br><span class="line">    <span class="keyword">int</span> resultOffset = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span>[] result = <span class="keyword">new</span> <span class="keyword">char</span>[len]; <span class="comment">/* may grow */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Just copy the first few upperCase characters. */</span></span><br><span class="line">    System.arraycopy(value, <span class="number">0</span>, result, <span class="number">0</span>, firstLower);</span><br><span class="line"></span><br><span class="line">    String lang = locale.getLanguage();</span><br><span class="line">    <span class="keyword">boolean</span> localeDependent =</span><br><span class="line">            (lang == <span class="string">"tr"</span> || lang == <span class="string">"az"</span> || lang == <span class="string">"lt"</span>);</span><br><span class="line">    <span class="keyword">char</span>[] upperCharArray;</span><br><span class="line">    <span class="keyword">int</span> upperChar;</span><br><span class="line">    <span class="keyword">int</span> srcChar;</span><br><span class="line">    <span class="keyword">int</span> srcCount;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = firstLower; i &lt; len; i += srcCount) &#123;</span><br><span class="line">        srcChar = (<span class="keyword">int</span>)value[i];</span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">char</span>)srcChar &gt;= Character.MIN_HIGH_SURROGATE &amp;&amp;</span><br><span class="line">            (<span class="keyword">char</span>)srcChar &lt;= Character.MAX_HIGH_SURROGATE) &#123;</span><br><span class="line">            srcChar = codePointAt(i);</span><br><span class="line">            srcCount = Character.charCount(srcChar);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            srcCount = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (localeDependent) &#123;</span><br><span class="line">            upperChar = ConditionalSpecialCasing.toUpperCaseEx(<span class="keyword">this</span>, i, locale);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            upperChar = Character.toUpperCaseEx(srcChar);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((upperChar == Character.ERROR)</span><br><span class="line">                || (upperChar &gt;= Character.MIN_SUPPLEMENTARY_CODE_POINT)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (upperChar == Character.ERROR) &#123;</span><br><span class="line">                <span class="keyword">if</span> (localeDependent) &#123;</span><br><span class="line">                    upperCharArray =</span><br><span class="line">                            ConditionalSpecialCasing.toUpperCaseCharArray(<span class="keyword">this</span>, i, locale);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    upperCharArray = Character.toUpperCaseCharArray(srcChar);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (srcCount == <span class="number">2</span>) &#123;</span><br><span class="line">                resultOffset += Character.toChars(upperChar, result, i + resultOffset) - srcCount;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                upperCharArray = Character.toChars(upperChar);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* Grow result if needed */</span></span><br><span class="line">            <span class="keyword">int</span> mapLen = upperCharArray.length;</span><br><span class="line">            <span class="keyword">if</span> (mapLen &gt; srcCount) &#123;</span><br><span class="line">                <span class="keyword">char</span>[] result2 = <span class="keyword">new</span> <span class="keyword">char</span>[result.length + mapLen - srcCount];</span><br><span class="line">                System.arraycopy(result, <span class="number">0</span>, result2, <span class="number">0</span>, i + resultOffset);</span><br><span class="line">                result = result2;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; mapLen; ++x) &#123;</span><br><span class="line">                result[i + resultOffset + x] = upperCharArray[x];</span><br><span class="line">            &#125;</span><br><span class="line">            resultOffset += (mapLen - srcCount);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result[i + resultOffset] = (<span class="keyword">char</span>)upperChar;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(result, <span class="number">0</span>, len + resultOffset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="toLowerCase"><a href="#toLowerCase" class="headerlink" title="toLowerCase"></a>toLowerCase</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toLowerCase</span><span class="params">(Locale locale)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (locale == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> firstUpper;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> len = value.length;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Now check if there are any characters that need to be changed. */</span></span><br><span class="line">    scan: &#123;</span><br><span class="line">        <span class="keyword">for</span> (firstUpper = <span class="number">0</span> ; firstUpper &lt; len; ) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = value[firstUpper];</span><br><span class="line">            <span class="keyword">if</span> ((c &gt;= Character.MIN_HIGH_SURROGATE)</span><br><span class="line">                    &amp;&amp; (c &lt;= Character.MAX_HIGH_SURROGATE)) &#123;</span><br><span class="line">                <span class="keyword">int</span> supplChar = codePointAt(firstUpper);</span><br><span class="line">                <span class="keyword">if</span> (supplChar != Character.toLowerCase(supplChar)) &#123;</span><br><span class="line">                    <span class="keyword">break</span> scan;</span><br><span class="line">                &#125;</span><br><span class="line">                firstUpper += Character.charCount(supplChar);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (c != Character.toLowerCase(c)) &#123;</span><br><span class="line">                    <span class="keyword">break</span> scan;</span><br><span class="line">                &#125;</span><br><span class="line">                firstUpper++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span>[] result = <span class="keyword">new</span> <span class="keyword">char</span>[len];</span><br><span class="line">    <span class="keyword">int</span> resultOffset = <span class="number">0</span>;  <span class="comment">/* result may grow, so i+resultOffset</span></span><br><span class="line"><span class="comment">                            * is the write location in result */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Just copy the first few lowerCase characters. */</span></span><br><span class="line">    System.arraycopy(value, <span class="number">0</span>, result, <span class="number">0</span>, firstUpper);</span><br><span class="line"></span><br><span class="line">    String lang = locale.getLanguage();</span><br><span class="line">    <span class="keyword">boolean</span> localeDependent =</span><br><span class="line">            (lang == <span class="string">"tr"</span> || lang == <span class="string">"az"</span> || lang == <span class="string">"lt"</span>);</span><br><span class="line">    <span class="keyword">char</span>[] lowerCharArray;</span><br><span class="line">    <span class="keyword">int</span> lowerChar;</span><br><span class="line">    <span class="keyword">int</span> srcChar;</span><br><span class="line">    <span class="keyword">int</span> srcCount;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = firstUpper; i &lt; len; i += srcCount) &#123;</span><br><span class="line">        srcChar = (<span class="keyword">int</span>)value[i];</span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">char</span>)srcChar &gt;= Character.MIN_HIGH_SURROGATE</span><br><span class="line">                &amp;&amp; (<span class="keyword">char</span>)srcChar &lt;= Character.MAX_HIGH_SURROGATE) &#123;</span><br><span class="line">            srcChar = codePointAt(i);</span><br><span class="line">            srcCount = Character.charCount(srcChar);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            srcCount = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (localeDependent ||</span><br><span class="line">            srcChar == <span class="string">'\u03A3'</span> || <span class="comment">// GREEK CAPITAL LETTER SIGMA</span></span><br><span class="line">            srcChar == <span class="string">'\u0130'</span>) &#123; <span class="comment">// LATIN CAPITAL LETTER I WITH DOT ABOVE</span></span><br><span class="line">            lowerChar = ConditionalSpecialCasing.toLowerCaseEx(<span class="keyword">this</span>, i, locale);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            lowerChar = Character.toLowerCase(srcChar);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((lowerChar == Character.ERROR)</span><br><span class="line">                || (lowerChar &gt;= Character.MIN_SUPPLEMENTARY_CODE_POINT)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (lowerChar == Character.ERROR) &#123;</span><br><span class="line">                lowerCharArray =</span><br><span class="line">                        ConditionalSpecialCasing.toLowerCaseCharArray(<span class="keyword">this</span>, i, locale);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (srcCount == <span class="number">2</span>) &#123;</span><br><span class="line">                resultOffset += Character.toChars(lowerChar, result, i + resultOffset) - srcCount;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                lowerCharArray = Character.toChars(lowerChar);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* Grow result if needed */</span></span><br><span class="line">            <span class="keyword">int</span> mapLen = lowerCharArray.length;</span><br><span class="line">            <span class="keyword">if</span> (mapLen &gt; srcCount) &#123;</span><br><span class="line">                <span class="keyword">char</span>[] result2 = <span class="keyword">new</span> <span class="keyword">char</span>[result.length + mapLen - srcCount];</span><br><span class="line">                System.arraycopy(result, <span class="number">0</span>, result2, <span class="number">0</span>, i + resultOffset);</span><br><span class="line">                result = result2;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; mapLen; ++x) &#123;</span><br><span class="line">                result[i + resultOffset + x] = lowerCharArray[x];</span><br><span class="line">            &#125;</span><br><span class="line">            resultOffset += (mapLen - srcCount);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result[i + resultOffset] = (<span class="keyword">char</span>)lowerChar;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(result, <span class="number">0</span>, len + resultOffset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h3><h4 id="length"><a href="#length" class="headerlink" title="length"></a>length</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">length</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value.length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="isEmpty"><a href="#isEmpty" class="headerlink" title="isEmpty"></a>isEmpty</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value.length == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="charAt"><a href="#charAt" class="headerlink" title="charAt"></a>charAt</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">char</span> <span class="title">charAt</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ((index &lt; <span class="number">0</span>) || (index &gt;= value.length)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value[index];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="字符串指定索引的字符码点"><a href="#字符串指定索引的字符码点" class="headerlink" title="字符串指定索引的字符码点"></a>字符串指定索引的字符码点</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">codePointAt</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ((index &lt; <span class="number">0</span>) || (index &gt;= value.length)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Character.codePointAtImpl(value, index, value.length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">codePointBefore</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = index - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ((i &lt; <span class="number">0</span>) || (i &gt;= value.length)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Character.codePointBeforeImpl(value, index, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">codePointCount</span><span class="params">(<span class="keyword">int</span> beginIndex, <span class="keyword">int</span> endIndex)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (beginIndex &lt; <span class="number">0</span> || endIndex &gt; value.length || beginIndex &gt; endIndex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Character.codePointCountImpl(value, beginIndex, endIndex - beginIndex);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">offsetByCodePoints</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span> codePointOffset)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; value.length) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Character.offsetByCodePointsImpl(value, <span class="number">0</span>, value.length,</span><br><span class="line">            index, codePointOffset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="trim"><a href="#trim" class="headerlink" title="trim"></a>trim</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a string whose value is this string, with any leading and trailing</span></span><br><span class="line"><span class="comment"> * whitespace removed.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * If this &#123;<span class="doctag">@code</span> String&#125; object represents an empty character</span></span><br><span class="line"><span class="comment"> * sequence, or the first and last characters of character sequence</span></span><br><span class="line"><span class="comment"> * represented by this &#123;<span class="doctag">@code</span> String&#125; object both have codes</span></span><br><span class="line"><span class="comment"> * greater than &#123;<span class="doctag">@code</span> '\u005Cu0020'&#125; (the space character), then a</span></span><br><span class="line"><span class="comment"> * reference to this &#123;<span class="doctag">@code</span> String&#125; object is returned.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Otherwise, if there is no character with a code greater than</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> '\u005Cu0020'&#125; in the string, then a</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> String&#125; object representing an empty string is</span></span><br><span class="line"><span class="comment"> * returned.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Otherwise, let &lt;i&gt;k&lt;/i&gt; be the index of the first character in the</span></span><br><span class="line"><span class="comment"> * string whose code is greater than &#123;<span class="doctag">@code</span> '\u005Cu0020'&#125;, and let</span></span><br><span class="line"><span class="comment"> * &lt;i&gt;m&lt;/i&gt; be the index of the last character in the string whose code</span></span><br><span class="line"><span class="comment"> * is greater than &#123;<span class="doctag">@code</span> '\u005Cu0020'&#125;. A &#123;<span class="doctag">@code</span> String&#125;</span></span><br><span class="line"><span class="comment"> * object is returned, representing the substring of this string that</span></span><br><span class="line"><span class="comment"> * begins with the character at index &lt;i&gt;k&lt;/i&gt; and ends with the</span></span><br><span class="line"><span class="comment"> * character at index &lt;i&gt;m&lt;/i&gt;-that is, the result of</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> this.substring(k, m + 1)&#125;.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * This method may be used to trim whitespace (as defined above) from</span></span><br><span class="line"><span class="comment"> * the beginning and end of a string.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  A string whose value is this string, with any leading and trailing white</span></span><br><span class="line"><span class="comment"> *          space removed, or this string if it has no leading or</span></span><br><span class="line"><span class="comment"> *          trailing white space.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">trim</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len = value.length;</span><br><span class="line">    <span class="keyword">int</span> st = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span>[] val = value;    <span class="comment">/* avoid getfield opcode */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ((st &lt; len) &amp;&amp; (val[st] &lt;= <span class="string">' '</span>)) &#123;</span><br><span class="line">        st++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ((st &lt; len) &amp;&amp; (val[len - <span class="number">1</span>] &lt;= <span class="string">' '</span>)) &#123;</span><br><span class="line">        len--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ((st &gt; <span class="number">0</span>) || (len &lt; value.length)) ? substring(st, len) : <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="hasCode"><a href="#hasCode" class="headerlink" title="hasCode"></a>hasCode</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a hash code for this string. The hash code for a</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> String&#125; object is computed as</span></span><br><span class="line"><span class="comment"> * &lt;blockquote&gt;&lt;pre&gt;</span></span><br><span class="line"><span class="comment"> * s[0]*31^(n-1) + s[1]*31^(n-2) + ... + s[n-1]</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;&lt;/blockquote&gt;</span></span><br><span class="line"><span class="comment"> * using &#123;<span class="doctag">@code</span> int&#125; arithmetic, where &#123;<span class="doctag">@code</span> s[i]&#125; is the</span></span><br><span class="line"><span class="comment"> * &lt;i&gt;i&lt;/i&gt;th character of the string, &#123;<span class="doctag">@code</span> n&#125; is the length of</span></span><br><span class="line"><span class="comment"> * the string, and &#123;<span class="doctag">@code</span> ^&#125; indicates exponentiation.</span></span><br><span class="line"><span class="comment"> * (The hash value of the empty string is zero.)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  a hash code value for this object.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h = hash;</span><br><span class="line">    <span class="keyword">if</span> (h == <span class="number">0</span> &amp;&amp; value.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">char</span> val[] = value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; value.length; i++) &#123;</span><br><span class="line">            h = <span class="number">31</span> * h + val[i];</span><br><span class="line">        &#125;</span><br><span class="line">        hash = h;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>该方法返回字符串的哈希值，该hash值的计算方式为： s[0]<em>31^(n-1) + s[1]</em>31^(n-2) + … + s[n-1] hash冲突？</p></blockquote><h4 id="String-Pool"><a href="#String-Pool" class="headerlink" title="String Pool"></a>String Pool</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a canonical representation for the string object.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * A pool of strings, initially empty, is maintained privately by the</span></span><br><span class="line"><span class="comment"> * class &#123;<span class="doctag">@code</span> String&#125;.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * When the intern method is invoked, if the pool already contains a</span></span><br><span class="line"><span class="comment"> * string equal to this &#123;<span class="doctag">@code</span> String&#125; object as determined by</span></span><br><span class="line"><span class="comment"> * the &#123;<span class="doctag">@link</span> #equals(Object)&#125; method, then the string from the pool is</span></span><br><span class="line"><span class="comment"> * returned. Otherwise, this &#123;<span class="doctag">@code</span> String&#125; object is added to the</span></span><br><span class="line"><span class="comment"> * pool and a reference to this &#123;<span class="doctag">@code</span> String&#125; object is returned.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * It follows that for any two strings &#123;<span class="doctag">@code</span> s&#125; and &#123;<span class="doctag">@code</span> t&#125;,</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> s.intern() == t.intern()&#125; is &#123;<span class="doctag">@code</span> true&#125;</span></span><br><span class="line"><span class="comment"> * if and only if &#123;<span class="doctag">@code</span> s.equals(t)&#125; is &#123;<span class="doctag">@code</span> true&#125;.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * All literal strings and string-valued constant expressions are</span></span><br><span class="line"><span class="comment"> * interned. String literals are defined in section 3.10.5 of the</span></span><br><span class="line"><span class="comment"> * &lt;cite&gt;The Java&amp;trade; Language Specification&lt;/cite&gt;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  a string that has the same contents as this string, but is</span></span><br><span class="line"><span class="comment"> *          guaranteed to be from a pool of unique strings.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">intern</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><blockquote><p>String类维护了一个初始为空的String Pool 在调用intern方法时，如果String池中已经包含了一个相等的字符串对象，则直接返回String池中的该实例</p></blockquote><h2 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h2><h3 id="String类为什么是final"><a href="#String类为什么是final" class="headerlink" title="String类为什么是final"></a>String类为什么是final</h3><h3 id="value为什么是private"><a href="#value为什么是private" class="headerlink" title="value为什么是private"></a>value为什么是private</h3><h3 id="value为什么是final"><a href="#value为什么是final" class="headerlink" title="value为什么是final"></a>value为什么是final</h3><blockquote><ul><li>String类设计成final主要是给String做了阉割，不让String有子类，防止子类重载破坏String类的原有设计</li><li>value设计成final，第一是为了实现String Pool，不论在哪或者怎么样使用String，都保证了value有初始值、第二是value在String类的很多方法里作为形参传递(对象本质上是传引用，而final修饰的数组，这是这个数组引用不能变，数组本身能够被改变)，防止value被更改</li><li>private是为了只能让value属性在本String类中可用，如果为package private和protected的话，就会暴露在String的包下</li></ul></blockquote><h3 id="为什么要实现String-Pool"><a href="#为什么要实现String-Pool" class="headerlink" title="为什么要实现String Pool"></a>为什么要实现String Pool</h3><blockquote><ul><li>Java中字符串是最常用的数据结构，String池可以让同一个字符串的引用只占用堆中的一块地址，节省内存空间</li><li>让Java的String可以不冲突的共享</li></ul></blockquote><h3 id="子面值赋值-String-str-“123”-是如何实现的"><a href="#子面值赋值-String-str-“123”-是如何实现的" class="headerlink" title="子面值赋值(String str = “123”;)是如何实现的"></a>子面值赋值(String str = “123”;)是如何实现的</h3><blockquote><p>子面值赋值时，JVM会直接去String Pool中找是否存在”123”，存在则返回”123”这个对象的引用地址；如果不存在就先在String Pool中创建”123”这个对象，然后再返回</p></blockquote><h3 id="子面值赋值和new-String-“123”-字符串对象有什么区别"><a href="#子面值赋值和new-String-“123”-字符串对象有什么区别" class="headerlink" title="子面值赋值和new String(“123”)字符串对象有什么区别"></a>子面值赋值和new String(“123”)字符串对象有什么区别</h3><blockquote><p>子面值赋值流程如上；</p><p>new实例化String时，JVM会先在String Pool中查找是否有”123”这个对象，如果有则不再在String Pool中创建”123”了，而是直接在堆中创建”123”字符串对象，然后将堆中的”123”对象的引用地址返回；如果没有，则现在String Pool中创建”123”字符串对象，然后再在堆中创建”123”对象，最后将堆中的这个”123”对象的引用地址返回</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Java中所有的字符串都是String类实例的实现。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;字符串是常量，所以一旦字符串被创建后，它们的值就不能被更改。 &lt;strong&gt;但字符串缓冲区支持可变字符串&lt;/strong&gt;&lt;
      
    
    </summary>
    
    
      <category term="源码分析" scheme="http://yoursite.com/categories/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="String" scheme="http://yoursite.com/tags/String/"/>
    
  </entry>
  
  <entry>
    <title>Redis规范与设计</title>
    <link href="http://yoursite.com/2020/06/27/Redis%E8%A7%84%E8%8C%83%E4%B8%8E%E8%AE%BE%E8%AE%A1/"/>
    <id>http://yoursite.com/2020/06/27/Redis%E8%A7%84%E8%8C%83%E4%B8%8E%E8%AE%BE%E8%AE%A1/</id>
    <published>2020-06-27T15:55:47.000Z</published>
    <updated>2020-07-22T13:48:25.786Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Redis数据结构及使用场景"><a href="#Redis数据结构及使用场景" class="headerlink" title="Redis数据结构及使用场景"></a>Redis数据结构及使用场景</h2><h3 id="string"><a href="#string" class="headerlink" title="string"></a>string</h3><blockquote><p>可以包含任何数据，比如jpg图像或者序列化的对象，一个键最大能储存512M</p></blockquote><h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><blockquote><p>本质是链表而不是数组，这意味着list的增删效率高，时间复杂度为O(1)；但索引定位很慢，时间复杂度为O(n) 使用场景： 消息队列、TimeLine</p></blockquote><h3 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h3><blockquote><p>在实现上和java中的hashmap一致，是数组+链表的二维结构。 hash的值只能是字符串 使用场景： 存储对象</p></blockquote><h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><blockquote><p>相当于Java中的HashSet，它内部的键值对是无序唯一的。 使用场景： </p><ol><li>集合的交集、差集：共同好友、好友推荐</li><li>唯一性： 统计访问网站的所有IP</li></ol></blockquote><h3 id="sortedSet"><a href="#sortedSet" class="headerlink" title="sortedSet"></a>sortedSet</h3><blockquote><p>类似于Java的SortedSet和HashMap的结合体，和set相比，增加了权重参数score 使用场景： 排行榜</p></blockquote><h2 id="Redis规范"><a href="#Redis规范" class="headerlink" title="Redis规范"></a>Redis规范</h2><h3 id="KEY-VALUE规范"><a href="#KEY-VALUE规范" class="headerlink" title="KEY-VALUE规范"></a>KEY-VALUE规范</h3><h4 id="KEY"><a href="#KEY" class="headerlink" title="KEY"></a>KEY</h4><h5 id="可读性和可管理性"><a href="#可读性和可管理性" class="headerlink" title="可读性和可管理性"></a>可读性和可管理性</h5><blockquote><p>以服务名及数据库表名称作为前缀，用冒号分割。如：服务名:表名:ID</p></blockquote><h5 id="简洁性"><a href="#简洁性" class="headerlink" title="简洁性"></a>简洁性</h5><blockquote><p>在保证key语义和防冲突的前提下，控制key长度，当大量key存在时，key也占很大的内存空间。</p></blockquote><h5 id="不包含特殊字符"><a href="#不包含特殊字符" class="headerlink" title="不包含特殊字符"></a>不包含特殊字符</h5><blockquote><p>key中不能包含特殊字符，如空格、\n、引号及其他</p></blockquote><h4 id="VALUE"><a href="#VALUE" class="headerlink" title="VALUE"></a>VALUE</h4><h5 id="拒绝数据量大的key-bigkey"><a href="#拒绝数据量大的key-bigkey" class="headerlink" title="拒绝数据量大的key(bigkey)"></a>拒绝数据量大的key(bigkey)</h5><blockquote><p>string类型不超过10KB，hash、list、set、zset元素个数不能超过5000个</p></blockquote><h5 id="选择合适的数据类型"><a href="#选择合适的数据类型" class="headerlink" title="选择合适的数据类型"></a>选择合适的数据类型</h5><blockquote><p>根据实际情况，合理使用数据结果，平衡内存和性能</p></blockquote><h5 id="控制key的生命周期"><a href="#控制key的生命周期" class="headerlink" title="控制key的生命周期"></a>控制key的生命周期</h5><blockquote><p>使用 expire 设置过期时间(打散过期时间，防止集中过期造成的雪崩) 不过期数据重点关注idletime</p></blockquote><h3 id="REDIS命令规范"><a href="#REDIS命令规范" class="headerlink" title="REDIS命令规范"></a>REDIS命令规范</h3><h4 id="O-N-关注N的数量"><a href="#O-N-关注N的数量" class="headerlink" title="O(N)关注N的数量"></a>O(N)关注N的数量</h4><blockquote><p>例如hgetall、lrange、smembers、zrange、sinter等并非不能使用，但需要明确N的值 有遍历需求时可以使用hscan、sscan、zscan等代替</p></blockquote><h4 id="禁用命令"><a href="#禁用命令" class="headerlink" title="禁用命令"></a>禁用命令</h4><blockquote><p>禁止线上使用keys、flushall、flushdb等，通过redis的rename机制禁掉命令，或者使用scan的方式渐进式处理</p></blockquote><h4 id="合理使用select"><a href="#合理使用select" class="headerlink" title="合理使用select"></a>合理使用select</h4><blockquote><p>redis的多数据库支持较弱，客户端支持较差。同时多业务用多数据库在底层实际还是单线程处理，并且会有干扰</p></blockquote><h4 id="使用批处理提高效率"><a href="#使用批处理提高效率" class="headerlink" title="使用批处理提高效率"></a>使用批处理提高效率</h4><blockquote><p>使用非原生命令pipeline替代mget、mset提高效率； 但要控制一次批量操作的元素个数（实际也和元素字节数有关）</p></blockquote><h4 id="不推荐过多使用redis事务"><a href="#不推荐过多使用redis事务" class="headerlink" title="不推荐过多使用redis事务"></a>不推荐过多使用redis事务</h4><blockquote><p>redis事务不支持回滚</p></blockquote><h3 id="客户端规范"><a href="#客户端规范" class="headerlink" title="客户端规范"></a>客户端规范</h3><h4 id="避免多应用使用同一个redis实例"><a href="#避免多应用使用同一个redis实例" class="headerlink" title="避免多应用使用同一个redis实例"></a>避免多应用使用同一个redis实例</h4><blockquote><p>不相干的业务拆分，公共数据做服务化</p></blockquote><h4 id="使用-redis连接池，有效控制连接的同时提高效率"><a href="#使用-redis连接池，有效控制连接的同时提高效率" class="headerlink" title="使用 redis连接池，有效控制连接的同时提高效率"></a>使用 redis连接池，有效控制连接的同时提高效率</h4><blockquote><p>使用Jedis等连接池操作redis</p></blockquote><h4 id="高并发下建议客户端添加熔断功能"><a href="#高并发下建议客户端添加熔断功能" class="headerlink" title="高并发下建议客户端添加熔断功能"></a>高并发下建议客户端添加熔断功能</h4><blockquote><p>例如：netflix hystrix</p></blockquote><h4 id="设置合理的密码，如果有必要使用SSL加密访问"><a href="#设置合理的密码，如果有必要使用SSL加密访问" class="headerlink" title="设置合理的密码，如果有必要使用SSL加密访问"></a>设置合理的密码，如果有必要使用SSL加密访问</h4><blockquote><p>设置合理的密码</p></blockquote><h4 id="根据业务类型，选择合适的内存淘汰策略，并设置好过期实际"><a href="#根据业务类型，选择合适的内存淘汰策略，并设置好过期实际" class="headerlink" title="根据业务类型，选择合适的内存淘汰策略，并设置好过期实际"></a>根据业务类型，选择合适的内存淘汰策略，并设置好过期实际</h4><blockquote><p>edis默认策略为volatile-lru，根据实际业务更改</p></blockquote><h2 id="REDIS相关工具"><a href="#REDIS相关工具" class="headerlink" title="REDIS相关工具"></a>REDIS相关工具</h2><h3 id="数据同步"><a href="#数据同步" class="headerlink" title="数据同步"></a>数据同步</h3><blockquote><p>redis-port</p></blockquote><h3 id="BIG-KEY-搜索"><a href="#BIG-KEY-搜索" class="headerlink" title="BIG KEY 搜索"></a>BIG KEY 搜索</h3><blockquote><p><a href="https://yq.aliyun.com/articles/117042?spm=a2c4e.11153940.0.0.fdaf744aWFvoW0" target="_blank" rel="noopener">https://yq.aliyun.com/articles/117042?spm=a2c4e.11153940.0.0.fdaf744aWFvoW0</a></p></blockquote><h3 id="HOT-KEY-搜索"><a href="#HOT-KEY-搜索" class="headerlink" title="HOT KEY 搜索"></a>HOT KEY 搜索</h3><blockquote><p><a href="https://yq.aliyun.com/go/articleRenderRedirect?spm=a2c4e.11153940.0.0.fdaf744aWFvoW0&url=https%3A%2F%2Fgithub.com%2Ffacebookarchive%2Fredis-faina" target="_blank" rel="noopener">redis-faina</a></p></blockquote><h2 id="Redis设计方案"><a href="#Redis设计方案" class="headerlink" title="Redis设计方案"></a>Redis设计方案</h2><h3 id="KEY-VALUE设计"><a href="#KEY-VALUE设计" class="headerlink" title="KEY-VALUE设计"></a>KEY-VALUE设计</h3><h4 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h4><blockquote><p>【KEY】: 服务名:表名:{entityId}</p><p>【VALUE】：(string) entityString</p><p>如: ucenter:user:{userId} VALUE:</p><ol><li>将实体对象转成map，然后存储到hash结构中</li><li>将实体对象存储到string结构中</li></ol></blockquote><h4 id="热搜词"><a href="#热搜词" class="headerlink" title="热搜词"></a>热搜词</h4><blockquote><p>【KEY】: 服务名:{业务类型}:keyword:hot</p><p>【VALUE】：clickNum keyword</p><p>如: media:{type}:keyword:hot VALUE: [sortedSet] 1199 “zhangsan” (点击数 keywords)</p></blockquote><h4 id="热榜"><a href="#热榜" class="headerlink" title="热榜"></a>热榜</h4><blockquote><p>【KEY】: 服务名:{业务类型}:read:hot</p><p>【VALUE】：(sortedSet) clickNum entityId</p><p>如: media:{type}:read:hot VALUE: [sortedSet] 234 98 (点击数 实体Id)</p></blockquote><h4 id="计数器"><a href="#计数器" class="headerlink" title="计数器"></a>计数器</h4><h5 id="PV"><a href="#PV" class="headerlink" title="PV"></a>PV</h5><blockquote><p>【KEY】: 服务名:pv:{entityType}:{entityId} </p><p>【VALUE】：(string) pvNum    </p><p>如: ass:pv:{entityType}:{entityId} VALUE: [string] 99</p></blockquote><h5 id="UV"><a href="#UV" class="headerlink" title="UV"></a>UV</h5><blockquote><p>【KEY】: 服务名:uv:{entityType}:{entityId}</p><p>【VALUE】：(string) uvNum     </p><p>如: ass:uv:{entityType}:{entityId} VALUE: [string] 124</p></blockquote><h4 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h4><blockquote><p>【KEY】:  服务名:表名:page:{pageNo}:{orderType}</p><p>【VALUE】: (zset) 实体ID（score: 实体ID）</p></blockquote><h4 id="浏览"><a href="#浏览" class="headerlink" title="浏览"></a>浏览</h4><blockquote><p>【KEY】: 服务名:表名:{uid}:browser</p><p>【VALUE】：(sortedSet) orderNum entityType+entityId</p><p>如: ucenter:user:{uid}:browser VALUE: [sortedSet] 1587029692 “{}” (排序 entityType和entityId组成的json)</p></blockquote><h4 id="评论"><a href="#评论" class="headerlink" title="评论"></a>评论</h4><blockquote><p>【KEY】: 服务名:{topicId}:{parentId}:comment</p><p>【VALUE】：(sortedSet) sort 实体ID (score: sort，value：实体ID)</p></blockquote><h4 id="实体赞"><a href="#实体赞" class="headerlink" title="实体赞"></a>实体赞</h4><blockquote><p>【KEY】: 服务名:行为:实体类型:实体ID</p><p>【VALUE】：(string) 行为Num</p><p>如: media:like:{entityType}:{entityId} VALUE: [string]    21</p></blockquote><h4 id="点赞"><a href="#点赞" class="headerlink" title="点赞"></a>点赞</h4><blockquote><p>【KEY】: 服务名:表名:{uid}:行为</p><p>【VALUE】：(sortedSet) 行为发生时间 entitiyType+entityId</p><p>如: ucenter:user:{uid}:like VALUE: [sortedSet]     1587029692 “{}” (排序 entityType和entityId组成的json)</p></blockquote><h4 id="收藏"><a href="#收藏" class="headerlink" title="收藏"></a>收藏</h4><blockquote><p>【KEY】: 服务名:表名:{uid}:行为</p><p>【VALUE】：(sortedSet) 行为发生时间 entityType+entityId</p><p>如: ucenter:user:{uid}:favorite VALUE: [sortedSet]    1587029692 “{}” (排序 entityType和entityId组成的json)</p></blockquote><h4 id="关注"><a href="#关注" class="headerlink" title="关注"></a>关注</h4><blockquote><p>【KEY】: 服务名:表名:{uid}:行为</p><p>【VALUE】：行为发生时间 entityType+entityId</p><p>如: ucenter:user:{uid}:follow VALUE: [sortedSet]    1587029692 “{}” (排序 entityType和entityId组成的json，此处的entity不指政策法规，指用户、主题这类)</p></blockquote><h4 id="在线用户"><a href="#在线用户" class="headerlink" title="在线用户"></a>在线用户</h4><blockquote><p>【KEY】: 服务名:行为:表名</p><p>【VALUE】：(list) uid</p><p>如: ass:active:user VALUE: [list]     uid</p></blockquote><h4 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h4><h4 id="延时队列"><a href="#延时队列" class="headerlink" title="延时队列"></a>延时队列</h4><h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="Jedis异常总结"><a href="#Jedis异常总结" class="headerlink" title="Jedis异常总结"></a><a href="https://yq.aliyun.com/articles/236384?spm=a2c4e.11153940.0.0.fdaf744aWFvoW0" target="_blank" rel="noopener">Jedis异常总结</a></h3><h3 id="JedisPool资源池优化"><a href="#JedisPool资源池优化" class="headerlink" title="JedisPool资源池优化"></a><a href="https://yq.aliyun.com/articles/236383?spm=a2c4e.11153940.0.0.fdaf744aWFvoW0" target="_blank" rel="noopener">JedisPool资源池优化</a></h3><h3 id="Redis设计与实现"><a href="#Redis设计与实现" class="headerlink" title="Redis设计与实现"></a><a href="https://redisbook.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener">Redis设计与实现</a></h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Redis数据结构及使用场景&quot;&gt;&lt;a href=&quot;#Redis数据结构及使用场景&quot; class=&quot;headerlink&quot; title=&quot;Redis数据结构及使用场景&quot;&gt;&lt;/a&gt;Redis数据结构及使用场景&lt;/h2&gt;&lt;h3 id=&quot;string&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
    
      <category term="Cache" scheme="http://yoursite.com/categories/Cache/"/>
    
    
      <category term="Redis规范" scheme="http://yoursite.com/tags/Redis%E8%A7%84%E8%8C%83/"/>
    
      <category term="Redis Key" scheme="http://yoursite.com/tags/Redis-Key/"/>
    
      <category term="Redis Value" scheme="http://yoursite.com/tags/Redis-Value/"/>
    
  </entry>
  
  <entry>
    <title>mybatis-plus-generator源码分析</title>
    <link href="http://yoursite.com/2020/06/27/Mybatis-Plus-Generator%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/06/27/Mybatis-Plus-Generator%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</id>
    <published>2020-06-27T07:03:26.000Z</published>
    <updated>2020-07-22T13:48:25.786Z</updated>
    
    <content type="html"><![CDATA[<h2 id="架构图"><a href="#架构图" class="headerlink" title="架构图"></a>架构图</h2><h3 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">left to right direction</span><br><span class="line"></span><br><span class="line">actor Application as app</span><br><span class="line">note left of app: 外部应用</span><br><span class="line"></span><br><span class="line">rectangle mybatis-plus-generator as mpg &#123;</span><br><span class="line">&#125;</span><br><span class="line">note bottom of mpg: mybatis-plus代码生成工具</span><br><span class="line"></span><br><span class="line">rectangle mybatis-plus-core as mpc &#123;</span><br><span class="line">&#125;</span><br><span class="line">note right of mpc: mybatis-plus核心代码</span><br><span class="line"></span><br><span class="line">rectangle mybatis-plus-annotation as mpa &#123;</span><br><span class="line">&#125;</span><br><span class="line">note right of mpa: mybatis-plus注释封装</span><br><span class="line"></span><br><span class="line">rectangle mybatis-plus-extension as mpe &#123;</span><br><span class="line">&#125;</span><br><span class="line">note right of mpe: mybatis-plus扩展</span><br><span class="line"></span><br><span class="line">app --&gt; mpg</span><br><span class="line">mpg &lt;-- mpc</span><br><span class="line">mpg &lt;-- mpa</span><br><span class="line">mpg &lt;-- mpe</span><br><span class="line"></span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><h3 id="Containers"><a href="#Containers" class="headerlink" title="Containers"></a>Containers</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line"></span><br><span class="line">left to right direction</span><br><span class="line"></span><br><span class="line">actor Application as app</span><br><span class="line">note left of app: 外部应用</span><br><span class="line"></span><br><span class="line">rectangle mybatis-plus-generator &#123;</span><br><span class="line">  rectangle AutoGenerator as ag &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  note top of ag: 自动生成入口</span><br><span class="line"></span><br><span class="line">  rectangle ConfigBuilder as cb &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  note bottom of cb: 构建配置类</span><br><span class="line"></span><br><span class="line">  rectangle GlobalConfig as gc &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  note right of gc: 全局配置</span><br><span class="line"></span><br><span class="line">  rectangle DataSourceConfig as dc &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  note right of dc: 数据源配置</span><br><span class="line"></span><br><span class="line">  rectangle PackageConfig as pc &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  note right of pc: 包配置</span><br><span class="line"></span><br><span class="line">  rectangle TemplateConfig as tc &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  note right of tc: 模板配置</span><br><span class="line"></span><br><span class="line">  rectangle StrategyConfig as sc &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  note right of sc: 策略配置</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app --&gt; ag</span><br><span class="line">ag -- cb</span><br><span class="line">app ..&gt; gc</span><br><span class="line">app ..&gt; dc</span><br><span class="line">app ..&gt; pc</span><br><span class="line">app ..&gt; tc</span><br><span class="line">app ..&gt; sc</span><br><span class="line">cb &lt;-- gc: init GlobalConfig</span><br><span class="line">cb &lt;-- dc: init DataSourceConfig</span><br><span class="line">cb &lt;-- pc: init PackageConfig</span><br><span class="line">cb &lt;-- tc: init TemplateConfig</span><br><span class="line">cb &lt;-- sc: init StrategyConfig</span><br><span class="line"></span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line"></span><br><span class="line">package generator &#123;</span><br><span class="line"></span><br><span class="line">  AutoGenerator *--&gt; ConfigBuilder</span><br><span class="line">  AutoGenerator *--&gt; InjectionConfig</span><br><span class="line">  AutoGenerator *--&gt; DataSourceConfig</span><br><span class="line">  AutoGenerator *--&gt; StrategyConfig</span><br><span class="line">  AutoGenerator *--&gt; PackageConfig</span><br><span class="line">  AutoGenerator *--&gt; TemplateConfig</span><br><span class="line">  AutoGenerator *--&gt; GlobalConfig</span><br><span class="line">  AutoGenerator *--&gt; AbstractTemplateEngine</span><br><span class="line">  AutoGenerator --&gt; TableInfo</span><br><span class="line"></span><br><span class="line">  InjectionConfig *--&gt; ConfigBuilder</span><br><span class="line">  InjectionConfig --&gt; FileOutConfig</span><br><span class="line">  InjectionConfig --&gt; IFileCreate</span><br><span class="line"></span><br><span class="line">  package config &#123;</span><br><span class="line">    interface ConstVal</span><br><span class="line"></span><br><span class="line">    DataSourceConfig *--&gt; IDbQuery</span><br><span class="line">    DataSourceConfig *--&gt; DbType</span><br><span class="line">    DataSourceConfig *--&gt; ITypeConvert</span><br><span class="line">    DataSourceConfig *--&gt; Connection</span><br><span class="line"></span><br><span class="line">    FileOutConfig --&gt; TableInfo</span><br><span class="line"></span><br><span class="line">    GlobalConfig *--&gt; DateType</span><br><span class="line">    GlobalConfig *--&gt; IdType</span><br><span class="line"></span><br><span class="line">    IDbQuery --&gt; DbType</span><br><span class="line">    IDbQuery --&gt; ResultSet</span><br><span class="line"></span><br><span class="line">    IFileCreate --&gt; ConfigBuilder</span><br><span class="line">    IFileCreate --&gt; FileType</span><br><span class="line"></span><br><span class="line">    INameConvert --&gt; TableInfo</span><br><span class="line">    INameConvert --&gt; TableField</span><br><span class="line"></span><br><span class="line">    ITypeConvert --&gt; GlobalConfig</span><br><span class="line">    ITypeConvert --&gt; TableField</span><br><span class="line">    ITypeConvert --&gt; IColumnType</span><br><span class="line"></span><br><span class="line">    Class PackageConfig</span><br><span class="line"></span><br><span class="line">    StrategyConfig *--&gt; INameConvert</span><br><span class="line">    StrategyConfig *--&gt; NamingStrategy</span><br><span class="line">    StrategyConfig *--&gt; TableFill</span><br><span class="line"></span><br><span class="line">    TemplateConfig --&gt; TemplateType</span><br><span class="line">    TemplateConfig --&gt; TemplateConfig</span><br><span class="line"></span><br><span class="line">    package builder &#123;</span><br><span class="line">      ConfigBuilder *--&gt; TemplateConfig</span><br><span class="line">      ConfigBuilder *--&gt;DataSourceConfig</span><br><span class="line">      ConfigBuilder *--&gt; Connection</span><br><span class="line">      ConfigBuilder *--&gt; IDbQuery</span><br><span class="line">      ConfigBuilder *--&gt; TableInfo</span><br><span class="line">      ConfigBuilder *--&gt; StrategyConfig</span><br><span class="line">      ConfigBuilder *--&gt; GlobalConfig</span><br><span class="line">      ConfigBuilder *--&gt; InjectionConfig</span><br><span class="line">      ConfigBuilder *--&gt; PackageConfig</span><br><span class="line">      ConfigBuilder *--&gt; TemplateConfig</span><br><span class="line">      ConfigBuilder *--&gt; TableInfo</span><br><span class="line">      ConfigBuilder *--&gt; NamingStrategy</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    package converts &#123;</span><br><span class="line">      DB2TypeConvert --&gt; GlobalConfig</span><br><span class="line">      ITypeConvert &lt;|-- DB2TypeConvert</span><br><span class="line"></span><br><span class="line">      DmTypeConvert --&gt; GlobalConfig</span><br><span class="line">      DmTypeConvert --&gt; IColumnType</span><br><span class="line">      ITypeConvert &lt;|-- DmTypeConvert</span><br><span class="line"></span><br><span class="line">      MySqlTypeConvert --&gt; GlobalConfig</span><br><span class="line">      MySqlTypeConvert --&gt; IColumnType</span><br><span class="line">      ITypeConvert &lt;|-- MySqlTypeConvert</span><br><span class="line"></span><br><span class="line">      OracleTypeConvert --&gt; GlobalConfig</span><br><span class="line">      OracleTypeConvert --&gt; IColumnType</span><br><span class="line">      ITypeConvert &lt;|-- OracleTypeConvert</span><br><span class="line"></span><br><span class="line">      PostgreSqlTypeConvert --&gt; GlobalConfig</span><br><span class="line">      PostgreSqlTypeConvert --&gt; IColumnType</span><br><span class="line">      ITypeConvert &lt;|-- PostgreSqlTypeConvert</span><br><span class="line"></span><br><span class="line">      SqlServerTypeConvert --&gt;GlobalConfig</span><br><span class="line">      SqlServerTypeConvert --&gt; IColumnType</span><br><span class="line">      ITypeConvert &lt;|-- SqlServerTypeConvert</span><br><span class="line"></span><br><span class="line">      SqliteTypeConvert --&gt; GlobalConfig</span><br><span class="line">      SqliteTypeConvert --&gt; IColumnType</span><br><span class="line">      ITypeConvert &lt;|-- SqliteTypeConvert</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    package po &#123;</span><br><span class="line">      TableField *--&gt; IColumnType</span><br><span class="line">      TableField *--&gt; StrategyConfig</span><br><span class="line"></span><br><span class="line">      class FieldFill</span><br><span class="line"></span><br><span class="line">      TableInfo *--&gt; TableField</span><br><span class="line">      TableInfo *--&gt; StrategyConfig</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    package querys &#123;</span><br><span class="line">      AbstractDbQuery --&gt; ResultSet</span><br><span class="line">      DB2Query --|&gt; AbstractDbQuery</span><br><span class="line">      DMQuery --|&gt; AbstractDbQuery</span><br><span class="line">      H2Query --|&gt; AbstractDbQuery</span><br><span class="line">      MariadbQuery --|&gt; AbstractDbQuery</span><br><span class="line">      MySqlQuery --|&gt; AbstractDbQuery</span><br><span class="line">      OracleQuery --|&gt; AbstractDbQuery</span><br><span class="line">      PostgreSqlQuery --|&gt; AbstractDbQuery</span><br><span class="line">      SqlServerQuery --|&gt; AbstractDbQuery</span><br><span class="line">      SqliteQuery --|&gt; AbstractDbQuery</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    package rules &#123;</span><br><span class="line">      enum DateType</span><br><span class="line">      DbColumnType --|&gt; IColumnType</span><br><span class="line">      enum FileType </span><br><span class="line">      interface IColumnType </span><br><span class="line">      enum NamingStrategy</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  package engine &#123;</span><br><span class="line">    AbstractTemplateEngine *--&gt; ConfigBuilder </span><br><span class="line"></span><br><span class="line">    BeetlTemplateEngine --|&gt; AbstractTemplateEngine</span><br><span class="line">    BeetlTemplateEngine *--&gt; ConfigBuilder</span><br><span class="line"></span><br><span class="line">    FreemarkerTemplateEngine --|&gt; AbstractTemplateEngine</span><br><span class="line">    FreemarkerTemplateEngine *--&gt; ConfigBuilder</span><br><span class="line"></span><br><span class="line">    VelocityTemplateEngine --|&gt; AbstractTemplateEngine</span><br><span class="line">    VelocityTemplateEngine *--&gt; ConfigBuilder</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class AutoGenerator &#123;</span><br><span class="line">  # config:ConfigBuilder</span><br><span class="line">  # injectionConfig:InjectionConfig</span><br><span class="line">  - dataSource:DataSourceConfig</span><br><span class="line">  - strategy:StrategyConfig</span><br><span class="line">  - packageInfo:PackageConfig</span><br><span class="line">  - template:TemplateConfig</span><br><span class="line">  - globalConfig:GlobalConfig </span><br><span class="line">  - templateEngine:AbstractTemplateEngine</span><br><span class="line">  + execute():void</span><br><span class="line">  # getAllTableInfoList(config:ConfigBuilder):List&lt;TableInfo&gt;</span><br><span class="line">  # pretreatmentConfigBuilder(config:ConfigBuilder):ConfigBuilder</span><br><span class="line">  + getCfg():InjectionConfig</span><br><span class="line">  + setCfg(injectionConfig:InjectionConfig):AutoGenerator</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface InjectionConfig &#123;</span><br><span class="line">  - config:ConfigBuilder</span><br><span class="line">  - fileOutConfigList:List&lt;FileOutConfig&gt;</span><br><span class="line">  - fileCreate:IFileCreate</span><br><span class="line">  + initMap():abstract void</span><br><span class="line">  + prepareObjectMap(objectMap:Map&lt;String,Object&gt;):Map&lt;String,Object&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface ConstVal &#123;</span><br><span class="line">  MODULE_NAME:String</span><br><span class="line">  ENTITY:String</span><br><span class="line">  SERVICE:String</span><br><span class="line">  SERVICE_IMPL:String</span><br><span class="line">  MAPPER:String</span><br><span class="line">  XML:String</span><br><span class="line">  CONTROLLER:String</span><br><span class="line">  ENTITY_PATH:String</span><br><span class="line">  SERVICE_PATH:String</span><br><span class="line">  SERVICE_IMPL_PATH:String</span><br><span class="line">  MAPPER_PATH:String</span><br><span class="line">  XML_PATH:String</span><br><span class="line">  CONTROLLER_PATH:String</span><br><span class="line">  JAVA_TMPDIR:String</span><br><span class="line">  UTF8:String</span><br><span class="line">  UNDERLINE:String</span><br><span class="line">  JAVA_SUFFIX:String</span><br><span class="line">  KT_SUFFIX:String</span><br><span class="line">  XML_SUFFIX:String</span><br><span class="line">  TEMPLATE_ENTITY_JAVA:String</span><br><span class="line">  TEMPLATE_ENTITY_KT:String</span><br><span class="line">  TEMPLATE_MAPPER:String</span><br><span class="line">  TEMPLATE_XML:String</span><br><span class="line">  TEMPLATE_SERVICE:String</span><br><span class="line">  TEMPLATE_SERVICE_IMPL:String</span><br><span class="line">  TEMPLATE_CONTROLLER:String</span><br><span class="line">  VM_LOAD_PATH_KEY:String</span><br><span class="line">  VM_LOAD_PATH_VALUE:String</span><br><span class="line">  SUPER_MAPPER_CLASS:String</span><br><span class="line">  SUPER_SERVICE_CLASS:String</span><br><span class="line">  SUPER_SERVICE_IMPL_CLASS:String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class DataSourceConfig &#123;</span><br><span class="line">  - dbQuery:IDbQuery;</span><br><span class="line">  - dbType:DbType;</span><br><span class="line">  - schemaName:String;</span><br><span class="line">  - typeConvert:ITypeConvert;</span><br><span class="line">  - url:String;</span><br><span class="line">  - driverName:String</span><br><span class="line">  - username:String</span><br><span class="line">  - password:String</span><br><span class="line">  + getDbQuery():IDbQuery</span><br><span class="line">  + getDbType():DbType</span><br><span class="line">  - getDbType(str:String):DbType</span><br><span class="line">  + getTypeConvert():ITypeConvert</span><br><span class="line">  + getConn():Connection</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">abstract class FileOutConfig &#123;</span><br><span class="line">  - templatePath:String</span><br><span class="line">  + FileOutConfig()</span><br><span class="line">  + FileOutConfig(templatePath:String)</span><br><span class="line">  + outputFile(tableInfo:TableInfo):abstract String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class GlobalConfig &#123;</span><br><span class="line">  - outputDir:String</span><br><span class="line">  - fileOverride:boolean</span><br><span class="line">  - open:boolean</span><br><span class="line">  - enableCache:boolean</span><br><span class="line">  - author:String</span><br><span class="line">  - kotlin:booealn</span><br><span class="line">  - swagger2:boolean</span><br><span class="line">  - activeRecord:boolean</span><br><span class="line">  - baseResultMap:boolean</span><br><span class="line">  - dateType:DateType</span><br><span class="line">  - baseColumnList:boolean</span><br><span class="line">  - entityName:String</span><br><span class="line">  - mapperName:String</span><br><span class="line">  - xmlName:String</span><br><span class="line">  - serviceName:String</span><br><span class="line">  - serviceImplName:String</span><br><span class="line">  - controllerName:String</span><br><span class="line">  - idType:IdType</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface IDbQuery &#123;</span><br><span class="line">  dbType():DbType</span><br><span class="line">  tablesSql():String</span><br><span class="line">  tableFieldsSql():String</span><br><span class="line">  tableName():String</span><br><span class="line">  tableComment():String</span><br><span class="line">  fieldName():String</span><br><span class="line">  fieldType():String</span><br><span class="line">  fieldComment():String</span><br><span class="line">  fieldKey():String</span><br><span class="line">  isKeyIdentity(results:ResultSet) throws SQLException:boolean</span><br><span class="line">  fieldCustom():String[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface IFileCreate &#123;</span><br><span class="line">  isCreate(configBuilder:ConfigBuilder, fileType:FileType, filePath:String):boolean</span><br><span class="line">  checkDir(filePath:String):void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface INameConvert  &#123;</span><br><span class="line">  entityNameConvert(tableInfo:TableInfo):String</span><br><span class="line">  propertyNameConvert(field:TableField):void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface ITypeConvert &#123;</span><br><span class="line">  processTypeConvert(globalConfig:GlobalConfig, tableField:TableField):IColumnType</span><br><span class="line">  processTypeConvert(globalConfig:GlobalConfig, fieldType:String):IColumnType</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PackageConfig &#123;</span><br><span class="line">  - parent:String</span><br><span class="line">  - moduleName:String</span><br><span class="line">  - entity:String</span><br><span class="line">  - service:String</span><br><span class="line">  - serviceImpl:String</span><br><span class="line">  - mapper:String</span><br><span class="line">  - xml:String</span><br><span class="line">  - controller:String</span><br><span class="line">  - pathInfo:Map&lt;String, String&gt;</span><br><span class="line">  + getParent():String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class StrategyConfig &#123;</span><br><span class="line">  - isCapitalMode:boolean</span><br><span class="line">  - skipView:boolean</span><br><span class="line">  - nameConvert:INameConvert</span><br><span class="line">  - naming:NamingStrategy</span><br><span class="line">  - columnNaming:NamingStrategy</span><br><span class="line">  - tablePrefix:String[]</span><br><span class="line">  - fieldPrefix:String[]</span><br><span class="line">  - superEntityClass:String</span><br><span class="line">  - superEntityColumns:String[]</span><br><span class="line">  - superMapperClass:String</span><br><span class="line">  - superServiceClass:String</span><br><span class="line">  - superServiceImplClass:String</span><br><span class="line">  - superControllerClass:String</span><br><span class="line">  - include:String[]</span><br><span class="line">  - exclude:String[]</span><br><span class="line">  - entitySerialVersionUID:boolean</span><br><span class="line">  - entityColumnConstant:boolean</span><br><span class="line">  - entityBuilderModel:boolean</span><br><span class="line">  - entityLombokModel:boolean</span><br><span class="line">  - entityBooleanColumnRemoveIsPrefix:boolean</span><br><span class="line">  - restControllerStyle:boolean</span><br><span class="line">  - controllerMappingHyphenStyle:boolean</span><br><span class="line">  - entityTableFieldAnnotationEnable:boolean</span><br><span class="line">  - versionFieldName:String</span><br><span class="line">  - logicDeleteFieldName:String</span><br><span class="line">  - tableFillList:List&lt;TableFill&gt;</span><br><span class="line">  + isCapitalModeNaming(word:String):boolean</span><br><span class="line">  + containsTablePrefix(tableName:String):boolean</span><br><span class="line">  + getColumnNaming():NamingStrategy</span><br><span class="line">  + setTablePrefix():StrategyConfig </span><br><span class="line">  + includeSuperEntityColumns(fieldName:String):boolean</span><br><span class="line">  + setSuperEntityColumns(superEntityColumns:String...):StrategyConfig</span><br><span class="line">  + setInclude(include:String...):StrategyConfig </span><br><span class="line">  + setExclude(exclude:String...):StrategyConfig</span><br><span class="line">  + setFieldPrefix(fieldPrefixs:String...):StrategyConfig</span><br><span class="line">  + setSuperEntityClass(superEntityClass:String):StrategyConfig </span><br><span class="line">  + setSuperEntityClass(clazz:Class&lt;?&gt;):StrategyConfig</span><br><span class="line">  + setSuperEntityClass(clazz:Class&lt;?&gt;, columnNaming:NamingStrategy):StrategyConfig</span><br><span class="line">  # convertSuperEntityColumns(clazz:Class&lt;?&gt;):void</span><br><span class="line">  + entityTableFieldAnnotationEnable(isEnableAnnotation:boolean):StrategyConfig</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">class ConfigBuilder &#123;</span><br><span class="line">  - template:final TemplateConfig</span><br><span class="line">  - dataSourceConfig:final DataSourceConfig</span><br><span class="line">  - connection:Connection</span><br><span class="line">  - dbQuery:IDbQuery</span><br><span class="line">  - superEntityClass:String</span><br><span class="line">  - superMapperClass:String</span><br><span class="line">  - superServiceClass:String</span><br><span class="line">  - superServiceImplClass:String</span><br><span class="line">  - superServiceImplClass:String</span><br><span class="line">  - tableInfoList:List&lt;TableInfo&gt;</span><br><span class="line">  - packageInfo:Map&lt;String, String&gt;</span><br><span class="line">  - pathInfo:Map&lt;String, String&gt;</span><br><span class="line">  - strategyConfig:StrategyConfig</span><br><span class="line">  - globalConfig:GlobalConfig</span><br><span class="line">  - injectionConfig:InjectionConfig</span><br><span class="line">  - commentSupported:boolean</span><br><span class="line">  + ConfigBuilder(packageConfig:PackageConfig, dataSourceConfig:DataSourceConfig, strategyConfig:StrategyConfig, template:TemplateConfig, globalConfig:GlobalConfig)</span><br><span class="line">  + getPackageInfo():Map&lt;String, String&gt;</span><br><span class="line">  + getPathInfo():Map&lt;String, String&gt;</span><br><span class="line">  + getSuperEntityClass():String</span><br><span class="line">  + getSuperMapperClass():String</span><br><span class="line">  + getSuperServiceClass():String</span><br><span class="line">  + getSuperServiceImplClass():String</span><br><span class="line">  + getSuperControllerClass():String</span><br><span class="line">  + getTableInfoList():List&lt;TableInfo&gt;</span><br><span class="line">  + setTableInfoList(tableInfoList:List&lt;TableInfo&gt;):ConfigBuilder</span><br><span class="line">  + getTemplate():TemplateConfig</span><br><span class="line">  - handlerPackage(template:TemplateConfig, outputDir:String, config:PackageConfig):void</span><br><span class="line">  - setPathInfo(pathInfo:Map&lt;String,String&gt;, template:String, template:String, path:String, module:String):void</span><br><span class="line">  - handlerDataSource(config:DataSourceConfig):void</span><br><span class="line">  - handlerStrategy(config:StrategyConfig):void</span><br><span class="line">  - processTypes(config:StrategyConfig):void</span><br><span class="line">  - processTable(tableList:List&lt;TableInfo&gt;, strategy:NamingStrategy, config:StrategyConfig):List&lt;TableInfo&gt;</span><br><span class="line">  - checkImportPackages(tableInfo:TableInfo):void</span><br><span class="line">  - getTablesInfo(config:StrategyConfig):List&lt;TableInfo&gt;</span><br><span class="line">  - tableNameMatches(setTableName:String, dbTableName:String):boolean</span><br><span class="line">  - convertTableFields(tableInfo:TableInfo, config:StrategyConfig):TableInfo</span><br><span class="line">  - joinPath(parentDir:String, packageName:String):String</span><br><span class="line">  - joinPackage(parent:String, subPackage:String):String</span><br><span class="line">  - processName(name:String, strategy:NamingStrategy):String</span><br><span class="line">  - processName(name:String, strategy:NamingStrategy, prefix:String[]):String</span><br><span class="line">  + getStrategyConfig():StrategyConfig</span><br><span class="line">  + setStrategyConfig(strategyConfig:StrategyConfig):ConfigBuilder</span><br><span class="line">  + getGlobalConfig():GlobalConfig</span><br><span class="line">  + setGlobalConfig(globalConfig:GlobalConfig):ConfigBuilder</span><br><span class="line">  + getInjectionConfig():InjectionConfig</span><br><span class="line">  + setInjectionConfig(injectionConfig:InjectionConfig):ConfigBuilder</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class DB2TypeConvert &#123;</span><br><span class="line">  + processTypeConvert(globalConfig:GlobalConfig, fieldType:String):GlobalConfig</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class DmTypeConvert &#123;</span><br><span class="line">  + processTypeConvert(globalConfig:GlobalConfig, fieldType:String):IColumnType</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MySqlTypeConvert &#123;</span><br><span class="line">  + processTypeConvert(globalConfig:GlobalConfig, fieldType:String):IColumnType</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class OracleTypeConvert &#123;</span><br><span class="line">  + processTypeConvert(globalConfig:ClobalConfig, fieldType:String):IColumnType</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PostgreSqlTypeConvert &#123;</span><br><span class="line">  + processTypeConvert(globalConfig:GlobalConfig, fieldType:String):IColumnType</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SqlServerTypeConvert &#123;</span><br><span class="line">  + processTypeConvert(globalConfig:GlobalConfig, fieldType:String):IColumnType</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SqliteTypeConvert &#123;</span><br><span class="line">  + processTypeConvert(globalConfig:GlobalConfig, fieldType:String):IColumnType</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class TableField &#123;</span><br><span class="line">  - keyIdentityFlag:boolean</span><br><span class="line">  - name:String</span><br><span class="line">  - type:String</span><br><span class="line">  - propertyName:String</span><br><span class="line">  - columnType:IColumnType</span><br><span class="line">  - comment:String</span><br><span class="line">  - fill:String</span><br><span class="line">  - customMap:Map&lt;String, Object&gt;</span><br><span class="line">  + setConvert(boolean convert):TableField</span><br><span class="line">  # setConvert(strategyConfig:StrategyConfig):TableField</span><br><span class="line">  + setProperty(strategyConfig:StrategyConfig, propertyName:String):TableField</span><br><span class="line">  + getPropertyType():String</span><br><span class="line">  + getCapitalName():String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class TableFill &#123;</span><br><span class="line">  - fieldName:String</span><br><span class="line">  - fieldFill:String</span><br><span class="line">  + TableFill(fieldName:String, ignore:FieldFill)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class TableInfo &#123;</span><br><span class="line">  - importPackages:final Set&lt;String&gt;</span><br><span class="line">  - convert:boolean</span><br><span class="line">  - name:String</span><br><span class="line">  - comment:String</span><br><span class="line">  - entityName:String</span><br><span class="line">  - mapperName:String</span><br><span class="line">  - xmlName:String</span><br><span class="line">  - serviceName:String</span><br><span class="line">  - serviceImplName:String</span><br><span class="line">  - controllerName:String</span><br><span class="line">  - fields:List&lt;TableField&gt;</span><br><span class="line">  - commonFields:List&lt;TableField&gt;</span><br><span class="line">  - fieldName:String</span><br><span class="line">  + setConvert(convert:boolean):TableInfo</span><br><span class="line">  # setConvert(strategyConfig:StrategyConfig):TableInfo</span><br><span class="line">  + getEntityPath(): String</span><br><span class="line">  + setEntityName(strategyConfig:StrategyConfig, entityName:String):TableInfo</span><br><span class="line">  + setFields(fields:List&lt;TableField&gt;):TableIInfo</span><br><span class="line">  + setImportPackages(pkg:String):TableInfo</span><br><span class="line">  + getFieldNames():String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class AbstractDbQuery &#123;</span><br><span class="line">  + isKeyIdentity(results:ResultSet)throws SQLException:boolean</span><br><span class="line">  + fieldCustom():String[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class DB2Query &#123;</span><br><span class="line">  + dbType(): DbType</span><br><span class="line">  + tableSql():String</span><br><span class="line">  + tableFieldsSql():String</span><br><span class="line">  + tableName():String</span><br><span class="line">  + tableComment():String</span><br><span class="line">  + fieldName():String</span><br><span class="line">  + fieldType():String</span><br><span class="line">  + fieldComment():String</span><br><span class="line">  + fieldKey():String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class DMQuery &#123;</span><br><span class="line">  + dbType():DbType</span><br><span class="line">  + tablesSql():Striing</span><br><span class="line">  + tableFiieldsSql():String</span><br><span class="line">  + tableName():String</span><br><span class="line">  + tableComment():String</span><br><span class="line">  + fieldName():String</span><br><span class="line">  + fieldType():String</span><br><span class="line">  + fieldComment():String</span><br><span class="line">  + fieldKey():String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class H2Query &#123;</span><br><span class="line">  + dbType():DbType</span><br><span class="line">  + tablesSql():String</span><br><span class="line">  + tableFieldsSql():String</span><br><span class="line">  + tableName():String</span><br><span class="line">  + tableComment():String</span><br><span class="line">  + fieldName():String</span><br><span class="line">  + fieldType():String</span><br><span class="line">  + fieldComment():String</span><br><span class="line">  + fieldKey():String</span><br><span class="line">  + iskeyIdentity(results:ResultSet)throws SQLException:boolean</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MariadbQuery &#123;</span><br><span class="line">  + dbType():DbType</span><br><span class="line">  + tablesSql():String</span><br><span class="line">  + tableFieldsSql():String</span><br><span class="line">  + tableName():String</span><br><span class="line">  + tableComment():String</span><br><span class="line">  + fieldName():String</span><br><span class="line">  + fieldType():String</span><br><span class="line">  + fieldComment():Striing</span><br><span class="line">  + fieldKey():String</span><br><span class="line">  + isKeyIdentity()throws SQLException:boolean</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MySqlQuery &#123;</span><br><span class="line">  + dbType():DbType</span><br><span class="line">  + tablesSql():String</span><br><span class="line">  + tableFieldsSql():String</span><br><span class="line">  + tableName():String</span><br><span class="line">  + tableComment():String</span><br><span class="line">  + fieldName():String</span><br><span class="line">  + fieldType():String</span><br><span class="line">  + fieldComment():Striing</span><br><span class="line">  + fieldKey():String</span><br><span class="line">  + isKeyIdentity()throws SQLException:boolean</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class OracleQuery &#123;</span><br><span class="line">  + dbType():DbType</span><br><span class="line">  + tablesSql():String</span><br><span class="line">  + tableFieldsSql():String</span><br><span class="line">  + tableName():String</span><br><span class="line">  + tableComment():String</span><br><span class="line">  + fieldName():String</span><br><span class="line">  + fieldType():String</span><br><span class="line">  + fieldComment():Striing</span><br><span class="line">  + fieldKey():String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PostgreSqlQuery &#123;</span><br><span class="line">  + dbType():DbType</span><br><span class="line">  + tablesSql():String</span><br><span class="line">  + tableFieldsSql():String</span><br><span class="line">  + tableName():String</span><br><span class="line">  + tableComment():String</span><br><span class="line">  + fieldName():String</span><br><span class="line">  + fieldType():String</span><br><span class="line">  + fieldComment():Striing</span><br><span class="line">  + fieldKey():String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SqlServerQuery &#123;</span><br><span class="line">  + dbType():DbType</span><br><span class="line">  + tablesSql():String</span><br><span class="line">  + tableFieldsSql():String</span><br><span class="line">  + tableName():String</span><br><span class="line">  + tableComment():String</span><br><span class="line">  + fieldName():String</span><br><span class="line">  + fieldType():String</span><br><span class="line">  + fieldComment():Striing</span><br><span class="line">  + fieldKey():String</span><br><span class="line">  + isKeyIdentity()throws SQLException:boolean</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SqliteQuery &#123;</span><br><span class="line">  + dbType():DbType</span><br><span class="line">  + tablesSql():String</span><br><span class="line">  + tableFieldsSql():String</span><br><span class="line">  + tableName():String</span><br><span class="line">  + tableComment():String</span><br><span class="line">  + fieldName():String</span><br><span class="line">  + fieldType():String</span><br><span class="line">  + fieldComment():Striing</span><br><span class="line">  + fieldKey():String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum DateType &#123;</span><br><span class="line">  ONLY_DATE</span><br><span class="line">  SQL_PACK</span><br><span class="line">  TIME_PACK</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum DbColumnType &#123;</span><br><span class="line">  BASE_BYTE</span><br><span class="line">  BASE_SHORT</span><br><span class="line">  BASE_CHAR</span><br><span class="line">  BASE_INT</span><br><span class="line">  BASE_LONG</span><br><span class="line">  BASE_FLOAT</span><br><span class="line">  BASE_DOUBLE</span><br><span class="line">  BASE_BOOLEAN</span><br><span class="line">  BYTE</span><br><span class="line">  SHORT</span><br><span class="line">  CHARACTER</span><br><span class="line">  INTEGER</span><br><span class="line">  LONG</span><br><span class="line">  FLOAT</span><br><span class="line">  DOUBLE</span><br><span class="line">  BOOLEAN</span><br><span class="line">  STRING</span><br><span class="line">  DATA_SQL</span><br><span class="line">  TIME</span><br><span class="line">  TIMESTAMP</span><br><span class="line">  BLOB</span><br><span class="line">  CLOB</span><br><span class="line">  LOCAL_DATE</span><br><span class="line">  LOCAL_TIME</span><br><span class="line">  YEAR</span><br><span class="line">  YEAR_MONTH</span><br><span class="line">  LOCAL_DATE_TIME</span><br><span class="line">  INSTANT</span><br><span class="line">  BYTE_ARRAY</span><br><span class="line">  OBJECT</span><br><span class="line">  DATE</span><br><span class="line">  BIG_INTEGER</span><br><span class="line">  BIG_DECIMAL</span><br><span class="line">  - type:final String</span><br><span class="line">  - pkg:final String</span><br><span class="line">  DbColumnType(type:finalString, pkg:final String)</span><br><span class="line">  + getType():String</span><br><span class="line">  + getPkg():String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum FileType &#123;</span><br><span class="line">  ENTITY</span><br><span class="line">  MAPPER</span><br><span class="line">  XML</span><br><span class="line">  SERVICE</span><br><span class="line">  SERVICE_IMPL</span><br><span class="line">  CONTROLLER</span><br><span class="line">  OTHER</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface IColumnType &#123;</span><br><span class="line">  getType():Striing</span><br><span class="line">  getPkg():Striing</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum NamingStrategy &#123;</span><br><span class="line">  + underlineToCamel(name:String):static String</span><br><span class="line">  + removePrefix(name:String, prefix:String...):static String</span><br><span class="line">  + isPrefixContained(name:String, prefix:String...):static boolean</span><br><span class="line">  + removePrefixAndCamel(name:String, tablePrefix:String[]):static String</span><br><span class="line">  + capitalFirst(name:String):static String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class TemplateConfig &#123;</span><br><span class="line">  - entity:String</span><br><span class="line">  - entityKt:String</span><br><span class="line">  - service:String</span><br><span class="line">  - serviceImpl:String</span><br><span class="line">  - mapper:String</span><br><span class="line">  - xml:String</span><br><span class="line">  - controller:String</span><br><span class="line">  + getEntity(kotlin:boolean):String</span><br><span class="line">  + disable(templateTypes:TemplateType...):TemplateConfig</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><h2 id="ConfigBuilder类"><a href="#ConfigBuilder类" class="headerlink" title="ConfigBuilder类"></a>ConfigBuilder类</h2><h3 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h3><h4 id="TableField类"><a href="#TableField类" class="headerlink" title="TableField类"></a>TableField类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">class TableField &#123;</span><br><span class="line">  - keyIdentityFlag:boolean</span><br><span class="line">  - name:String</span><br><span class="line">  - type:String</span><br><span class="line">  - propertyName:String</span><br><span class="line">  - columnType:IColumnType</span><br><span class="line">  - comment:String</span><br><span class="line">  - fill:String</span><br><span class="line">  - customMap:Map&lt;String, Object&gt;</span><br><span class="line">  + setConvert(boolean convert):TableField</span><br><span class="line">  # setConvert(strategyConfig:StrategyConfig):TableField</span><br><span class="line">  + setProperty(strategyConfig:StrategyConfig, propertyName:String):TableField</span><br><span class="line">  + getPropertyType():String</span><br><span class="line">  + getCapitalName():String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface IColumnType &#123;</span><br><span class="line">  getType():Striing</span><br><span class="line">  getPkg():Striing</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TableField ..&gt; IColumnType</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><blockquote><p>该类封装了DB表字段的信息：</p><ul><li>keyIdentityFlag:boolean： 主键是否为自增类型</li><li>name：字段名</li><li>columnType：字段类型</li><li>customMap：自定义查询字段列表</li></ul></blockquote><h4 id="TableInfo类"><a href="#TableInfo类" class="headerlink" title="TableInfo类"></a>TableInfo类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">class TableInfo &#123;</span><br><span class="line">  - importPackages:final Set&lt;String&gt;</span><br><span class="line">  - convert:boolean</span><br><span class="line">  - name:String</span><br><span class="line">  - comment:String</span><br><span class="line">  - entityName:String</span><br><span class="line">  - mapperName:String</span><br><span class="line">  - xmlName:String</span><br><span class="line">  - serviceName:String</span><br><span class="line">  - serviceImplName:String</span><br><span class="line">  - controllerName:String</span><br><span class="line">  - fields:List&lt;TableField&gt;</span><br><span class="line">  - commonFields:List&lt;TableField&gt;</span><br><span class="line">  - fieldName:String</span><br><span class="line">  + setConvert(convert:boolean):TableInfo</span><br><span class="line">  # setConvert(strategyConfig:StrategyConfig):TableInfo</span><br><span class="line">  + getEntityPath(): String</span><br><span class="line">  + setEntityName(strategyConfig:StrategyConfig, entityName:String):TableInfo</span><br><span class="line">  + setFields(fields:List&lt;TableField&gt;):TableIInfo</span><br><span class="line">  + setImportPackages(pkg:String):TableInfo</span><br><span class="line">  + getFieldNames():String</span><br><span class="line">&#125;</span><br><span class="line">class TableField &#123;</span><br><span class="line">&#125;</span><br><span class="line">TableInfo ..&gt; TableField</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><blockquote><p>该类是表信息对应的JaveBean，用来封装DB表对应生成的Controller/Service等的名称，和TableField对应</p><ul><li>importPackages：使用时候应该导入表</li><li>entityName：生成的实体的名称</li><li>mapperName：生成的Mapper类的名称</li><li>xmlName：生成的XML的名称</li><li>serviceName/serviceImplName：生成的service相关的名称</li><li>controllerName：生成的控制器的名称</li></ul></blockquote><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">class ConfigBuilder &#123;</span><br><span class="line">  - template: TemplateConfig</span><br><span class="line">  - dataSourceConfig: DataSourceConfig</span><br><span class="line">  - connection: Connection</span><br><span class="line">  - dbQuery: IDbQuery</span><br><span class="line">  - superEntityClass: String</span><br><span class="line">  - superMapperClass: String</span><br><span class="line">  - superServiceClass: String</span><br><span class="line">  - superServiceImplClass: String</span><br><span class="line">  - superControllerClass: String</span><br><span class="line">  - superParamClass: String</span><br><span class="line">  - superPatterClass: String</span><br><span class="line">  - tableInfoList: List&lt;TableInfo&gt;</span><br><span class="line">  - packageInfo: Map</span><br><span class="line">  - pathInfo: Map</span><br><span class="line">  - strategyConfig: StrategyConfig</span><br><span class="line">  - globalConfig: GlobalConfig</span><br><span class="line">  - commentSupported: boolean</span><br><span class="line">  + ConfigBuilder(packageConfig, dataSourceConfig, strategyConfig, template, globalConfig)</span><br><span class="line">  - handlerPackage(templateConfig, outputDir, packageConfig)</span><br><span class="line">  - handlerDataSource(dataSourceConfig)</span><br><span class="line">  - handlerStrategy(strategyConfig)</span><br><span class="line">  - processTypes(strategyConfig)</span><br><span class="line">  - getTablesInfo(strategyConfig): List&lt;TableInfo&gt;</span><br><span class="line">  - processTable(tableList, namingStrategy, strategyConfig): List&lt;TableInfo&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ConfigBuilder ..&gt; TemplateConfig</span><br><span class="line">ConfigBuilder ..&gt; DataSourceConfig</span><br><span class="line">ConfigBuilder ..&gt; TableInfo</span><br><span class="line">ConfigBuilder ..&gt; StrategyConfig</span><br><span class="line">ConfigBuilder ..&gt; GlobalConfig</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><blockquote><p>方法说明：</p><ul><li>handlerPackage：该方法通过TemplateConfig类，设置entity/xml/service/controller等包的名称，再根据这些包名，设置各自的路径信息</li><li>handlerDataSource：该方法根据DB驱动设置DB的数据源，并且根据DB的种类，设置DB的查询语句(dbQuery)</li><li>handlerStrategy：该方法调用 processTypes 和 getTablesInfo方法，分类设置entity/mapper/service/controller等的超类，并且根据dbQuery填充TableInfo类</li><li>processTypes： 设置超类</li><li>getTablesInfo：通过dbQuery和jdbc组装SQL查询表信息，然后通过 processTable 将结果集和TableInfo对应</li><li>processTable： 把从DB中查询出的表/字段信息对应到TableInfo中</li></ul><p>在用ConfigBuilder的具有四个形参的构造方法实例化该类时，会在内部依次调用上面的6个方法。该构造方法在AutoGenerator的execute方法里调用。具体实时调用情况如下面时序图</p></blockquote><h2 id="AutoGenerator类"><a href="#AutoGenerator类" class="headerlink" title="AutoGenerator类"></a>AutoGenerator类</h2><h3 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a>实现</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">class AutoGenerator &#123;</span><br><span class="line">  # config:ConfigBuilder</span><br><span class="line">  # injectionConfig:InjectionConfig</span><br><span class="line">  - dataSource:DataSourceConfig</span><br><span class="line">  - strategy:StrategyConfig</span><br><span class="line">  - packageInfo:PackageConfig</span><br><span class="line">  - template:TemplateConfig</span><br><span class="line">  - globalConfig:GlobalConfig </span><br><span class="line">  - templateEngine:AbstractTemplateEngine</span><br><span class="line">  + execute():void</span><br><span class="line">  # getAllTableInfoList(config:ConfigBuilder):List&lt;TableInfo&gt;</span><br><span class="line">  # pretreatmentConfigBuilder(config:ConfigBuilder):ConfigBuilder</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">abstract class AbstractTemplateEngine &#123;</span><br><span class="line">  - configBuilder: ConfigBuilder</span><br><span class="line">  + init(configBuilder): AbstractTemplateEngine</span><br><span class="line">  + batchOutput(): AbstractTemplateEngine</span><br><span class="line">  + writer()</span><br><span class="line">  + mkdirs()</span><br><span class="line">  + open()</span><br><span class="line">  + getObjectMap(tableInfo)</span><br><span class="line">  + isCreate(fileType, filePath)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class FreemarkerTemplateEngine &#123;</span><br><span class="line">  - configuration: Configuration</span><br><span class="line">  + init(configBuilder): FreemarkerTemplateEngine</span><br><span class="line">  + writer()</span><br><span class="line">&#125;</span><br><span class="line">AutoGenerator --&gt; AbstractTemplateEngine</span><br><span class="line">AbstractTemplateEngine &lt;|-- FreemarkerTemplateEngine</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><blockquote><p>AbstractTemplateEngine方法说明：</p><ul><li>init：初始化模板引擎</li><li>mkdirs：创建目录</li><li>batchOutput：判断是否生成entity/mapper/service/controller目录，如已经生成则调用 FreemarkerTemplateEngine 类的 write 方法使用模板引擎生成代码文件</li><li>open：打开文件输出目录</li></ul><p>AutoGenerator类的execute方法为该类的入口函数，外部的Application调用该方法。</p><p>execute：该方法中，初始化ConfigBuilder配置类，并调用模板引擎类生成代码</p></blockquote><h3 id="时序图"><a href="#时序图" class="headerlink" title="时序图"></a>时序图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">actor Application</span><br><span class="line"></span><br><span class="line">Application -&gt; AutoGenerator ++: execute</span><br><span class="line"></span><br><span class="line">AutoGenerator -&gt; ConfigBuilder ++: ConfigBuilder</span><br><span class="line"></span><br><span class="line">ConfigBuilder -&gt; AbstractTemplateEngine ++: init</span><br><span class="line"></span><br><span class="line">AbstractTemplateEngine -&gt; AbstractTemplateEngine ++: mkdir</span><br><span class="line"></span><br><span class="line">AbstractTemplateEngine -&gt; AbstractTemplateEngine ++: batch</span><br><span class="line"></span><br><span class="line">AbstractTemplateEngine -&gt; FreemarkerTemplateEngine ++: writer</span><br><span class="line"></span><br><span class="line">FreemarkerTemplateEngine -&gt; Template ++: process</span><br><span class="line"></span><br><span class="line">return processDone</span><br><span class="line"></span><br><span class="line">return write success</span><br><span class="line"></span><br><span class="line">return batch done</span><br><span class="line"></span><br><span class="line">return mkdir success</span><br><span class="line"></span><br><span class="line">return init done</span><br><span class="line"></span><br><span class="line">return done</span><br><span class="line"></span><br><span class="line">return success</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;架构图&quot;&gt;&lt;a href=&quot;#架构图&quot; class=&quot;headerlink&quot; title=&quot;架构图&quot;&gt;&lt;/a&gt;架构图&lt;/h2&gt;&lt;h3 id=&quot;Context&quot;&gt;&lt;a href=&quot;#Context&quot; class=&quot;headerlink&quot; title=&quot;Context
      
    
    </summary>
    
    
      <category term="源码分析" scheme="http://yoursite.com/categories/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
      <category term="mybatis-plus-generator" scheme="http://yoursite.com/tags/mybatis-plus-generator/"/>
    
      <category term="mybatis-plus" scheme="http://yoursite.com/tags/mybatis-plus/"/>
    
  </entry>
  
</feed>
