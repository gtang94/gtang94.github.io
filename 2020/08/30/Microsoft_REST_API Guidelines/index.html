<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="rest api," />










<meta name="description" content="本文翻译自 微软Rest Api指南  摘要 The Microsoft REST API指南作为一种设计原则，估计程序开发人员通过RESTful HTTP接口访问资源。为了在遵循Microsoft REST API的平台上为开发人员提供尽可能流程的体验，REST API应当遵循一致的设计原则，以使其变得简单和直观。 本文档建立了Microsoft REST API应该遵循的指导原则，以便统一一">
<meta property="og:type" content="article">
<meta property="og:title" content="Microsoft REST API 指南">
<meta property="og:url" content="http://yoursite.com/2020/08/30/Microsoft_REST_API%20Guidelines/index.html">
<meta property="og:site_name" content="gtang94&#39;s note">
<meta property="og:description" content="本文翻译自 微软Rest Api指南  摘要 The Microsoft REST API指南作为一种设计原则，估计程序开发人员通过RESTful HTTP接口访问资源。为了在遵循Microsoft REST API的平台上为开发人员提供尽可能流程的体验，REST API应当遵循一致的设计原则，以使其变得简单和直观。 本文档建立了Microsoft REST API应该遵循的指导原则，以便统一一">
<meta property="og:image" content="https://camo.githubusercontent.com/b2f75e771f13a40f441f4ab918f84259c03d8ede/68747470733a2f2f7777772e77656273657175656e63656469616772616d732e636f6d2f6367692d62696e2f63647261773f6c7a3d626d39305a534276646d56794945526c646d56736233426c63697767515856306232316864476c76626977675158427749464e6c636e5a6c636a6f67436941674943416751573441454155414a776b6762476c725a53424e62335a705a55316861325679414341475632467564484d6764473867615735305a5764795958526c494864706447676763484a70625746796553427a5a584a3261574e6c4144634752484a7663474a766541706c626d5167626d39305a516f416751774c5169425162334a3059577773494552434149454a42564a6c5a326c7a6448494167526b4852454967546d393061575a70597743424c41567a414345476458526f4143734655774267426a6f675647686c414630654149465f436b4e736157567564414174426d56755a4342316332567963796367596e4a7664334e6c6369427663694270626e4e30595778735a5751675958427743674342495177416769516741494641425143424953384167516f4749446f6754574675645746734149467a45516f4b4367434441676f384c53302d4149497143694136494578765a326c7549476c7564473841676a384a41494931454342565743414b41436f4b4c5434674b77434357424d364149514742553568625755675a58526a4c6743444651344147784a446232356d61584a74414945424345466a5932567a637942556232746c62676f4b41494d33457941745069417441494e6b4351426e426b6c454149454d43774342565155416851494d41495233436d4e7663476c6c63774172434143434948414168484d4d41494d4b44774344414267364948646c596d6876623273676367434365673441676e55534149565144546f41685859485a584941677767474149635442674245435656535443776755324e7663475541687a49475355514b54674347505177416868774e4941434442683441486845416778455062674342616777416778774e41494d61446941416778304d6257463549474e7663486b414c5245416856747141495a484230463164476876636d6c36414959374277434758516374506941724149457544564a6c6358566c63335167595143464f515a306279424551694277636d39305a574e305a5751676157356d62334941696951474367434442517374506941744149637443564a6c5a476c795a574e30414459484147774e494756755a4842766157353041496f57426d45414477317941485947414945514441434a564163415377746c5a41415948674349434167414d4163416341344168476f474145304641494564466d4a6859327367644738416846384e6158526f49474e765a47554167686f61615143426167634167546f484144304a4149492d42334d4150677341676c4548414573464149497a4467434258773041676e3847644739725a57357a414363534149305f42584a705a3268304947396d4149747044554e685932686c4948526f5958516764476870637942566332567949456c454948427962335a705a47566b41494e4e437743495a676f416767634a41494e3744334e776232357a4149305f427743454367597349484a6c5a6e4a6c63326773494746755a43424a524143424841634167514d5041495941445143424441634167555547596e6b416a466b4649456c454149516b47335231636d34416846344d4948527649474d416a523846414977526167434a5677314762473933414959714351434d61516741676d6f4b614746755a3255416a3359464149465842575268644745674c534230655842705932467349485a70595143514467567959574e306157356e414a41504267434a51517432615745416a6e7348436743504e676f67414968444541434b5a7730416b464d4641496b424477434444415541676b59574b77424e437743485741706a4149457942514348526730416857554859574e6f414951654441434566775668626d5167496e4e70626d4e6c49674346455159416b53514f414952334367434e66776341684851464149705145414342556773416846416341494938425746755a4342755a58634159525141684655544f6942566347526864475567633352686448554167536b47414946444251417845776f4b436726733d6d736367656e">
<meta property="og:image" content="https://camo.githubusercontent.com/b9f6961da5bc139a7169515a83f56ab4a8f9ede5/68747470733a2f2f7777772e77656273657175656e63656469616772616d732e636f6d2f6367692d62696e2f63647261773f6c7a3d626d39305a534276646d56794945526c646d56736233426c63697767515856306232316864476c76626977675158427749464e6c636e5a6c636a6f67436941674943416751573441454155414a776b6762476c725a53424e62335a705a55316861325679414341475632467564484d6764473867615735305a5764795958526c494864706447676763484a70625746796553427a5a584a3261574e6c4144634752484a7663474a766541706c626d5167626d39305a516f416751774c5169425162334a3059577773494552434149454a42564a6c5a326c7a6448494167526b4852454967546d393061575a70597743424c41567a414345476458526f4143734655774267426a6f675647686c414630654149465f436b4e736157567564414174426d56755a4342316332567963796367596e4a7664334e6c6369427663694270626e4e30595778735a5751675958427743674342495177416769516741494641425143424953384167516f4749446f416757775243677068624851416779554941494548426942794142514d494341416778734c50433074506743445477733649454e76626d5a705a3356795a516f6749414344614173674c5434674b77434357424d4165675a4f5957316c49475630597934416841674641494d61445141664567426442584a744149515f4255466a5932567a637942556232746c41494554426743444f7849674c5434674c5143424667784263484167535551416848774959334a6c644143424778417450674346466773674f69424662574a6c5a41416b46475673633255675457467564574673414949454a41434562516b674f69424d6232647062694270626e527641495542435143424b52465657414347474155414c516f416768386d4149495a4b77434243416341676a6f4e41494973484143474c776b41676a38494149455344674345434159416831454c41496446436d4e7663476c6c63774175434756755a41434565476f4168575148515856306147397961586f4168563848414956364279302d494373416732414e556d56786457567a6443426841495256426e527649455243494842796233526c5933526c5a434270626d5a766367434a5151594b414951614379302d49433041686b6f4a556d566b61584a6c593351414e676341624130675a57356b63473970626e514169544d475951415044584941646759416752414d414968784277424c4332566b414267654149526a43414177423045416351785657416f415351674167527757596d466a617942306277434664417741696c77465932396b5a5143434752707041494670427743424f51634150516b41676a30486377412d437743435541634153775541676a494f414946654451434366675a306232746c626e4d414a7849416a467346636d6c6e61485167623259416977554e5132466a61475567644768686443423061476c7a4946567a5a5849675355516763484a76646d6c6b5a5751416730774c41495536427743434241774167336f5063334276626e4d416a4673484149514a42697767636d566d636d567a614377675957356b49456c454149456342774342417738416944454e4149454d4277434252515a696551434c645155675355514168434d62644856796267434558517767644738675977434d4f77554b4367434c4c326f416a58554d41497754447743504e516f74506973416a6877514f67434f5251646c6367434d56775941673359495a574a6f62323972494656535443776755324e76634755416b414547535551416a776f4f41493572445341416932554b41494e464251434c5977304148424541677a554f4f6942754149453244414267434143444342316f5a5143426151354a52414344597755416168494167684234526d78766477434a4d776b416a45304941495630436d6868626d646c414a4963425143455951566b595852684943306764486c7761574e6862434232615745416b6a5146636d466a64476c755a7743534e5159416a56384c646d6c68414a456842776f416b56774b4941434e666841416841734e414a4a35425143435751384168685946414956514669734154517341696d454b597743424d675541696b384e414968764232466a614143484b41774169416b465957356b49434a7a6157356a5a53494169427347414a4e4b4467434941516f4168423063414946534377434857687741676a77465957356b4947356c647742684641434858784d36494656775a4746305a53427a64474630645143424b51594167554d464144455443676f4b26733d6d736367656e">
<meta property="article:published_time" content="2020-08-30T15:55:27.000Z">
<meta property="article:modified_time" content="2021-03-05T13:26:39.297Z">
<meta property="article:author" content="gtang94">
<meta property="article:tag" content="rest api">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://camo.githubusercontent.com/b2f75e771f13a40f441f4ab918f84259c03d8ede/68747470733a2f2f7777772e77656273657175656e63656469616772616d732e636f6d2f6367692d62696e2f63647261773f6c7a3d626d39305a534276646d56794945526c646d56736233426c63697767515856306232316864476c76626977675158427749464e6c636e5a6c636a6f67436941674943416751573441454155414a776b6762476c725a53424e62335a705a55316861325679414341475632467564484d6764473867615735305a5764795958526c494864706447676763484a70625746796553427a5a584a3261574e6c4144634752484a7663474a766541706c626d5167626d39305a516f416751774c5169425162334a3059577773494552434149454a42564a6c5a326c7a6448494167526b4852454967546d393061575a70597743424c41567a414345476458526f4143734655774267426a6f675647686c414630654149465f436b4e736157567564414174426d56755a4342316332567963796367596e4a7664334e6c6369427663694270626e4e30595778735a5751675958427743674342495177416769516741494641425143424953384167516f4749446f6754574675645746734149467a45516f4b4367434441676f384c53302d4149497143694136494578765a326c7549476c7564473841676a384a41494931454342565743414b41436f4b4c5434674b77434357424d364149514742553568625755675a58526a4c6743444651344147784a446232356d61584a74414945424345466a5932567a637942556232746c62676f4b41494d33457941745069417441494e6b4351426e426b6c454149454d43774342565155416851494d41495233436d4e7663476c6c63774172434143434948414168484d4d41494d4b44774344414267364948646c596d6876623273676367434365673441676e55534149565144546f41685859485a584941677767474149635442674245435656535443776755324e7663475541687a49475355514b54674347505177416868774e4941434442683441486845416778455062674342616777416778774e41494d61446941416778304d6257463549474e7663486b414c5245416856747141495a484230463164476876636d6c36414959374277434758516374506941724149457544564a6c6358566c63335167595143464f515a306279424551694277636d39305a574e305a5751676157356d62334941696951474367434442517374506941744149637443564a6c5a476c795a574e30414459484147774e494756755a4842766157353041496f57426d45414477317941485947414945514441434a564163415377746c5a41415948674349434167414d4163416341344168476f474145304641494564466d4a6859327367644738416846384e6158526f49474e765a47554167686f61615143426167634167546f484144304a4149492d42334d4150677341676c4548414573464149497a4467434258773041676e3847644739725a57357a414363534149305f42584a705a3268304947396d4149747044554e685932686c4948526f5958516764476870637942566332567949456c454948427962335a705a47566b41494e4e437743495a676f416767634a41494e3744334e776232357a4149305f427743454367597349484a6c5a6e4a6c63326773494746755a43424a524143424841634167514d5041495941445143424441634167555547596e6b416a466b4649456c454149516b47335231636d34416846344d4948527649474d416a523846414977526167434a5677314762473933414959714351434d61516741676d6f4b614746755a3255416a3359464149465842575268644745674c534230655842705932467349485a70595143514467567959574e306157356e414a41504267434a51517432615745416a6e7348436743504e676f67414968444541434b5a7730416b464d4641496b424477434444415541676b59574b77424e437743485741706a4149457942514348526730416857554859574e6f414951654441434566775668626d5167496e4e70626d4e6c49674346455159416b53514f414952334367434e66776341684851464149705145414342556773416846416341494938425746755a4342755a58634159525141684655544f6942566347526864475567633352686448554167536b47414946444251417845776f4b436726733d6d736367656e">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/08/30/Microsoft_REST_API Guidelines/"/>





  <title>Microsoft REST API 指南 | gtang94's note</title>
  









	<link href='http://fonts.font.im/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
	<link href='//fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>

<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="gtang94's note" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">gtang94's note</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">gtang94的技术笔记</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/30/Microsoft_REST_API%20Guidelines/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="gtang94">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gtang94's note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Microsoft REST API 指南</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-30T23:55:27+08:00">
                2020-08-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index">
                    <span itemprop="name">架构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>本文翻译自 <a href="https://github.com/microsoft/api-guidelines/blob/vNext/Guidelines.md" target="_blank" rel="noopener">微软Rest Api指南</a></p>
</blockquote>
<h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><blockquote>
<p>The Microsoft REST API指南作为一种设计原则，估计程序开发人员通过RESTful HTTP接口访问资源。为了在遵循Microsoft REST API的平台上为开发人员提供尽可能流程的体验，REST API应当遵循一致的设计原则，以使其变得简单和直观。</p>
<p>本文档建立了Microsoft REST API应该遵循的指导原则，以便统一一致的开发RESTful接口。</p>
</blockquote>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><blockquote>
<p>开发人员通常通过HTTP接口访问微软云平台资源，虽然每个服务通常提供特定于语言框架来包括其API，但他们的所有操作最后都归结为HTTP请求。微软必须支持广泛的客户端和服务，不能依赖于每个开发环境都有丰富的框架。因此，本指南的目标是确保Microsoft REST API能够被任何具有基本HTTP支持的客户端轻松且一致的使用。</p>
<p>为了给开发人员提供顺畅的体验，让这些API遵循统一的设计准则是很重要的，从而使其简单易用，符合人们的直觉反应。本文档建立了 Microsoft REST API开发人员应该遵循的指南。以便统一一致的开发API。</p>
<p>一致性的好处在于可以不断的积累合理的规范；一致性使得团队拥有统一的代码、模式、文档和设计策略。</p>
<p>这些指南旨在达成以下目标：</p>
<ul>
<li>为微软技术平台所有API定义了一致的实现和体验</li>
<li>尽可能的遵守行业普遍接受的 REST/HTTP 最佳实践</li>
<li>使所有开发人员可以通过REST接口轻松的访问微软服务</li>
<li>允许服务开发人员在其他服务的基础上来开发一致的REST API接口</li>
<li>允许合作伙伴用这些指南设置自己的REST接口</li>
</ul>
</blockquote>
<h3 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h3><blockquote>
<p>理解REST设计风格背后的理念，有助于开发更好的HTTP服务。如果你是REST设计风格的初学者，这儿有些非常好的学习资源：</p>
<p><a href="https://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank" rel="noopener">REST维基百科</a></p>
<p><a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm" target="_blank" rel="noopener">REST论文</a></p>
<p><a href="https://tools.ietf.org/html/rfc7231" target="_blank" rel="noopener">RFC7320</a></p>
<p><a href="https://www.amazon.com/REST-Practice-Hypermedia-Systems-Architecture/dp/0596805829/" target="_blank" rel="noopener">REST实践</a></p>
</blockquote>
<h2 id="解读指南"><a href="#解读指南" class="headerlink" title="解读指南"></a>解读指南</h2><h3 id="应用指南"><a href="#应用指南" class="headerlink" title="应用指南"></a>应用指南</h3><blockquote>
<p>这些指南适用于Microsoft公开的任何REST API或任何合作伙伴的服务。私有或内部的API也应尝试这些指南，因为内部服务往往最后都会公开。一致性不仅对外部客户而且对内部服务消费者都很有价值，而且这些准则提供了对任何服务都有用的最佳实践。</p>
<p>有合理理由可以不遵循这些准则，如：实现或必须与某些外部定义的REST API互操作的REST服务必须与那些外部的API兼容，从而无法遵循这些准则；还有一些服务可能有特殊的性能要求，必须采用其他格式，比如二进制协议。</p>
</blockquote>
<h3 id="存在服务和服务版本指导"><a href="#存在服务和服务版本指导" class="headerlink" title="存在服务和服务版本指导"></a>存在服务和服务版本指导</h3><blockquote>
<p>我们不推荐仅仅为了合规而对在这些准则之前的服务进行大量修改。无论如何，如果兼容性遭到破坏，则改服务应该在下一个版本中变得兼容。当服务添加新的API时，该API应该和相同版本的其他API一致。因此，如果服务是针对1.0版本的指南编写的，那么增量添加到服务的新的API也应该遵循1.0版本的指南。然后该服务在下一次主要版本更新时，再去遵循最新版本指南。</p>
</blockquote>
<h3 id="要求的语言"><a href="#要求的语言" class="headerlink" title="要求的语言"></a>要求的语言</h3><blockquote>
<p>本文档中”MUST”(必须)、”MUST NOT”(禁止)、”REQUIRED”(需要)、”SHALL”(将要)、”SHALL NOT”(最好不要)、”SHOULD”(应该)、”SHOULD NOT”(不应该)、”RECOMMENDED”(推荐)、”MAY”(可能)、”OPTIONAL”(可选) 等关键字的解释详见<a href="https://www.ietf.org/rfc/rfc2119.txt" target="_blank" rel="noopener">RFC2119</a></p>
</blockquote>
<h3 id="许可证"><a href="#许可证" class="headerlink" title="许可证"></a>许可证</h3><blockquote>
<p>本作品根据知识共享署名4.0国际许可协议授权。如需查看本授权的副本，请访问<a href="http://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener">http://creativecommons.org/licenses/by/4.0/</a> 或致函 PO Box 1866, Mountain View, CA 94042, USA.</p>
</blockquote>
<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><blockquote>
<p>作为Microsoft REST API指南的一部分，服务必须满足下面定义的分类法</p>
</blockquote>
<h3 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h3><blockquote>
<p>错误，或更具体的说是服务错误，定义为客户端将无效的数据传递给服务，并且服务正确拒绝该数据。比如包括无效的凭证、不正确的参数、未知的版本ID或类似内容。这些通常是“4xx”HTTP错误码，是客户端传递不正确的参数或无效数据导致的结果。</p>
<p>错误不会影响API的整体可用性。</p>
</blockquote>
<h3 id="故障"><a href="#故障" class="headerlink" title="故障"></a>故障</h3><blockquote>
<p>故障，或更具体的说是服务故障，定义为服务未能响应有效的客户端请求而正确返回。这些通常是”5xx”HTTP错误码。</p>
<p>故障会影响API的整体可用性。</p>
<p>由于限流或配额故障而是失败的调用不能算作故障。由于服务快速失败(fast-failing)请求(通常是为了保护自己)而失败的调用被视为故障</p>
</blockquote>
<h3 id="延迟"><a href="#延迟" class="headerlink" title="延迟"></a>延迟</h3><blockquote>
<p>延迟定义为特定的API调用完成所需的时间（尽可能使用客户端调用进行测量）。此测量方法同样适用于同步和异步API。对于长时间运行的调用，延迟定义为第一次调用它所需的时间，而不是整个操作完成所需的时间。</p>
</blockquote>
<h3 id="完成时间"><a href="#完成时间" class="headerlink" title="完成时间"></a>完成时间</h3><blockquote>
<p>暴露长时间操作的服务必须跟踪这些操作的“完成时间”指标。</p>
</blockquote>
<h3 id="长期运行的API故障"><a href="#长期运行的API故障" class="headerlink" title="长期运行的API故障"></a>长期运行的API故障</h3><blockquote>
<p>对于长时间运行的API，很可能第一次请求成功，且后续每次去获取结果时API也处于正常运行（每个都返回200），但其中底层操作已经失败了的情况。长期运行故障必须作为故障汇总到总体可用性指标中。</p>
</blockquote>
<h2 id="客户端指南"><a href="#客户端指南" class="headerlink" title="客户端指南"></a>客户端指南</h2><blockquote>
<p>为确保客户端更好的接入REST服务，客户端应该遵循以下最佳实践：</p>
</blockquote>
<h3 id="忽略规则"><a href="#忽略规则" class="headerlink" title="忽略规则"></a>忽略规则</h3><blockquote>
<p>对于松散耦合的客户端调用，在调用之前不知道数据的确切定义和格式，如果服务器没有返回客户端预期的内容，客户端必须安全地忽略他。</p>
<p>在服务迭代的过程中，有些服务(接口)可能在不更改版本号的情况下向响应添加字段。此类服务必须在其文档中注明，客户端必须忽略这些未知字段。</p>
</blockquote>
<h3 id="变量排序规则"><a href="#变量排序规则" class="headerlink" title="变量排序规则"></a>变量排序规则</h3><blockquote>
<p>客户端处理响应数据时一定不能依赖服务端JSON响应数据字段的顺序。例如，当服务器返回的JSON对象中的字段顺序发生变化，客户端应当能够正确进行解析处理。</p>
<p>当服务端支持时，客户端可以请求以特定的顺序返回数据。例如，服务端可能支持使用$orderBy querystring参数来指定JSON数组中元素的顺序。</p>
<p>服务端也可以在协议中显式说明指定某些元素按指定方式进行排序。例如，服务端可以每次返回JSON对象时都把JSON对象的类型信息作为第一个字段返回，进而简化客户端解析返回数据格式的难度。客户端处理数据时可以依赖于服务端明确指定了的排序行为。</p>
</blockquote>
<h3 id="无提示的失效规则"><a href="#无提示的失效规则" class="headerlink" title="无提示的失效规则"></a>无提示的失效规则</h3><blockquote>
<p>当客户端请求带可选功能参数的服务时（例如带可选的头部信息），必须对服务端的返回格式有一定兼容性，可以忽略某些特定功能。</p>
</blockquote>
<h2 id="一致性基础"><a href="#一致性基础" class="headerlink" title="一致性基础"></a>一致性基础</h2><h3 id="URL结构"><a href="#URL结构" class="headerlink" title="URL结构"></a>URL结构</h3><blockquote>
<p>URL必须保证友好的可读性和可构造性，人类应该能够轻松读取和构造URL。这有助于用户发现并简化接口的调用，即使平台没有良好的客户大SDK支持。</p>
<p>结构良好的URL如：</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">https://api.contoso.com/v1.0/people/jdoe@contoso.com/inbox</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>结构不好的URL如：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.contoso.com/EWS/OData/Users('jdoe@microsoft.com')/Folders('AAMkADdiYzI1MjUzLTk4MjQtNDQ1Yy05YjJkLWNlMzMzYmIzNTY0MwAuAAAAAACzMsPHYH6HQoSwfdpDx-2bAQCXhUk6PC1dS7AERFluCgBfAAABo58UAAA=')</span><br></pre></td></tr></table></figure>

<blockquote>
<p>出现的常见模式是使用URL作为值（参数）。服务可以使用URL作为值。例如，下面的内容是可以接受的：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.contoso.com/v1.0/items?url=https://resources.contoso.com/shoes/fancy</span><br></pre></td></tr></table></figure>

<h3 id="URL长度"><a href="#URL长度" class="headerlink" title="URL长度"></a>URL长度</h3><blockquote>
<p>HTTP1.1消息格式对请求没有长度限制，其中包括目标URL。RFC：</p>
<blockquote>
<p>HTTP没有对请求行长度设置预定义的限制。[…]如果服务器接收到的请求目标比它希望解析的任何URL都长，那么它必须使用414（URI太长）状态代码响应。</p>
</blockquote>
<p>服务如果能够生成超过2083个字符的URL，必须考虑兼容它支持的客户端。不同客户端支持的最长URL长度参见：</p>
</blockquote>
<ul>
<li><a href="http://stackoverflow.com/a/417184" target="_blank" rel="noopener">http://stackoverflow.com/a/417184</a></li>
<li><a href="https://blogs.msdn.microsoft.com/ieinternals/2014/08/13/url-length-limits/" target="_blank" rel="noopener">https://blogs.msdn.microsoft.com/ieinternals/2014/08/13/url-length-limits/</a></li>
</ul>
<blockquote>
<p>其他需要注意，一些技术栈有强制的URL限定，所以在设计服务时要记住这一定。</p>
</blockquote>
<h3 id="标准标识符"><a href="#标准标识符" class="headerlink" title="标准标识符"></a>标准标识符</h3><blockquote>
<p>除了提供友好的URL之外，能够移动或重命名的资源必须包含唯一稳定的标识符。在与服务进行交互时可能需要通过友好的名称来获取资源固定的URL，就像某些服务使用的”/my”快捷方式一样。指南不强制要求，固定标识符使用GUID。包含规范标识符的URL例子：</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">https://api.contoso.com/v1.0/people/7011042402/inbox</span></span><br></pre></td></tr></table></figure>

<h3 id="支持方法"><a href="#支持方法" class="headerlink" title="支持方法"></a>支持方法</h3><blockquote>
<p>客户端必须尽可能使用正确的HTTP动词来执行操作，并且必须考虑是否支持此操作的幂等性。HTTP方法通常称为HTTP动词。</p>
<p>下面是Microsoft REST服务应该支持的方法列表。并不是所有资源都支持所有方法，但是使用以下方法的所有资源必须符合他们的用法。</p>
</blockquote>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
<th>Is Idempotent</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>返回对象的当前值</td>
<td>true</td>
</tr>
<tr>
<td>PUT</td>
<td>在适当时替换对象或创建命名对象</td>
<td>true</td>
</tr>
<tr>
<td>DELETE</td>
<td>删除一个对象</td>
<td>true</td>
</tr>
<tr>
<td>POST</td>
<td>创建基于数据提供者的一个新对象，或者提交一个操作</td>
<td>false</td>
</tr>
<tr>
<td>HEAD</td>
<td>返回一个GET响应对象的元数据，支持GET方法的资源也可能支持HEAD方法</td>
<td>true</td>
</tr>
<tr>
<td>PATCH</td>
<td>更新对象部分应用</td>
<td>false</td>
</tr>
<tr>
<td>OPTIONS</td>
<td>获取关于请求的信息</td>
<td>true</td>
</tr>
</tbody></table>
<h4 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h4><blockquote>
<p>POST操作应该支持重定向响应标头，以便通过重定向标头返回创建好的资源和链接。</p>
<p>例如：假如一个服务允许创建并命名托管服务器</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST http://api.contoso.com/account1/servers</span><br></pre></td></tr></table></figure>

<blockquote>
<p>响应就会像下面这样：</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">201 Created</span><br><span class="line"><span class="attribute">Location</span>: http://api.contoso.com/account1/servers/server321</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这儿的“server321”就是服务分配的服务器名。</p>
<p>服务还可以在响应中返回已创建项的完整元数据。</p>
</blockquote>
<h4 id="PATCH"><a href="#PATCH" class="headerlink" title="PATCH"></a>PATCH</h4><blockquote>
<p>PATCH 已被IETF标准化为用于增量更新现有对象的方法，符合Microsoft REST API准则的API应该支持PATCH。</p>
</blockquote>
<h4 id="通过PATCH创建资源-UPSERT定义"><a href="#通过PATCH创建资源-UPSERT定义" class="headerlink" title="通过PATCH创建资源 (UPSERT定义)"></a>通过PATCH创建资源 (UPSERT定义)</h4><blockquote>
<p>允许客户端在创建资源的时候只指定部分键值数据的必须支持UPSET语义，该服务必须支持以PATCH动词来创建资源。</p>
<p>鉴于PUT被定义为内容的完全替换，所以客户端使用PUT修改数据是危险的。</p>
<p>当试图更新资源时，不理解资源的某些属性的客户端，很可能在PUT上忽视这些属性，导致提交后这些属性可能在不经意间被删除。</p>
<p>所以，如果选择支持PUT来更新现有资源，则必须是完整替换（即，PUT之后，资源的属性必须匹配请求中提供的内容，包括删除没有提供的任何服务端的属性）。</p>
<p>在UPSET语义下，对不存在资源的PATCH调用，由服务器作为“创建”处理，对已存在资源的PATCH调用作为“更新”处理。</p>
<p>为确保更新请求不被视为创建，客户端可以在请求中指定预先定义的HTTP请求头。</p>
<ul>
<li>如果PATCH请求包含if-match标头，则服务不能将其视为插入；如果PATCH请求包含值为”*“的if-none-match头，则服务不能将其视为更新。</li>
</ul>
<p>如果服务不支持UPSERT，则针对不存在资源的PATCH调用必须导致HTTP”409 Conflict“错误。 </p>
</blockquote>
<h4 id="Options标头和link标签"><a href="#Options标头和link标签" class="headerlink" title="Options标头和link标签"></a>Options标头和link标签</h4><blockquote>
<p>OPTIONS允许客户端查询某个资源的元信息，并至少可以通过返回支持该资源的有效方法的Allow标头。</p>
<p>此外，建议服务返回应该包含一个指向有关资源的稳定链接（Link header）</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Link:<span class="tag">&lt;<span class="name">&#123;help&#125;</span>&gt;</span>;rel="help"</span><br></pre></td></tr></table></figure>

<blockquote>
<p>其中{help}是指向文档资源的URL。</p>
<p>有关选项使用的实例，请参见CORS跨域调用。</p>
</blockquote>
<h3 id="标准请求头"><a href="#标准请求头" class="headerlink" title="标准请求头"></a>标准请求头</h3><blockquote>
<p>下面的请求标头表应该遵循Microsoft REST API指南服务使用。使用这些标题不是强制性的，但如果使用他们则必须始终一致的使用。</p>
<p>所有标头值都必须遵循规范中规定的标头字段的语法规则，许多HTTP标头在RFC7231中定义，但是在IANA标头注册表中可以找到完整的已批准头列表。</p>
</blockquote>
<table>
<thead>
<tr>
<th>Header</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>Authorization</td>
<td>String</td>
<td>请求的授权标头</td>
</tr>
<tr>
<td>Date</td>
<td>Date</td>
<td>请求的时间戳，基于客户端的时钟，采用RFC5322日期和时间格式，服务器不应该对客户端时钟的准确性做任何假设。此标头可以包含在请求中，但在提供时必须采用此格式。当提供此报头时，必须使用格林尼治平均时间（GMT）作为时区参考，例如：Web，24 Aug 2016 18:41:30 GMT. 请注意，GMT正好等于UTC（协调世界时）。</td>
</tr>
<tr>
<td>Accept</td>
<td>Content    type</td>
<td>响应请求的内容类型，例如：- application/xml   - text/xml   - application/json   - text/javascript 根据HTTP准则，这只是一个提示，响应可能有不同的内容类型，例如blob fetch，其中成功的响应将只是blob流作为有效负载。对于遵循OData的服务，应该遵循OData中指定的首选项循序</td>
</tr>
<tr>
<td>Accept-Encoding</td>
<td>Gzip，deflate</td>
<td>如果适用，REST端点应该支持GZIP和DEFLATE编码。对于非常大的资源，服务可能会忽略并返回未压缩的数据。</td>
</tr>
<tr>
<td>Accept-Language</td>
<td>“en”,”es”,etc</td>
<td>指定响应的首选语言，不需要服务来支持这一点，但是如果一个服务支持本地化，那么它必须通过Accept-Language头来支持本地化。</td>
</tr>
<tr>
<td>Accept-Charset</td>
<td>Charset type like “UTF-8”</td>
<td>默认值是UTF-8，但是服务应该能够处理ISO-8859-1</td>
</tr>
<tr>
<td>Content-Type</td>
<td>Content-Type</td>
<td>请求体的Mine type（PUT/POST/PATCH）</td>
</tr>
<tr>
<td>Prefer</td>
<td>return=minimal,return=representation</td>
<td>如果指定了return=minimal首选项，则服务应该返回一个空主体(empty body)以响应一次成功插入或更新。如果指定了return=representation，则服务应该在响应中返回创建或更新的资源。如果服务的场景中客户端有时会从响应中获益，但有时响应会对带宽造成太大影响，那么应该中支持这个报头。</td>
</tr>
<tr>
<td>If-Match, If-None-Match, If-Range</td>
<td>String</td>
<td>使用乐观并发控制支持资源更新的服务必须支持If-Match标头。服务也可以使用其他与ETag相关的头，只要他们遵循HTTP规范</td>
</tr>
</tbody></table>
<h3 id="标准响应头"><a href="#标准响应头" class="headerlink" title="标准响应头"></a>标准响应头</h3><blockquote>
<p>服务应该返回以下响应标头，除非在”required”列中注明。</p>
</blockquote>
<table>
<thead>
<tr>
<th>响应头</th>
<th>Required</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Date</td>
<td>All Responses</td>
<td>根据服务器的时钟，以RFC5322日期和时间格式处理响应。这个头必须包含在响应中，此报头必须使用格林尼治平均时间（GMT）作为时区参考，例如:Wed, 24 Aug 2016 18:41:30 GMT.请注意，GMT正好等于协调世界时(UTC)。</td>
</tr>
<tr>
<td>Content-type</td>
<td>All Responses</td>
<td>内容类型</td>
</tr>
<tr>
<td>Content-Encoding</td>
<td>All Responses</td>
<td>GZIP或DEFLATE，视情况而定</td>
</tr>
<tr>
<td>Preference-Applied</td>
<td>在请求中指定时</td>
<td>是否应用了首选项请求头中指示的首选项</td>
</tr>
<tr>
<td>ETag</td>
<td>当请求的资源具有实体标记时</td>
<td>ETag响应头字段为请求的变量提供实体标记的当前值。与If-Match、If-None-Match和If-Range一起使用，实现乐观并发控制。</td>
</tr>
</tbody></table>
<h3 id="自定义请求头"><a href="#自定义请求头" class="headerlink" title="自定义请求头"></a>自定义请求头</h3><blockquote>
<p>基本的Api操作不应该支持自定义标头。</p>
<p>本文档中的一些准则规定了非标准HTTP标头的使用。此外，某些服务可能需要添加额外的功能，这些功能通过HTTP标头文件公开。以下准则有助于在使用自定义标头时保持一致性。</p>
<p>非标准HTTP标头必须具有以下两种格式之一：</p>
<ol>
<li>使用IANA（RFC3864）注册为“临时”的标头的通用格式。</li>
<li>为注册使用过特定的头文件的范围格式。</li>
</ol>
<p>这两种格式如下所述。</p>
</blockquote>
<h3 id="以查询参数方式提交自定义请求头"><a href="#以查询参数方式提交自定义请求头" class="headerlink" title="以查询参数方式提交自定义请求头"></a>以查询参数方式提交自定义请求头</h3><blockquote>
<p>有些标头对某些场景（如Ajax客户端）不兼容，特别是在不支持添加标头的跨域调用时。因此，除了常见的标头信息外，一些标头信息可以允许被作为查询参数传递给服务端，其命名与请求头中的名称保持一致：</p>
<p>并不是所有的标头都可以用作查询参数，包括大多数标准HTTP标头。</p>
<p>考虑何时接受标头作为参数的标准如下：</p>
<ol>
<li>任何自定义标头也必须作为参数接受。</li>
<li>请求的标准标头也可以作为参数接受。</li>
<li>具有安全敏感性的必需标头（例如，授权标头Authorization）可能不适合作为参数；服务所有者应该具体情况具体分析。</li>
</ol>
<p>此规则的一个例外情况是Accept头。使用具有简单名称的方案，而不是使用HTTP规范中描述的用于Accept的完整功能，这是一种常见的实践。</p>
</blockquote>
<h3 id="PII个人身份信息参数"><a href="#PII个人身份信息参数" class="headerlink" title="PII个人身份信息参数"></a>PII个人身份信息参数</h3><blockquote>
<p>与普遍的隐私政策一致，客户端不应该在URL中传输个人身份信息(PII)参数(作为路径或查询参数)，因为这些信息可能通过客户端、网络和服务器日志和其他机制无意暴露出来。</p>
<p>因此，服务应该接受PII参数作为标头传输。</p>
<p>然而在实践中，由于客户端或软件的限制，在许多情况下无法遵循上述建议。为了解决这些限制，服务也应该接受这些PII参数作为URL的一部分，与本指导原则的其余部分保持一致。</p>
<p>接受PII参数(无论是在URL中还是作为标头)的服务 应该符合其组织的隐私保护原则。通常建议包括：客户端使用标头进行加密传输，并且实现要遵循特殊的预防措施，以确保日志和其他服务数据收集得到正确的处理。</p>
</blockquote>
<h3 id="Response-formats响应格式"><a href="#Response-formats响应格式" class="headerlink" title="Response formats响应格式"></a>Response formats响应格式</h3><blockquote>
<p>一个成功的平台，往往提供可读性较好并且一致的响应结果，并允许开发人员使用公共 Http 代码处理响应。</p>
<p>基于Web的通信，特别是当涉及移动端或其他低带宽客户端时，我们推荐使用JSON作为传输格式。主要是由于其更轻量以及易于与JavaScript交互。</p>
<p>JSON属性名应该采用camelCasedE驼峰命名规范。</p>
<p>服务应该提供JSON作为默认输出格式。</p>
</blockquote>
<h4 id="Clients-specified客户端指定响应格式"><a href="#Clients-specified客户端指定响应格式" class="headerlink" title="Clients-specified客户端指定响应格式"></a><strong>Clients-specified</strong>客户端指定响应格式</h4><blockquote>
<p>在HTTP中，客户端应该使用Accept头请求响应格式。服务端可以选择性的忽略，如客户端发送多个Accept标头，服务可以选择其中一个格式进行响应。</p>
<p>默认的响应格式(没有提供Accept头)应该是application/json，并且所有服务必须支持application/json。</p>
</blockquote>
<table>
<thead>
<tr>
<th>Accept Header</th>
<th>Response Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td>application/json</td>
<td>必须是返回json格式</td>
<td>同样接受JSONP请求的text/JavaScript</td>
</tr>
</tbody></table>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.contoso.com/v1.0/products/user</span><br><span class="line"><span class="attribute">Accept</span>: application/json</span><br></pre></td></tr></table></figure>

<h4 id="错误情况下的响应格式"><a href="#错误情况下的响应格式" class="headerlink" title="错误情况下的响应格式"></a>错误情况下的响应格式</h4><blockquote>
<p>对于调用不成功的情况，开发人员应该能够用相同的代码库一致地处理错误。这允许构建简单可靠的基础架构来处理异常，将异常作为成功响应的独立处理流程来处理。下面的代码基于OData v4 JSON规范。但是，它非常通用，不需要特定的OData构造。即使api没有使用其他OData结构，也应该使用这种格式。</p>
<p>错误响应必须是单个JSON对象。该对象必须有一个名为“error”的 名称/值（name/value） 对。该值必须是JSON对象。</p>
<p>这个对象必须包含名称“code”和“message”的 键值对，并且它建议包含譬如“target”、“details”和 “innererror” 的键值对。</p>
<p>“code”键值对的值 是一个与语言无关的字符串。它的值是该服端务定义的错误代码，应该简单可读。与响应中指定的HTTP错误代码相比，此代码用作错误的更具体的指示。服务应该具有相对较少的“code”数量(别超过20个)，并且所有客户端必须能够处理所有这些错误信息。</p>
<p>大多数服务将需要更大数量的更具体的错误代码以满足所有的客户端请求。这些错误代码应该在“innererror” 键值对中公开，如下所述。为现有客户端可见的“代码”引入新值是一个破坏性的更改，需要增加版本。服务可以通过向“innererror”添加新的错误代码来避免中断服务更改。</p>
<p>“message”键值对的值 必须是错误提示消息，必须是可读且易于理解。它旨在是帮助开发人员，不适合暴露给最终用户。想要为最终用户公开合适消息的服务必须通过annotation注释或其他自定义属性来公开。服务不应该为最终用户本地化“message”，因为这样对于开发者变得非常不友好并且难以处理。</p>
<p>“target”键值对的值 是指向错误的具体的目标(例如，错误中属性的名称)。</p>
<p>“details”键值对的值 必须是JSON对象数组，其中必须包含“code”和“message”的键值对，还可能包含“target”的键值对，如上所述。“details”数组中的对象通常表示请求期间发生的不同的、相关的错误。请参见下面的例子。</p>
<p>“innererror”键值对的值 必须是一个对象。这个对象的内容是服务端定义的。想要返回比根级别代码更具体的错误的服务，必须包含“code”的键值对和嵌套的“innererror”。每个嵌套的“innererror”对象表示比其父对象更高层次的细节。在评估错误时，客户端必须遍历所有嵌套的“内部错误”，并选择他们能够理解的最深的一个。这个方案允许服务在层次结构的任何地方引入新的错误代码，而不破坏向后兼容性，只要旧的错误代码仍然出现。服务可以向不同的调用者返回不同级别的深度和细节。例如，在开发环境中，最深的“innererror”可能包含有助于调试服务的内部信息。为了防范信息公开带来的潜在安全问题，服务应注意不要无意中暴露过多的细节。错误对象还可以包括特定于代码的自定义服务器定义的键值对。带有自定义服务器定义属性的错误类型应该在服务的元数据文档中声明。请参见下面的例子。</p>
<p>错误响应返回的的任何JSON对象中都可能包含注释。</p>
<p>我们建议，对于任何可能重试的临时错误，服务应该包含一个 Retry-After HTTP头，告诉客户端在再次尝试操作之前应该等待的最小秒数。</p>
</blockquote>
<h5 id="ErrorResponse-Object"><a href="#ErrorResponse-Object" class="headerlink" title="ErrorResponse: Object"></a>ErrorResponse: Object</h5><table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>error</td>
<td>Error</td>
<td>true</td>
<td>The error object.</td>
</tr>
</tbody></table>
<h5 id="Error-Object"><a href="#Error-Object" class="headerlink" title="Error: Object"></a>Error: Object</h5><table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>code</td>
<td>String</td>
<td>true</td>
<td>服务器定义的错误代码集之一。message</td>
</tr>
<tr>
<td>target</td>
<td>String</td>
<td></td>
<td>The target of the error.</td>
</tr>
<tr>
<td>Details</td>
<td>Error[]</td>
<td></td>
<td>An array of details about specific errors that led to this reported error.</td>
</tr>
<tr>
<td>innererror</td>
<td>innerError</td>
<td></td>
<td>An object containing more specific information than the current object about the error.</td>
</tr>
</tbody></table>
<h5 id="InnerError-Object"><a href="#InnerError-Object" class="headerlink" title="InnerError: Object"></a>InnerError: Object</h5><table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>code</td>
<td>String</td>
<td></td>
<td>A more specific error code than was provided by the containing error.</td>
</tr>
<tr>
<td>innererror</td>
<td>innerError</td>
<td></td>
<td>An object containing more specific information than the current object about the error.</td>
</tr>
</tbody></table>
<h5 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h5><blockquote>
<p>innerError错误例子</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"error"</span>: &#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="string">"BadArgument"</span>,</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"Previous passwords may not be reused"</span>,</span><br><span class="line">    <span class="attr">"target"</span>: <span class="string">"password"</span>,</span><br><span class="line">    <span class="attr">"innererror"</span>: &#123;</span><br><span class="line">      <span class="attr">"code"</span>: <span class="string">"PasswordError"</span>,</span><br><span class="line">      <span class="attr">"innererror"</span>: &#123;</span><br><span class="line">        <span class="attr">"code"</span>: <span class="string">"PasswordDoesNotMeetPolicy"</span>,</span><br><span class="line">        <span class="attr">"minLength"</span>: <span class="string">"6"</span>,</span><br><span class="line">        <span class="attr">"maxLength"</span>: <span class="string">"64"</span>,</span><br><span class="line">        <span class="attr">"characterTypes"</span>: [<span class="string">"lowerCase"</span>,<span class="string">"upperCase"</span>,<span class="string">"number"</span>,<span class="string">"symbol"</span>],</span><br><span class="line">        <span class="attr">"minDistinctCharacterTypes"</span>: <span class="string">"2"</span>,</span><br><span class="line">        <span class="attr">"innererror"</span>: &#123;</span><br><span class="line">          <span class="attr">"code"</span>: <span class="string">"PasswordReuseNotAllowed"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在本例中，基本的错误代码是“BadArgument”，但是对于感兴趣的客户端，“innererror”中提供了更具体的错误代码。<br>“passwordreusenotal”代码可能是在之后的迭代中由该服务添加的，之前只返回“passwordnotmeetpolicy”。<br>这种增量型的添加方式并不会破坏老的客户端的处理过程，而又可以给开发者一些更详细的信息。</p>
<p>“PasswordDoesNotMeetPolicy”错误还包括额外的键值对，这些键值对 允许客户机确定服务器的配置、以编程方式验证用户的输入，或者在客户机自己的本地化消息传递中向用户显示服务器的约束。</p>
</blockquote>
<blockquote>
<p>详细的例子 “details”:</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"error"</span>: &#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="string">"BadArgument"</span>,</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"Multiple errors in ContactInfo data"</span>,</span><br><span class="line">    <span class="attr">"target"</span>: <span class="string">"ContactInfo"</span>,</span><br><span class="line">    <span class="attr">"details"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"code"</span>: <span class="string">"NullValue"</span>,</span><br><span class="line">        <span class="attr">"target"</span>: <span class="string">"PhoneNumber"</span>,</span><br><span class="line">        <span class="attr">"message"</span>: <span class="string">"Phone number must not be null"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"code"</span>: <span class="string">"NullValue"</span>,</span><br><span class="line">        <span class="attr">"target"</span>: <span class="string">"LastName"</span>,</span><br><span class="line">        <span class="attr">"message"</span>: <span class="string">"Last name must not be null"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"code"</span>: <span class="string">"MalformedValue"</span>,</span><br><span class="line">        <span class="attr">"target"</span>: <span class="string">"Address"</span>,</span><br><span class="line">        <span class="attr">"message"</span>: <span class="string">"Address is not valid"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在本例中，请求存在多处问题，每个错误都列在 “details” 字段中进行返回了。</p>
</blockquote>
<h3 id="HTTP状态码"><a href="#HTTP状态码" class="headerlink" title="HTTP状态码"></a>HTTP状态码</h3><blockquote>
<p>应使用标准HTTP状态码作为响应状态码; 更多信息，请参见HTTP状态代码定义。</p>
</blockquote>
<h3 id="可选择的客户端库"><a href="#可选择的客户端库" class="headerlink" title="可选择的客户端库"></a>可选择的客户端库</h3><blockquote>
<p>开发人员必须能够在各种平台和语言上进行开发，比如Windows、macOS、Linux、c#、Python和Node.js或是Ruby。</p>
<p>服务应该能够让简单的HTTP工具(如curl)进行访问，而不需要做太多的工作。</p>
<p>该服务提供给开发人员的网站应该提供相当于“获得开发者令牌(Get developer Token)的功能，以帮助开发人员测试并应提供curl支持。</p>
</blockquote>
<h2 id="CORS跨域"><a href="#CORS跨域" class="headerlink" title="CORS跨域"></a>CORS跨域</h2><blockquote>
<p>符合Microsoft REST API准则的服务必须支持CORS(跨源资源共享)。</p>
<p>服务应该支持CORS *的允许起源，并通过有效的OAuth令牌强制授权。</p>
<p>服务不应该支持带有源验证的用户凭据。</p>
<p>特殊情况可例外。</p>
</blockquote>
<h3 id="客户端指南-1"><a href="#客户端指南-1" class="headerlink" title="客户端指南"></a>客户端指南</h3><blockquote>
<p>Web开发人员通常不需要做任何特殊处理来利用CORS。</p>
<p>作为标准XMLHttpRequest调用的一部分，所有握手步骤都是不可见的。</p>
<p>许多其他平台（如.NET）已集成了对CORS的支持。</p>
</blockquote>
<h4 id="避免额外的预检查"><a href="#避免额外的预检查" class="headerlink" title="避免额外的预检查"></a>避免额外的预检查</h4><blockquote>
<p>由于CORS协议会触发向服务器添加额外往返的预检请求，因此，注重性能的应用程序可能会有意避免这些请求。CORS背后的精神是避免对旧的不支持CORS功能的浏览器能够做出的任何简单的跨域请求进行预检。所有其他请求都需要预检。</p>
<p>请求是“简单类型请求“，如果其方法是GET，HEAD或POST，并且除了Accept，Accept-Language和Content-Language之外它不包含任何请求标头，则可以免去预检。</p>
<p>对于POST请求，也允许使用Content-Type标头，但前提是其值为“application/x-www-form-urlencoded”，“multipart/form-data”或“text/plain”。</p>
<p>对于任何其他标头或值，将发生预检请求。</p>
</blockquote>
<h3 id="服务端指导"><a href="#服务端指导" class="headerlink" title="服务端指导"></a>服务端指导</h3><blockquote>
<p>服务必须至少：</p>
<ul>
<li>了解浏览器在跨域请求上发送的Origin请求标头，以及他们在检查访问权限的预检OPTIONS 请求上发送的 Access-Control-Request-Method请求标头。</li>
<li>如果请求中存在Origin标头：<ul>
<li>添加一个Access-Control-Allow-Headers响应标头，其中包含允许客户端使用的请求标头名称列表。这个列表只需要包含不在(简单请求头)[rs-simple-headers] (Accept、Accept- language、Content-Language)集合中的头。如果服务接受的报头没有限制，则服务可以简单地返回与客户机发送的访问-控制-请求-报头报头相同的值。</li>
<li>添加一个Access-Control-Allow-Methods响应头，其中包含允许调用方使用的HTTP方法列表。</li>
<li>如果请求使用 OPTIONS 方法并包含 Access-Control-Request-Method标头，则它是一个预检请求，用于在实际请求之前探测访问。否则，这是一个实际的请求。对于预检请求，除了执行以下步骤添加标头之外，服务必须不执行任何额外处理，并且必须返回 200 OK。对于非预检请求，除了请求的常规处理之外，还会添加以下标头。</li>
<li>服务向响应添加 Access-Control-Allow-Origin 标头，其中包含与Origin 请求标头相同的值。请注意，这需要服务来动态生成标头值。不需要cookie或任何其他形式的[用户凭证] cors-user-credentials的资源可以使用通配符星号（*）进行响应。请注意，通配符仅在此处可接受，而不适用于下面描述的任何其他标头。</li>
<li>如果调用者需要访问不属于[简单响应头] cors-simple-headers集合中的响应头（Cache-Control，Content-Language，Content-Type，Expires，Last-Modified，Pragma），同时添加一个Access-Control-Expose-Headers标头，其中包含客户端应有权访问的其他响应标头名称列表。</li>
<li>如果请求需要cookie，则添加一个Access-Control-Allow-Credentials头，并将其设置为“true”。</li>
<li>如果请求是预检请求(见第一个项目符号)，则服务必须满足:</li>
</ul>
</li>
</ul>
<p>添加一个Access-Control-Max-Age pref</p>
<p>响应头，其中包含此预检前响应有效的秒数(因此可以在后续实际请求之前避免)。注意，虽然习惯上使用较大的值，比如2592000(30天)，但是许多浏览器会自动设置一个更低的限制(例如，5分钟)。</p>
<p>众所周知，由于浏览器预检响应缓存很弱，因此预检响应的额外往返会损害性能。</p>
<p>注重性能端的交互式 Web客户端使用的服务端应该避免使用导致预检的请求。</p>
<ul>
<li>对于GET和HEAD调用，请避免要求不属于上述简单集的请求标头。最好是允许将它们作为查询参数提供。<ul>
<li>Authorization标头不是简单集的一部分，因此对于需要验证的资源，必须通过“access_token”查询参数发送验证令牌。请注意，不建议在URL中传递身份验证令牌，因为它可能导致令牌记录在服务器日志中，并暴露给有权访问这些日志的任何人。通过URL接受身份验证令牌的服务必须采取措施来降低安全风险，例如使用短期身份验证令牌，禁止记录身份验证令牌以及控制对服务器日志的访问。</li>
</ul>
</li>
<li>避免要求cookie。如果设置了“withCredentials”属性，XmlHttpRequest将仅在跨域请求上发送cookie; 这也会导致预检请求。<ul>
<li>需要基于cookie的身份验证的服务必须使用“动态验证码（dynamic canary）” [*]译者注：服务器生成某种验证码，客户端获取后，服务器再进行验证的操作。来保护所有接受cookie的API。</li>
</ul>
</li>
<li>对于POST调用，在适用的情况下，选择简单的内容类型(“application/x-www-form-urlencoded”、“multipart/form-data”、“text/plain”)。其他任何内容类型都会引发预检请求。<ul>
<li>服务不得以避免CORS预检请求的名义违反其他API指南。由于内容类型的原因，大多数POST请求实际上需要预检请求。</li>
<li>如果非要取消预检工作，那么服务支持的其他的替代数据传输机制必须遵循本指南。</li>
</ul>
</li>
</ul>
<p>此外，当适当的服务可以支持JSONP模式时，只需简单的GET跨域访问。</p>
<p>在JSONP中，服务采用指示格式的参数(<em>$format=json</em>)和表示回调的参数(<em>$callback=someFunc</em>)，并返回一个 text/javascript 文档，其中包含用指定名称封装在函数调用中的JSON响应。</p>
<p>更多关于JSONP的信息，请访问Wikipedia: JSONP。</p>
</blockquote>
<h2 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h2><h3 id="项的Key"><a href="#项的Key" class="headerlink" title="项的Key"></a>项的Key</h3><blockquote>
<p>服务可以支持集合中每个项的持久标识符(主键)，该标识符应用JSON表示为”id” , 这些持久标识符通常用作项目的key。</p>
<p>支持持久标识符(主键)的集合可以支持增量查询。</p>
</blockquote>
<h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h3><blockquote>
<p>集合使用标准数组表示法以JSON表示。</p>
</blockquote>
<h3 id="集合的URL匹配模式"><a href="#集合的URL匹配模式" class="headerlink" title="集合的URL匹配模式"></a>集合的URL匹配模式</h3><blockquote>
<p>集合在顶级时直接位于服务的根目录下，或者作用于该资源时作为另一个资源下的段。</p>
<p>例如：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.contoso.com/v1.0/people</span><br></pre></td></tr></table></figure>

<blockquote>
<p>服务必须尽可能支持“/” 匹配。</p>
<p>例如：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://&#123;serviceRoot&#125;/&#123;collection&#125;/&#123;id&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Where:</p>
<ul>
<li>{serviceRoot} – 站点URL (site URL) + 服务的根路径的组合</li>
<li>{collection} – 集合的名称，未缩写，复数</li>
<li>{id} – 唯一id属性的值. 当使用 “/“ 匹配必须属于 string/number/guid value 不带引号，转义正确以适应URL。</li>
</ul>
</blockquote>
<h4 id="嵌套的集合和属性"><a href="#嵌套的集合和属性" class="headerlink" title="嵌套的集合和属性"></a>嵌套的集合和属性</h4><blockquote>
<p>集合项可以包含其他集合。</p>
<p>例如，用户集合可能包含多个地址的用户资源:</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.contoso.com/v1.0/people/123/addresses</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"value"</span>: [</span><br><span class="line">    &#123; <span class="attr">"street"</span>: <span class="string">"1st Avenue"</span>, <span class="attr">"city"</span>: <span class="string">"Seattle"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">"street"</span>: <span class="string">"124th Ave NE"</span>, <span class="attr">"city"</span>: <span class="string">"Redmond"</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="大集合"><a href="#大集合" class="headerlink" title="大集合"></a>大集合</h3><blockquote>
<p>随着数据的增长，集合也在增长。所以计划采用分页对所有服务都很重要。</p>
<p>因此，当数据包含多页时，序列化有效负载(payload)必须适当地包含下一页的不透明URL。</p>
<p>有关详细信息，请参阅分页指南。</p>
<p>客户端必须能够恰当的处理请求返回的任何给定的分页或非分页集合数据。</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"value"</span>:[</span><br><span class="line">    &#123; <span class="attr">"id"</span>: <span class="string">"Item 1"</span>,<span class="attr">"price"</span>: <span class="number">99.95</span>,<span class="attr">"sizes"</span>: <span class="literal">null</span>&#125;,</span><br><span class="line">    &#123; … &#125;,</span><br><span class="line">    &#123; … &#125;,</span><br><span class="line">    &#123; <span class="attr">"id"</span>: <span class="string">"Item 99"</span>,<span class="attr">"price"</span>: <span class="number">59.99</span>,<span class="attr">"sizes"</span>: <span class="literal">null</span>&#125;</span><br><span class="line">  ],</span><br><span class="line">  "@nextLink": "&#123;opaqueUrl&#125;"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改集合"><a href="#修改集合" class="headerlink" title="修改集合"></a>修改集合</h3><blockquote>
<p>POST请求不是幂等的。</p>
<p>这意味着发送到具有完全相同的有效负载(payload)的集合资源的两次POST请求可能导致在该集合中创建多个项。</p>
<p>例如，对于具有服务器端生成的id的项的插入操作，通常就是这种情况。</p>
<p>例如，以下请求:</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST https://api.contoso.com/v1.0/people</span><br></pre></td></tr></table></figure>

<blockquote>
<p>会导致响应，指示新集合项的位置：</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">201 Created</span><br><span class="line"><span class="attribute">Location</span>: https://api.contoso.com/v1.0/people/123</span><br></pre></td></tr></table></figure>

<blockquote>
<p>一旦再次执行，可能会导致创建另一个资源：</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">201 Created</span><br><span class="line"><span class="attribute">Location</span>: https://api.contoso.com/v1.0/people/124</span><br></pre></td></tr></table></figure>

<blockquote>
<p>而PUT请求则需要使用相应的键来指示集合项:</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT https://api.contoso.com/v1.0/people/123</span><br></pre></td></tr></table></figure>

<h3 id="集合排序"><a href="#集合排序" class="headerlink" title="集合排序"></a>集合排序</h3><blockquote>
<p>可以基于属性值对集合查询的结果进行排序。</p>
<p>该属性由_$orderBy_查询参数的值确定。</p>
<p><em>$orderBy</em> 参数的值包含用于对项目进行排序表达式列表，用逗号分隔的。</p>
<p>这种表达式的特殊情况是属性路径终止于基本属性。</p>
<p>表达式可以包含升序的后缀“asc”或降序的后缀“desc”，它们与属性名之间用一个或多个空格分隔。</p>
<p>如果没有指定“asc”或“desc”，则服务必须按照指定的属性以升序排序。</p>
<p>空值(NULL)必须排序为“小于”非空值。</p>
<p>必须根据第一个表达式的结果值对项进行排序，然后根据第二个表达式的结果值对第一个表达式具有相同值的项进行排序，以此类推。</p>
<p>排序顺序是属性类型的固有顺序。</p>
<p>例如：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.contoso.com/v1.0/people?$orderBy=name</span><br></pre></td></tr></table></figure>

<blockquote>
<p>将返回按name进行升序排序的所有人员。</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.contoso.com/v1.0/people?$orderBy=name desc</span><br></pre></td></tr></table></figure>

<blockquote>
<p>将返回按name进行降序排序的所有人。</p>
<p>可以通过逗号分隔的属性名称列表以及可选方向限定符来指定子排序。</p>
<p>例如：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.contoso.com/v1.0/people?$orderBy=name desc,hireDate</span><br></pre></td></tr></table></figure>

<blockquote>
<p>将返回按姓名降序排列的所有人员，并按雇佣日期降序排列的次要排序。</p>
<p>排序必须与筛选相结合，如下:</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.contoso.com/v1.0/people?$filter=name eq 'david'&amp;$orderBy=hireDate</span><br></pre></td></tr></table></figure>

<blockquote>
<p>将返回所有名称为David的人，按雇佣日期按升序排列。</p>
</blockquote>
<h4 id="排序表达式的解释"><a href="#排序表达式的解释" class="headerlink" title="排序表达式的解释"></a>排序表达式的解释</h4><blockquote>
<p>跨页面的排序参数必须一致，因为客户端和服务器端分页都依赖该排序该参数进行排序。</p>
<p>如果服务不支持按_$orderBy_表达式中命名的属性排序，则服务必须按照“响应不支持的请求”部分中定义的错误消息进行响应。</p>
</blockquote>
<h3 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h3><blockquote>
<p>$filter_querystring 参数允许客户端通过URL过滤集合。</p>
<p>使用_$filter_指定的表达式将为集合中的每个资源求值，只有表达式求值为true的项才包含在响应中。</p>
<p>表达式计算为false或null的资源，或由于权限而不可用的引用属性，将从响应中省略。</p>
<p>例如:返回所有产品的价格低于10.00美元</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.contoso.com/v1.0/products?$filter=price lt 10.00</span><br></pre></td></tr></table></figure>

<blockquote>
<p>$filter_选项的值是 一个布尔表达式 表示 price less than 10.00。</p>
</blockquote>
<h4 id="过滤运算符"><a href="#过滤运算符" class="headerlink" title="过滤运算符"></a>过滤运算符</h4><blockquote>
<p>支持_$filter_的服务应该支持以下最小操作集。</p>
</blockquote>
<table>
<thead>
<tr>
<th>Operator</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody><tr>
<td>Comparison Operators</td>
<td></td>
<td></td>
</tr>
<tr>
<td>eq</td>
<td>Equal</td>
<td>city eq ‘Redmond’</td>
</tr>
<tr>
<td>ne</td>
<td>Not equal</td>
<td>city ne ‘London’</td>
</tr>
<tr>
<td>gt</td>
<td>Greater than</td>
<td>price gt 20</td>
</tr>
<tr>
<td>ge</td>
<td>Greater than or equal</td>
<td>price ge 10</td>
</tr>
<tr>
<td>lt</td>
<td>Less than</td>
<td>price lt 20</td>
</tr>
<tr>
<td>le</td>
<td>Less than or equal</td>
<td>price le 100</td>
</tr>
<tr>
<td>Logical Operators</td>
<td></td>
<td></td>
</tr>
<tr>
<td>and</td>
<td>Logical and</td>
<td>price le 200 and price gt 3.5</td>
</tr>
<tr>
<td>or</td>
<td>Logical or</td>
<td>price le 3.5 or price gt 200</td>
</tr>
<tr>
<td>not</td>
<td>Logical negation</td>
<td>not price le 3.5</td>
</tr>
<tr>
<td>Grouping Operators</td>
<td></td>
<td></td>
</tr>
<tr>
<td>( )</td>
<td>Precedence grouping</td>
<td>(priority eq 1 or city eq ‘Redmond’) and price gt 100</td>
</tr>
</tbody></table>
<h4 id="运算符实例"><a href="#运算符实例" class="headerlink" title="运算符实例"></a>运算符实例</h4><blockquote>
<p>下面的示例说明了每个逻辑操作符的用法和语义。</p>
<p>示例:所有名称等于“Milk”的产品</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.contoso.com/v1.0/products?$filter=name eq 'Milk'</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例:所有名称不等于“Milk”的产品</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.contoso.com/v1.0/products?$filter=name ne 'Milk'</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例:所有标有“Milk”的产品价格都低于2.55:</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.contoso.com/v1.0/products?$filter=name eq 'Milk' and price lt 2.55</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例:所有标有“Milk”字样或价格低于2.55美元的产品:</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.contoso.com/v1.0/products?$filter=name eq 'Milk' or price lt 2.55</span><br></pre></td></tr></table></figure>

<blockquote>
<p>示例:所有名称为“牛奶”或“鸡蛋”且价格低于2.55的产品:</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.contoso.com/v1.0/products?$filter=(name eq 'Milk' or name eq 'Eggs') and price lt 2.55</span><br></pre></td></tr></table></figure>

<h4 id="运算符优先级"><a href="#运算符优先级" class="headerlink" title="运算符优先级"></a>运算符优先级</h4><blockquote>
<p>在计算_$filter_表达式时，服务使用以下操作符优先级。</p>
<p>操作符按类别按优先级从高到低排列。</p>
<p>同一类别的运算符具有同等优先级:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Group</th>
<th>Operator</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>Grouping</td>
<td>( )</td>
<td>Precedence grouping</td>
</tr>
<tr>
<td>Unary</td>
<td>not</td>
<td>Logical Negation</td>
</tr>
<tr>
<td>Relational</td>
<td>gt</td>
<td>Greater Than</td>
</tr>
<tr>
<td></td>
<td>ge</td>
<td>Greater than or Equal</td>
</tr>
<tr>
<td></td>
<td>lt</td>
<td>Less Than</td>
</tr>
<tr>
<td></td>
<td>le</td>
<td>Less than or Equal</td>
</tr>
<tr>
<td>Equality</td>
<td>eq</td>
<td>Equal</td>
</tr>
<tr>
<td></td>
<td>ne</td>
<td>Not Equal</td>
</tr>
<tr>
<td>Conditional AND</td>
<td>and</td>
<td>Logical And</td>
</tr>
<tr>
<td>Conditional OR</td>
<td>or</td>
<td>Logical Or</td>
</tr>
</tbody></table>
<h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><blockquote>
<p>返回集合的RESTful API可能返回部分集。</p>
<p>这些服务的消费者清楚将获得部分结果集，并能正确地翻页以检索整个结果集。</p>
<p>RESTful API可能支持两种形式的分页。</p>
<p>服务器驱动的分页：通过在多个响应有效载荷上强制分页请求来减轻拒绝服务攻击。</p>
<p>客户端驱动的分页：允许客户机只请求它在给定时间可以使用的资源数量。</p>
<p>跨页面的排序和筛选参数必须一致，因为客户端和服务器端分页都完全兼容于筛选和排序。</p>
</blockquote>
<h4 id="服务端驱动分页"><a href="#服务端驱动分页" class="headerlink" title="服务端驱动分页"></a>服务端驱动分页</h4><blockquote>
<p>分页响应必须通过在响应中包含延续分页标记来告诉客户端这是部分结果。</p>
<p>没有延续分页标记意味着没有下一页了。</p>
<p>客户端必须将延续URL视为不透明的，这意味着在迭代一组部分结果时，查询选项可能不会更改。</p>
<p>例如:</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET http://api.contoso.com/v1.0/people HTTP/1.1</span><br><span class="line">Accept: application/json</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  ...,</span><br><span class="line">  "value": [...],</span><br><span class="line">  "@nextLink": "&#123;opaqueUrl&#125;"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="客户端驱动分页"><a href="#客户端驱动分页" class="headerlink" title="客户端驱动分页"></a>客户端驱动分页</h4><blockquote>
<p>客户端可以使用<em>$top_和</em>$skip_查询参数来指定返回的结果数量和跳过的集合数量。</p>
<p>服务器应遵守客户端指定的参数; 但是，客户端必须做好准备处理包含不同页面大小的响应或包含延续分页标记的响应。</p>
<p>当客户端同时提供<em>$top_和</em>$skip_时，服务器应该首先应用<em>$skip_，然后对集合应用</em>$top_。</p>
<p>注意:如果服务器不能执行<em>$top_和/或</em>$skip_，服务器必须返回一个错误给客户端，告知它，而不是忽略该查询参数。 这将避免客户端对返回的数据做出假设的风险。</p>
<p>实例:</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET http://api.contoso.com/v1.0/people?$top=5&amp;$skip=2 HTTP/1.1</span><br><span class="line">Accept: application/json</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  ...,</span><br><span class="line">  "value": [...]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="其他注意事项"><a href="#其他注意事项" class="headerlink" title="其他注意事项"></a>其他注意事项</h4><blockquote>
<p><strong>固定的顺序先决条件:</strong>两种分页形式都依赖于具有固定顺序的项的集合。</p>
<p>服务器必须使用额外的排序(通常是按键排序)来补充任何指定的顺序标准，以确保项目始终保持一致的顺序。</p>
<p><strong>缺失/重复结果：</strong>即使服务器强制执行一致的排序顺序，结果也可能会因创建或删除其他资源而导致丢失或重复。</p>
<p>客户端必须准备好处理这些差异。</p>
<p>服务器应该总是编码最后读取记录的记录ID，帮助客户端管理重复/丢失的结果。</p>
<p><strong>结合客户端和服务驱动的分页：</strong>请注意，客户端驱动的分页不排除服务器驱动的分页。</p>
<p>如果客户端请求的页面大小大于服务器支持的默认页面大小，则预期响应将是客户端指定的结果数，否则按服务端分页设置的指定分页。</p>
<p><strong>页面大小：</strong>客户端可以通过指定_$maxpagesize_首选项来请求具有特定页面大小的服务端驱动的分页。</p>
<p>如果指定的页面大小小于服务端的默认页面大小，服务器应该遵循此首选项。</p>
<p><strong>分页嵌入式集合：</strong>客户端驱动的分页和服务端驱动的分页都可以应用于嵌入式集合。</p>
<p>如果服务端对嵌入式集合进行分页，则必须包含其他适当的延续分页标记。</p>
<p><strong>记录集计数：</strong>想要知道所有页面中的完整记录数的开发人员可以包含查询参数_$ count=true_，以告知服务端包含响应中的记录数。</p>
</blockquote>
<h3 id="复合集合操作"><a href="#复合集合操作" class="headerlink" title="复合集合操作"></a>复合集合操作</h3><blockquote>
<p>筛选、排序和分页操作都可以针对给定的集合执行。</p>
<p>当这些操作一起执行时，评估顺序必须是:</p>
<ol>
<li><strong>筛选</strong>。这包括作为AND操作执行的所有范围表达式。</li>
<li><strong>排序</strong>。可能已过滤的列表根据排序条件进行排序。</li>
<li><strong>分页</strong>。经过筛选和排序的列表上显示了实现分页视图。这适用于服务器驱动的分页和客户端驱动的分页。</li>
</ol>
</blockquote>
<h2 id="增量查询"><a href="#增量查询" class="headerlink" title="增量查询"></a>增量查询</h2><blockquote>
<p>服务可以选择支持Delta查询。</p>
</blockquote>
<h3 id="增量链接"><a href="#增量链接" class="headerlink" title="增量链接"></a>增量链接</h3><blockquote>
<p>增量(Delta)链接是不透明的、由服务生成的链接，客户端使用这些链接查询对结果的后续更改。</p>
<p>在概念层面上，delta链接基于一个定义查询，该查询描述正在跟踪更改的一组结果集。</p>
<p>delta链接编码并跟踪这些更改的实体集合，以及跟踪更改的起点。</p>
<p>如果查询包含筛选器，则响应必须只包含对匹配指定条件的实体的更改。</p>
<p>Delta查询的主要原则是:</p>
<ul>
<li>集合中的每个项目必须具有持久标识符（永久不变的主键）。该标识符应该表示为“id”。此标识符由服务定义，客户端可以使用该字符串跨调用跟踪对象。</li>
<li>delta 必须包含每个与指定条件新匹配的实体的条目，并且必须为每个不再符合条件的实体包含“@removed”条目。</li>
<li>重新调用查询并将其与原始结果集进行比较; 必须将当前集合中惟一的每个条目作为”add”操作返回，并且必须将原始集合中惟一的每个条目作为“remove”操作返回。</li>
<li>以前与标准不匹配但现在匹配的每个实体必须作为”add”返回; 相反，先前与查询匹配但不再必须返回的每个实体必须作为“@removed”条目返回。</li>
<li>已更改的实体必须使用其标准表示形式包含在集合中。</li>
<li>服务可以向“@remove”节点添加额外的元数据，例如删除的原因或“removed at”时间戳。我们建议团队与Microsoft REST API指导原则工作组协调，以帮助维护一致性。</li>
</ul>
<p>Delta链接不能编码任何客户端 top 或 skip 值。</p>
</blockquote>
<h3 id="实体表示"><a href="#实体表示" class="headerlink" title="实体表示"></a>实体表示</h3><blockquote>
<p>添加和更新的实体使用其标准表示在实体集中表示。</p>
<p>从集合的角度来看，添加或更新的实体之间没有区别。</p>
<p>删除的实体仅使用其“id”和“@removed”节点表示。</p>
<p>“@removed”节点的存在必须表示从集合中删除条目。</p>
</blockquote>
<h3 id="获得增量链接"><a href="#获得增量链接" class="headerlink" title="获得增量链接"></a>获得增量链接</h3><blockquote>
<p>通过查询集合或实体并附加 $delta 查询字符串参数来获得 Delta 链接。</p>
<p>例如：</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.contoso.com/v1.0/people?$delta</span><br><span class="line">HTTP/1.1</span><br><span class="line">Accept: application/json</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"value"</span>:[</span><br><span class="line">    &#123; <span class="attr">"id"</span>: <span class="string">"1"</span>, <span class="attr">"name"</span>: <span class="string">"Matt"</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">"id"</span>: <span class="string">"2"</span>, <span class="attr">"name"</span>: <span class="string">"Mark"</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">"id"</span>: <span class="string">"3"</span>, <span class="attr">"name"</span>: <span class="string">"John"</span>&#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"@deltaLink"</span>: <span class="string">"&#123;opaqueUrl&#125;"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意:如果集合分页，deltaLink将只出现在最后一页，但必须反映对所有页面返回的数据的任何更改。</p>
</blockquote>
<h3 id="增量链接响应内容"><a href="#增量链接响应内容" class="headerlink" title="增量链接响应内容"></a>增量链接响应内容</h3><blockquote>
<p>添加/更新的条目必须以常规JSON对象的形式出现，并带有常规项目属性。</p>
<p>在常规表示中返回添加/修改的项，允许客户端使用基于“id”字段的标准合并概念将它们合并到现有的“缓存”中。</p>
<p>从定义的集合中删除的条目必须包含在响应中。</p>
<p>从集合中删除的项必须仅使用它们的“id”和“@remove”节点表示。</p>
</blockquote>
<h3 id="使用增量链接"><a href="#使用增量链接" class="headerlink" title="使用增量链接"></a>使用增量链接</h3><blockquote>
<p>客户端通过调用delta链接上的GET方法请求更改。</p>
<p>客户端必须按原样使用delta URL——换句话说，客户端不能以任何方式修改URL(例如，解析URL并添加额外的查询字符串参数)。</p>
<p>在这个例子中:</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET https://&#123;opaqueUrl&#125; HTTP/1.1</span><br><span class="line">Accept: application/json</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"value"</span>:[</span><br><span class="line">    &#123; <span class="attr">"id"</span>: <span class="string">"1"</span>, <span class="attr">"name"</span>: <span class="string">"Mat"</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">"id"</span>: <span class="string">"2"</span>, <span class="attr">"name"</span>: <span class="string">"Marc"</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">"id"</span>: <span class="string">"3"</span>, <span class="attr">"@removed"</span>: &#123;&#125; &#125;,</span><br><span class="line">    &#123; <span class="attr">"id"</span>: <span class="string">"4"</span>, <span class="attr">"name"</span>: <span class="string">"Luc"</span>&#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"@deltaLink"</span>: <span class="string">"&#123;opaqueUrl&#125;"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>针对delta链接的请求的结果可以跨多个页面，但是必须由服务跨所有页面进行排序，以便在应用到包含delta链接的响应时确保得到确定的结果。</p>
<p>如果没有发生任何更改，则响应是一个空集合，其中包含一个delta链接，用于根据请求进行后续更改。</p>
<p>这个delta链接可能与delta链接相同，从而导致更改的空集合。</p>
<p>如果delta链接不再有效，则服务必须使用_410 Gone_响应。响应应该包含一个Location头，客户端可以使用它来检索新的基线结果集。</p>
</blockquote>
<h2 id="JSON标准化"><a href="#JSON标准化" class="headerlink" title="JSON标准化"></a>JSON标准化</h2><h3 id="基本类型的JSON格式标准化"><a href="#基本类型的JSON格式标准化" class="headerlink" title="基本类型的JSON格式标准化"></a>基本类型的JSON格式标准化</h3><blockquote>
<p>基本类型必须按照[RFC8259]的规则序列化为JSON。</p>
<p>对于64位(bit)的重要说明：JavaScript会自动截断大于Number.MAX_SAFE_INTEGER（2^53-1）或小于Number.MIN_SAFE_INTEGER (-2^53+1)的整数。如果希望服务返回安全值范围之外的整数，则要着重考虑将值作为字符串返回，以最大程度的提高互操作性并避免数据丢失。</p>
</blockquote>
<h3 id="日期和时间指南"><a href="#日期和时间指南" class="headerlink" title="日期和时间指南"></a>日期和时间指南</h3><h4 id="创建日期"><a href="#创建日期" class="headerlink" title="创建日期"></a>创建日期</h4><blockquote>
<p>服务必须使用DateLiteral格式生成日期，并且应该使用Iso8601Literal格式，除非有其他不得已的原因。使用StructuredDateLiteral格式的服务不得T类型生成日期，除非同时要求附加精度并且明确不支持ECMAScript客户端。（非规范性声明：在确定要对哪个特定的DateKind标准化时，优先级的顺序为E，C，U，W，O，X，I，T。改命令会针对ECMAScript、.NET、C++程序员做优化）</p>
</blockquote>
<h4 id="使用日期"><a href="#使用日期" class="headerlink" title="使用日期"></a>使用日期</h4><blockquote>
<p>服务必须接受其客户端使用相同的DateLiteral格式（包括DateKind）产生的日期，并且应接受使用任何DateLiteral格式的日期。</p>
</blockquote>
<h4 id="兼容日期"><a href="#兼容日期" class="headerlink" title="兼容日期"></a>兼容日期</h4><blockquote>
<p>服务必须针对相同类型的所有资源使用相同的DateLiteral格式（如果适用，也包括DateKind），并且应针对整个服务中的所有资源使用相同的DateLiteral格式（如果适用，也包括DateKind）。</p>
<p>服务所产生的对DateLiteral格式的任何更改（如果适用，也包括DateKind）以及服务接受的DateLiteral格式的减少（如果使用，也包括DateKind）都必须为重大更改。服务接受的DateLiteral格式的任何扩展均不视为重大更改。</p>
</blockquote>
<h3 id="日期和时间的JSON序列化"><a href="#日期和时间的JSON序列化" class="headerlink" title="日期和时间的JSON序列化"></a>日期和时间的JSON序列化</h3><blockquote>
<p>正反序列化日期是JSON的一大难题，尽管ECMAScript支持大多数内置类型的文字，但它并未定义日期的文字格式。Web已经合并了ISO8601日期格式的ECMAScript子集，但在某些情况下，此格式是不可取的。对于这些情况，本文档定义了JSON序列化格式，可用于明确表示不同格式的日期。其他序列化格式（例如XML）也可以从该格式派生。</p>
</blockquote>
<h4 id="DateLiteral-格式"><a href="#DateLiteral-格式" class="headerlink" title="DateLiteral 格式"></a>DateLiteral 格式</h4><blockquote>
<p>JSON表示的日期使用以下语法进行序列化。非正式地，DateValue是ISO8601格式的字符串或JSON对象，其中包含两个名为kind和value的属性，他们共同定义了一个时间点。以下不是上下文无关的域大；特别是，DateValue的解释取决于DateKind的值，但这可以最大程度地减少描述该格式所需的生产数量。</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">DateLiteral:</span><br><span class="line">  Iso8601Literal</span><br><span class="line">  StructuredDateLiteral</span><br><span class="line"></span><br><span class="line">Iso8601Literal:</span><br><span class="line">  A string literal as defined in http://www.ecma-international.org/ecma-262/5.1/#sec-15.9.1.15. Note that the full grammar for ISO 8601 (such as "basic format" without separators) is not supported.</span><br><span class="line">  All dates default to UTC unless specified otherwise.</span><br><span class="line"></span><br><span class="line">StructuredDateLiteral:</span><br><span class="line">  &#123; DateKindProperty , DateValueProperty &#125;</span><br><span class="line">  &#123; DateValueProperty , DateKindProperty &#125;</span><br><span class="line"></span><br><span class="line">DateKindProperty</span><br><span class="line">  "kind" : DateKind</span><br><span class="line"></span><br><span class="line">DateKind:</span><br><span class="line">  "C"            ; see below</span><br><span class="line">  "E"            ; see below</span><br><span class="line">  "I"            ; see below</span><br><span class="line">  "O"            ; see below</span><br><span class="line">  "T"            ; see below</span><br><span class="line">  "U"            ; see below</span><br><span class="line">  "W"            ; see below</span><br><span class="line">  "X"            ; see below</span><br><span class="line"></span><br><span class="line">DateValueProperty:</span><br><span class="line">  "value" : DateValue</span><br><span class="line"></span><br><span class="line">DateValue:</span><br><span class="line">  UnsignedInteger        ; not defined here</span><br><span class="line">  SignedInteger        ; not defined here</span><br><span class="line">  RealNumber        ; not defined here</span><br><span class="line">  Iso8601Literal        ; as above</span><br></pre></td></tr></table></figure>



<h4 id="日期格式的注释"><a href="#日期格式的注释" class="headerlink" title="日期格式的注释"></a>日期格式的注释</h4><blockquote>
<p>使用ISO8601的Literal生成的DateLiteral相对简单，这是一个对象的示例，该对象具有一个名为creationDate的属性，该属性设置为2015年2月13日下午1:15。世界标准时间：</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">"creationDate"</span> : <span class="string">"2015-02-13T13:15Z"</span> &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>StructuredDateLiteral由一个DateKind和一个伴随的DateValue组成，其有效值取决于DateKind，下面描述了有效的组合及其含义：</p>
</blockquote>
<table>
<thead>
<tr>
<th>DateKind</th>
<th>DateValue</th>
<th>Colloquial Name &amp; Interpretation</th>
<th>More Info</th>
</tr>
</thead>
<tbody><tr>
<td>C</td>
<td>UnsignedInteger</td>
<td>“CLR”; number of milliseconds since midnight January 1, 0001; negative values are not allowed. <em>See note below.</em></td>
<td><a href="https://msdn.microsoft.com/en-us/library/System.DateTime(v=vs.110).aspx" target="_blank" rel="noopener">MSDN</a></td>
</tr>
<tr>
<td>E</td>
<td>SignedInteger</td>
<td>“ECMAScript”; number of milliseconds since midnight, January 1, 1970.</td>
<td><a href="http://www.ecma-international.org/ecma-262/5.1/#sec-15.9.1.1" target="_blank" rel="noopener">ECMA International</a></td>
</tr>
<tr>
<td>I</td>
<td>Iso8601Literal</td>
<td>“ISO 8601”; a string limited to the ECMAScript subset.</td>
<td></td>
</tr>
<tr>
<td>O</td>
<td>RealNumber</td>
<td>“OLE Date”; integral part is the number of days since midnight, December 31, 1899, and fractional part is the time within the day (0.5 = midday).</td>
<td><a href="https://docs.microsoft.com/en-us/windows/desktop/api/oleauto/nf-oleauto-varianttimetosystemtime" target="_blank" rel="noopener">MSDN</a></td>
</tr>
<tr>
<td>T</td>
<td>SignedInteger</td>
<td>“Ticks”; number of ticks (100-nanosecond intervals) since midnight January 1, 1601. <em>See note below.</em></td>
<td><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms724290(v=vs.85).aspx" target="_blank" rel="noopener">MSDN</a></td>
</tr>
<tr>
<td>U</td>
<td>SignedInteger</td>
<td>“UNIX”; number of seconds since midnight, January 1, 1970.</td>
<td><a href="https://msdn.microsoft.com/en-us/library/1f4c8f33.aspx" target="_blank" rel="noopener">MSDN</a></td>
</tr>
<tr>
<td>W</td>
<td>SignedInteger</td>
<td>“Windows”; number of milliseconds since midnight January 1, 1601. <em>See note below.</em></td>
<td><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms724290(v=vs.85).aspx" target="_blank" rel="noopener">MSDN</a></td>
</tr>
<tr>
<td>X</td>
<td>RealNumber</td>
<td>“Excel”; as for <code>O</code> but the year 1900 is incorrectly treated as a leap year, and day 0 is “January 0 (zero).”</td>
<td><a href="http://support.microsoft.com/kb/214326?wa=wsignin1.0" target="_blank" rel="noopener">Microsoft Support</a></td>
</tr>
</tbody></table>
<blockquote>
<p>对于C和W类型的重要说明：本地CLR和Windows时间用100纳米傲地“刻度”值来表示。为了与精度有限的ECMAScript客户端精选互操作，当（反）序列化为DateLiteral时，这些值必须在毫秒之间转换。一毫秒等于1000滴答声。</p>
<p>对于T类型的重要说明：这种类型保留了Windows本机时间格式的全部保真度（并且可以轻松地与本机CLR格式进行转换），但与ECMAScript客户端不兼容。因此，它的使用应仅限于既需要更好的精度又不需要与ECMAScript客户端进行互操作的场景。</p>
<p>这是一个对象的示例，该对象具有一个名为creationDate的属性，该属性设置为2015年2月13日下午1:15 UTC，使用几下格式：</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123; <span class="attr">"creationDate"</span> : &#123; <span class="attr">"kind"</span> : <span class="string">"O"</span>, <span class="attr">"value"</span> : <span class="number">42048.55</span> &#125; &#125;,</span><br><span class="line">  &#123; <span class="attr">"creationDate"</span> : &#123; <span class="attr">"kind"</span> : <span class="string">"E"</span>, <span class="attr">"value"</span> : <span class="number">1423862100000</span> &#125; &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>将值与种类分来的好处之一是，一旦客户知道特定服务使用的种类，便可以解释该值而无需任何其他解析。在值通常为数字的情况下，这使得开发人员更容易编写代码：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// We know this service always gives out ECMAScript-format dates</span><br><span class="line">var date = new Date(serverResponse.someObject.creationDate.value);</span><br></pre></td></tr></table></figure>

<h3 id="持续时间"><a href="#持续时间" class="headerlink" title="持续时间"></a>持续时间</h3><blockquote>
<p>持续时间需要按照IISO8601进行序列化。持续时间以格式P[n]Y[n]M[n]DT[n]H[n]M[n]S表示”，从标准：</p>
<ul>
<li>P是放置在持续时间表示开始处的持续时间指示符（也称为”周期“）</li>
<li>Y是跟随年份值的年份指示符</li>
<li>M是跟随月份数的月份指示符</li>
<li>D是跟随天数值的天数指示符</li>
<li>T是在表示的时间成分之前的时间指示符</li>
<li>H是跟随小时数的值的小时指示符</li>
<li>M是分钟数值后面的分钟指示符</li>
<li>S是跟随描述的第二个指示符</li>
</ul>
<p>例如，”P3Y6M4DT12H30M5S“表示持续时间为”三年，六个月，四天，十二小时，三十分钟五秒“</p>
</blockquote>
<h3 id="间隔"><a href="#间隔" class="headerlink" title="间隔"></a>间隔</h3><blockquote>
<p>间隔定义为ISO8601的一部分。</p>
<ul>
<li>开始和结束，例如”2007-03-01T13:00:00Z/2008-05-11T15:30:00Z“</li>
<li>开始时间和持续时间，例如”2007-03-01T13:00:00Z/P1Y2M10DT2H30M“</li>
<li>持续时间和结束时间，例如”P1Y2M10DT2H30M/2008-05-11T15:30:00Z“</li>
<li>仅持续时间，例如”P1Y2M10DT2H30M“，以及其他上下文信息</li>
</ul>
</blockquote>
<h3 id="重复间隔"><a href="#重复间隔" class="headerlink" title="重复间隔"></a>重复间隔</h3><blockquote>
<p>重复间隔是ISO8601的一部分：</p>
<blockquote>
<p>Formed by adding “R[n]/“ to the beginning of an interval expression, where R is used as the letter itself and [n] is replaced by the number of repetitions. Leaving out the value for [n] means an unbounded number of repetitions.</p>
</blockquote>
<p>例如，要从”2008-03-01 T 13:00:00 Z“开始重复五次”P1Y2M10DT2H30M“间隔，使用”R5/2008-03-01T13:00:00Z/P1Y2M10DT2H30M“</p>
</blockquote>
<h2 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h2><blockquote>
<p>所有符合Microsoft REST API标准的API都必须支持显式版本控制。客户端可以依靠服务保持稳定是至关重要的，服务可以添加功能并进行更改也至关重要。</p>
</blockquote>
<h3 id="版本格式"><a href="#版本格式" class="headerlink" title="版本格式"></a>版本格式</h3><blockquote>
<p>使用Major.Minor版本控制方案对服务进行版本控制。服务可以选择”仅主要“版本方案，在这种情况下暗含”.0”,并且本节中的所有其他规则均使用。支持两种用于指定REST API请求版本的选项：</p>
<p>嵌入在请求URL路径中，位于服务根目录的末尾：</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">https://api.contoso.com/v1.0/products/users</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>作为URL的查询字符串参数：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.contoso.com/products/users?api-version=1.0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在两个选择之间进行选择的规则如下：</p>
<ol>
<li>共同位于DNS端点后面的服务必须使用相同的版本控制机制</li>
<li>在这种情况下，跨端点的一致用户体验至关重要。Microsoft REST API准则工作组建议在未与组织领导团队进行明确对话的情况下，不要创建新的顶级DNS终结点。</li>
<li>保证其REST API的URL路径稳定的服务，即使通过API的未来版本，也可以采用查询字符串参数机制。这意味着在API交付后，API中描述的关系的命名和结构就无法发展，即使是在具有重大更改的版本之间也是如此。</li>
<li>无法确保未来版本中URL路径稳定性的服务必须将版本嵌入URL路径中。</li>
</ol>
<p>某些基础服务，如Microsoft的Azure Active Directory可能暴露于多个终结点之后。这样的服务必须支持每个端点的版本控制机制，即使这意味着支持多种版本控制机制。</p>
</blockquote>
<h4 id="组版本控制"><a href="#组版本控制" class="headerlink" title="组版本控制"></a>组版本控制</h4><blockquote>
<p>组版本控制是一种可选功能，可以使用查询字符串参数机制在服务上提供。组版本允许在通用版本名称下对API端点进行逻辑分组。这使开发人员可以查找单个版本号，并在多个端点之间使用它。组版本号是众所周知的，服务应该拒绝任何无法识别的值。</p>
<p>在内部，服务将采用组版本并将其映射到适当的Major.Minor版本。</p>
<p>组本版格式定义为YYYY-MM-DD，例如2012年12月7日为2012-12-07.此日期版本格式仅适用组版本，不应该作为Major.Minor版本的替代。</p>
<p>组版本示例：</p>
</blockquote>
<table>
<thead>
<tr>
<th>Group</th>
<th>Major.Minor</th>
</tr>
</thead>
<tbody><tr>
<td>2012-12-01</td>
<td>1.0</td>
</tr>
<tr>
<td></td>
<td>1.1</td>
</tr>
<tr>
<td></td>
<td>1.2</td>
</tr>
<tr>
<td>2013-03-21</td>
<td>1.0</td>
</tr>
<tr>
<td></td>
<td>2.0</td>
</tr>
<tr>
<td></td>
<td>3.0</td>
</tr>
<tr>
<td></td>
<td>3.1</td>
</tr>
<tr>
<td></td>
<td>3.2</td>
</tr>
<tr>
<td></td>
<td>3.3</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>Version Format</th>
<th>Example</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody><tr>
<td>{groupVersion}</td>
<td>2013-03-21, 2012-12-01</td>
<td>3.3, 1.2</td>
</tr>
<tr>
<td>{majorVersion}</td>
<td>3</td>
<td>3.0</td>
</tr>
<tr>
<td>{majorVersion}.{minorVersion}</td>
<td>1.2</td>
<td>1.2</td>
</tr>
</tbody></table>
<blockquote>
<p>客户端可以具体说明组版本或者Major.Minor版本：</p>
<p>例如：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET http://api.contoso.com/acct1/c1/blob2?api-version=1.0</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT http://api.contoso.com/acct1/c1/b2?api-version=2011-12-07</span><br></pre></td></tr></table></figure>

<h3 id="版本时间"><a href="#版本时间" class="headerlink" title="版本时间"></a>版本时间</h3><blockquote>
<p> 服务必须响应任何重大的API更改而增加其版本号。有关构成突变的内容的详细讨论，请参见以下部分。如果需要，服务也可以增加其版本号以进行不间断的更改。</p>
<p>使用新的主要版本号表示将来不再支持现有客户端。引入新的主要版本时，服务必须为现有客户提供清晰的升级路径，并制定与其业务组策略一致的弃用计划。服务应将新的次要版本号用于所有其他更改。</p>
<p>版本化服务的在线文档必须指出每个先前API版本的当前支持状态，并提供最新版本的路径。</p>
</blockquote>
<h3 id="重大变化的定义"><a href="#重大变化的定义" class="headerlink" title="重大变化的定义"></a>重大变化的定义</h3><blockquote>
<p>对于API约定的更改被视作重大更改，影响API向后兼容性的更改是一项重大更改。</p>
<p>团队可以根据他们的业务需求定义向后的兼容性。例如，Azure将响应中的新JSON字段定义为不向后兼容。Office365具有向后兼容性的较宽松的定义，并允许将JSON字段添加到响应中。</p>
<p>重大更改更清晰的示例：</p>
<ol>
<li>删除或重命名API或者参数</li>
<li>现有API的行为的更改</li>
<li>错误代码或故障约定的变更</li>
<li>任何违反最小意外原则的东西</li>
</ol>
<p>服务务必明确定义其重大更改的定义，尤其是在向JSON响应中添加新字段以及使用默认字段添加新API参数方面。与其他服务一起位于DNS端点后面的服务在定义合同可扩展性时必须保持一致。</p>
<p>本节中描述的OData V4规范适用更改应被视为所有服务必须考虑的重大更改的最低要求的一部分。</p>
</blockquote>
<h2 id="长时间运行的操作"><a href="#长时间运行的操作" class="headerlink" title="长时间运行的操作"></a>长时间运行的操作</h2><blockquote>
<p>长时间运行的操作（有时称为异步操作）对不同的人以为着不同的意思，本节针对不同类型的长时间运行设置了指南，并介绍了这些类型的操作的线路协议和最佳实践。</p>
<ol>
<li>一个或多个客户端必须能够同时监视和操作同一资源。</li>
<li>系统状态应始终可发现和可测试。即使操作跟踪资源不再处于活动状态，客户端也应该能够确定系统状态。查询长时间运行状态的操作本身应该利用网络原理。即具有统一接口语义的定义明确的资源。客户端可以在某些资源上发出GET来确定长时间运行的状态。</li>
<li>长期运行的操作应该为希望”解雇“的客户以及希望积极监控结果并根据结果采取行动的客户服务。</li>
<li>取消并不明确意味着回滚。在按API定义的情况下，这可能意味这回滚、补偿、完成或部分完成等。在取消操作之后，客户不应该将服务返回到允许继续服务的一致状态的责任。</li>
</ol>
</blockquote>
<h3 id="基于资源的长时间运行（RELO）"><a href="#基于资源的长时间运行（RELO）" class="headerlink" title="基于资源的长时间运行（RELO）"></a>基于资源的长时间运行（RELO）</h3><blockquote>
<p>基于资源的建模是将操作的状态编码在资源中，并且所使用的有限协议是标准同步协议。在此模型中，状态转移定义明确，目标状态定义类似。</p>
<p>对于长时间运行的操作，这是首选模型，应尽可能使用它。避免了LRO Wire Protocol的复杂性和机制i，对于我们的用户和工具链而言，事情就变得更加简单。</p>
<p>一个示例可能是计算机重新引导，该操作本身同步完成，但是虚拟机资源上的GET操作将具有”状态：正在重新引导”，“状态：正在运行”，可以随时查询。</p>
<p>该模型可以集成推送通知。</p>
<p>尽管大多数操作可能是POST语义，但除POST语义外，服务可以通过路由支持的PUT语义以简化其API。例如：想要创建一个名为“db1”的数据库的用户可以调用：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT https://api.contoso.com/v1.0/databases/db1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在这种情况下，数据库正在处理PUT操作。</p>
<p>服务也可以使用下面定义的混合</p>
</blockquote>
<h3 id="分步运行长时运行"><a href="#分步运行长时运行" class="headerlink" title="分步运行长时运行"></a>分步运行长时运行</h3><blockquote>
<p>分步操作是一种需要很长时间（通常是不可预测的）的时间来完成的操作，并且不提供在资源中建模的状态转换。本节概述了服务应该使用的方法来公开这些长时间运行的操作。</p>
<p>服务可以公开逐步操作。</p>
<blockquote>
<p>Stepwise Long Running Operations are sometimes called “Async” operations. This causes confusion, as it mixes elements of platforms (“Async / await”, “promises”, “futures”) with elements of API operation. This document uses the term “Stepwise Long Running Operation” or often just “Stepwise Operation” to avoid confusion over the word “Async”.</p>
</blockquote>
<p>服务必须对分步请求执行尽可能多的同步验证。服务必须以同步方式确定返回错误的优先级，目标是使用长时间运行的操作有线协议仅处理”有效“操作。</p>
<p>对于定义为分步长时间运行操作的API，即使该操作可以立即完成，服务也必须经过分步长期运行操作流程。换句话说，API必须采用并坚持LRO模式，并且不得根据情况更改模式。</p>
</blockquote>
<h4 id="PUT"><a href="#PUT" class="headerlink" title="PUT"></a>PUT</h4><blockquote>
<p>服务可以启用用于实体创建的PUT情况。</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT https://api.contoso.com/v1.0/databases/db1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在这种情况下，数据库正在处理PUT操作。</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">202</span> Accepted</span><br><span class="line"><span class="attribute">Operation-Location</span>: https://api.contoso.com/v1.0/operations/123</span><br></pre></td></tr></table></figure>

<blockquote>
<p>对于需要返回此处创建201的服务，请使用下面描述的混合流程。</p>
<p>202已接受不返回任何正文，201Created案例应该返回目标资源的主体。</p>
</blockquote>
<h4 id="POST-1"><a href="#POST-1" class="headerlink" title="POST"></a>POST</h4><blockquote>
<p>服务可以启用用于实体创建的POST请求。</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST https://api.contoso.com/v1.0/databases/</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "fileName": "someFile.db",</span><br><span class="line">  "color": "red"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">202</span> Accepted</span><br><span class="line"><span class="attribute">Operation-Location</span>: https://api.contoso.com/v1.0/operations/123</span><br></pre></td></tr></table></figure>

<h4 id="POST-混合模式"><a href="#POST-混合模式" class="headerlink" title="POST, 混合模式"></a>POST, 混合模式</h4><blockquote>
<p>服务可以对创建资源的集合的POST请求进行同步响应，即使在生成响应时资源没有完全创建。为了使用这种模式，响应必须包含不完整资源的表示和不完整资源的指示。</p>
<p>例如：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">https://api.contoso.com/v1.0/databases/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: api.contoso.com</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="attribute">Accept</span>: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "fileName": "someFile.db",</span><br><span class="line">  "color": "red"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>服务响应说数据库已经创建，但是通过包含Operation-Location标头指示请求未完成。在这种情况下，响应有负载中的status属性还指示该操作尚未完全完成。</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">201</span> Created</span><br><span class="line"><span class="attribute">Location</span>: https://api.contoso.com/v1.0/databases/db1</span><br><span class="line"><span class="attribute">Operation-Location</span>: https://api.contoso.com/v1.0/operations/123</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "databaseName": "db1",</span><br><span class="line">  "color": "red",</span><br><span class="line">  "Status": "Provisioning",</span><br><span class="line">  [ … other fields for "database" …]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="运作资源"><a href="#运作资源" class="headerlink" title="运作资源"></a>运作资源</h4><blockquote>
<p>服务可以在租户级别提供’/operations’资源。</p>
<p>提供”/operations”资源的服务必须提供GET语义。GET必须枚举遵循标准分页、排序和过滤语义的操作集。此操作的默认排序顺序必须为：</p>
</blockquote>
<table>
<thead>
<tr>
<th>Primary Sort</th>
<th>Secondary Sort</th>
</tr>
</thead>
<tbody><tr>
<td>Not Started Operations</td>
<td>Operation Creation Time</td>
</tr>
<tr>
<td>Running Operations</td>
<td>Operation Creation Time</td>
</tr>
<tr>
<td>Completed Operations</td>
<td>Operation Creation Time</td>
</tr>
</tbody></table>
<blockquote>
<p>请注意：“完成的操作”是目标状态（参见下文），实际上可以是几种不同的状态中的任何一种，例如“成功”、“已取消”、“失败”等。</p>
</blockquote>
<h4 id="运作资源-1"><a href="#运作资源-1" class="headerlink" title="运作资源"></a>运作资源</h4><blockquote>
<p>操作是用户可寻址资源，它跟踪逐步进行的逐步操作。操作必须支持GET语义，针对某个操作的GET操作务必返回：</p>
<ol>
<li>操作资源，其状态以及与特定API相关的任何扩展状态。</li>
<li>200 OK作为响应代码。</li>
</ol>
<p>服务可以通过在操作上暴露DELETE来支持取消操作。如果支持，则删除操作必须是等幂的。</p>
<blockquote>
<p>Note: From an API design perspective, cancellation does not explicitly mean rollback. On a per-API defined case it may mean rollback, or compensation, or completion, or partial completion, etc. Following a cancelled operation, It SHOULD NOT be a client’s responsibility to return the service to a consistent state which allows continued service.</p>
</blockquote>
<p>不支持取消操作的服务必须在发生DELETE时返回 405 Method Not Allowed.</p>
<p>操作必须支持以下状态：</p>
<ol>
<li>NotStarted</li>
<li>Running</li>
<li>Succeeded. Terminal State</li>
<li>Failed. Terminal State</li>
</ol>
<p>服务可以添加其他状态，例如“已取消”或“部分完成”。支持取消的服务必须充分描述其取消，以便可以准确地确定系统状态，并且可以运行任何补偿操作。</p>
<p>支持其他状态的服务应考虑一下规范名称列表，并尽可能避免创建新的名称：正在取消、已取消、正在中止、已中止、终止、正在删除、已删除。</p>
<p>一个操作必须包含以下信息，并在GET响应中提供以下信息：</p>
<ol>
<li>创建操作的时间戳。</li>
<li>输入当前状态的时间戳。</li>
<li>操作状态（未启动/正在运行/已完成）。</li>
</ol>
<p>服务可以在操作中添加其他特定于API的字段。返回的操作状态JSON如下：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "createdDateTime": "2015-06-19T12-01-03.45Z",</span><br><span class="line">  "lastActionDateTime": "2015-06-19T12-01-03.45Z",</span><br><span class="line">  "status": "notstarted | running | succeeded | failed"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="完成百分比"><a href="#完成百分比" class="headerlink" title="完成百分比"></a>完成百分比</h5><blockquote>
<p>有时，服务将无法完全准确地知道操作何时完成，这使得使用Retry-After标头有问题。在这种情况下，服务可以在oprationStatus JSON中包含完成百分比字段。</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "createdDateTime": "2015-06-19T12-01-03.45Z",</span><br><span class="line">  "percentComplete": "50",</span><br><span class="line">  "status": "running"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在此示例中，服务器已向客户端指示长时间运行的操作已完成50%</p>
</blockquote>
<h5 id="目标资源位置"><a href="#目标资源位置" class="headerlink" title="目标资源位置"></a>目标资源位置</h5><blockquote>
<p>对于产生或操纵资源的操作，服务必须在操作完成后的状态中包含目标资源位置。</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "createdDateTime": "2015-06-19T12-01-03.45Z",</span><br><span class="line">  "lastActionDateTime": "2015-06-19T12-06-03.0024Z",</span><br><span class="line">  "status": "succeeded",</span><br><span class="line">  "resourceLocation": "https://api.contoso.com/v1.0/databases/db1"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="操作终止"><a href="#操作终止" class="headerlink" title="操作终止"></a>操作终止</h4><blockquote>
<p>服务可以选择支持逻辑删除操作，服务可以在服务定义的一段时间后选择删除逻辑删除。</p>
</blockquote>
<h4 id="典型流程：轮询"><a href="#典型流程：轮询" class="headerlink" title="典型流程：轮询"></a>典型流程：轮询</h4><blockquote>
<ul>
<li>客户端通过使用POST调用动作来调用逐步操作</li>
<li>服务器必须通过响应202接受的状态码来指示请求已开始。响应应该包含位置标头，该标头包含一个URL，客户端应该等待Retry-After标头中指定的秒数后，客户端应该轮询结果。</li>
<li>客户端轮询该位置，直到收到带有终端操作状态的200响应</li>
</ul>
<p>轮询的示例：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">https://api.contoso.com/v1.0/databases</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Accept</span>: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "fromFile": "myFile.db",</span><br><span class="line">  "color": "red"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>服务器响应指示请求已创建</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">202</span> Accepted</span><br><span class="line"><span class="attribute">Operation-Location</span>: https://api.contoso.com/v1.0/operations/123</span><br></pre></td></tr></table></figure>

<blockquote>
<p>客户端等待一段时间，然后调用另一个请求以尝试获取操作状态</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.contoso.com/v1.0/operations/123</span><br><span class="line"><span class="attribute">Accept</span>: application/json</span><br></pre></td></tr></table></figure>

<blockquote>
<p>服务器响应结果仍未准备好，可以选择提供建议以等待30秒</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Retry-After</span>: 30</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "createdDateTime": "2015-06-19T12-01-03.4Z",</span><br><span class="line">  "status": "running"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>客户端等待建议的30秒，然后调用另一个请求以获取操作结果</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.contoso.com/v1.0/operations/123</span><br><span class="line"><span class="attribute">Accept</span>: application/json</span><br></pre></td></tr></table></figure>

<blockquote>
<p>服务端以包含资源位置的“status:succeeded”操作进行响应</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "createdDateTime": "2015-06-19T12-01-03.45Z",</span><br><span class="line">  "lastActionDateTime": "2015-06-19T12-06-03.0024Z",</span><br><span class="line">  "status": "succeeded",</span><br><span class="line">  "resourceLocation": "https://api.contoso.com/v1.0/databases/db1"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="典型流程：推送通知"><a href="#典型流程：推送通知" class="headerlink" title="典型流程：推送通知"></a>典型流程：推送通知</h4><blockquote>
<ol>
<li>客户端通过使用POST调用操作来调用长时间运行的操作。客户端已经在父资源上设置了推送通知</li>
<li>该服务通过响应202接受的状态码来指示请求已经开始。客户端忽略所有其他内容</li>
<li>完成整体操作后，服务将通过订阅在父资源上推送通知</li>
<li>客户端通过资源URL获取操作结果</li>
</ol>
<p>推送通知到现有订阅的示例：</p>
<p>客户端调用备份操作，客户端已经为db1设置了推送通知订阅。</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">https://api.contoso.com/v1.0/databases/db1?backup</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Accept</span>: application/json</span><br></pre></td></tr></table></figure>

<blockquote>
<p>服务器响应指示该请求已被接受</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">202</span> Accepted</span><br><span class="line"><span class="attribute">Operation-Location</span>: https://api.contoso.com/v1.0/operations/123</span><br></pre></td></tr></table></figure>

<blockquote>
<p>调用方将忽略返回中的所有标头。</p>
<p>操作完成后，目标URL会收到推送通知。</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "value": [</span><br><span class="line">    &#123;</span><br><span class="line">      "subscriptionId": "1234-5678-1111-2222",</span><br><span class="line">      "context": "subscription context that was specified at setup",</span><br><span class="line">      "resourceUrl": "https://api.contoso.com/v1.0/databases/db1",</span><br><span class="line">      "userId" : "contoso.com/user@contoso.com",</span><br><span class="line">      "tenantId" : "contoso.com"</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="重试机制"><a href="#重试机制" class="headerlink" title="重试机制"></a>重试机制</h4><blockquote>
<p>在上面的示例中，”Retry-After“标头指示客户端尝试从位置标头标识的URL获取结果之前应等待的秒数。</p>
<p>HTTP规范允许Retry-After标头替代性地指定HTTP日期，因此客户端也应准备好处理此日期。</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">202</span> Accepted</span><br><span class="line"><span class="attribute">Operation-Location</span>: http://api.contoso.com/v1.0/operations/123</span><br><span class="line"><span class="attribute">Retry-After</span>: 60</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：HTTP日期的使用与本文档中使用的ISO8601日期格式不一致，但由[RFC 7231]中的HTTP标准明确定义。服务应该首选整数秒格式而不是HTTP日期格式。</p>
</blockquote>
<h3 id="操作结果保留策略"><a href="#操作结果保留策略" class="headerlink" title="操作结果保留策略"></a>操作结果保留策略</h3><blockquote>
<p>在某些情况下，长时间运行的结果不是可以解决的资源。例如，如果您调用一个长时间运行的Action，该Action返回一个boolean（而不是资源），在这些情况下，Location标头指向可以检索布尔结果的位置。</p>
<p>这就有人提出了问题了”操作结果应该保留多长时间？“</p>
<p>建议最短保留时间为24小时。</p>
<p>在从系统中清除之前，应该将操作过度到”逻辑删除“一段额外的时间。</p>
</blockquote>
<h2 id="节流、配额、限制"><a href="#节流、配额、限制" class="headerlink" title="节流、配额、限制"></a>节流、配额、限制</h2><h3 id="原则"><a href="#原则" class="headerlink" title="原则"></a>原则</h3><blockquote>
<p>服务应尽可能具有响应性，以免阻止呼叫者。根据经验，在第99个百分位数中，任何预期花费超过0.5秒的API调用都应考虑对这些调用使用长时间运行模式。显然，面对来自呼叫者的无限负载，服务无法保证这些响应时间，因此，服务应设计和记录客户的呼叫请求限制，并在超出这些限制时以适当的可操作错误和错误消息进行响应。服务通常在超载时以错误快速响应，而不是简单地缓慢响应。最后，胡多服务将具有通话配额，可能是每小时或每天进行多次操作，服务还必须提供立即可操作的错误。配额和限制应限制在一个客户单位范围内：订阅、组合、应用程序、计划或没有任何其他表示的IP地址范围等等视服务目标而定，以便正确分担负载和一个单位不干扰他人</p>
</blockquote>
<h3 id="返回值（429-vs-503）"><a href="#返回值（429-vs-503）" class="headerlink" title="返回值（429 vs 503）"></a>返回值（429 vs 503）</h3><blockquote>
<p>HTTP为了这些情况指定了两个返回码：”429 太多请求“ 和 ”503 服务不可用“。如果客户调用太多次请求，服务可以使用429，并且可以童工更改其通话方式来解决这种情况。如果一般的负载或个别调用者无法控制的问题导致服务变慢，则服务应该以503响应。在所有情况下，服务还应该提供建议调用者等待多长时间才能再次尝试的信息。客户端应该尊重这些标头，并实施其他瞬态故障处理技术。但是，可能有一些客户端仅在故障时立即重试，从而可能增加服务的负载。为了解决这个问题，服务应该设计成使得返回429或者503尽可能方便，方式是输入特殊的快速路径代码，或者理想情况下，取决于提供此功能的通用前门或负载平衡器</p>
</blockquote>
<h3 id="重试机制和-RateLimit-头"><a href="#重试机制和-RateLimit-头" class="headerlink" title="重试机制和 RateLimit 头"></a>重试机制和 RateLimit 头</h3><blockquote>
<p>Retry-After标头是响应受到限制的客户端的标准方法，在限制和配额（但不是整个系统负载）的情况下，使用标头描述超出限制也很常见，但是可选的。但是，为此，Microsoft和整个行业中的服务使用各种不同的标头，我们建议使用三个标头来描述限制，限制之下的剩余调用数量以及限制将重重置的时间。但是，其他标头可能适用于特定类型的限制。在所有情况下，这些都必须记录在案</p>
</blockquote>
<h3 id="服务端指南"><a href="#服务端指南" class="headerlink" title="服务端指南"></a>服务端指南</h3><blockquote>
<p>服务应根据SLA或业务目标选择合适的时间窗口。对于”配额“，在“Retry-After”时间和时间窗口可能会很长（小时、天、周、甚至数月），服务使用429指示特定的调用者调用了太多次，使用503指示该服务正在减少负载，但这不是调用者的问题</p>
</blockquote>
<h4 id="响应性"><a href="#响应性" class="headerlink" title="响应性"></a>响应性</h4><blockquote>
<ol>
<li>服务在任何情况下都必须快速响应，即使在负载下也是如此</li>
<li>在第99个百分位中响应超过1秒的调用应使用长时间运行模式</li>
<li>在第99个百分位响应中时间超过0.5秒的呼叫应强烈考虑LRO模式</li>
<li>服务不应该引入阻塞调用者或不可采取行动的睡眠、暂停等</li>
</ol>
</blockquote>
<h4 id="速率配置和限额"><a href="#速率配置和限额" class="headerlink" title="速率配置和限额"></a>速率配置和限额</h4><blockquote>
<p>当客户端调用太多次时：</p>
<ol>
<li>服务必须返回429</li>
<li>服务必须返回描述细节的标准错误响应，以便程序员可以进行适当的修改</li>
<li>服务务必返回Retry-After标头，该标头指示客户端在重试之前应等待多长时间</li>
<li>服务可以返回RateLimit标头，该标头记录了已超过的限制和配额</li>
<li>服务可以返回RateLimit-Limit：运行客户端在一个时间窗口内进行调用次数</li>
<li>服务可以返回RateLimit-Remaining：时间窗口中剩余的调用次数</li>
<li>服务可以返回RateLimit-Reset：窗口重置的时间，以UTC纪元秒为单位</li>
<li>服务可以返回其他特定于服务的RateLimit标头，以获取更多详细信息或特定的限制或配额</li>
</ol>
</blockquote>
<h4 id="服务负载"><a href="#服务负载" class="headerlink" title="服务负载"></a>服务负载</h4><blockquote>
<p>当服务通常超负且负载减少时：</p>
<ol>
<li>服务必须返回503</li>
<li>服务务必返回描述细节的标准错误响应，以便程序员可以进行适当的更改</li>
<li>服务务必返回Retry-After标头，该标头指示客户端在重试之前应等待的时间</li>
<li>在503的情况下，服务不应返回RateLimit标头</li>
</ol>
</blockquote>
<h4 id="响应实例"><a href="#响应实例" class="headerlink" title="响应实例"></a>响应实例</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">429</span> Too Many Requests</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="attribute">Retry-After</span>: 5</span><br><span class="line"><span class="attribute">RateLimit-Limit</span>: 1000</span><br><span class="line"><span class="attribute">RateLimit-Remaining</span>: 0</span><br><span class="line"><span class="attribute">RateLimit-Reset</span>: 1538152773</span><br><span class="line">&#123;</span><br><span class="line">  "error": &#123;</span><br><span class="line">    "code": "requestLimitExceeded",</span><br><span class="line">    "message": "The caller has made too many requests in the time period.",</span><br><span class="line">    "details": &#123;</span><br><span class="line">      "code": "RateLimit",</span><br><span class="line">       "limit": "1000",</span><br><span class="line">       "remaining": "0",</span><br><span class="line">       "reset": "1538152773",</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="调用者指南"><a href="#调用者指南" class="headerlink" title="调用者指南"></a>调用者指南</h3><blockquote>
<p>调用者包括API的所有用户：工具、门户网站、其他服务，不仅仅是指用户客户端</p>
<ol>
<li>在重试请求之前，调用者必须等待响应中指定的最短时间</li>
<li>调用者可以在收到带有Retry-After标头的响应后，假设该请求是可重试的，而无需对该请求进行任何更改</li>
<li>客户端应使用共享的SDK和常见的瞬态故障库来实现适当的行为</li>
</ol>
<p>详见：<a href="https://docs.microsoft.com/en-us/azure/architecture/best-practices/transient-faults" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/azure/architecture/best-practices/transient-faults</a></p>
</blockquote>
<h3 id="处理忽略了重试机制的Header头的调用者"><a href="#处理忽略了重试机制的Header头的调用者" class="headerlink" title="处理忽略了重试机制的Header头的调用者"></a>处理忽略了重试机制的Header头的调用者</h3><blockquote>
<p>理想情况下，429和503的成本非常低，以致于即使立即重试的客户也可以得到处理。在这种情况下，服务团队应尽可能与客户端联系。如果是已知的合作伙伴，则应提交错误或事件，在极端情况下，可能有必要使用DOS样式保护，例如阻止调用者</p>
</blockquote>
<h2 id="通过webhooks推送通知"><a href="#通过webhooks推送通知" class="headerlink" title="通过webhooks推送通知"></a>通过webhooks推送通知</h2><h3 id="范围"><a href="#范围" class="headerlink" title="范围"></a>范围</h3><blockquote>
<p>服务可以通过webhooks实现推送通知。本节介绍以下关键方案：</p>
<blockquote>
<p>Push notification via HTTP Callbacks, often called Web Hooks, to publicly-addressable servers.</p>
</blockquote>
<p>选择该方法的原因是它简单性，广泛的适用性以及服务订户进入的门槛低。它旨在作为一组最低要求，并作为其他功能的起点。</p>
</blockquote>
<h3 id="原则-1"><a href="#原则-1" class="headerlink" title="原则"></a>原则</h3><blockquote>
<p>支持webhooks挂钩的服务的核心原则是：</p>
<ol>
<li>服务必须至少实现poke/pull模型。在poke/pull模型中，将通知发送给客户端，然后客户端发送请求以获取当前状态或自上次通知以来的更改记录。这种方法避免了消息排序，遗漏消息和变更集的复杂性。服务可以添加更多数据以提供丰富的通知</li>
<li>服务必须实现用于配置回调URL的质询/响应协议</li>
<li>服务应有一个建议的过期期限，并应根据情况灵活调整服务</li>
<li>服务应该允许正在发出成功通知的订阅永久存在，并且应该容忍合理的终端时间</li>
<li>Firehose订阅必须仅通过HTTPS交付。服务应该要求其他订阅类型为HTTPS。有关更多详细信息，请参见“安全性”部分</li>
</ol>
</blockquote>
<h3 id="订阅类型"><a href="#订阅类型" class="headerlink" title="订阅类型"></a>订阅类型</h3><blockquote>
<p>订阅有两种类型，服务可以实现，或者两者都不实现。支持订阅类型为：</p>
<ol>
<li>Firehose订阅 - 通常在应用程序注册门户中为订阅应该程序手动创建订阅。任何用户已同意接收应用程序的活动通知将发送到该单个订阅</li>
<li>每个资源的订阅-订阅应用程序使用代码在运行时以编程方式为某些特定于用户的实体创建订阅</li>
</ol>
<p>同时支持两种订阅类型的服务应为两种类型提供差异化的开发人员体验：</p>
<ol>
<li>Firehose - 服务必须不要开发人员创建代码，除非直接验证并响应通知。服务必须提供用户订阅管理的管理UI。服务不应假设最终用户知道订阅，而只能假设订阅应用程序的功能</li>
<li>用户 - 服务必须为开发人员提供一个API，以供开发人员创建和管理订阅（作为其应用程序的一部分）以及验证和响应通知。服务可能希望最终用户意识到订阅，并且必须允许最终用户撤销直接响应用户操作而创建的订阅</li>
</ol>
</blockquote>
<h3 id="调用顺序"><a href="#调用顺序" class="headerlink" title="调用顺序"></a>调用顺序</h3><blockquote>
<p>订阅firehose的调用顺序必须遵循下图，它显示了手动注册应用程序和订阅，然后显示了最终用户使用服务的API一直。在流程的这一部分，必须存储两件事：</p>
<ol>
<li>服务必须存储最终用户同意从该特定应用程序接收通知的行为（通常是后台使用OAUTH范围）</li>
<li>订阅应用程序必须存储最终用户的令牌，以便在收到更改通知后回调详细信息</li>
</ol>
<p>序列的最后一部分是通知流本身</p>
<p>非规范实施指南：服务中的资源发生更改，并且该服务需要运行以下逻辑：</p>
<ol>
<li>确定有权访问资源的用户组，从而可以期望应用程序代表他们接收有关资源的通知</li>
<li>查看其中哪些用户已同意接收通知以及来自哪些应用程序</li>
<li>查看哪些应用已注册firehose订阅</li>
<li>加入1、2、3以产生必须发送到应用程序的具体通知集</li>
</ol>
<p>应该注意的是，用户同意的行为和建立firehose订阅的行为可以以任何顺序到达，服务应发送通知，并以两种顺序处理设置</p>
</blockquote>
<p><img src="https://camo.githubusercontent.com/b2f75e771f13a40f441f4ab918f84259c03d8ede/68747470733a2f2f7777772e77656273657175656e63656469616772616d732e636f6d2f6367692d62696e2f63647261773f6c7a3d626d39305a534276646d56794945526c646d56736233426c63697767515856306232316864476c76626977675158427749464e6c636e5a6c636a6f67436941674943416751573441454155414a776b6762476c725a53424e62335a705a55316861325679414341475632467564484d6764473867615735305a5764795958526c494864706447676763484a70625746796553427a5a584a3261574e6c4144634752484a7663474a766541706c626d5167626d39305a516f416751774c5169425162334a3059577773494552434149454a42564a6c5a326c7a6448494167526b4852454967546d393061575a70597743424c41567a414345476458526f4143734655774267426a6f675647686c414630654149465f436b4e736157567564414174426d56755a4342316332567963796367596e4a7664334e6c6369427663694270626e4e30595778735a5751675958427743674342495177416769516741494641425143424953384167516f4749446f6754574675645746734149467a45516f4b4367434441676f384c53302d4149497143694136494578765a326c7549476c7564473841676a384a41494931454342565743414b41436f4b4c5434674b77434357424d364149514742553568625755675a58526a4c6743444651344147784a446232356d61584a74414945424345466a5932567a637942556232746c62676f4b41494d33457941745069417441494e6b4351426e426b6c454149454d43774342565155416851494d41495233436d4e7663476c6c63774172434143434948414168484d4d41494d4b44774344414267364948646c596d6876623273676367434365673441676e55534149565144546f41685859485a584941677767474149635442674245435656535443776755324e7663475541687a49475355514b54674347505177416868774e4941434442683441486845416778455062674342616777416778774e41494d61446941416778304d6257463549474e7663486b414c5245416856747141495a484230463164476876636d6c36414959374277434758516374506941724149457544564a6c6358566c63335167595143464f515a306279424551694277636d39305a574e305a5751676157356d62334941696951474367434442517374506941744149637443564a6c5a476c795a574e30414459484147774e494756755a4842766157353041496f57426d45414477317941485947414945514441434a564163415377746c5a41415948674349434167414d4163416341344168476f474145304641494564466d4a6859327367644738416846384e6158526f49474e765a47554167686f61615143426167634167546f484144304a4149492d42334d4150677341676c4548414573464149497a4467434258773041676e3847644739725a57357a414363534149305f42584a705a3268304947396d4149747044554e685932686c4948526f5958516764476870637942566332567949456c454948427962335a705a47566b41494e4e437743495a676f416767634a41494e3744334e776232357a4149305f427743454367597349484a6c5a6e4a6c63326773494746755a43424a524143424841634167514d5041495941445143424441634167555547596e6b416a466b4649456c454149516b47335231636d34416846344d4948527649474d416a523846414977526167434a5677314762473933414959714351434d61516741676d6f4b614746755a3255416a3359464149465842575268644745674c534230655842705932467349485a70595143514467567959574e306157356e414a41504267434a51517432615745416a6e7348436743504e676f67414968444541434b5a7730416b464d4641496b424477434444415541676b59574b77424e437743485741706a4149457942514348526730416857554859574e6f414951654441434566775668626d5167496e4e70626d4e6c49674346455159416b53514f414952334367434e66776341684851464149705145414342556773416846416341494938425746755a4342755a58634159525141684655544f6942566347526864475567633352686448554167536b47414946444251417845776f4b436726733d6d736367656e" alt="firehose1"></p>
<blockquote>
<p>对于每个用户的订阅，应用程序注册可以手动或自动进行。每个用户订阅的呼叫流程必须遵循下图。它显示了最终用户使用服务的API之一，并且同样，必须存储相同的两件事：</p>
<ol>
<li>服务必须存储最终用户同意从该特定应用程序接收通知的行为（通常是后台使用OAUTH范围）</li>
<li>订阅应用程序必须存储最终用户的令牌，以便在收到更改通知后回调详细信息</li>
</ol>
<p>在这种情况下，使用来自订阅应用程序的最终用户令牌以编程方式设置订阅。应用必须务必已注册订阅的ID与用户令牌一起存储。</p>
<p>非规范性实施指南：在序列的最后部分，当服务中的数据项发生更改并且服务需要运行以下逻辑时：</p>
<ol>
<li>查找通过资源与己更改数据相对应的订阅集</li>
<li>对于使用app+user令牌创建的订阅，请使用订阅创建者的订阅ID和用户ID向每个订阅的应用发送通知</li>
</ol>
<p>对于使用仅应用令牌创建的订阅，请检查已更改数据的所有者具有已更改数据可见性的任何用户均已同意向应用程序发送通知，如果是，则按每个用户ID向每个应用程序发送一组通知带有订阅ID的订阅</p>
</blockquote>
<p><img src="https://camo.githubusercontent.com/b9f6961da5bc139a7169515a83f56ab4a8f9ede5/68747470733a2f2f7777772e77656273657175656e63656469616772616d732e636f6d2f6367692d62696e2f63647261773f6c7a3d626d39305a534276646d56794945526c646d56736233426c63697767515856306232316864476c76626977675158427749464e6c636e5a6c636a6f67436941674943416751573441454155414a776b6762476c725a53424e62335a705a55316861325679414341475632467564484d6764473867615735305a5764795958526c494864706447676763484a70625746796553427a5a584a3261574e6c4144634752484a7663474a766541706c626d5167626d39305a516f416751774c5169425162334a3059577773494552434149454a42564a6c5a326c7a6448494167526b4852454967546d393061575a70597743424c41567a414345476458526f4143734655774267426a6f675647686c414630654149465f436b4e736157567564414174426d56755a4342316332567963796367596e4a7664334e6c6369427663694270626e4e30595778735a5751675958427743674342495177416769516741494641425143424953384167516f4749446f416757775243677068624851416779554941494548426942794142514d494341416778734c50433074506743445477733649454e76626d5a705a3356795a516f6749414344614173674c5434674b77434357424d4165675a4f5957316c49475630597934416841674641494d61445141664567426442584a744149515f4255466a5932567a637942556232746c41494554426743444f7849674c5434674c5143424667784263484167535551416848774959334a6c644143424778417450674346466773674f69424662574a6c5a41416b46475673633255675457467564574673414949454a41434562516b674f69424d6232647062694270626e527641495542435143424b52465657414347474155414c516f416768386d4149495a4b77434243416341676a6f4e41494973484143474c776b41676a38494149455344674345434159416831454c41496446436d4e7663476c6c63774175434756755a41434565476f4168575148515856306147397961586f4168563848414956364279302d494373416732414e556d56786457567a6443426841495256426e527649455243494842796233526c5933526c5a434270626d5a766367434a5151594b414951614379302d49433041686b6f4a556d566b61584a6c593351414e676341624130675a57356b63473970626e514169544d475951415044584941646759416752414d414968784277424c4332566b414267654149526a43414177423045416351785657416f415351674167527757596d466a617942306277434664417741696c77465932396b5a5143434752707041494670427743424f51634150516b41676a30486377412d437743435541634153775541676a494f414946654451434366675a306232746c626e4d414a7849416a467346636d6c6e61485167623259416977554e5132466a61475567644768686443423061476c7a4946567a5a5849675355516763484a76646d6c6b5a5751416730774c41495536427743434241774167336f5063334276626e4d416a4673484149514a42697767636d566d636d567a614377675957356b49456c454149456342774342417738416944454e4149454d4277434252515a696551434c645155675355514168434d62644856796267434558517767644738675977434d4f77554b4367434c4c326f416a58554d41497754447743504e516f74506973416a6877514f67434f5251646c6367434d56775941673359495a574a6f62323972494656535443776755324e76634755416b414547535551416a776f4f41493572445341416932554b41494e464251434c5977304148424541677a554f4f6942754149453244414267434143444342316f5a5143426151354a52414344597755416168494167684234526d78766477434a4d776b416a45304941495630436d6868626d646c414a4963425143455951566b595852684943306764486c7761574e6862434232615745416b6a5146636d466a64476c755a7743534e5159416a56384c646d6c68414a456842776f416b56774b4941434e666841416841734e414a4a35425143435751384168685946414956514669734154517341696d454b597743424d675541696b384e414968764232466a614143484b41774169416b465957356b49434a7a6157356a5a53494169427347414a4e4b4467434941516f4168423063414946534377434857687741676a77465957356b4947356c647742684641434858784d36494656775a4746305a53427a64474630645143424b51594167554d464144455443676f4b26733d6d736367656e" alt="subscription"></p>
<h3 id="验证订阅"><a href="#验证订阅" class="headerlink" title="验证订阅"></a>验证订阅</h3><blockquote>
<p>当订阅以编程方式更改或响应通过管理UI门户的更改时，需要保护订阅服务免受恶意或意外调用的干扰，因为这些服务可能会导致大量通知流量。</p>
<p>对于所有订阅，无论是firehose还是按用户，服务都必须在发送任何其他通知之前，通过门户网站UI或者API请求发送验证请求，作为创建或修改的一部分。</p>
<p>验证请求必须采用以下格式，作为对订阅的notification的HTTP/HTTPS post</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST https://&#123;notificationUrl&#125;?validationToken=&#123;randomString&#125;</span><br><span class="line"><span class="attribute">ClientState</span>: clientOriginatedOpaqueToken (if provided by client on subscription-creation)</span><br><span class="line"><span class="attribute">Content-Length</span>: 0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>对于要建立的订阅，应用程序必须对该请求作出200 OK的响应，并且validation Token值为唯一的实体主体。请注意，如果notificationUrl包含查询参数，则validationToken参数必须附加一个&amp;</p>
<p>如果任何质询请求在发送请求后的5秒内未收到规定的响应，则该服务服务返回错误，不得创建订阅，也不得将其他请求或通知发送到notificationUrl</p>
<p>服务可以对URL所有权执行其他验证。</p>
</blockquote>
<h3 id="接收通知"><a href="#接收通知" class="headerlink" title="接收通知"></a>接收通知</h3><blockquote>
<p>服务应该发送通知以通知服务数据更改，这些更改不包括更改本身的详细信息，但应包含足够的信息，供订阅应用程序适当地响应以下过程：</p>
<ol>
<li>应用程序必须标识正确的缓存OAuth令牌以用于回调应用程序可以查找任何先前的data令牌以获取相关的更改范围</li>
<li>应用程序必须确定要调用的URL，以对服务的新状态执行相关查询，该查询可以是增量查询</li>
</ol>
<p>提供通知的服务将被中继给最终用户，可以选择向通知包添加更多的细节，以减少其服务上的传入呼叫负载。子类服务必须明确，不能保证一定会发送通知，并且通知可能有损或乱序。</p>
<p>通知可以汇总并分批发送。应用程序必须准备好在单个推送通知中接收多个事件。</p>
<p>服务必须发送所有webhooks数据通知作为POST请求</p>
<p>服务必须允许30秒的通知超时时间。如果发生超时或应用程序以5xx响应进行响应，则服务应该使用指数退避重试通知，所有其他响应将被忽略。</p>
<p>该服务不得遵循301/302重定向请求。</p>
</blockquote>
<h4 id="通知有效负载"><a href="#通知有效负载" class="headerlink" title="通知有效负载"></a>通知有效负载</h4><blockquote>
<p>通知有效负载的基本格式是事件列表，每个事件包含订阅的ID（已更改），该订阅的参考资源已更改，更改的类型，应消耗的资源以标识更改的确切消息信息以及足够的标识信息以供查看嗲用该资源所需的 令牌。</p>
<p>对于firehose订阅，具体实例如下：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "value": [</span><br><span class="line">    &#123;</span><br><span class="line">      "subscriptionId": "32b8cbd6174ab18b",</span><br><span class="line">      "resource": "https://api.contoso.com/v1.0/users/user@contoso.com/files?$delta",</span><br><span class="line">      "userId" : "&lt;User GUID&gt;",</span><br><span class="line">      "tenantId" : "&lt;Tenant Id&gt;"</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>对于per-user subscription，如下：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "value": [</span><br><span class="line">    &#123;</span><br><span class="line">      "subscriptionId": "32b8cbd6174ab183",</span><br><span class="line">      "clientState": "clientOriginatedOpaqueToken",</span><br><span class="line">      "expirationDateTime": "2016-02-04T11:23Z",</span><br><span class="line">      "resource": "https://api.contoso.com/v1.0/users/user@contoso.com/files/$delta",</span><br><span class="line">      "userId" : "&lt;User GUID&gt;",</span><br><span class="line">      "tenantId" : "&lt;Tenant Id&gt;"</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      "subscriptionId": "97b391179fa22",</span><br><span class="line">      "clientState ": "clientOriginatedOpaqueToken",</span><br><span class="line">      "expirationDateTime": "2016-02-04T11:23Z",</span><br><span class="line">      "resource": "https://api.contoso.com/v1.0/users/user@contoso.com/files/$delta",</span><br><span class="line">      "userId" : "&lt;User GUID&gt;",</span><br><span class="line">      "tenantId" : "&lt;Tenant Id&gt;"</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>以下是JSON有效负载的详细说明。</p>
<p>通知项包含一个顶层对象，该对象包含一系列事件，每个事件都标识了遇有发送此通知而导致的订阅。</p>
</blockquote>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>value</td>
<td>Array of events that have been raised within the subscription’s scope since the last notification.</td>
</tr>
</tbody></table>
<blockquote>
<p>事件数组的每一项都包含以下属性：</p>
</blockquote>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>subscriptionId</td>
<td>The id of the subscription due to which this notification has been sent. Services MUST provide the <em>subscriptionId</em> field.</td>
</tr>
<tr>
<td>clientState</td>
<td>Services MUST provide the <em>clientState</em> field if it was provided at subscription creation time.</td>
</tr>
<tr>
<td>expirationDateTime</td>
<td>Services MUST provide the <em>expirationDateTime</em> field if the subscription has one.</td>
</tr>
<tr>
<td>resource</td>
<td>Services MUST provide the resource field. This URL MUST be considered opaque by the subscribing application. In the case of a richer notification it MAY be subsumed by message content that implicitly contains the resource URL to avoid duplication. If a service is providing this data as part of a more detailed data packet, then it need not be duplicated.</td>
</tr>
<tr>
<td>userId</td>
<td>Services MUST provide this field for user-scoped resources. In the case of user-scoped resources, the unique identifier for the user should be used. In the case of resources shared between a specific set of users, multiple notifications must be sent, passing the unique identifier of each user. For tenant-scoped resources, the user id of the subscription should be used.</td>
</tr>
<tr>
<td>tenantId</td>
<td>Services that wish to support cross-tenant requests SHOULD provide this field. Services that provide notifications on tenant-scoped data MUST send this field.</td>
</tr>
</tbody></table>
<h3 id="订阅管理"><a href="#订阅管理" class="headerlink" title="订阅管理"></a>订阅管理</h3><blockquote>
<p>对于每个用户的订阅，必须提供一个API以创建和管理订阅。API必须至少支持此处描述的操作。</p>
</blockquote>
<h4 id="创建订阅"><a href="#创建订阅" class="headerlink" title="创建订阅"></a>创建订阅</h4><blockquote>
<p>客户端通过对订阅资源的发出POST请求来创建订阅。订阅名称空间是通过POST操作由客户端定义的</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;api.contoso.com&#x2F;apiVersion&#x2F;$subscriptions</span><br></pre></td></tr></table></figure>

<blockquote>
<p>POST 请求包含一个要创建的订阅对象，对订阅对象具有以下属性：</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">Property Name</th>
<th align="left">Required</th>
<th align="left">Notes</th>
</tr>
</thead>
<tbody><tr>
<td align="left">resource</td>
<td align="left">Yes</td>
<td align="left">Resource path to watch.</td>
</tr>
<tr>
<td align="left">notificationUrl</td>
<td align="left">Yes</td>
<td align="left">The target web hook URL.</td>
</tr>
<tr>
<td align="left">clientState</td>
<td align="left">No</td>
<td align="left">Opaque string passed back to the client on all notifications. Callers may choose to use this to provide tagging mechanisms.</td>
</tr>
</tbody></table>
<blockquote>
<p>如果成功创建了订阅，则服务必须使用状态码201 CREATED包含至少以下属性的主体进行响应：</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">Property Name</th>
<th align="left">Required</th>
<th align="left">Notes</th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td align="left">Yes</td>
<td align="left">Unique ID of the new subscription that can be used later to update/delete the subscription.</td>
</tr>
<tr>
<td align="left">expirationDateTime</td>
<td align="left">No</td>
<td align="left">Uses existing Microsoft REST API Guidelines defined time formats.</td>
</tr>
</tbody></table>
<blockquote>
<p>订阅的创建应该是幂等的，范围限定于auth令牌的属性的组合提供了唯一性约束。</p>
<p>以下是使用用户+应用程序主体来订阅文件通知的实例请求：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST https://api.contoso.com/files/v1.0/$subscriptions HTTP 1.1</span><br><span class="line"><span class="attribute">Authorization</span>: Bearer &#123;UserPrincipalBearerToken&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "resource": "http://api.service.com/v1.0/files/file1.txt",</span><br><span class="line">  "notificationUrl": "https://contoso.com/myCallbacks",</span><br><span class="line">  "clientState": "clientOriginatedOpaqueToken"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>服务应该以最小的响应格式响应这样的消息：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;: &quot;32b8cbd6174ab18b&quot;,</span><br><span class="line">  &quot;expirationDateTime&quot;: &quot;2016-02-04T11:23Z&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>以下是使用仅应用程序主体的实例，其中应用程序正在监视其授权的所有文件：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST https:&#x2F;&#x2F;api.contoso.com&#x2F;files&#x2F;v1.0&#x2F;$subscriptions HTTP 1.1</span><br><span class="line">Authorization: Bearer &#123;ApplicationPrincipalBearerToken&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;resource&quot;: &quot;All.Files&quot;,</span><br><span class="line">  &quot;notificationUrl&quot;: &quot;https:&#x2F;&#x2F;contoso.com&#x2F;myCallbacks&quot;,</span><br><span class="line">  &quot;clientState&quot;: &quot;clientOriginatedOpaqueToken&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>服务应该以最小的响应格式响应这样的消息：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "id": "8cbd6174abb391179",</span><br><span class="line">  "expirationDateTime": "2016-02-04T11:23Z"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="更新订阅"><a href="#更新订阅" class="headerlink" title="更新订阅"></a>更新订阅</h4><blockquote>
<p>服务可以支持修改订阅。为了更新现有订阅的属性，客户端使用PATCH请求来提供ID和需要更改的属性。忽略的属性将保留其值。要删除属性，请为其分配JSON null值。</p>
<p>与创建一样，订阅是单独管理的。</p>
<p>以下请求更改现有订阅的通知URL：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PATCH https://api.contoso.com/files/v1.0/$subscriptions/&#123;id&#125; HTTP 1.1</span><br><span class="line"><span class="attribute">Authorization</span>: Bearer &#123;UserPrincipalBearerToken&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "notificationUrl": "https://contoso.com/myNewCallback"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果PATCH请求包含一个新的notificationUrl，则服务器必须如上所述对其进行验证。如果新的URL验证失败，则该服务务必使PATCH请求失败，并使订阅保持其先前的状态。</p>
<p>服务必须返回一个空的主体和204 No Connect表示补丁成功。</p>
<p>如果补丁失败i，服务必须返回错误体和状态码。</p>
<p>该操作必须成功完成或失败。</p>
</blockquote>
<h4 id="删除订阅"><a href="#删除订阅" class="headerlink" title="删除订阅"></a>删除订阅</h4><blockquote>
<p>服务必须支持删除订阅，可以通过对订阅资源发出DELETE请求来删除现有订阅：</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE https://api.contoso.com/files/v1.0/$subscriptions/&#123;id&#125; HTTP 1.1</span><br><span class="line"><span class="attribute">Authorization</span>: Bearer &#123;UserPrincipalBearerToken&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>与更新一样，服务必须返回204 No Connect才能成功删除，或者返回错误体和状态码以指示失败。</p>
</blockquote>
<h4 id="枚举订阅"><a href="#枚举订阅" class="headerlink" title="枚举订阅"></a>枚举订阅</h4><blockquote>
<p>为了获取活动订阅的列表，客户端使用用户+应用程序或仅应用程序承载令牌对订阅资源发出GET请求：</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.contoso.com/files/v1.0/$subscriptions HTTP 1.1</span><br><span class="line"><span class="attribute">Authorization</span>: Bearer &#123;UserPrincipalBearerToken&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>服务必须使用用户+应用程序主体承载令牌返回以下格式：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "value": [</span><br><span class="line">    &#123;</span><br><span class="line">      "id": "32b8cbd6174ab18b",</span><br><span class="line">      "resource": " http://api.contoso.com/v1.0/files/file1.txt",</span><br><span class="line">      "notificationUrl": "https://contoso.com/myCallbacks",</span><br><span class="line">      "clientState": "clientOriginatedOpaqueToken",</span><br><span class="line">      "expirationDateTime": "2016-02-04T11:23Z"</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以使用仅应用程序主体承载令牌返回的实例：</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "value": [</span><br><span class="line">    &#123;</span><br><span class="line">      "id": "6174ab18bfa22",</span><br><span class="line">      "resource": "All.Files ",</span><br><span class="line">      "notificationUrl": "https://contoso.com/myCallbacks",</span><br><span class="line">      "clientState": "clientOriginatedOpaqueToken",</span><br><span class="line">      "expirationDateTime": "2016-02-04T11:23Z"</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h3><blockquote>
<p>所有服务URL必须为HTTPS（也就是说，所有入站呼叫必须为HTTPS）。处理WebHooks的服务必须接收HTTPS。</p>
<p>我们建议允许客户端定义的Webhook回调URL的服务不应通过HTTP传输数据。这是因为信息可能会通过客户端、网络、服务器日志和其他机制无意间公开。</p>
<p>但是，在某些情况下，由于客户端端点或软件限制，无法遵循上述规则。因此，服务可以允许webhooks URL为HTTP。</p>
<p>此外，允许客户端定义的HTTP Web Hooks回调URL的服务应符合工程领导指定的隐私策略。这通常包括建议客户端选择SSL连接并遵守特殊的预防措施，以确保正确处理日志和其他服务数据收集。</p>
<p>例如，服务可能不希望要求开发人员生成证书，服务可能仅在测试账户上启用此功能。</p>
</blockquote>
<h2 id="不支持的请求"><a href="#不支持的请求" class="headerlink" title="不支持的请求"></a>不支持的请求</h2><blockquote>
<p>RESTful API 客户端可以请求当前不支持的功能。RESTful API必须响应与本节一致的有效但不受支持的请求</p>
</blockquote>
<h3 id="基本指南"><a href="#基本指南" class="headerlink" title="基本指南"></a>基本指南</h3><blockquote>
<p>RESTful API通常会选择限制客户端可以执行的功能。例如，审核系统允许创建记录，但不能修改和删除记录。同样，某些API会公开集合，但需要或以其他方式限制过滤和排序标准，或者可能不支持客户端驱动的分页。</p>
</blockquote>
<h3 id="功能允许列表"><a href="#功能允许列表" class="headerlink" title="功能允许列表"></a>功能允许列表</h3><blockquote>
<p>如果服务不支持一下任何API功能，则如果调用者请求该功能，则必须提供错误响应，功能包括：</p>
<ul>
<li>集合的关键地址，例如：<a href="https://api.contoso.com/v1.0/people/user1@contoso.com" target="_blank" rel="noopener">https://api.contoso.com/v1.0/people/user1@contoso.com</a></li>
<li>按属性值过滤集合，例如：<a href="https://api.contoso.com/v1.0/people?$filter=name" target="_blank" rel="noopener">https://api.contoso.com/v1.0/people?$filter=name</a> eq ‘david’</li>
<li>按范围过滤集合，例如：<a href="http://api.contoso.com/v1.0/people?$filter=hireDate" target="_blank" rel="noopener">http://api.contoso.com/v1.0/people?$filter=hireDate</a> ge 2014-01-01 and hireDate le 2014-12-31</li>
<li>通过$top和$skip进行客户端驱动的分页，例如：<a href="https://api.contoso.com/v1.0/people?$orderBy=name" target="_blank" rel="noopener">https://api.contoso.com/v1.0/people?$orderBy=name</a> desc</li>
<li>提供$delta令牌，例如：<a href="https://api.contoso.com/v1.0/people?$delta" target="_blank" rel="noopener">https://api.contoso.com/v1.0/people?$delta</a></li>
</ul>
</blockquote>
<h4 id="错误返回值"><a href="#错误返回值" class="headerlink" title="错误返回值"></a>错误返回值</h4><blockquote>
<p>如果呼叫者请求在功能运行列表中找到不支持的功能，则服务必须提供错误响应。错误响应必须是4xx系列的HTTP状态码，表示无法满足该请求。除非更具体的错误状态适合给定的请求，否则服务应返回”400 Bad Request”和符合Microsoft REST API指南中提供的错误响应只能的错误有效负载。服务应该在响应消息中包含足够的详细信息，以供开发人员确定不支持请求的哪一部分。</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">https://api.contoso.com/v1.0/people?$orderBy=name</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Accept</span>: application/json</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">400</span> Bad Request</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "error": &#123;</span><br><span class="line">    "code": "ErrorUnsupportedOrderBy",</span><br><span class="line">    "message": "Ordering by name is not supported."</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="命名指南"><a href="#命名指南" class="headerlink" title="命名指南"></a>命名指南</h2><h3 id="途径"><a href="#途径" class="headerlink" title="途径"></a>途径</h3><blockquote>
<p>命名策略应有助于开发人员发现功能，而不必参考文档。使用通用模式和标准约定可以极大地帮助开发人员正确猜测通用属性名称和含义。服务应该使用冗长的命名模式，并且不应该使用除首字母缩略词外的缩写，首字母缩略词是由API表示的域（例如URL）中的主要表达方式。</p>
</blockquote>
<h3 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h3><blockquote>
<ul>
<li>首字母缩写应该遵循大小写约定，就好像它们是常规单词一样（例如URL）。</li>
<li>所有标识符，包括名称空间、entityType、entitySets、属性、操作、函数和枚举值，均应使用lowerCamelCase</li>
<li>HTTP标头是例外，应该使用大写连字符术语的标准HTTP约定</li>
</ul>
</blockquote>
<h3 id="需避免的命名"><a href="#需避免的命名" class="headerlink" title="需避免的命名"></a>需避免的命名</h3><blockquote>
<p>某些名称在API域中是如此超载，以致于它们失去所有含义或与使用REST API（如OAUTH）时无法避免的域中的其他常见用法冲突。服务不应该使用一下名称：</p>
<ul>
<li>Context</li>
<li>Scope</li>
<li>Resource</li>
</ul>
</blockquote>
<h3 id="规范的复合词"><a href="#规范的复合词" class="headerlink" title="规范的复合词"></a>规范的复合词</h3><blockquote>
<ul>
<li>服务应该避免使用诸如“a”，”the”，”of”之类的术语，除非需要传达含义。<ul>
<li>例如，不应该使用诸如aUser、theAccount、countOfBooks之类的名称，而应首选user、account、bookCount</li>
</ul>
</li>
<li>如果不这样做，服务应该在属性名称中添加类型，这回导致数据表示方式的歧义，或者导致服务不使用通用属性名称</li>
<li>将类型添加到属性名称时，服务务必在末尾添加类型，例如：createdDateTime</li>
</ul>
</blockquote>
<h3 id="标识属性"><a href="#标识属性" class="headerlink" title="标识属性"></a>标识属性</h3><blockquote>
<ul>
<li>服务必须使用字符串类型作为身份属性</li>
<li>对于OData属性，该服务务必使用OData @id属性来表示资源的规范标识符</li>
<li>服务可以使用简单的“id”属性来表示资源的本地或遗留主键值。</li>
<li>服务应该使用后缀为“id”的关系名称来表示另一个资源的外键，例如：subscriptionId<ul>
<li>这个属性的内容应该是被引用资源的规范ID</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="日期和时间属性"><a href="#日期和时间属性" class="headerlink" title="日期和时间属性"></a>日期和时间属性</h4><blockquote>
<ul>
<li>对于同时需要日期和时间的属性，服务必须使用后缀“DateTime”</li>
<li>对于仅需要日期信息而不指定时间的属性，服务必须使用后缀“Date”，例如birthDate</li>
<li>对于仅需要时间信息但未指定日期的属性，服务必须使用后缀“Time”，例如appointmentStartTime</li>
</ul>
</blockquote>
<h4 id="名称属性"><a href="#名称属性" class="headerlink" title="名称属性"></a>名称属性</h4><blockquote>
<ul>
<li>对于通常显示给用户的资源的整体名称，服务必须使用属性名称“displayName”</li>
<li>服务可以使用其他常见的命名属性，例如：givenName,surname,signInName</li>
</ul>
</blockquote>
<h4 id="集合和计数"><a href="#集合和计数" class="headerlink" title="集合和计数"></a>集合和计数</h4><blockquote>
<ul>
<li>服务必须使用正确的英文将集合命名为复数名词或者复数名词短语</li>
<li>对于可能带有复数形式但不常见的口头名词，服务可以使用简化的英语<ul>
<li>例如，可以使用used代替schemata</li>
</ul>
</li>
<li>服务必须使用后缀为”Count“的名词或名词短语来命名资源计数</li>
</ul>
</blockquote>
<h4 id="通用属性命名"><a href="#通用属性命名" class="headerlink" title="通用属性命名"></a>通用属性命名</h4><blockquote>
<p>如果服务具有属性，其数据与下面的名称匹配，则服务必须使用此表中的名称。随着服务添加将更常用的术语，该表将增长。添加此类术语的服务所有者应该在本文档中提出其他建议</p>
</blockquote>
<table>
<thead>
<tr>
<th>通用属性名</th>
</tr>
</thead>
<tbody><tr>
<td>attendees</td>
</tr>
<tr>
<td>body</td>
</tr>
<tr>
<td>createdDateTime</td>
</tr>
<tr>
<td>childCount</td>
</tr>
<tr>
<td>children</td>
</tr>
<tr>
<td>contentUrl</td>
</tr>
<tr>
<td>country</td>
</tr>
<tr>
<td>createdBy</td>
</tr>
<tr>
<td>displayName</td>
</tr>
<tr>
<td>errorUrl</td>
</tr>
<tr>
<td>eTag</td>
</tr>
<tr>
<td>event</td>
</tr>
<tr>
<td>expirationDateTime</td>
</tr>
<tr>
<td>givenName</td>
</tr>
<tr>
<td>jobTitle</td>
</tr>
<tr>
<td>kind</td>
</tr>
<tr>
<td>id</td>
</tr>
<tr>
<td>lastModifiedDateTime</td>
</tr>
<tr>
<td>location</td>
</tr>
<tr>
<td>memberOf</td>
</tr>
<tr>
<td>message</td>
</tr>
<tr>
<td>name</td>
</tr>
<tr>
<td>owner</td>
</tr>
<tr>
<td>people</td>
</tr>
<tr>
<td>person</td>
</tr>
<tr>
<td>postalCode</td>
</tr>
<tr>
<td>photo</td>
</tr>
<tr>
<td>preferredLanguage</td>
</tr>
<tr>
<td>properties</td>
</tr>
<tr>
<td>signInName</td>
</tr>
<tr>
<td>surname</td>
</tr>
<tr>
<td>tags</td>
</tr>
<tr>
<td>userPrincipalName</td>
</tr>
<tr>
<td>webUrl</td>
</tr>
</tbody></table>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/rest-api/" rel="tag"># rest api</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/08/17/List%E9%9B%86%E5%90%88/" rel="next" title="List集合">
                <i class="fa fa-chevron-left"></i> List集合
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/08/31/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" rel="prev" title="函数式编程">
                函数式编程 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpeg"
                alt="gtang94" />
            
              <p class="site-author-name" itemprop="name">gtang94</p>
              <p class="site-description motion-element" itemprop="description">Make things as simple as possible, but no simpler</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">91</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/gtang94" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:gtang94@outlook.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-users"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.baidu.com/" title="百度" target="_blank">百度</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#摘要"><span class="nav-number">1.</span> <span class="nav-text">摘要</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#介绍"><span class="nav-number">2.</span> <span class="nav-text">介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#推荐阅读"><span class="nav-number">2.1.</span> <span class="nav-text">推荐阅读</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#解读指南"><span class="nav-number">3.</span> <span class="nav-text">解读指南</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#应用指南"><span class="nav-number">3.1.</span> <span class="nav-text">应用指南</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#存在服务和服务版本指导"><span class="nav-number">3.2.</span> <span class="nav-text">存在服务和服务版本指导</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#要求的语言"><span class="nav-number">3.3.</span> <span class="nav-text">要求的语言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#许可证"><span class="nav-number">3.4.</span> <span class="nav-text">许可证</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分类"><span class="nav-number">4.</span> <span class="nav-text">分类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#错误"><span class="nav-number">4.1.</span> <span class="nav-text">错误</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#故障"><span class="nav-number">4.2.</span> <span class="nav-text">故障</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#延迟"><span class="nav-number">4.3.</span> <span class="nav-text">延迟</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#完成时间"><span class="nav-number">4.4.</span> <span class="nav-text">完成时间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#长期运行的API故障"><span class="nav-number">4.5.</span> <span class="nav-text">长期运行的API故障</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#客户端指南"><span class="nav-number">5.</span> <span class="nav-text">客户端指南</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#忽略规则"><span class="nav-number">5.1.</span> <span class="nav-text">忽略规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#变量排序规则"><span class="nav-number">5.2.</span> <span class="nav-text">变量排序规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#无提示的失效规则"><span class="nav-number">5.3.</span> <span class="nav-text">无提示的失效规则</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一致性基础"><span class="nav-number">6.</span> <span class="nav-text">一致性基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#URL结构"><span class="nav-number">6.1.</span> <span class="nav-text">URL结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#URL长度"><span class="nav-number">6.2.</span> <span class="nav-text">URL长度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#标准标识符"><span class="nav-number">6.3.</span> <span class="nav-text">标准标识符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#支持方法"><span class="nav-number">6.4.</span> <span class="nav-text">支持方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#POST"><span class="nav-number">6.4.1.</span> <span class="nav-text">POST</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PATCH"><span class="nav-number">6.4.2.</span> <span class="nav-text">PATCH</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#通过PATCH创建资源-UPSERT定义"><span class="nav-number">6.4.3.</span> <span class="nav-text">通过PATCH创建资源 (UPSERT定义)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Options标头和link标签"><span class="nav-number">6.4.4.</span> <span class="nav-text">Options标头和link标签</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#标准请求头"><span class="nav-number">6.5.</span> <span class="nav-text">标准请求头</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#标准响应头"><span class="nav-number">6.6.</span> <span class="nav-text">标准响应头</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义请求头"><span class="nav-number">6.7.</span> <span class="nav-text">自定义请求头</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#以查询参数方式提交自定义请求头"><span class="nav-number">6.8.</span> <span class="nav-text">以查询参数方式提交自定义请求头</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PII个人身份信息参数"><span class="nav-number">6.9.</span> <span class="nav-text">PII个人身份信息参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Response-formats响应格式"><span class="nav-number">6.10.</span> <span class="nav-text">Response formats响应格式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Clients-specified客户端指定响应格式"><span class="nav-number">6.10.1.</span> <span class="nav-text">Clients-specified客户端指定响应格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#错误情况下的响应格式"><span class="nav-number">6.10.2.</span> <span class="nav-text">错误情况下的响应格式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ErrorResponse-Object"><span class="nav-number">6.10.2.1.</span> <span class="nav-text">ErrorResponse: Object</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Error-Object"><span class="nav-number">6.10.2.2.</span> <span class="nav-text">Error: Object</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#InnerError-Object"><span class="nav-number">6.10.2.3.</span> <span class="nav-text">InnerError: Object</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#示例"><span class="nav-number">6.10.2.4.</span> <span class="nav-text">示例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP状态码"><span class="nav-number">6.11.</span> <span class="nav-text">HTTP状态码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#可选择的客户端库"><span class="nav-number">6.12.</span> <span class="nav-text">可选择的客户端库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CORS跨域"><span class="nav-number">7.</span> <span class="nav-text">CORS跨域</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#客户端指南-1"><span class="nav-number">7.1.</span> <span class="nav-text">客户端指南</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#避免额外的预检查"><span class="nav-number">7.1.1.</span> <span class="nav-text">避免额外的预检查</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#服务端指导"><span class="nav-number">7.2.</span> <span class="nav-text">服务端指导</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#集合"><span class="nav-number">8.</span> <span class="nav-text">集合</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#项的Key"><span class="nav-number">8.1.</span> <span class="nav-text">项的Key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#序列化"><span class="nav-number">8.2.</span> <span class="nav-text">序列化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集合的URL匹配模式"><span class="nav-number">8.3.</span> <span class="nav-text">集合的URL匹配模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#嵌套的集合和属性"><span class="nav-number">8.3.1.</span> <span class="nav-text">嵌套的集合和属性</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#大集合"><span class="nav-number">8.4.</span> <span class="nav-text">大集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改集合"><span class="nav-number">8.5.</span> <span class="nav-text">修改集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集合排序"><span class="nav-number">8.6.</span> <span class="nav-text">集合排序</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#排序表达式的解释"><span class="nav-number">8.6.1.</span> <span class="nav-text">排序表达式的解释</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#过滤"><span class="nav-number">8.7.</span> <span class="nav-text">过滤</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#过滤运算符"><span class="nav-number">8.7.1.</span> <span class="nav-text">过滤运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#运算符实例"><span class="nav-number">8.7.2.</span> <span class="nav-text">运算符实例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#运算符优先级"><span class="nav-number">8.7.3.</span> <span class="nav-text">运算符优先级</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分页"><span class="nav-number">8.8.</span> <span class="nav-text">分页</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#服务端驱动分页"><span class="nav-number">8.8.1.</span> <span class="nav-text">服务端驱动分页</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#客户端驱动分页"><span class="nav-number">8.8.2.</span> <span class="nav-text">客户端驱动分页</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#其他注意事项"><span class="nav-number">8.8.3.</span> <span class="nav-text">其他注意事项</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#复合集合操作"><span class="nav-number">8.9.</span> <span class="nav-text">复合集合操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#增量查询"><span class="nav-number">9.</span> <span class="nav-text">增量查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#增量链接"><span class="nav-number">9.1.</span> <span class="nav-text">增量链接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实体表示"><span class="nav-number">9.2.</span> <span class="nav-text">实体表示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获得增量链接"><span class="nav-number">9.3.</span> <span class="nav-text">获得增量链接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#增量链接响应内容"><span class="nav-number">9.4.</span> <span class="nav-text">增量链接响应内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用增量链接"><span class="nav-number">9.5.</span> <span class="nav-text">使用增量链接</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JSON标准化"><span class="nav-number">10.</span> <span class="nav-text">JSON标准化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本类型的JSON格式标准化"><span class="nav-number">10.1.</span> <span class="nav-text">基本类型的JSON格式标准化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#日期和时间指南"><span class="nav-number">10.2.</span> <span class="nav-text">日期和时间指南</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建日期"><span class="nav-number">10.2.1.</span> <span class="nav-text">创建日期</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用日期"><span class="nav-number">10.2.2.</span> <span class="nav-text">使用日期</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#兼容日期"><span class="nav-number">10.2.3.</span> <span class="nav-text">兼容日期</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#日期和时间的JSON序列化"><span class="nav-number">10.3.</span> <span class="nav-text">日期和时间的JSON序列化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DateLiteral-格式"><span class="nav-number">10.3.1.</span> <span class="nav-text">DateLiteral 格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#日期格式的注释"><span class="nav-number">10.3.2.</span> <span class="nav-text">日期格式的注释</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#持续时间"><span class="nav-number">10.4.</span> <span class="nav-text">持续时间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#间隔"><span class="nav-number">10.5.</span> <span class="nav-text">间隔</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重复间隔"><span class="nav-number">10.6.</span> <span class="nav-text">重复间隔</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#版本"><span class="nav-number">11.</span> <span class="nav-text">版本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#版本格式"><span class="nav-number">11.1.</span> <span class="nav-text">版本格式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#组版本控制"><span class="nav-number">11.1.1.</span> <span class="nav-text">组版本控制</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#版本时间"><span class="nav-number">11.2.</span> <span class="nav-text">版本时间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重大变化的定义"><span class="nav-number">11.3.</span> <span class="nav-text">重大变化的定义</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#长时间运行的操作"><span class="nav-number">12.</span> <span class="nav-text">长时间运行的操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基于资源的长时间运行（RELO）"><span class="nav-number">12.1.</span> <span class="nav-text">基于资源的长时间运行（RELO）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分步运行长时运行"><span class="nav-number">12.2.</span> <span class="nav-text">分步运行长时运行</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PUT"><span class="nav-number">12.2.1.</span> <span class="nav-text">PUT</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#POST-1"><span class="nav-number">12.2.2.</span> <span class="nav-text">POST</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#POST-混合模式"><span class="nav-number">12.2.3.</span> <span class="nav-text">POST, 混合模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#运作资源"><span class="nav-number">12.2.4.</span> <span class="nav-text">运作资源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#运作资源-1"><span class="nav-number">12.2.5.</span> <span class="nav-text">运作资源</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#完成百分比"><span class="nav-number">12.2.5.1.</span> <span class="nav-text">完成百分比</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#目标资源位置"><span class="nav-number">12.2.5.2.</span> <span class="nav-text">目标资源位置</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#操作终止"><span class="nav-number">12.2.6.</span> <span class="nav-text">操作终止</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#典型流程：轮询"><span class="nav-number">12.2.7.</span> <span class="nav-text">典型流程：轮询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#典型流程：推送通知"><span class="nav-number">12.2.8.</span> <span class="nav-text">典型流程：推送通知</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#重试机制"><span class="nav-number">12.2.9.</span> <span class="nav-text">重试机制</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#操作结果保留策略"><span class="nav-number">12.3.</span> <span class="nav-text">操作结果保留策略</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#节流、配额、限制"><span class="nav-number">13.</span> <span class="nav-text">节流、配额、限制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#原则"><span class="nav-number">13.1.</span> <span class="nav-text">原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#返回值（429-vs-503）"><span class="nav-number">13.2.</span> <span class="nav-text">返回值（429 vs 503）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重试机制和-RateLimit-头"><span class="nav-number">13.3.</span> <span class="nav-text">重试机制和 RateLimit 头</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#服务端指南"><span class="nav-number">13.4.</span> <span class="nav-text">服务端指南</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#响应性"><span class="nav-number">13.4.1.</span> <span class="nav-text">响应性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#速率配置和限额"><span class="nav-number">13.4.2.</span> <span class="nav-text">速率配置和限额</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#服务负载"><span class="nav-number">13.4.3.</span> <span class="nav-text">服务负载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#响应实例"><span class="nav-number">13.4.4.</span> <span class="nav-text">响应实例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#调用者指南"><span class="nav-number">13.5.</span> <span class="nav-text">调用者指南</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#处理忽略了重试机制的Header头的调用者"><span class="nav-number">13.6.</span> <span class="nav-text">处理忽略了重试机制的Header头的调用者</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通过webhooks推送通知"><span class="nav-number">14.</span> <span class="nav-text">通过webhooks推送通知</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#范围"><span class="nav-number">14.1.</span> <span class="nav-text">范围</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#原则-1"><span class="nav-number">14.2.</span> <span class="nav-text">原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#订阅类型"><span class="nav-number">14.3.</span> <span class="nav-text">订阅类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#调用顺序"><span class="nav-number">14.4.</span> <span class="nav-text">调用顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#验证订阅"><span class="nav-number">14.5.</span> <span class="nav-text">验证订阅</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#接收通知"><span class="nav-number">14.6.</span> <span class="nav-text">接收通知</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#通知有效负载"><span class="nav-number">14.6.1.</span> <span class="nav-text">通知有效负载</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#订阅管理"><span class="nav-number">14.7.</span> <span class="nav-text">订阅管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建订阅"><span class="nav-number">14.7.1.</span> <span class="nav-text">创建订阅</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#更新订阅"><span class="nav-number">14.7.2.</span> <span class="nav-text">更新订阅</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#删除订阅"><span class="nav-number">14.7.3.</span> <span class="nav-text">删除订阅</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#枚举订阅"><span class="nav-number">14.7.4.</span> <span class="nav-text">枚举订阅</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安全"><span class="nav-number">14.8.</span> <span class="nav-text">安全</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不支持的请求"><span class="nav-number">15.</span> <span class="nav-text">不支持的请求</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本指南"><span class="nav-number">15.1.</span> <span class="nav-text">基本指南</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#功能允许列表"><span class="nav-number">15.2.</span> <span class="nav-text">功能允许列表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#错误返回值"><span class="nav-number">15.2.1.</span> <span class="nav-text">错误返回值</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#命名指南"><span class="nav-number">16.</span> <span class="nav-text">命名指南</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#途径"><span class="nav-number">16.1.</span> <span class="nav-text">途径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#框架"><span class="nav-number">16.2.</span> <span class="nav-text">框架</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#需避免的命名"><span class="nav-number">16.3.</span> <span class="nav-text">需避免的命名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#规范的复合词"><span class="nav-number">16.4.</span> <span class="nav-text">规范的复合词</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#标识属性"><span class="nav-number">16.5.</span> <span class="nav-text">标识属性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#日期和时间属性"><span class="nav-number">16.5.1.</span> <span class="nav-text">日期和时间属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#名称属性"><span class="nav-number">16.5.2.</span> <span class="nav-text">名称属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#集合和计数"><span class="nav-number">16.5.3.</span> <span class="nav-text">集合和计数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#通用属性命名"><span class="nav-number">16.5.4.</span> <span class="nav-text">通用属性命名</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">gtang94</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
